!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.gx=t()}(this,function(){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var i=(function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}(e,[{key:"init2dScreen",value:function(e,t){var n=this.g3d,a=this.dm2d=new ht.DataModel,i=this.g2d=new ht.graph.GraphView(a),o=i.getView();if(o.style.left="0",o.style.right="0",o.style.top="0",o.style.bottom="0",i.getSelectWidth=function(){return 0},i.handleScroll=function(){},i.handlePinch=function(){},i.setPannable(!1),i.setRectSelectable(!1),i.setScrollBarVisible(!1),i.setMovableFunc(function(){return!1}),n?n.getView().appendChild(i.getView()):document.body.appendChild(i.getView()),e){var r=e.downListener,s=e.moveListener,l=e.upListener,d=e.wheelListener,u=e.commonListener;u&&(this.commonListener=u,o.addEventListener("mousedown",this.commonListener.bind(this,i)),o.addEventListener("mousemove",this.commonListener.bind(this,i)),o.addEventListener("mouseup",this.commonListener.bind(this,i)),o.addEventListener("touchstart",this.commonListener.bind(this,i)),o.addEventListener("touchmove",this.commonListener.bind(this,i)),o.addEventListener("touchend",this.commonListener.bind(this,i))),r&&(this.downListener=r,o.addEventListener("mousedown",this.downListener.bind(this,i)),o.addEventListener("touchstart",this.downListener.bind(this,i))),s&&(this.moveListener=s,o.addEventListener("mousemove",this.moveListener.bind(this,i)),o.addEventListener("touchmove",this.moveListener.bind(this,i))),l&&(this.upListener=l,o.addEventListener("mouseup",this.upListener.bind(this,i)),o.addEventListener("touchend",this.upListener.bind(this,i))),d&&(this.wheelListener=d,o.addEventListener("mousewheel",this.wheelListener.bind(this,i)))}this.g2dResizeListener=function(e){i.fitContent(!1,0),i.iv()},window.addEventListener("resize",this.g2dResizeListener),"function"==typeof t&&t(i,a)}},{key:"init3dScreen",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.body,t=arguments[1],n=this.dm3d=new ht.DataModel,a=this.g3d=new ht.graph3d.Graph3dView(n),i=a.getView(),o=i.style;o.left="0",o.right="0",o.top="0",o.bottom="0",e.appendChild(i),this.g3dResizeListener=function(e){a.iv()},window.addEventListener("resize",this.g3dResizeListener),"function"==typeof t&&t(a,n)}},{key:"load2dScreen",value:function(e,t,n){var a=this.dm2d,i=this.g2d;if(a.clear(),"function"==typeof t&&t(i,a),"string"==typeof e)ht.Default.xhrLoad(e,function(e){e?(a.deserialize(e),"function"==typeof n&&n(i,a)):console.log("资源加载失败")});else if(e instanceof ht.Data){var o=e;e=null,a.add(o),this.addNodeChilds(o,a),"function"==typeof n&&n(i,a)}}},{key:"load3dScreen",value:function(e,t,l){var d=this,u=this.dm3d,c=this.g3d;if(u.clear(),"function"==typeof t&&t(c,u),"string"==typeof e)ht.Default.xhrLoad(e,function(e){if(e){u.deserialize(e);var t=ht.Default.parse(e),n=ht.Default.clone(t.a),a=d.defaultScene=t.scene;if(c.isOrtho()){var i=window.htBuildConfig,o=i.eye,r=i.center,s=i.orthoWidth;c.setOrthoWidth(ht.Default.isTouchable?s.mb:s.pc),c.setEye(ht.Default.isTouchable?o.mb:o.pc),c.setCenter(ht.Default.isTouchable?r.mb:r.pc)}else c.setEye(a.eye),c.setCenter(a.center);c.setFar(a.far),c.setNear(a.near),"function"==typeof l&&l(c,u,n)}else console.log("资源加载失败")});else if(e instanceof ht.Data){var n=e;e=null,u.add(n),this.addNodeChilds(n,u),"function"==typeof l&&l(c,u)}}},{key:"reset2dEvent",value:function(e){var t=e.miListener,n=e.umiListener,a=e.mpListener,i=e.umpListener,o=e.scope;t&&this.add2dMiEvent(t,o),n&&this.remove2dMiEvent(n,o),a&&this.add2dMpEvent(a,o),i&&this.remove2dMpEvent(i,o)}},{key:"reset3dEvent",value:function(e){var t=e.miListener,n=e.umiListener,a=e.mpListener,i=e.umpListener,o=e.scope;t&&this.add3dMiEvent(t,o),n&&this.remove3dMiEvent(n,o),a&&this.add3dMpEvent(a,o),i&&this.remove3dMpEvent(i,o)}},{key:"add2dMiEvent",value:function(e,t){var n=this.g2d,a=this.mi2dEventInfo;if(a){var i=a.listener,o=a.listenerScope;this.remove2dMiEvent(i,o)}this.mi2dEventInfo={listener:e,listenerScope:t},e&&n.mi(e,t)}},{key:"remove2dMiEvent",value:function(e,t){var n=this.g2d;e&&n.umi(e,t)}},{key:"add3dMiEvent",value:function(e,t){var n=this.g3d,a=this.mi3dEventInfo;if(a){var i=a.listener,o=a.listenerScope;this.remove3dMiEvent(i,o)}this.mi3dEventInfo={listener:e,listenerScope:t},e&&n.mi(e,t)}},{key:"remove3dMiEvent",value:function(e,t){var n=this.g3d;e&&n.umi(e,t)}},{key:"add2dMpEvent",value:function(e,t){var n=this.g2d,a=this.mp2dEventInfo;if(a){var i=a.listener,o=a.listenerScope;this.remove2dMpEvent(i,o)}this.mp2dEventInfo={listener:e,listenerScope:t},e&&n.mp(e,t)}},{key:"remove2dMpEvent",value:function(e,t){var n=this.g2d;e&&n.ump(e,t)}},{key:"add3dMpEvent",value:function(e,t){var n=this.g3d,a=this.mp3dEventInfo;if(a){var i=a.listener,o=a.listenerScope;this.remove3dMpEvent(i,o)}this.mp3dEventInfo={listener:e,listenerScope:t},e&&n.mp(e,t)}},{key:"remove3dMpEvent",value:function(e,t){var n=this.g3d;e&&n.ump(e,t)}},{key:"remove2d",value:function(){var e=this.g2d,t=this.dm2d,n=this.g3d,a=e.getView();e&&(t.clear(),this.g2dResizeListener&&window.removeEventListener("resize",this.g2dResizeListener),this.commonListener&&(a.removeEventListener("mousedown",this.commonListener),a.removeEventListener("mousemove",this.commonListener),a.removeEventListener("mouseup",this.commonListener),a.removeEventListener("touchstart",this.commonListener),a.removeEventListener("touchmove",this.commonListener),a.removeEventListener("touchend",this.commonListener)),this.downListener&&(a.removeEventListener("mousedown",this.downListener),a.removeEventListener("touchstart",this.downListener)),this.moveListener&&(a.removeEventListener("mousemove",this.moveListener),a.removeEventListener("touchmove",this.moveListener)),this.upListener&&(a.removeEventListener("mouseup",this.upListener),a.removeEventListener("touchend",this.upListener)),this.wheelListener&&a.removeEventListener("mousewheel",this.wheelListener),this.mi2dEventInfo&&(this.mi2dEventInfo=null),this.mp2dEventInfo&&(this.mp2dEventInfo=null),n?n.getView().removeChild(e.getView()):document.body.removeChild(e.getView()))}},{key:"remove3d",value:function(e){this.remove2d(),this.mi3dEventInfo&&(this.mi3dEventInfo=null),this.mp3dEventInfo&&(this.mp3dEventInfo=null),this.g3dResizeListener&&window.removeEventListener("resize",this.g3dResizeListener);var t=this.g3d;this.dm3d.clear(),e.removeChild(t.getView())}},{key:"destory",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.body;this.remove3d(e)}},{key:"addNodeChilds",value:function(e,n){var a=this,t=e.getChildren();t&&0<t.size()&&t.each(function(e){n.add(e);var t=e.getChildren();t&&0<t.size()&&a.addNodeChilds(e,n)})}}]),e);function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var f={formatDate:function(e,t){var n=t;n=(n=n.replace(/yyyy|YYYY/,e.getFullYear())).replace(/yy|YY/,9<e.getYear()%100?(e.getYear()%100).toString():"0"+e.getYear()%100);var a=e.getMonth()+1;return n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=n.replace(/MM/,9<a?a.toString():"0"+a)).replace(/M/g,a)).replace(/w|W/g,["日","一","二","三","四","五","六"][e.getDay()])).replace(/dd|DD/,9<e.getDate()?e.getDate().toString():"0"+e.getDate())).replace(/d|D/g,e.getDate())).replace(/hh|HH/,9<e.getHours()?e.getHours().toString():"0"+e.getHours())).replace(/h|H/g,e.getHours())).replace(/mm/,9<e.getMinutes()?e.getMinutes().toString():"0"+e.getMinutes())).replace(/m/g,e.getMinutes())).replace(/ss|SS/,9<e.getSeconds()?e.getSeconds().toString():"0"+e.getSeconds())).replace(/s|S/g,e.getSeconds())},GetLunarDay:function(e,t,n){var r,s,l,a,d=new Array(100),u=new Array(12),i="正二三四五六七八九十冬腊";function c(e,t){return e>>t&1}return d=new Array(2635,333387,1701,1748,267701,694,2391,133423,1175,396438,3402,3749,331177,1453,694,201326,2350,465197,3221,3402,400202,2901,1386,267611,605,2349,137515,2709,464533,1738,2901,330421,1242,2651,199255,1323,529706,3733,1706,398762,2741,1206,267438,2647,1318,204070,3477,461653,1386,2413,330077,1197,2637,268877,3365,531109,2900,2922,398042,2395,1179,267415,2635,661067,1701,1748,398772,2742,2391,330031,1175,1611,200010,3749,527717,1452,2742,332397,2350,3222,268949,3402,3493,133973,1386,464219,605,2349,334123,2709,2890,267946,2773,592565,1210,2651,395863,1323,2707,265877),u[0]=0,u[1]=31,u[2]=59,u[3]=90,u[4]=120,u[5]=151,u[6]=181,u[7]=212,u[8]=243,u[9]=273,u[10]=304,u[11]=334,e<1921||2020<e?"":(function(){var e,t,n,a,i=!1,o=(l=3!=arguments.length?new Date:new Date(arguments[0],arguments[1],arguments[2])).getYear();for(o<1900&&(o+=1900),e=365*(o-1921)+Math.floor((o-1921)/4)+u[l.getMonth()]+l.getDate()-38,l.getYear()%4==0&&1<l.getMonth()&&e++,t=0;;t++){for(n=a=d[t]<4095?11:12;0<=n;n--){if(e<=29+c(d[t],n)){i=!0;break}e=e-29-c(d[t],n)}if(i)break}r=a-n+1,s=e,12==a&&(r==Math.floor(d[t]/65536)+1&&(r=1-r),r>Math.floor(d[t]/65536)+1&&r--)}(e,t=0<parseInt(t)?t-1:11,n),a="",r<1?(a+="(闰)",a+=i.charAt(-r-1)):a+=i.charAt(r-1),a+="月",a+=s<11?"初":s<20?"十":s<30?"廿":"三十",s%10==0&&10!=s||(a+="一二三四五六七八九十".charAt((s-1)%10)),a)},prefixInteger:function(e,t){return(Array(t).join(0)+e).slice(-t)},randomNumBetween:function(e,t){var n=t-e,a=Math.random();return e+Math.round(a*n)},getRandomValue:function(e,t,n){var a=null;return void 0!==n?(a=new RegExp("(\\d)(?=(?:\\d{"+n+"})+$)","g"),this.prefixInteger(this.randomNumBetween(e[0],e[1]),t).replace(a,"$1,")):this.prefixInteger(this.randomNumBetween(e[0],e[1]),t)},getRandomPointInCircle:function(e,t,n){var a=this.randomNumBetween(0,n),i=this.randomNumBetween(0,360);return{x:e+a*Math.sin(i),y:t+a*Math.cos(i)}},getNodeMat:function(e,t){return e.getData3dUI(t).validate(),e.getData3dUI(t).mat},toLocalPostion:function(e,t,n){var a=ht.Math.Matrix4,i=ht.Math.Vector3,o=(new a).fromArray(this.getNodeMat(e,t)),r=(new a).getInverse(o);return new i(n).applyMatrix4(r).toArray()}},z={getP3ByAnchor3d:function(e,t,n){var a=t.getAnchor3d(),i=n.x-a.x,o=n.z-a.z,r=i*t.getWidth(),s=o*t.getHeight(),l=t.p3();return f.toLocalPostion(e,t,[l[0]+r,l[1],l[2]+s])},addPanelByDevice:function(e,t,l,n){var a={lineSymbol:"symbols/3d-panel/alarm/left/line.json",symbolUrl:{alarm:"symbols/3d-panel/alarm/left/alarm.json"}},i={lineSymbol:"symbols/3d-panel/alarm/right/line.json",symbolUrl:{alarm:"symbols/3d-panel/alarm/right/alarm.json"}},d=new ht.Node;d.setAnchor3d({x:"right"===l?0:1,y:0,z:.5}),d.s({shape3d:"billboard","shape3d.image":"left"===l?a.symbolUrl[t]:i.symbolUrl[t],"shape3d.reverse.flip":!0,"shape3d.transparent":!0,"shape3d.vector.dynamic":!0,"shape3d.alwaysOnTop":!0,"select.brightness":1,interactive:!0,"3d.visible":!1,"3d.selectable":!0,"3d.movable":!1}),d.setSize3d([200,80,1]),d.setScaleX(n),d.setScaleTall(n);var u=new ht.Node;return u.setAnchor3d({x:"right"===l?0:1,y:0,z:.5}),u.s({shape3d:"billboard","shape3d.image":"left"===l?a.lineSymbol:i.lineSymbol,"shape3d.reverse.flip":!0,"shape3d.transparent":!0,"shape3d.vector.dynamic":!0,"shape3d.alwaysOnTop":!0,"3d.visible":!1,"3d.selectable":!1,"3d.movable":!1}),u.setSize3d([140,80,1]),u.setScaleTall(n),d.onPropertyChanged=function(e){var t=e.property,n=e.newValue;"s:3d.visible"===t&&u.s("3d.visible",n)},u.onPropertyChanged=function(e){var t=e.property,n=e.newValue;if("width"===t){var a=u.p3(),i="right"===l?1:-1;d.p3([a[0]+i*u.getWidth(),a[1],a[2]])}if("position"===t){var o=n.x,r=n.y,s="right"===l?1:-1;d.setPosition({x:o+s*u.getWidth(),y:r})}"elevation"===t&&d.setElevation(n)},d.setParent(u),e.add(u),e.add(d),d},getFloorByFloorId:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},a=n.isUp,i=n.isDown;"string"!=typeof e&&(e=e.a("info").ID);for(var o=0,r=t.length;o<r;o++){var s=t[o];if(s.a("info").ID==e)return a?t[o+1]:i?t[o-1]:s}return null},sortDm3dData:function(e,t){var d=e.getEye(),n=e.getCenter(),a=t.getDatas(),u={},c=e.isOrtho(),h=new ht.Math.Vector3(n).sub(new ht.Math.Vector3(d));a.forEach(function(e){e.getDisplayName();var t=e.getId(),n=e.p3(),a=Math.pow(n[0]-d[0],2),i=Math.pow(n[1]-d[1],2),o=Math.pow(n[2]-d[2],2),r=Math.sqrt(a+o),s=new ht.Math.Vector3(n).sub(new ht.Math.Vector3(d)),l=c?h.dot(s):Math.sqrt(a+i+o);u[t]={xzDistance:r,xyzDistance:l,data:e}}),a.sort(function(e,t){var n=u[e.getId()],a=n.xzDistance,i=n.xyzDistance,o=u[t.getId()],r=o.xzDistance,s=o.xyzDistance;return.5<Math.abs(r-a)?r-a:s-i})},setElevatorMoveRange:function(e,t){var n=[];e.forEach(function(e){var t=e.getTall()/2;n.push(e.getElevation()+t)}),t.forEach(function(e){e.a("floorElevationArray",n)})},setElevatorFloor:function(e,t){var n=e.a("startFloorNum"),a=e.a("endFloorNum"),i=e.a("floorElevationArray"),o=i.length-1;a&&Math.abs(e.getElevation()-i[a])>t||(a=(n=a||f.randomNumBetween(1,o),f.randomNumBetween(1,o)),e.a("startFloorNum",n),e.a("endFloorNum",a),e.setElevation(i[n]))},setNodesStatus:function(e,n){function t(e){if(void 0!==o&&e.s({"2d.visible":o,"3d.visible":o}),void 0!==r&&e.s({"2d.selectable":r,"3d.selectable":r}),i){var t=e.getChildren().toArray();t.length&&a.setNodesStatus(t,n)}}var a=this,i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],o=n.visible,r=n.selectable;e instanceof Array?e.forEach(function(e){t(e)}):t(e)},addAlarmNode:function(e){var t=e.dm3d,n=e.p3,a=e.attr,i=e.floorNum,o=a.equipmentCategoryShortName,r=new ht.Node,s=new ht.Node;return r.setRotationX(Math.PI/2),r.setSize3d([200,1,200]),r.setAnchor3d({x:.5,y:.5,z:.5}),r.s({"2d.movable":!1,"3d.movable":!1,"2d.selectable":!1,"3d.selectable":!1,"select.brightness":1,shape3d:"plane","shape3d.fixSizeOnScreen":!1,"shape3d.image":{smoked:"symbols/3d-alarm/alarm3.json"}[o]||"symbols/3d-alarm/alarm5.json","shape3d.opacity":1,"shape3d.reverse.flip":!0,"shape3d.transparent":!0,"shape3d.vector.dynamic":!1,interactive:!0}),r.p3(n),r.a(a),r.a("floorNum",i),s.setSize3d([60,60,60]),s.setAnchor3d({x:.5,y:.5,z:.5}),s.s({"2d.movable":!1,"2d.selectable":!1,"3d.movable":!1,"3d.selectable":!1,"all.color":"rgba(224,68,3,0.70)","all.reverse.cull":!0,"all.transparent":!0}),s.p3([n[0],n[1],n[2]-30]),r.setDisplayName("告警水波"),s.setParent(r),t.add(r),t.add(s),r},setFloorStatus:function(e,t,n){function a(e){e.s({"shape3d.color":t,"shape3d.top.color":t,"shape3d.bottom.color":t}),e.getChildren().toArray().forEach(function(e){e.s({"2d.visible":!1,"3d.visible":!1})})}n&&a(n),a(e)},restoreFloorStatus:function(e,t){function n(e){e.s({"shape3d.color":a,"shape3d.top.color":a,"shape3d.bottom.color":a}),e.getChildren().toArray().forEach(function(e){e.s({"2d.visible":!0,"3d.visible":!0})})}var a="rgba(255, 255, 255, 0.01)";t&&n(t),n(e)},layout2dPanel:function(r,e){for(var s=r.dm2d,t=r.settingPanel,l={},n=1;n<=e;n++)l[n]||(l[n]={}),l[n].mark=t.a("mark"+n),l[n].visible="symbols/2d-icon/open-btn2.json"===t.a("btn"+n);for(var a in l){var i=l[a].mark;r[i].setParent(void 0)}function o(e){var t=l[e],n=t.mark,a=t.visible,i=s.getDataByTag("panel"+e),o=r[n];o.setPosition(i.getPosition()),o.setParent(i),o.getChildren().each(function(e){e.s("2d.visible",a)}),i.s("2d.visible",a),i.a("isVisible",a)}for(var d in l)o(d)},showPanel:function(e,t,n,a,i){function o(){a&&a(),n.s("3d.visible",!0),e.preClickInfo={prePanel:n,preClickNode:t,preRestoreFunName:i}}var r=this,s=e.preClickInfo,l={"楼层地板":function(e,t){r.restoreFloorStatus(e)}};if(s){var d=s.prePanel,u=s.preClickNode,c=s.preRestoreFunName;d.s("3d.visible",!1),l[c]&&l[c](u,d),t!==u?o():e.preClickInfo=null}else o()}},h={oneWaterWaveAnimate:function(e,t){var n=t.rectAttrName,a=t.colorAttrName,i=t.initRect,o=t.maxHeight,r=e.a(n),s=0===e.a("alarmLevel")?"rgb(217,46,32)":"rgb(255,183,28)";if(r){var l=r[3]+7,d=r[1]-3.5,u=s.slice(4,s.length-1);l<o?(r[1]=d,r[3]=l,e.a(n,r),e.a(a,"rgba("+u+", "+(1-(l-i[3])/(o-i[3]))+")")):(e.a(n,i),e.a(a,"rgb("+u+")"))}else e.a(n,i)},waterWaveAction:function(t,e){var n=this;e.forEach(function(e){n.oneWaterWaveAnimate(t,e)})},breathLightAnimate:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.05,a=e.getChildren(),i=(e.s(t)||0)+(e.a("direction")||n);1<=i&&e.a("direction",-n),i<=0&&e.a("direction",n),a&&0<a.size()&&a.each(function(e){e.s("all.opacity",i)}),e.s(t,i)},elevatorAnimate:function(e,t){var n=e.a("floorElevationArray"),a=e.getElevation(),i=n[e.a("startFloorNum")],o=n[e.a("endFloorNum")],r=0;if(r=i<o?1:-1,Math.abs(a-o)>t){var s=a+r*t;e.setElevation(s)}},scrollAlarmTable:function(n){this.scrollAnimate&&this.scrollAnimate.stop();var e=n.a("ht.dataSource"),t=n.a("dataSource"),a=n.a("ht.tdHeight")||25,i=n.a("tableRowIndex"),o=t.slice(i,i+4),r=o.length;r<4?(o=o.concat(t.slice(0,4-r)),n.a("tableRowIndex",0)):n.a("tableRowIndex",i+4),e&&(o=o.concat(e));var s=4*a;n.a("ht.dataSource",o),n.a("ht.translateY",-s),this.scrollAnimate=ht.Default.startAnim({frames:80,interval:10,easing:function(e){return e},action:function(e,t){n.a("ht.translateY",s*e-s)}})}},p={getWireNode:function(e,t,n,a){var i=new ht.Shape;return i.s({"all.color":"rgba("+e+","+t+")","top.color":"rgba("+e+","+t+")","all.transparent":!0,"all.reverse.cull":!0,"all.reverse.flip":!0,"left.visible":!1,"right.visible":!1,"2d.movable":!1,"3d.movable":!1,"2d.selectable":!1,"3d.selectable":!1}),i.setTall(n),i.setThickness(a),i.setAnchor3d([.5,.5,.5]),i},getFloorNode:function(e){var t=new ht.Shape;return t.s({"shape3d.color":"rgba(255, 255, 255, 0.01)","shape3d.top.color":"rgba(255, 255, 255, 0.01)","shape3d.bottom.color":"rgba(255, 255, 255, 0.01)","shape3d.transparent":!0,"shape3d.reverse.flip":!0,"shape3d.reverse.cull":!0,"select.brightness":1,"2d.movable":!1,"3d.movable":!1}),t.setTall(e),t.setThickness(-1),t.setAnchor3d([.5,.5,.5]),t.setScaleX(.98),t.setScaleY(.98),t},setDecStatus:function(e,t,n){var a=ht.Math.Vector3,i=ht.Math.Matrix4,o=ht.Math.Euler,r=new a(n[0]),s=new a(n[1]),l=new a(n[2]);t.p3(r.toArray()),t.lookAtX(s.clone().sub(r).cross(l.clone().sub(r)),"top");var d=new o(t.r3(),t.getRotationMode(),!0),u=new i,c=new i;u.makeRotationFromEuler(d),c.getInverse(u);for(var h=[],f=0,v=n.length;f<v;f++){var m=new a(n[f]).applyMatrix4(c);h.push({x:m.x,y:m.z})}var g=new a(n[0]).applyMatrix4(c);h.push({x:g.x,y:g.z}),t.setPoints(h);var p=e.getData3dUI(t);p.validate(),u.fromArray(p.mat);var y=t.getPoints().get(0),b=r.clone().sub(new a(y.x,t.getElevation(),y.y).applyMatrix4(u)),w=t.p3();t.p3(w[0]+b.x,w[1]+b.y,w[2]+b.z)},getDecNode:function(){var e=new ht.Shape;return e.s({"shape3d.color":"rgb(3, 50, 109)","shape3d.transparent":!0,"shape3d.opacity":.4,"shape3d.reverse.flip":!0,"shape3d.reverse.cull":!0,"2d.movable":!1,"3d.movable":!1,"2d.selectable":!1,"3d.selectable":!1}),e.setThickness(-1),e.setTall(.1),e.setAnchor3d([.5,.5,.5]),e.setDisplayName("装饰多边形"),e},getDecBorderNode:function(){var e=new ht.Shape;return e.s({"all.color":"rgb(66, 180, 218)","all.transparent":!0,"all.opacity":.4,"all.reverse.flip":!0,"all.reverse.cull":!0,"2d.movable":!1,"3d.movable":!1,"2d.selectable":!1,"3d.selectable":!1}),e.setThickness(.3),e.setTall(.1),e.setAnchor3d([.5,.5,.5]),e.setDisplayName("装饰多边形框"),e},pointTransform:function(e,t,n){var a=ht.Math.Vector3,i=ht.Math.Matrix4,o=e.getData3dUI(t),r=new i;return o.validate(),r.fromArray(o.mat),new a(n.x,t.getElevation(),n.y).applyMatrix4(r)},getNodeMat:function(e,t){return e.getData3dUI(t).validate(),e.getData3dUI(t).mat},toLocalPostion:function(e,t,n){var a=ht.Math.Matrix4,i=ht.Math.Vector3,o=(new a).fromArray(this.getNodeMat(e,t)),r=(new a).getInverse(o);return new i(n).applyMatrix4(r).toArray()},setNodeAnchor3d:function(e,t,n){var a=t.p3(),i=this.toLocalPostion(e,t,[n.x,t.getElevation(),n.z]),o=i[0]-a[0],r=i[2]-a[2],s=o/t.getWidth(),l=r/t.getHeight(),d=t.getAnchor3d();t.setAnchor3d({x:d.x+s,y:d.y,z:d.z+l},!0)},makeBuilding:function(o,t,n,s,e,r){function l(e,t,n){var a=function(e,t,n){var a=d.getWireNode(f(n),v(n),g(n),y(n));return a.setPoints(e),a.setSegments(E),a.setElevation(t),a}(e,t,n);h.add(a);var i=function(e,t,n){var a=d.getFloorNode(g(n));return a.setPoints(e),a.setSegments(E),a.setElevation(t),a}(e,t,n);h.add(i),r&&(d.setNodeAnchor3d(o,a,r),d.setNodeAnchor3d(o,i,r)),a.setParent(i),w(n,i,a)}var d=this,u=[],c=[],h=o.dm(),a=e.getColor,f=void 0===a?function(){return"222,222,222"}:a,i=e.getOpacity,v=void 0===i?function(){return 1}:i,m=e.getTall,g=void 0===m?function(){return 1}:m,p=e.getThickness,y=void 0===p?function(){return.5}:p,b=e.floorCall,w=void 0===b?function(){}:b,k=ht.Math.Vector3,N=t.getPoints().length,E=t.getSegments();if(t.getPoints().each(function(e){u.push(d.pointTransform(o,t,e))}),n.getPoints().each(function(e){c.push(d.pointTransform(o,n,e))}),1===s){var S=[],D=u[0].y;u.forEach(function(e){S.push({x:e.x,y:e.z})}),l(S,D,1)}else for(var P=function(e){for(var t=e/(s-1),n=[],a=0;a<N;a++){var i=new k;i.lerpVectors(u[a],c[a],t),n.push(i)}var o=[],r=n[0].y;n.forEach(function(e){o.push({x:e.x,y:e.z})}),l(o,r,e+1)},L=0;L<s;L++)P(L)},makeDecShape:function(s,t,n,l,e){var d=this,a=e.faceCall,u=void 0===a?function(){}:a,c=[],h=[],f=s.dm();t.getPoints().forEach(function(e){c.push(d.pointTransform(s,t,e))}),n.getPoints().forEach(function(e){h.push(d.pointTransform(s,n,e))});function i(e){var t=l[e],n=t.first,a=t.last,i=d.getDecNode(),o=d.getDecBorderNode(),r=[];n.forEach(function(e){r.push(c[e])}),a.forEach(function(e){r.push(h[e])}),d.setDecStatus(s,i,r),d.setDecStatus(s,o,r),i.a("worldPoint",r),o.a("worldPoint",r),u(e,i,o),f.add(i),f.add(o)}for(var o in l)i(o)}};var u=function(e,t){if("office"===e){if(0<=t&&t<250)return{color:"rgb(0, 180, 81)",level:5};if(250<=t&&t<500)return{color:"rgb(115, 204, 52)",level:4};if(500<=t&&t<750)return{color:"rgb(66, 180, 218)",level:3};if(750<=t&&t<1e3)return{color:"rgb(255, 183, 27)",level:2};if(1e3<=t)return{color:"rgb(224, 68, 3)",level:1}}if("business"===e){if(0<=t&&t<500)return{color:"rgb(0, 180, 81)",level:5};if(500<=t&&t<1e3)return{color:"rgb(115, 204, 52)",level:4};if(1e3<=t&&t<1500)return{color:"rgb(66, 180, 218)",level:3};if(1500<=t&&t<2e3)return{color:"rgb(255, 183, 27)",level:2};if(2e3<=t)return{color:"rgb(224, 68, 3)",level:1}}if("basement"===e){if(0<=t&&t<50)return{color:"rgb(0, 180, 81)",level:5};if(50<=t&&t<100)return{color:"rgb(115, 204, 52)",level:4};if(100<=t&&t<150)return{color:"rgb(66, 180, 218)",level:3};if(150<=t&&t<200)return{color:"rgb(255, 183, 27)",level:2};if(200<=t)return{color:"rgb(224, 68, 3)",level:1}}},l=function(e){return 0<=e&&e<=50?"rgb(1, 142, 91)":51<=e&&e<=100?"rgb(255, 216, 45)":101<=e&&e<=150?"rgb(255, 142, 45)":151<=e&&e<=200?"rgb(197, 16, 45)":201<=e&&e<=300?"rgb(91, 4, 142)":301<=e?"rgb(115, 6, 32)":void 0};function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=(function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}(s,[{key:"getWeather",value:function(t){this.sendAjax(this.methodGetSettings("weather",{siteId:this.siteId}),function(e){"function"==typeof t&&t(e)},function(e){console.error(e)})}},{key:"getWorkOrder",value:function(t){this.sendAjax(this.methodGetSettings("workOrder",{siteId:this.siteId}),function(e){"function"==typeof t&&t(e)},function(e){console.error(e)})}},{key:"getVisitors",value:function(t){this.sendAjax(this.methodGetSettings("visitors",{siteId:this.siteId}),function(e){"function"==typeof t&&t(e)},function(e){console.error(e)})}},{key:"getInsidePassengers",value:function(t){this.sendAjax(this.methodGetSettings("insidePassengers",{siteId:this.siteId}),function(e){"function"==typeof t&&t(e)},function(e){console.error(e)})}},{key:"getParkingPlaceStatus",value:function(t){this.sendAjax(this.methodGetSettings("parkingPlaceStatus",{siteId:this.siteId}),function(e){"function"==typeof t&&t(e)},function(e){console.error(e)})}},{key:"getEmergencyAlarm",value:function(t){this.sendAjax(this.methodGetSettings("emergencyAlarm",{siteId:this.siteId}),function(e){"function"==typeof t&&t(e)},function(e){console.error(e)})}},{key:"getFloorPassengers",value:function(e,t){this.sendAjax(this.methodGetSettings("floorPassengers",{floorId:e}),function(e){"function"==typeof t&&t(e)},function(e){console.error(e)})}},{key:"getEquipmentAlarm",value:function(t){this.sendAjax(this.methodGetSettings("equipmentAlarm",{siteId:this.siteId}),function(e){"function"==typeof t&&t(e)},function(e){console.error(e)})}},{key:"methodGetSettings",value:function(e,t){var n=this.baseurl,a=this.ajax[e],i=a.url,o=a.method;if(t)for(var r in t)i=i.replace("{"+r+"}",t[r]);return{url:window.buildUrl.debug?n+"/console/dashboard"+i+".json":n+"/console/dashboard"+i,method:o,headers:window.buildUrl.headers}}},{key:"sendAjax",value:function(e,t,n){var a=e.method,i=e.url,o=e.headers,r=e.body,s=new XMLHttpRequest;for(var l in s.open(a,i),o)s.setRequestHeader(l,o[l]);s.onreadystatechange=function(){4===s.readyState&&(200<=s.status&&s.status<400?"function"==typeof t&&t(JSON.parse(s.responseText)):"function"==typeof n&&n(s.status))},s.send(r)}},{key:"destory",value:function(){this.ajax=null,this.baseurl=null,this.siteId=null}}]),s);function s(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var e=window.buildUrl,t=e.baseurl,n=e.siteId,a=e.ajax;this.baseurl=t,this.siteId=n,this.ajax=a}function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var v=(function(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),e}(c,[{key:"initBuildSpaceId",value:function(e){var t=this.build,n=t.basement,a=t.business,i=t.office,o=(e.ID,e.Building),r=o[0].Floor,s=o[1].Floor,l=o[2].Floor;n.floorNodes.forEach(function(e,t){e.a("info",r[t])}),a.floorNodes.forEach(function(e,t){e.a("info",s[t])}),i.floorNodes.forEach(function(e,t){e.a("info",l[t])})}},{key:"initFloorPassengers",value:function(o,r){var s=this.build,l=o.a("floorNum"),d=o.a("floorType"),e=o.a("info").ID;window.buildUrl.debug&&(e=f.randomNumBetween(0,1)),r.s("shape3d.image","symbols/3d-icon/loading.json"),r.a("isLoading",!0),r.p3(z.getP3ByAnchor3d(s.g3d,o,o.a("panelAnchor")?o.a("panelAnchor"):{x:0,y:.5,z:1})),this.dataSource.getFloorPassengers(e,function(e){if(!s.preClickInfo||s.preClickInfo.preClickNode===o){r.s("shape3d.image","symbols/3d-panel/build-panel/mr-build-panel.json"),r.a("isLoading",!1);var t=(e||{}).totalPassengers,n=u(d,t=t||0),a=n.color,i=n.level;r.s("state","level"+i),r.a({floorNum:l,totalPassengers:t}),z.setFloorStatus(o,a)}}),z.showPanel(s,o,r,null,"楼层地板")}},{key:"initWeather",value:function(){var s=this.build.weatherPanel;this.dataSource.getWeather(function(e){var t=e.data||{},n=t.temperature,a=t.temperature1,i=t.city,o=t.pm25Des,r=t.pm25;s.a({temperature:n,temperature1:a,city:i,pm25Des:o,pm25:r,pm25Color:l(r)})})}},{key:"initWorkOrder",value:function(){var l=this.build.panel1;this.dataSource.getWorkOrder(function(e){var t=e.data||{},n=t.today,a=t.week,i=n||{},o=i.totalWork,r=i.unhandled,s=[];a instanceof Array&&0<a.length&&a.forEach(function(e,t){e.timePoint;var n=e.totalWork;s.push(n),s.push(0)}),o=o||0,r=r||0,l.a({"chart.values":s,totalWork:o,unhandled:r})})}},{key:"initVisitors",value:function(){var f=this.build.panel2;this.dataSource.getVisitors(function(e){var t=e.data||{},n=t.dayVisitors,a=t.syncRatio,i=t.temporary,o=t.unsuccessful,r=t.dayPeak;if(r instanceof Array&&0<r.length){var s=r[0],l=s.begin,d=s.end,u=r[1],c=u.begin,h=u.end;f.a({begin1:l,end1:d,begin2:c,end2:h})}n=n||0,a=a||0,i=i||0,o=o||0,f.a({dayVisitors:n,syncRatio:a,temporary:i,unsuccessful:o,syncRatioColor:0<a?"rgb(212, 0, 0)":"rgb(111, 212, 74)",upShapeVisible:0<a,downShapeVisible:a<=0})})}},{key:"initInsidePassengers",value:function(){var i=this.build.bottomPanel;this.dataSource.getInsidePassengers(function(e){var t=e||{},n=t.totalEmployees,a=t.totalVisitors;n=n||0,a=a||0,i.a({totalEmployees:n,totalVisitors:a})})}},{key:"initParkingPlaceStatus",value:function(){var i=this.build.bottomPanel;this.dataSource.getParkingPlaceStatus(function(e){var t=e||{},n=t.totalParkingPlace,a=t.emptyParkingPlace;n=n||0,a=a||0,i.a({totalParkingPlace:n,emptyParkingPlace:a})})}},{key:"initTime",value:function(){var e=this.build.timePanel,t=new Date,n=f.formatDate(t,"yyyy"),a=f.formatDate(t,"MM"),i=f.formatDate(t,"dd"),o=f.formatDate(t,"周w"),r=f.formatDate(new Date,"hh: mm"),s=f.GetLunarDay(t.getFullYear(),t.getMonth()+1,t.getDate());e.a({year:n,month:a,day:i,week:o,time:r,lunarDay:s})}},{key:"initEquipmentAlarm",value:function(){function n(e){var t=e.alarms;if(0<t.length){for(var n=t.length-1;0<=n;n--)l.remove(t[n]);t.length=0}}var e=this.build,a=e.g3d,l=e.dm3d,d=e.basement,u=e.business,c=e.office,h=e.all;this.dataSource.getEquipmentAlarm(function(e){var t=e.data||[];h.alarms.length=0,n(d),n(u),n(c),t instanceof Array&&0<t.length&&(t.forEach(function(e){var t=e.floorId,n=z.getFloorByFloorId(t,h.floorNodes);if(n){var a=n.p3(),i=n.a("floorNum"),o=n.a("floorType"),r=f.getRandomPointInCircle(a[0],a[2],n.getWidth()/4),s=z.addAlarmNode({dm3d:l,floorNum:i,floorType:o,attr:e,p3:[r.x,a[1],r.y]});"basement"===o&&d.alarms.push(s),"business"===o&&u.alarms.push(s),"office"===o&&c.alarms.push(s),h.alarms.push(s)}}),z.sortDm3dData(a,l))})}},{key:"initEmergencyAlarm",value:function(){var u=this.build.bottomPanel,c=[];this.dataSource.getEmergencyAlarm(function(e){var t=e.data||[];if(t instanceof Array&&0<t.length){for(var n=0,a=t.length;n<a;n++){var i=t[n],o=i.type,r=i.latestTime,s=i.buildingName,l=i.spaceName,d=i.faultName;c.push({time:r,alarmDetail:s+" "+l,name:d,type:o})}u.a("dataSource",c),u.a("tableRowIndex",0),h.scrollAlarmTable(u)}})}},{key:"refreshNormalData",value:function(){this.initWeather(),this.initWorkOrder(),this.initVisitors(),this.initInsidePassengers(),this.initParkingPlaceStatus()}},{key:"refreshAlarmData",value:function(){this.initEmergencyAlarm()}},{key:"destory",value:function(){clearInterval(this.normalRefreshInterval),clearInterval(this.alarmRefreshInterval),clearInterval(this.timeInterval),clearInterval(this.emergencyAlarmInterval),z.scrollAnimate&&(z.scrollAnimate=null),this.build=null,this.dataSource.destory(),this.dataSource=null}}]),c);function c(){var n=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),!ht.Default.isEmptyObject(window.gx.build)){var e=window.buildUrl,t=e.dimensionInfo,a=e.normalRefreshTime,i=e.alarmRefreshTime,o=e.emergencyAlarmRefreshTime;this.dataSource=new r,this.build=window.gx.build,this.initBuildSpaceId(t),this.initTime(),this.refreshNormalData(),this.refreshAlarmData(),this.normalRefreshInterval=setInterval(function(){n.refreshNormalData()},a),this.alarmRefreshInterval=setInterval(function(){n.refreshAlarmData()},i),this.timeInterval=setInterval(function(){n.initTime()},6e4),this.emergencyAlarmInterval=setInterval(function(){var e=n.build.bottomPanel,t=e.a("dataSource");t instanceof Array&&4<t.length&&h.scrollAlarmTable(e)},o)}}function m(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var b=["zj","dt","ft","jb","kl"],n=(function(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),e}(t,[{key:"loadScreen",value:function(n){var a=this;Object.assign(this,{g3d:n.g3d,dm3d:n.dm3d,g2d:n.g2d,dm2d:n.dm2d});var e=this.g3d,t=window.htBuildConfig.screen,i=t.pc2d,o=t.pc3d,r=window.buildUrl.dirBasePath;e.setOrtho(!0),n.load3dScreen(r+"/"+o,null,function(e,t){a.init3dNodes(),n.add3dMiEvent(a.mi3dEvent,a),n.add3dMpEvent(a.mp3dEvent,a),a.notifier.fire({kind:"buildLoaded"})}),n.load2dScreen(r+"/"+i,null,function(e,t){a.init2dNodes(),n.add2dMiEvent(a.mi2dEvent,a),a.notifier.fire({kind:"buildLoaded"})})}},{key:"destory",value:function(){var e=this.dm3d;this.player=null,this.basement=null,this.business=null,this.office=null,this.all=null,this.floorPanel=null,this.panel1=null,this.panel2=null,this.panel3=null,this.panel4=null,this.panel5=null,this.panel6=null,this.weatherPanel=null,this.timePanel=null,this.bottomPanel=null,this.settingPanel=null,this.preClickInfo=null,this.task3d&&(e.removeScheduleTask(this.task3d),this.task3d=null),this.randomElevatorFloorInterval&&(clearInterval(this.randomElevatorFloorInterval),this.randomElevatorFloorInterval=null),this.weatherTimeChangeInterval&&(clearInterval(this.weatherTimeChangeInterval),this.weatherTimeChangeInterval=null),this.buildFill&&(this.buildFill.destory(),this.buildFill=null)}},{key:"init2dNodes",value:function(){var n=this,e=this.g2d,t=this.dm2d,a=this.notifier;this.editBuildName="all",this.buildPanelStatus={all:{zj:!0,dt:!0,ft:!1,jb:!0,kl:!0},basement:{zj:!0,dt:!0,ft:!1,jb:!0,kl:!0},business:{zj:!0,dt:!0,ft:!1,jb:!0,kl:!0},office:{zj:!0,dt:!0,ft:!1,jb:!0,kl:!0}},t.each(function(e){var t=e.getDisplayName();"工单面板"===t&&(n.panel1=e).a("notifier",a),"客流量面板"===t&&(n.panel2=e).a("notifier",a),"消防报警面板"===t&&(n.panel3=e).a("notifier",a),"重点区域监控面板"===t&&(n.panel4=e).a("notifier",a),"车位统计面板"===t&&(n.panel5=e).a("notifier",a),"功能面板"===t&&(n.panel6=e).a("notifier",a),"天气面板"===t&&(n.weatherPanel=e),"时间面板"===t&&(n.timePanel=e),"底部面板"===t&&(n.bottomPanel=e),"设置面板"===t&&(n.settingPanel=e),"投屏"===t&&e.a("notifier",a),"左侧toggle"===t&&e.a("notifier",a),"右侧toggle"===t&&e.a("notifier",a)}),e.addPropertyChangeListener(function(e){"videoLayout"===e.property&&(n.player||(n.player=videojs("example-video"),n.player.play()))})}},{key:"init3dNodes",value:function(){var n=this,e=this.g3d,t=this.dm3d,u=this.basement={gates:[],gateBlinks:[],elevators:[],elevatorLines:[],floorNodes:[],escalators:[],alarms:[]},c=this.business={gates:[],gateBlinks:[],elevators:[],elevatorLines:[],floorNodes:[],escalators:[],alarms:[]},l=this.office={gates:[],gateBlinks:[],elevators:[],elevatorLines:[],floorNodes:[],escalators:[],alarms:[]},h=this.all={gates:[],gateBlinks:[],elevators:[],elevatorLines:[],floorNodes:[],escalators:[],alarms:[]},d=[],f=[];this.makeBuilding(),t.each(function(e){var t=e.getDisplayName();"地-商-办"===t&&e.getChildren().each(function(e){var t=e.getDisplayName();if("电梯线集合"===t){var n,a,i,o,r=e.getChildren().toArray();(n=u.elevatorLines).push.apply(n,y(r)),(a=c.elevatorLines).push.apply(a,y(r)),(i=l.elevatorLines).push.apply(i,y(r)),(o=h.elevatorLines).push.apply(o,y(r))}if("电梯集合"===t){var s=e.getChildren().toArray();d.push.apply(d,y(s))}}),"地-商"===t&&e.getChildren().each(function(e){var t=e.getDisplayName();if("电梯线集合"===t){var n,a,i,o=e.getChildren().toArray();(n=u.elevatorLines).push.apply(n,y(o)),(a=c.elevatorLines).push.apply(a,y(o)),(i=h.elevatorLines).push.apply(i,y(o))}if("电梯集合"===t){var r,s,l,d=e.getChildren().toArray();(r=u.elevators).push.apply(r,y(d)),(s=c.elevators).push.apply(s,y(d)),(l=h.elevators).push.apply(l,y(d)),f.push.apply(f,y(d))}}),"商"===t&&e.getChildren().each(function(e){var t=e.getDisplayName();if("闸机集合"===t){var n,a,i=e.getChildren().toArray();(n=c.gates).push.apply(n,y(i)),(a=h.gates).push.apply(a,y(i))}if("扶梯集合"===t){var o,r,s=e.getChildren().toArray();(o=c.escalators).push.apply(o,y(s)),(r=h.escalators).push.apply(r,y(s))}}),"楼层面板"===t&&(n.floorPanel=e)}),h.floorNodes=u.floorNodes.concat(c.floorNodes,l.floorNodes),z.setElevatorMoveRange(h.floorNodes,d),z.setElevatorMoveRange(u.floorNodes.concat(c.floorNodes.slice(0,c.floorNodes.length-3)),f),z.sortDm3dData(e,t)}},{key:"mi2dEvent",value:function(e){var t=e.kind,n=e.data,a=(e.type,e.comp);if("clickData"===t){var i=n.getDisplayName(),o=this.notifier;if("设置"===i){var r=this.g2d,s=this.settingPanel;s.s("2d.visible",!r.isVisible(s))}if("还原"===i){var l=this.g3d,d=window.htBuildConfig,u=d.eye,c=d.center,h=d.orthoWidth;l.setOrthoWidth(ht.Default.isTouchable?h.mb:h.pc),l.setEye(ht.Default.isTouchable?u.mb:u.pc),l.setCenter(ht.Default.isTouchable?c.mb:c.pc)}"详情"===i&&o.fire({kind:"detail"}),"切换"===i&&o.fire({kind:"switch"}),"工单面板"===i&&o.fire({kind:"workSheetPanel"}),"客流量面板"===i&&o.fire({kind:"visitFlowPanel"}),"消防报警面板"===i&&o.fire({kind:"firePanel"}),"重点区域监控面板"===i&&o.fire({kind:"monitorPanel"}),"投屏"===i&&o.fire({kind:"screening"})}if("onDown"===t&&a){var f=a.displayName;if("还原"===f){for(var v=1;v<=6;v++){var m;this.settingPanel.a((g(m={},"btn"+v,void 0),g(m,"mark"+v,void 0),m))}z.layout2dPanel(this,6),n.s("2d.visible",!1)}"确认"===f&&(z.layout2dPanel(this,6),n.s("2d.visible",!1))}}},{key:"mi3dEvent",value:function(e){var t=e.kind,n=e.event,a=e.data,i=e.type,o=e.comp;if("clickBackground"===t)if(ht.Default.isLeftButton(n)){var r=this.preClickInfo,s=this.floorPanel,l=(r||{}).preClickNode;l&&"楼层地板"===l.getDisplayName()&&z.showPanel(this,l,s,null,"楼层地板"),this.g3d.setRotatable(!1)}else this.g3d.setRotatable(!0);if("clickData"===t){this.g3d.isRotatable()&&this.g3d.setRotatable(!1);var d=a.getDisplayName();if(d&&-1<d.indexOf("楼层地板")){var u=this.preClickInfo,c=this.floorPanel;(u||{}).preClickNode!==a?this.buildFill.initFloorPassengers(a,c):z.showPanel(this,a,c,null,"楼层地板")}}if("onDown"===t&&o){var h=o.displayName;if("删除"===h){var f=this.dm3d,v=this.preClickInfo;if(v){var m=v.prePanel,g=v.preClickNode;g===a&&z.showPanel(this,g,m)}f.remove(a)}if("警报图标"===h){var p=this.dm3d,y=this.alarmPanel;y||(y=this.alarmPanel=z.addPanelByDevice(p,"alarm","right",3));var b=y.getParent(),w=a.p3();b.p3(w),b.setSize({width:Math.abs(850-a.getX())}),z.showPanel(this,a,y)}if("floorUp"===h){var k=this.preClickInfo,N=this.editBuildName,E=this.floorPanel,S=this[N].floorNodes,D=z.getFloorByFloorId(k.preClickNode,S,{isUp:!0});this.buildFill.initFloorPassengers(D,E)}if("floorDown"===h){var P=this.preClickInfo,L=this.editBuildName,I=this.floorPanel,A=this[L].floorNodes,C=z.getFloorByFloorId(P.preClickNode,A,{isDown:!0});this.buildFill.initFloorPassengers(C,I)}}if("onEnter"===t&&"data"===i){var T=a.getDisplayName();if(T&&(-1<T.indexOf("告警水波")&&a.a("delete-icon-visible",!0),-1<T.indexOf("楼层地板"))){var x=this.dm3d.getDataByTag("buildFloorNum"),M=a.getChildAt(0);z.setNodesStatus(x,{visible:!0}),x.setElevation(a.getElevation()),x.a("floorNum",a.a("floorNum")),M&&x.a("floorNumColor",M.s("all.color"))}}if("onLeave"===t&&"data"===i){var B=a.getDisplayName();if(B&&(-1<B.indexOf("告警水波")&&a.a("delete-icon-visible",!1),-1<B.indexOf("楼层地板"))){var F=this.dm3d.getDataByTag("buildFloorNum");z.setNodesStatus(F,{visible:!1})}}"onEnter"===t&&"comp"===i&&"楼层号码"===o.displayName&&(this.g2d.getView().style.cursor="pointer"),"onLeave"===t&&"comp"===i&&"楼层号码"===o.displayName&&(this.g2d.getView().style.cursor="default")}},{key:"mp3dEvent",value:function(e){if("eye"===e.property){var t=this.g3d,n=this.dm3d;z.sortDm3dData(t,n)}}},{key:"makeBuilding",value:function(){var e=this.g3d,t=this.dm3d,a=this.basement,i=this.business,o=this.office,n=t.getDataByTag("first1"),r=t.getDataByTag("first2"),s=t.getDataByTag("last2"),l=t.getDataByTag("first3"),d=t.getDataByTag("last3"),u=t.getDataByTag("first4"),c=t.getDataByTag("last4"),h=t.getDataByTag("first5"),f=t.getDataByTag("last5"),v=t.getDataByTag("first6"),m=t.getDataByTag("last6"),g={x:476,z:439};p.makeBuilding(e,n,n,1,{getColor:function(e){return"53, 153, 219"},getOpacity:function(e){return.71},getTall:function(e){return 14},getThickness:function(e){return 6},floorCall:function(e,t,n){t.setDisplayName("楼层地板"),t.a("floorNum",["B4"][e-1]),t.a("floorType","basement"),a.floorNodes.push(t)}},g),p.makeBuilding(e,r,s,3,{getColor:function(e){return"53, 153, 219"},getOpacity:function(e){return.71},getTall:function(e){return 14},getThickness:function(e){return 6},floorCall:function(e,t,n){t.setDisplayName("楼层地板"),t.a("floorNum",["B3","B2","B1"][e-1]),1===e?(t.a("floorType","basement"),a.floorNodes.push(t)):(t.a("floorType","business"),i.floorNodes.push(t))}},g),p.makeBuilding(e,l,d,5,{getColor:function(e){return 1===e?"255, 184, 77":2<=e&&e<=4?"194, 133, 43":"209, 42, 145"},getOpacity:function(e){return 1===e?1:2<=e&&e<=4?.6:.85},getTall:function(e){return 14},getThickness:function(e){return 6},floorCall:function(e,t,n){t.setDisplayName("楼层地板"),t.a("floorNum",["1F","2F","3F","4F","5F"][e-1]),t.a("floorType","business"),i.floorNodes.push(t)}},g),p.makeBuilding(e,u,c,9,{getColor:function(e){return 1===e?"194, 133, 43":2===e?"255, 184, 77":"111, 166, 222"},getOpacity:function(e){return 1===e?.6:2===e?1:.58},getTall:function(e){return 14},getThickness:function(e){return 6},floorCall:function(e,t,n){t.setDisplayName("楼层地板"),t.a("floorNum",["6F","7F","8F","9F","10F","11F","12F","15F","16F"][e-1]),1===e||2===e?(t.a("floorType","business"),i.floorNodes.push(t)):(t.a("floorType","office"),o.floorNodes.push(t))}},g),p.makeBuilding(e,h,f,6,{getColor:function(e){return"53, 153, 219"},getOpacity:function(e){return.8},getTall:function(e){return 14},getThickness:function(e){return 6},floorCall:function(e,t,n){t.setDisplayName("楼层地板"),t.a("floorNum",["17F","18F","19F","20F","21F","22F"][e-1]),t.a("floorType","office"),o.floorNodes.push(t)}},g),p.makeBuilding(e,v,m,2,{getColor:function(e){return"49, 210, 235"},getOpacity:function(e){return.8},getTall:function(e){return 14},getThickness:function(e){return 6},floorCall:function(e,t,n){t.setDisplayName("楼层地板"),t.a("floorNum",["23F","25F"][e-1]),t.a("floorType","office"),o.floorNodes.push(t)}},g)}},{key:"showBuildByType",value:function(){var e=this.editBuildName,t=this.all,n=this.panel6,a=this.buildPanelStatus,i=this.preClickInfo,o=this[e],r=t.gates,s=t.gateBlinks,l=t.elevators,d=t.elevatorLines,u=t.floorNodes,c=t.escalators,h=t.alarms,f=o.floorNodes;if(i){var v=this.preClickInfo,m=v.prePanel,g=v.preClickNode;z.showPanel(this,g,m)}z.setNodesStatus(r.concat(s,l,d,u,c,h),{visible:!1}),z.setNodesStatus(f,{visible:!0});var p=a[e];for(var y in p)n.a(y+"-btn",p[y]?"symbols/2d-icon/open-btn.json":"symbols/2d-icon/close-btn.json"),this.executeBtnAction(y,p[y])}},{key:"executeBtnAction",value:function(e,t){function i(e,t){if(r){var n=r.prePanel,a=r.preClickNode;a.getDisplayName()===e&&z.showPanel(o,a,n,null,t)}}var o=this,n=this.editBuildName,r=this.preClickInfo,s=this[n],a={zj:{onOpen:function(){var e=s.gates,t=s.gateBlinks;z.setNodesStatus(e.concat(t),{visible:!0})},onClose:function(){var e=s.gates,t=s.gateBlinks;z.setNodesStatus(e.concat(t),{visible:!1}),i("闸机")}},dt:{onOpen:function(){var e=s.elevators,t=s.elevatorLines;z.setNodesStatus(e.concat(t),{visible:!0})},onClose:function(){var e=s.elevators,t=s.elevatorLines;z.setNodesStatus(e.concat(t),{visible:!1}),i("电梯")}},ft:{onOpen:function(){var e=s.escalators;z.setNodesStatus(e,{visible:!0})},onClose:function(){var e=s.escalators;z.setNodesStatus(e,{visible:!1}),i("扶梯")}},jb:{onOpen:function(){var e=s.alarms;z.setNodesStatus(e,{visible:!0})},onClose:function(){var e=s.alarms;z.setNodesStatus(e,{visible:!1}),i("告警水波")}},kl:{onOpen:function(){var e=s.gates,t=s.elevators,n=s.alarms,a=s.floorNodes;z.setNodesStatus(e.concat(t,n),{selectable:!1}),z.setNodesStatus(a,{selectable:!0},!1)},onClose:function(){var e=s.gates,t=s.elevators,n=s.alarms,a=s.floorNodes;z.setNodesStatus(e.concat(t,n),{selectable:!0},!1),z.setNodesStatus(a,{selectable:!1}),i("楼层地板","楼层地板")}}};t?a[e].onOpen():a[e].onClose()}},{key:"startAnimate",value:function(){function e(){r.forEach(function(e){z.setElevatorFloor(e,5)})}var t=this.g2d,n=this.dm3d,a=this.weatherPanel,i=this.timePanel,o=this.all,r=o.elevators;e(),this.randomElevatorFloorInterval=setInterval(function(){e()},1e3);var s=this.task3d={interval:100,action:function(e){if(-1<o.alarms.indexOf(e)&&h.waterWaveAction(e,[{rectAttrName:"warnRect1",colorAttrName:"borderColor1",initRect:[4,99,292,102],maxHeight:254},{rectAttrName:"warnRect2",colorAttrName:"borderColor2",initRect:[1.5,80,297,140],maxHeight:292}]),-1<r.indexOf(e)&&h.elevatorAnimate(e,5),e.a("isLoading")){var t=5*Math.PI,n=t/180,a=e.a("angle")||0;e.a("angle",(a+n)%(2*t))}}};n.addScheduleTask(s),this.weatherTimeChangeInterval=setInterval(function(){a.s("2d.visible",!t.isVisible(a)),i.s("2d.visible",!t.isVisible(i))},5e3)}}]),t);function t(e){var h=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.notifier=e,this.notifier.add(function(e){var t=e.kind,n=e.data,a=e.nextStatus;if(-1<b.indexOf(t)){var i=h.editBuildName,o=h.buildPanelStatus;i&&(o[i][t]=a,h.executeBtnAction(t,a))}if("changeEditBuild"===t){h.editBuildName={"全楼":"all","商   场":"business","办公楼":"office","停车场":"basement"}[n.a("editBuild1")],h.showBuildByType()}if("leftToggle"===t){var r=h.dm2d,s=[];["panel1","panel2","panel3"].forEach(function(e){var t=r.getDataByTag(e);if(t){var n=t.a("isVisible");(n||void 0===n)&&s.push(t)}}),z.setNodesStatus(s,{visible:"open"===a})}if("rightToggle"===t){var l=h.dm2d,d=[];["panel4","panel5","panel6"].forEach(function(e){var t=l.getDataByTag(e);if(t){var n=t.a("isVisible");(n||void 0===n)&&d.push(t)}}),z.setNodesStatus(d,{visible:"open"===a})}if("buildLoaded"===t){var u=h.dm2d,c=h.dm3d;0<u.size()&&0<c.size()&&(h.startAnimate(),h.buildFill=new v)}})}function w(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function k(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,k);var e=this.notifier=new ht.Notifier;this.build=new n(e),this.notifier.add(function(e){"loadBuildScreen"===e.kind&&t.build.loadScreen(t.screen)})}var N=new(function(e,t,n){return t&&w(e.prototype,t),n&&w(e,n),e}(k,[{key:"setScreenLang",value:function(e,n){var a=this;-1<["en","tw","zh"].indexOf(e)?ht.Default.loadJS([window.buildUrl.dirBasePath+"/js/locales/"+e+".js"],function(){var e=a.g2d,t=a.g3d;e&&e.redraw(),t&&t.iv(),"function"==typeof n&&n()}):console.warn("请传入正确的 language 枚举类型：en, tw, zh")}},{key:"loadScreen",value:function(t){var n=this;this.setScreenLang(window.buildUrl.defaultLang||"zh",function(){var e=n.screen=new i;e.init3dScreen(t),e.init2dScreen({commonListener:function(e,t){var n=e.getDataAt(t);n&&"video1"===n.getDisplayName()&&t.stopPropagation()}}),Object.assign(n,{g3d:e.g3d,dm3d:e.dm3d,g2d:e.g2d,dm2d:e.dm2d}),n.build.loadScreen(e)})}},{key:"removeScreen",value:function(e){this.build&&this.build.destory(),this.screen.destory(e),this.screen=null}}]),k);return function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&a.firstChild?a.insertBefore(i,a.firstChild):a.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}("",{}),N});
