!function(K,H,C){"use strict";function _(){this.el=[1,0,0,0,1,0,0,0,1]}function c(P){var c={};return{get:function(k){if(c[k]!==C)return c[k];var l;switch(k){case"WEBGL_depth_texture":l=P.getExtension("WEBGL_depth_texture")||P.getExtension("MOZ_WEBGL_depth_texture")||P.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":l=P.getExtension("EXT_texture_filter_anisotropic")||P.getExtension("MOZ_EXT_texture_filter_anisotropic")||P.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":l=P.getExtension("WEBGL_compressed_texture_s3tc")||P.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||P.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":l=P.getExtension("WEBGL_compressed_texture_pvrtc")||P.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":l=P.getExtension("WEBGL_compressed_texture_etc1");break;default:l=P.getExtension(k)}return c[k]=l,l}}}function E(N,t,z){function g(){if(d!==C)return d;var u=t.get("EXT_texture_filter_anisotropic");return d=null!==u?N.getParameter(u.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}function r(_){if("highp"===_){if(N.getShaderPrecisionFormat(N.VERTEX_SHADER,N.HIGH_FLOAT).precision>0&&N.getShaderPrecisionFormat(N.FRAGMENT_SHADER,N.HIGH_FLOAT).precision>0)return"highp";_="mediump"}return"mediump"===_&&N.getShaderPrecisionFormat(N.VERTEX_SHADER,N.MEDIUM_FLOAT).precision>0&&N.getShaderPrecisionFormat(N.FRAGMENT_SHADER,N.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var d;z=z||{};var P="undefined"!=typeof WebGL2RenderingContext&&N instanceof WebGL2RenderingContext,G=z.precision!==C?z.precision:"highp",Q=r(G);Q!==G&&(console.warn("WebGL:",G,"not supported, using",Q,"instead."),G=Q);var F=z.logarithmicDepthBuffer===!0,K=N.getParameter(N.MAX_TEXTURE_IMAGE_UNITS),E=N.getParameter(N.MAX_VERTEX_TEXTURE_IMAGE_UNITS),v=N.getParameter(N.MAX_TEXTURE_SIZE),b=N.getParameter(N.MAX_CUBE_MAP_TEXTURE_SIZE),a=N.getParameter(N.MAX_VERTEX_ATTRIBS),m=N.getParameter(N.MAX_VERTEX_UNIFORM_VECTORS),D=N.getParameter(N.MAX_VARYING_VECTORS),B=N.getParameter(N.MAX_FRAGMENT_UNIFORM_VECTORS),W=E>0,R=P||!!t.get("OES_texture_float"),U=W&&R,c=P?N.getParameter(N.MAX_SAMPLES):0;return{getMaxAnisotropy:g,getMaxPrecision:r,precision:G,logarithmicDepthBuffer:F,maxTextures:K,maxVertexTextures:E,maxTextureSize:v,maxCubemapSize:b,maxAttributes:a,maxVertexUniforms:m,maxVaryings:D,maxFragmentUniforms:B,vertexTextures:W,floatFragmentTextures:R,floatVertexTextures:U,maxSamples:c}}var N="ht";if(!K[N]){!function(){Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),K.performance&&K.performance.now||function(){var W=Date.now();K.performance||(K.performance={}),K.performance.now=function(){return Date.now()-W}}();for(var N=Date.now(),y=16,k=["ms","moz","webkit","o"],z=0;z<k.length&&!K.requestAnimationFrame;++z)K.requestAnimationFrame=K[k[z]+"RequestAnimationFrame"],K.cancelAnimationFrame=K[k[z]+"CancelAnimationFrame"]||K[k[z]+"CancelRequestAnimationFrame"];K.requestAnimationFrame||(K.requestAnimationFrame=function(C){var A=Date.now(),W=y+N-A;return 0>W&&(W=0),N=A,K.setTimeout(function(){N=Date.now(),C(performance.now())},W)}),K.cancelAnimationFrame||(K.cancelAnimationFrame=function(m){return K.clearTimeout(m)}),H.assign===C&&(H.assign=function(D){if(D===C||null===D)throw new TypeError("Cannot convert undefined or null to object");for(var L=H(D),j=1;j<arguments.length;j++){var X=arguments[j];if(X!==C&&null!==X)for(var g in X)H.prototype.hasOwnProperty.call(X,g)&&(L[g]=X[g])}return L})}();var T=K.document,V=null,k=K[N]={},p=K[N+"config"],m=k.Default=p&&p.Default||{},g=k.Style=p&&p.Style||{},b=k.Attr=p&&p.Attr||{},A=k.Color=p&&p.Color||{},y=k.IsGetter=p&&p.IsGetter||{};!function(){var t=!1;try{var $=H.defineProperty({},"passive",{get:function(){t=!0}});K.addEventListener("test",$,$),K.removeEventListener("test",$,$)}catch(j){t=!1}m.passiveSupported=t}();var R,x,z,P,O=m.passiveSupported,B=m.eventListenerOptionsFalse=O?{passive:!1,capture:!1}:!1,S=m.eventListenerOptionsTrue=O?{passive:!1,capture:!0}:!0,L=Math,n=L.round,$=L.floor,j=L.ceil,Y=L.sqrt,D=L.max,f=L.min,M=L.abs,e=L.cos,q=L.acos,U=L.sin,i=L.pow,o=L.asin,F=L.PI,w=2*F,X=F/2,I=L.tan,s=L.atan2,v=L.random,t=L.log,l=!1,d=!1,Q=K.parseInt||global.parseInt,J="2019-10-01",u=K.navigator?K.navigator.platform.indexOf("Win")>-1:!1,a=function(Z){return Z*Z},G=K.setTimeout,W=K.clearTimeout,r=K.location,Z=K.navigator?K.navigator.userAgent.toLowerCase():"",h=function(T){return T.test(Z)},hf=h(/msie/),Jk=h(/msie/)||h(/trident/),xf=h(/msie 10/),ai=h(/edge/),Uj=h(/firefox/),Yn=h(/mac/),fn=m.isTouchable===C?u?!1:T?"ontouchend"in T:!1:m.isTouchable,wi="default",ir="single",Yr="multiple",Bn="front",rg="back",ws="left",Hn="right",qs="top",rq="bottom",zg="center",Cb="eye",gp="middle",Pq="east",zl="west",Ue="north",Fi="none",Sd="px",jh="absolute",lp="border",jm="triangle",mc="rect",Yh="circle",Pj="cylinder",Hd="shape",Pc="items",mf="normal",ih="remove",cn="clear",th="width",Dl="height",Ym="ingroup",Em="check",Xm="uncheck",zf="radio",pm="radioOn",jn="radioOff",Lg="points",wm="values",mh="series",gj="body",Lr="label",nb="label2",_c="note",Vg="note2",Zj="icons",tl="labelFont",Xp="labelColor",Un="labelSelectColor",Di="note.expanded",fs="note2.expanded",oq="edge.expanded",sb="edge.points",Bb="edge.type",cs="rotation",ki="hidden",gk="visible",hq="tuv",Lm="no",cf="draw",Ho="select",_r="currentSubGraph",Xd="selectBackground",Cf="autoMakeVisible",ts="autoHideScrollBar",Qc="scrollBarColor",Qj="scrollBarSize",ag="indent",lr="rowHeight",Vh="columnLineColor",cq="rowLineColor",dm="columnLineVisible",ok="rowLineVisible",_d="visibleFunc",De="expandIcon",Pb="collapseIcon",io="checkMode",Lq="sortFunc",ne="editable",Fc="batchEditable",ys="tristate",ff="asc",sf="desc",kc="position",pl="elevation",wf="children",yh="translateX",Wj="translateY",al="dataModel",Fq="maxSize",pf="state",Hc="shape3d",Vp="shape3d.resolution",ck="shape3d.visible",jr="shape3d.from.visible",dq="shape3d.to.visible",Ip="shape3d.top.visible",zo="shape3d.bottom.visible",Le="repeat.uv.length",bb="serializeValue",Gf="deserializeValue",vl="centerUniform",ss="uniform",cm="rgba(255,255,255,0)",Xq="style",Rn="attr",fq="field",Sb="string",mp="boolean",oc="color",ce="int",Qg="number",bq="ew-resize",Ke="ns-resize",Ig="pointer",us="auto",Bj="mousedown",Hf="mousemove",mm="mouseup",Wl="mouseout",hg="touchstart",lf="touchmove",Aj="touchend",Ur="keydown",Fm="keyup",vi=["DOMMouseScroll","mousewheel"],Zg=Uj?vi[0]:vi[1],xq=fn?[hg,lf,Aj,Ur,Fm,"keypress","input","contextmenu","compositionstart","compositionupdate","compositionend"]:[Ur,Fm,"keypress","input",Bj,Hf,mm,Wl,Zg,"wheel","contextmenu","mouseenter","mouseleave","mouseover","compositionstart","compositionupdate","compositionend"],wg=V,Ri=V,Sp=V,Kd=mm.length,Qd=function(){Sp&&(W(Sp.timeout),Sp=V)},kp=function(){Sp&&xp(Sp.e,Sp.info)};K.addEventListener&&(fn||(K.addEventListener(Wl,function(){Qd()},B),K.addEventListener(Zg,function(){_g()},B)),K.addEventListener(Fm,function(m){91===m.keyCode?Gd={}:delete Gd[m.keyCode]},S),K.addEventListener(Ur,function(A){Gd[A.keyCode]=!0},S),K.addEventListener("blur",function(){Gd={}},B));var If,Ml,Km,Mb=0,Mo=V,Vr=function(j,s){var e=G(function(){delete Mo[e],Bk(Mo)&&(Mo=V),j()},s);return e},Xe=V,Pe=V,Wp={},Mm={},Ng={},be={},rj={},Gd={},kr={},Jp={},yk={},Io={},We=/.json$/,Ll=/^data:image\/svg\+xml/,zr={},xr=[],op={},Fj=V,oi=V,Yk=function(){},Qn=function(){throw"Oops!"},Ti=[0,0,0],fe={x:0,y:0,width:0,height:0},Oq=V,Ln=V,Yi=V,Gg=function(X,f){Mm[X]=f,f&&f.comps&&!f.uuid&&(f.uuid=k.Math.generateUUID()),dn[X]&&(f.cacheRule=dn[X],delete dn[X])},Gi=function(o){Ln&&!o._72O&&(Yi||(Yi={}),Yi[o._72O=Nk()]=o),If!=V?jl()<.05&&P&&!Ml&&(dl=Qd):dl=Hm},Rc=function(A,s,W,c){Ln||(Ln={});var P=Ln[A];if(P){if(P.url===s)return;P.image?(P.image.onload=Yk,P.image.onerror=Yk):P.request&&(P.request.onload=Yk,P.request.onerror=Yk)}if(We.test(s)){var d=new lh;if(Ln[A]={request:d,url:s},s=m.beforeLoadURL(s),s.data){var $=m.parse(s.data);fc(A,$),m.handleImageLoaded(A,$)}else{d.onload=function(){if(200===this.status||0===this.status){var q=m.parse(d.getResponseText());fc(A,q),m.handleImageLoaded(A,q)}else fc(A,m.handleUnfoundImage(A,s)||V)},d.onerror=function(){fc(A,m.handleUnfoundImage(A,s)||V)};var K={};K.url=encodeURI(s),K.sync=!1,d.send(K)}}else{var $=new Image;Ln[A]={image:$,url:s},/^data:image/.test(s)||(s=m.beforeLoadURL(s),s=m.appendTimeStamp(s),s=encodeURI(s),$.crossOrigin=m.crossOrigin),m.convertImageSrc(s,function(x){Jk&&(s.toLowerCase().indexOf(".svg")>0||Ll.test(s))?(T.body.appendChild($),$.style.visibility="hidden",$.onload=function(){G(function(){if(W&&($.width=W),c&&($.height=c),!$.width||!$.height){var R=$.width||$.clientWidth,I=$.height||$.clientHeight;$.width=R,$.height=I}m.handleImageLoaded(A,$),fc(A,$),T.body.removeChild($),$.style.visibility=""},180)},$.onerror=function(){fc(A,m.handleUnfoundImage(A,s)||V),T.body.removeChild($),$.style.visibility=""}):($.onload=function(){W&&($.width=W),c&&($.height=c),m.handleImageLoaded(A,$),fc(A,$)},$.onerror=function(){fc(A,m.handleUnfoundImage(A,s)||V)}),$.src=x})}},fc=function(A,o){if(Gg(A,o),delete Ln[A],Bk(Ln)&&(Ln=V,Yi)){for(var h in Yi){var G=Yi[h];G._2O&&G._2O[A]&&(G.deleteTexture(A),delete G._2O[A]),G.invalidateAll&&G.invalidateAll(C,"imageLoaded",A),G.redraw&&G.redraw(),G.iv(),delete G._72O}Yi=V}if(o&&Yi)for(var h in Yi){var G=Yi[h];G.invalidateAll&&G.invalidateAll(C,"imageLoading",A),G.redraw&&G.redraw(),G.iv()}},Zd=function(){return t=L&&Date,function(){return K.performance&&K.performance.now?K.performance.now():Date.now()}}(),aq=function(k,T){T?W(k):K.cancelAnimationFrame(k)},nr=function(S,R,q){return{width:S,height:R,comps:lk(q)?q:[q]}},hi=function(v,h){return{type:Yh,rect:[v,h,1.6,1.6],borderWidth:1,borderColor:Qb,gradient:lc,gradientColor:Sc,background:Qb}},uk=function(b,S){return nr(16,16,{type:jm,rect:[4,4,10,8],background:b,rotation:S?1.57:3.14})},he=function(b,D){return nr(16,16,{type:jm,rect:[4,4,8,7],background:b,rotation:D?3.14:0})},Ap=function(s){var D=s._orientation;return"horizontal"===D||"h"===D},Er=function(l,m){var f=V||4,X=V||1,_=V||1;0>f?f=0:f>.25&&(f=.25);var S,c,i,C,o,a,n,B=.5,Q=[],z=[],R=[],p=w/_,s=w/X,b=B-f;for(c=0;X>=c;c++)for(C=-F+c*s,a=e(C),o=U(C),S=0;_>=S;S++)i=S*p,n=b+f*a,Q.push(e(i)*n,o*f,-U(i)*n),(x=[l,m])&&z.push(S/_,1-c/X);for(c=0;X>c;c++){var Z=c*(_+1),P=(c+1)*(_+1);for(S=0;_>S;S++)R.push(Z+S,P+S+1,P+S,Z+S,Z+S+1,P+S+1),il.z=uj.z=[l,m]}},Og=function(S){var F=2,H=0;for(var e in S)e.length===F&&Q(e,32)===Ar&&(Fj=oi=S[e]),H++;return H},Gr=function(O,C,R,M){return R||(R=fn?5:3,R/=M||1),{x:O-R,y:C-R,width:2*R,height:2*R}},ms=function(b,m,x,R){var V=this;m||(m=fn?5:3,x=20,R=20);var r={x:b,y:m,width:x,height:R};if(x)for(var p=0;x>p;p++)if(3===x)R=20;else for(var E=0;R>E;E++)V=K?K:x;var D={x:F,y:2*F};if(zc(r,D)){var I=Dl[0]+qs[0]+cn[1]+ff.length,$=ki[0]+ys[0]+cn[1]+gj.length;Nq[Cb]=[V[I],V[$]],V[I]=wc[Cb],V[$]=wc[Hc]}},sc=function(h){return(/ble$/.test(h)||/ed$/.test(h)||y[h]?"is":"get")+h.charAt(0).toUpperCase()+h.slice(1)},wc=function(c){return"set"+c.charAt(0).toUpperCase()+c.slice(1)},Jh=function(v){return typeof v===Sb||v instanceof String},Mj=function(H){return typeof H===Qg},Hm=function(_){return typeof _===mp},Ib=function(i){return i&&"object"==typeof i},fg=function(W){return"function"==typeof W},lk=function(F){return F instanceof Array},br=function(O){return O instanceof Vd},Jd=function(z){return lk(z)?new Vd(z):z},rd=function(p){return p instanceof Gk},ee=function(a){return a instanceof hb},bm=function(r){return r instanceof qh},Rl=function(M,K){if(!(M instanceof k.Group))return!1;if(!K)return M.isExpanded();var B=K.getDataUI(M);return B&&B._88I?!0:!1},Jj=function(t){return t instanceof Cn},wd=function(C){return C&&"IFRAME"===C.tagName},jq=function(v){return v==V||m.numberDigits==V?v:parseFloat(v.toFixed(m.numberDigits))},Rd=function(S,r,R){var l,L=r.length;if(R)for(var n=0;R>n;n++)if(3===L)S.push(r[0]),S.push(r[1]),S.push(r[2]);else for(l=0;L>l;l++)S.push(r[l]);else if(3===L)S.push(r[0]),S.push(r[1]),S.push(r[2]);else for(l=0;L>l;l++)S.push(r[l])},Ah=function(J){return J?Ib(J)?J:{}:!1},dc=function(v,p,B){var V,e=Ib(v)?v:v.prototype;for(V in p)B&&V in e?e[V]===C&&console.warn("class",e,"has own undefined property",V,", keep exist!"):e[V]=p[V];return v},Jl=function(P){return String.fromCharCode(P)},kd=function(y){for(var j,r=0,b="";r<y.length;r++)j=y[y.length-1-r],"%"===j?j="'":"a"===j?j='"':"]"===j&&(j="\\"),b+=Jl(j.charCodeAt(0)-1);return b},Hh=function(H,G,u){H.superClass.constructor.apply(G,u)},Bk=function(J){for(var W in J)return!1;return!0},eh=function(f){return f?0===f.length:!0},sd=function(){var X="";return[Xm[0],cq[0],Lr[0]].forEach(function(f){X+=wc(f).slice(3)}),ss=T&&T[X]||vl,function(e,$){return e===$?!0:e.x===$.x&&e.y===$.y&&e.width===$.width&&e.height===$.height}}(),xo=function(w,W,D){return W>w?W:w>D?D:w},gb=function(N){return 0>N?-1:N>0?1:0},jl=function(){var w=1e4*U(Kd++);return w-$(w)},vc=function(q,w,x){return Jc(q.x,q.y,w.x,w.y,x.x,x.y,x.x+x.width,x.y,!0)||Jc(q.x,q.y,w.x,w.y,x.x+x.width,x.y,x.x+x.width,x.y+x.height,!0)||Jc(q.x,q.y,w.x,w.y,x.x+x.width,x.y+x.height,x.x,x.y+x.height,!0)||Jc(q.x,q.y,w.x,w.y,x.x,x.y+x.height,x.x,x.y,!0)},Jc=function(X,Z,A,a,q,H,C,d,c){var b=(C-q)*(Z-H)-(d-H)*(X-q),p=(d-H)*(A-X)-(C-q)*(a-Z);if(0!==p){var j=b/p,k=X+j*(A-X),P=Z+j*(a-Z);return c&&(k+mr<f(X,A)||k-mr>D(X,A)||k+mr<f(q,C)||k-mr>D(q,C)||P+mr<f(Z,a)||P-mr>D(Z,a)||P+mr<f(H,d)||P-mr>D(H,d))?V:[k,P]}return V},Gb=function(G,l,E){if(G&&E)if(l){if(l===Xq)return G.getStyle(E);if(l===Rn)return G.getAttr(E);if(l===fq)return G[E]}else if(E=sc(E),G[E])return G[E]();return C},gd=function(M,V,s,Q){if(M&&s)if(V){if(V===Xq)M.s(s,Q);else if(V===Rn)M.a(s,Q);else if(V===fq){var K=M[s];M[s]=Q,M.fp("f:"+s,K,Q)}}else s=wc(s),M[s]&&M[s](Q)},fp=function(w,X,i){return X&&"top"!==X?"bottom"===X?{x:w.x,y:w.y,width:w.width,height:w.height*i}:"right"===X?{x:w.x,y:w.y,width:w.width*i,height:w.height}:"left"===X?{x:w.x+w.width*(1-i),y:w.y,width:w.width*i,height:w.height}:void 0:{x:w.x,y:w.y+w.height*(1-i),width:w.width,height:w.height*i}},Tf=function(y,r,t,m,M){r&&Qm(y,t,m,1,M,r)},Pl=function(e,C,b,O){var p=1-e;return p*p*C+2*e*p*b+e*e*O},il=function(D,w,C,O,G){var P=1-D;return P*P*P*w+3*P*P*D*C+3*P*D*D*O+D*D*D*G},Od=function(O){var r,n,B,L,P=0;return O.forEach(function(m){if(r=m.length,r>0)for(n=m[0],L=1;r>L;L++)B=m[L],P+=_e(n,B),n=B}),P},Ph=function(v,D,n){var a="__"+v,A=function(W){n.disabled||n["handle_"+v](W)};n[a]||(n[a]=A,D.addEventListener(v,A,B))},ib=function(I,v,T){var M="__"+I,C=T[M];C&&(v.removeEventListener(I,C,B),delete T[M])},Ok=function(q,D){var s="_"+D;q[sc(D)]=function(){return this[s]},q[wc(D)]=function(I){var F=this[s];this[s]=I,this.fp(D,F,I)}},Vf=function(Q){return H.create(Q)},He=function(n){if(!n.element){var y,k;(y=n.textField)?k=Om(Ui.TextField,y):(y=n.textArea)?k=Om(Ui.TextArea,y):(y=n.button)?k=Om(Ui.Button,y):(y=n.comboBox)?k=Om(Ui.ComboBox,y):(y=n.checkBox)?k=Om(Ui.CheckBox,y):(y=n.radioButton)?k=Om(Ui.RadioButton,y):(y=n.slider)?k=Om(Ui.Slider,y):(y=n.colorPicker)?k=Om(Ui.ColorPicker,y):(y=n.image)&&(k=Om(Ui.Image,y)),k&&(n.element=k)}},np=function(I,P){var u=Ij(I);return u._ht=P,u},Ij=function(w,P){var M=T.createElement("div"),z=M.style;return M.tabIndex=-1,M.onkeydown=Mf,z.msTouchAction=Fi,Pr(M,V,0),fn&&z.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",V),w&&(z.overflow=ki),P&&Kl(P,M),M},sk=function(O,k){var j=T.createElement("canvas"),Q=j.style;return Q.msTouchAction=Fi,k||(Q.pointerEvents=Fi),Pr(j,V,0),O&&Kl(O,j),j},Pr=function(N,C,j){var D=N.style;D.border=C?C+" solid 1px":0,D.outline=0,D.padding=j?"0 "+j+Sd:0,Dq(N)},Dq=function(K){var l=K.style;l.position=jh,l.margin=0,l.setProperty("box-sizing","border-box",V),l.setProperty("-moz-box-sizing","border-box",V)},ye=function(j,z,N,h){h||(h=lo),z!=V&&(j.width=z*h,j.style.width=z+Sd),N!=V&&(j.height=N*h,j.style.height=N+Sd)},Kl=function(Q,m,V){Q.appendChild(m),V&&(m.style.position=jh)},tb=function(j,k){k.split||(k+="");for(var i,d=k.split("\n"),m=0,u=d.length,Q=0;u>Q;Q++){var x=hd(j.font,d[Q]);x.width>m&&(m=x.width),i||(i=x.height)}return j.ss=d,{width:m,height:i*u}},ui=function(n,Q,b,A,K,V){var W=Q.length;if(1===W)Dk(n,Q[0],b,A,K);else for(var Y=b.height/W,i={x:b.x,y:b.y,width:b.width,height:Y},u=0;u<Q.length;u++)V?_q(n,Q[u],A,K,i.x,i.y,i.width,i.height,V):Dk(n,Q[u],i,A,K),i.y+=Y},Dk=function(a,B,h,b,M){a.font=b?b:Zb,a.fillStyle=M?M:nd,a.textAlign=zg,a.textBaseline=gp;var u,O;h?h.width===C?(u=h.x,O=h.y):(u=h.x+h.width/2,O=h.y+h.height/2):(u=0,O=0),a.fillText(B,n(u),n(O))},gi=function(u){u.getView&&(u=u.getView());var X=u.offsetWidth||u.scrollWidth;return!X&&u.style.width&&(X=Q(u.style.width)),X},Uh=function(U){U.getView&&(U=U.getView());var $=U.offsetHeight||U.scrollHeight;return!$&&U.style.height&&($=Q(U.style.height)),$},te=function(l,L,w){var f=L[0].toUpperCase()+L.substring(1,L.length);l["webkit"+f]=w,l["moz"+f]=w,l["ms"+f]=w,l["o"+f]=w,l[L]=w},Rj=function(){var n=function(F){Mf(F),F.stopPropagation()},C=function(c){Mf(c)},b=fn?[hg]:[Ur,Bj];return function(I,H){var G=Ij(),L=G.style;return L.backgroundColor=m.disabledBackground,I&&(L.backgroundImage="url("+I+")",L.backgroundPosition="50% 50%",L.backgroundRepeat="no-repeat no-repeat"),H===!1?b.forEach(function(a){G.addEventListener(a,C,B)}):b.forEach(function(P){G.addEventListener(P,n,B)}),G}}(),Qq=function(J){var A=J.getContext("2d");return A.save(),A.lineCap=km,A.lineJoin=qc,A},dl=function(n,o,D,C){Zo(n,o*lo,D*lo),C*=lo,1!==C&&n.scale(C,C)},Zo=function(z,N,G){z.translate(N,G)},zi=function(n,J){J&&n.rotate(J)},cl=function(b,N,P){N===C&&(N=1),P===C&&(P=1),(1!==N||1!==P)&&b.scale(N,P)},Wh=!1,ob=function(m){var w=T.activeElement;if(T.activeElement!==m){w&&w.forceOnblur&&w.forceOnblur();for(var d=[],c=m.parentNode;c;)d.push([c,c.scrollLeft,c.scrollTop]),c=c.parentNode;if(!Wh){var p=[],$=[];try{for(var V=K.parent,J=K;V!==J;)p.push([V,V.scrollX,V.scrollY]),J=V,V=K.parent;var r=K.frameElement;if(r)for(var y=r.parentNode;y;)$.push([y,y.scrollLeft,y.scrollTop]),y=y.parentNode}catch(k){Wh=!0}}if(fn)m.focus();else{var B=ur(),H=B.target;m.focus(),H.scrollLeft=B.left,H.scrollTop=B.top}d.forEach(function(L){L[0].scrollLeft=L[1],L[0].scrollTop=L[2]}),Wh||(p.forEach(function(q){q[0].scrollTo(q[1],q[2])}),$.forEach(function(o){o[0].scrollLeft=o[1],o[0].scrollTop=o[2]}))}},Wg=function(H){return H&&H.getView?H.getView():H},xg=function(t,A,E,F,w){if(2===arguments.length&&(E=A.y,F=A.width,w=A.height,A=A.x),t.isSelfViewEvent)t.setX(A),t.setY(E),t.setWidth(F),t.setHeight(w);else{var H=Wg(t),k=H.style;if((T.fullscreenElement||T.mozFullScreenElement||T.webkitFullscreenElement||T.msFullscreenElement)!==H)A!==C&&(k.left=A+Sd),E!==C&&(k.top=E+Sd),F!==C&&(k.width=F+Sd),w!==C&&(k.height=w+Sd);else{var b=m.getWindowInfo();k.left=(A=b.left)+Sd,k.top=(E=b.top)+Sd,k.width=(F=b.width)+Sd,k.height=(w=b.height)+Sd}t.endEditing&&!fn&&t.endEditing(),t.redraw&&t.redraw(),t.invalidate&&t.invalidate(),t.onLayouted&&t.onLayouted(A,E,F,w),t.fireViewEvent&&t.fireViewEvent("layout")}},Mr=function(A){if(!A.touches)return A;var g=A.touches[0];return g?g:A.changedTouches[0]},Op=function(y){return fn?Mr(y).target:y.target},am=function(I){m.popup&&m.popup.close(),m.popup=I},bl=V,Eb=function(k){bl.handleWindowTouchMove(k)},ei=function(Z){bl.handleWindowTouchEnd(Z),K.removeEventListener(lf,Eb,B),K.removeEventListener(Aj,ei,B),bl=V},Fl=function(i){bl.handleWindowMouseMove(i)},Qr=function(I){bl.handleWindowMouseUp(I),K.removeEventListener(Hf,Fl,B),K.removeEventListener(mm,Qr,B),bl=V},Br=function(p){return 1===Sg(p)},qb=function(w,s){return s?s.keyCode===w:Gd[w]},_n=function(o){return Kg(o)&&qb(65,o)},Ol=function(F){return qb(46,F)||qb(8,F)},ns=function(i){return function(t){return t?t.keyCode===i:Gd[i]}},Ar=573,rf=[65,83,68,87,37,38,39,40,32,13,27],Qh=ns(rf[0]),Lk=ns(rf[1]),Wk=ns(rf[2]),zk=ns(rf[3]),hr=ns(rf[4]),Zp=ns(rf[5]),rc=ns(rf[6]),Bh=ns(rf[7]),on=ns(rf[8]),Yd=ns(rf[9]),zq=ns(rf[10]),bo={65:1,83:1,68:1,87:1,37:1,38:1,39:1,40:1},Qp=[2,2,2,2,2,2,2,2,2,2,2,3,3,3,5,5,5,5,5,5,23,79],ub=V,qp=V,Uf=function(z,B){ub||(ub=sk()),ye(ub,z,B,1);var g=Qq(ub);return g.clearRect(0,0,z,B),g},xk=function(){var k,e={};for(var _ in K){var f=Yr.length;if(_.length==f&&_[0]===Yr[2]&&_[1]===Fi[1]&&_[4]===Yr[3]&&_[5]===Yr[4]&&_.substr(f-2)===Fi[1]+Fi[2]){var w=K[_];for(var N in w)N.length===f&&N.substr(0,3)===Hn[3]+ih[3]+Ho[0]&&N.substr(f-2)===Yr[0]+_c[3]&&(vi=w[N])}}return function(J){var y,i=e[J];return i||(k||(k=sk(),ye(k,1,1,1)),y=k.getContext("2d"),y.clearRect(0,0,1,1),Qm(y,0,0,1,1,J),i=y.getImageData(0,0,1,1).data,i=e[J]=[i[0],i[1],i[2],i[3]]),i}}(),Fe=function(z){if(!Jh(z))return z;var i=xk(z);return i.CA||(i.CA=[i[0]/255,i[1]/255,i[2]/255,i[3]/255]),i.CA},Pk=function(r,k,q,A,T){var f=sk();f.width=q,f.height=A;var e=f.getContext("2d");e.drawImage(r,0,0,q,A);try{for(var a=e.getImageData(0,0,q,A),z=a.data,U=0,t=z.length;t>U;U+=4){var o=z[U+0],m=z[U+1],i=z[U+2],N=z[U+3];"override_a"===T?z[U+3]=255*k[3]:"override_rgb"===T?(z[U+0]=255*k[0],z[U+1]=255*k[1],z[U+2]=255*k[2]):"override"===T?(z[U+0]=255*k[0],z[U+1]=255*k[1],z[U+2]=255*k[2],z[U+3]=255*k[3]):(z[U+0]=k[0]*o,z[U+1]=k[1]*m,z[U+2]=k[2]*i,z[U+3]=k[3]*N)}e.putImageData(a,0,0)}catch(G){return r}return f},Nq=function($,C,X){return C&&(C="miter"===X?8*C+20:C+1,$&&ol($,C)),C},Nl=function(u,C){if(C){var A=new Ae(C),p=u.width/2,c=u.height/2,M=fr([A.tf(-p,-c),A.tf(p,-c),A.tf(p,c),A.tf(-p,c)]);return M.x+=u.x+p,M.y+=u.y+c,M}return u},Zr=function(U,A,P,k,S,B,n,R){k*=Math.PI/180;var E={x:Math.cos(k)*(U.x-n.x)/2+Math.sin(k)*(U.y-n.y)/2,y:-Math.sin(k)*(U.x-n.x)/2+Math.cos(k)*(U.y-n.y)/2},v=Math.pow(E.x,2)/Math.pow(A,2)+Math.pow(E.y,2)/Math.pow(P,2);v>1&&(A*=Math.sqrt(v),P*=Math.sqrt(v));var z=(S==B?-1:1)*Math.sqrt((Math.pow(A,2)*Math.pow(P,2)-Math.pow(A,2)*Math.pow(E.y,2)-Math.pow(P,2)*Math.pow(E.x,2))/(Math.pow(A,2)*Math.pow(E.y,2)+Math.pow(P,2)*Math.pow(E.x,2)));isNaN(z)&&(z=0);var d={x:z*A*E.y/P,y:z*-P*E.x/A},p={x:(U.x+n.x)/2+Math.cos(k)*d.x-Math.sin(k)*d.y,y:(U.y+n.y)/2+Math.sin(k)*d.x+Math.cos(k)*d.y},c=function(o){return Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2))},m=function($,G){return($[0]*G[0]+$[1]*G[1])/(c($)*c(G))},l=function(Y,s){return(Y[0]*s[1]<Y[1]*s[0]?-1:1)*Math.acos(m(Y,s))},Q=l([1,0],[(E.x-d.x)/A,(E.y-d.y)/P]),Y=[(E.x-d.x)/A,(E.y-d.y)/P],F=[(-E.x-d.x)/A,(-E.y-d.y)/P],f=l(Y,F);m(Y,F)<=-1&&(f=Math.PI),m(Y,F)>=1&&(f=0);var m=A>P?A:P,D=A>P?1:A/P,N=A>P?P/A:1;if(null==R){var O={x:0,y:0,width:0,height:0};ol(O,m),O.x*=D,O.width*=D,O.y*=N,O.height*=N;var J=new Ae(k);return O=fr([J.tf(O.x,O.y),J.tf(O.x+O.width,O.y),J.tf(O.x+O.width,O.y+O.height),J.tf(O.x,O.y+O.height)]),O.x+=p.x,O.y+=p.y,[{x:O.x,y:O.y},{x:O.x+O.width,y:O.y},{x:O.x+O.width,y:O.y+O.height},{x:O.x,y:O.y+O.height}]}R.translate(p.x,p.y),R.rotate(k),R.scale(D,N),R.arc(0,0,m,Q,Q+f,1-B),R.scale(1/D,1/N),R.rotate(-k),R.translate(-p.x,-p.y)},Tm=function(h,n){h&&h.beginPath();for(var c,u,x,S=[],q=function(m){for(var P,L=/(\-{0,1}[\d\.]+)/gi,U=[];P=L.exec(m);)U.push(parseFloat(P[0]));return U},v=/([MmLlHhVvCcSsQqTtAa]{1}[\d\.,\s\-Zz]*)/gi,X={x:0,y:0};c=v.exec(n);){var a=c[0],y=a.substr(0,1);if("M"===y||"m"===y){for(var D=q(a),P=0;P<D.length;P+=2){var f=D[P],w=D[P+1];"m"===y&&(f+=X.x,w+=X.y),h&&h.moveTo(f,w),S.push({x:f,y:w}),X.x=f,X.y=w}u=x=null}else if("H"===y||"h"===y){for(var D=q(a),P=0;P<D.length;P+=1){var f=D[P];"h"===y&&(f+=X.x),h&&h.lineTo(f,X.y),S.push({x:f,y:X.y}),X.x=f}u=x=null}else if("C"===y||"c"===y){for(var D=q(a),P=0;P<D.length;P+=6){var _=D[P],L=D[P+1],z=D[P+2],I=D[P+3],f=D[P+4],w=D[P+5];"c"===y&&(_+=X.x,L+=X.y,z+=X.x,I+=X.y,f+=X.x,w+=X.y),h&&h.bezierCurveTo(_,L,z,I,f,w),S.push({x:_,y:L}),S.push({x:z,y:I}),S.push({x:f,y:w}),X.x=f,X.y=w}u=[_,L,z,I,f,w],x=null}else if("S"===y||"s"===y){for(var D=q(a),P=0;P<D.length;P+=4){var _,L;u?(_=2*u[4]-u[2],L=2*u[5]-u[3]):(_=X.x,L=X.y);var z=D[P],I=D[P+1],f=D[P+2],w=D[P+3];"s"===y&&(z+=X.x,I+=X.y,f+=X.x,w+=X.y),h&&h.bezierCurveTo(_,L,z,I,f,w),S.push({x:_,y:L}),S.push({x:z,y:I}),S.push({x:f,y:w}),X.x=f,X.y=w}u=[_,L,z,I,f,w],x=null}else if("Q"===y||"q"===y){for(var D=q(a),P=0;P<D.length;P+=4){var _=D[P],L=D[P+1],f=D[P+2],w=D[P+3];"q"===y&&(_+=X.x,L+=X.y,f+=X.x,w+=X.y),h&&h.quadraticCurveTo(_,L,f,w),S.push({x:_,y:L}),S.push({x:f,y:w}),X.x=f,X.y=w}u=null,x=[_,L,f,w]}else if("T"===y||"t"===y){for(var D=q(a),P=0;P<D.length;P+=2){var _,L;x?(_=2*x[2]-x[0],L=2*x[3]-x[1]):(_=X.x,L=X.y);var f=D[P],w=D[P+1];"t"===y&&(f+=X.x,w+=X.y),h&&h.quadraticCurveTo(_,L,f,w),S.push({x:_,y:L}),S.push({x:f,y:w}),X.x=f,X.y=w}u=null,x=[_,L,f,w]}else if("V"===y||"v"===y){for(var D=q(a),P=0;P<D.length;P+=1){var w=D[P];"v"===y&&(w+=X.y),h&&h.lineTo(X.x,w),S.push({x:X.x,y:w}),X.y=w}u=x=null}else if("L"===y||"l"===y){for(var D=q(a),P=0;P<D.length;P+=2){var f=D[P],w=D[P+1];"l"===y&&(f+=X.x,w+=X.y),h&&h.lineTo(f,w),S.push({x:f,y:w}),X.x=f,X.y=w}u=x=null}else if("A"===y||"a"===y){for(var D=q(a),P=0;P<D.length;P+=7){var s=D[P],A=D[P+1],V=D[P+2],O=D[P+3],r=D[P+4],f=D[P+5],w=D[P+6];"a"===y&&(f+=X.x,w+=X.y);var N=Zr(X,s,A,V,O,r,{x:f,y:w},h);N&&(S=S.concat(N)),X.x=f,X.y=w}u=x=null}var t=a.substr(a.length-1);("z"===t||"Z"===t)&&h&&h.closePath()}return S},vm=function(b,F){var O,A,n="L"===F[0],v=F.length;b.save(),n?(b.transform(F[5],F[6],F[7],F[8],F[9],F[10]),O=b.createLinearGradient(F[1],F[2],F[3],F[4]),A=11):(b.transform(F[7],F[8],F[9],F[10],F[11],F[12]),O=b.createRadialGradient(F[1],F[2],F[3],F[4],F[5],F[6]),A=13);for(var I=b.compGray;v>A;)O.addColorStop(F[A],I?m.toGrayColor(F[A+1]):F[A+1]),A+=2;b.fillStyle=O},uj=function(F,p){var U=F.s("shape.gradient.pack");if(U){for(var i=U.length,L=new Array(i),V=0;i>V;V++)L[V]=U[V];var o,g,E,n,l,a,k,Z,w,v,J,K,B,G="L"===L[0];o=G?5:7,g=L[o],E=L[o+1],n=L[o+2],l=L[o+3],a=L[o+4],k=L[o+5],Z=p[0],w=p[1],v=p[2],J=p[3],K=p[4],B=p[5],L[o]=Z*g+v*E,L[o+1]=w*g+J*E,L[o+2]=Z*n+v*l,L[o+3]=w*n+J*l,L[o+4]=Z*a+v*k+K,L[o+5]=w*a+J*k+B,F.s("shape.gradient.pack",L)}},_l=function(o,j,W,T){var v=!1;if(o.beginPath?o.beginPath():v=!0,br(j)&&(j=j._as),br(W)&&(W=W._as),W&&W.length){for(var M,X,Z,R,f=0,A=0,F=W.length;F>A;A++)M=W[A],1===M?(X=j[f++],o.moveTo(X.x,v?-X.y:X.y)):2===M?(X=j[f++],o.lineTo(X.x,v?-X.y:X.y)):3===M?(X=j[f++],Z=j[f++],o.quadraticCurveTo(X.x,v?-X.y:X.y,Z.x,v?-Z.y:Z.y)):4===M?(X=j[f++],Z=j[f++],R=j[f++],o.bezierCurveTo(X.x,v?-X.y:X.y,Z.x,v?-Z.y:Z.y,R.x,v?-R.y:R.y)):5===M&&o.closePath();T&&5!==M&&o.closePath()}else{var e,u,L,s=j.length;if(s>0){for(e=j[0],o.moveTo(e.x,v?-e.y:e.y),u=1;s>u;u++)L=j[u],o.lineTo(L.x,v?-L.y:L.y);T&&o.closePath()}}},so=function(r,j,o,p){if(br(r)&&(r=r._as),br(j)&&(j=j._as),j&&j.length){o=o||Ej;for(var u,L,v,h,i,n,x,G,w=[],F=V,d=0,m=0,_=j.length;_>m;m++)if(u=j[m],1===u)w.push(F=[]),F.push(r[d++]);else if(2===u)F.push(r[d++]);else if(3===u){for(L=F[F.length-1],v=r[d++],h=r[d++],n=1;o>n;n++)x=Pl(n/o,L.x,v.x,h.x),G=Pl(n/o,L.y,v.y,h.y),F.push({x:x,y:G,b:!0});F.push(h)}else if(4===u){for(L=F[F.length-1],v=r[d++],h=r[d++],i=r[d++],n=1;o>n;n++)x=il(n/o,L.x,v.x,h.x,i.x),G=il(n/o,L.y,v.y,h.y,i.y),F.push({x:x,y:G,b:!0});F.push(i)}else 5===u&&F.push(F[0]);return p&&5!==u&&F&&F.length>2&&F.push(F[0]),w}return p&&r.length>2&&(r=r.slice(),r.push(r[0])),r?[r]:[]},Hb=function(J,B,S,s,t,i){var H,C,F,q=xk(B),L=s,K=q[0],h=q[1],V=q[2];if(S){var D=xk(S);H=D[0]-K,C=D[1]-h,F=D[2]-V}else H=255-K,C=255-h,F=255-V;for(i||(i=s>10?1:.5,i=1>t?f(i/t,2):i),J.save(),J.shadowOffsetX=0,J.shadowOffsetY=0,J.shadowBlur=0,J.shadowColor=0;(s-=i)>0;){var G=1-s/L,Q=K+H*G,x=h+C*G,p=V+F*G;Q=f(j(Q),255),x=f(j(x),255),p=f(j(p),255),J.strokeStyle="rgb("+Q+","+x+","+p+")",J.lineWidth=s,J.stroke()}J.restore()},wl=function(){var C={};return function(Y,h){var A=Y+"-"+h,P=C[A];if(P)return P;var q,N,X,b=xk(Y);return 0>h?(h=(100+h)/100,q=j(b[0]*h),N=j(b[1]*h),X=j(b[2]*h)):(h/=100,q=b[0],N=b[1],X=b[2],q+=(255-q)*h,N+=(255-N)*h,X+=(255-X)*h,q=f(j(q),255),N=f(j(N),255),X=f(j(X),255)),C[A]="rgb("+q+","+N+","+X+")"}}(),Qm=function(o,b,W,T,c,F){F&&(o.fillStyle=F),o.beginPath(),o.rect(b,W,T,c),o.fill()},En=function(T,L,x,j,G,K,t){T.beginPath(),eo[L](T,x.x,x.y,x.width,x.height,j,G,K,t)},ym=function(o,m,D,I,G){var $=eo[D];o.fillStyle=$?$(o,m,I?I:Sc,G.x,G.y,G.width,G.height):m},lb=function(A,j,R,v,H,d){try{if(!j.tagName&&j.comps){j._cacheImage_||(j._cacheImage_={});var Z;Z="override"===v?"colors_override":"override_rgb"===v?"colors_override_rgb":"override_a"===v?"colors_override_a":"colors",j._cacheImage_[Z]||(j._cacheImage_[Z]={__count__:0});var W=j._cacheImage_[Z][R];W||(j._cacheImage_[Z].__count__>m.imageCacheThreshold&&(j._cacheImage_[Z]={__count__:0}),W=k.Default.toCanvas(j,si(j),of(j),null,H,d,R,null,v),j._cacheImage_[Z][R]=W,j._cacheImage_[Z].__count__++),j=W}A.fillStyle=A.createPattern(j,"repeat")}catch(X){A.fillStyle="black"}},Zi=function(F,f,J,D,t,p,e){F.save(),F.translate(f,J),F.scale(1,e/p),F.arc(0,0,p,D,t),F.restore()},vf=function(g,Q,n,d,E,x,m,o){var b,z,V,A,v,_,X,B,I,k,P;if(M(E)>2*F&&(E=2*F),v=j(M(E)/(F/4)),b=E/v,z=-b,V=-d,v>0){_=Q+e(d)*x,X=n+U(-d)*m,o?g.lineTo(_,X):g.moveTo(_,X);for(var G=0;v>G;G++)V+=z,A=V-z/2,B=Q+e(V)*x,I=n+U(V)*m,k=Q+e(A)*(x/e(z/2)),P=n+U(A)*(m/e(z/2)),g.quadraticCurveTo(k,P,B,I)}},cb=function(Y,S,u,O,d,A,R,X,$){6===arguments.length&&(R=A,X=A,$=A);var a=S+O,t=u+d,G=d>O?2*O:2*d;A=G>A?A:G,R=G>R?R:G,X=G>X?X:G,$=G>$?$:G;var j=.29*$,s=.58*$;Y.moveTo(a,t-$),Y.quadraticCurveTo(a,t-s,a-j,t-j),Y.quadraticCurveTo(a-s,t,a-$,t),j=.29*X,s=.58*X,Y.lineTo(S+X,t),Y.quadraticCurveTo(S+s,t,S+j,t-j),Y.quadraticCurveTo(S,t-s,S,t-X),j=.29*A,s=.58*A,Y.lineTo(S,u+A),Y.quadraticCurveTo(S,u+s,S+j,u+j),Y.quadraticCurveTo(S+s,u,S+A,u),j=.29*R,s=.58*R,Y.lineTo(a-R,u),Y.quadraticCurveTo(a-s,u,a-j,u+j),Y.quadraticCurveTo(a,u+s,a,u+R),Y.lineTo(a,t-$)},Mh=function(R,x,g,K,V,v,T){x&&(g=n(g),K=n(K),T||(T=1),R.fillStyle=x,R.beginPath(),R.rect(g,K,T,v),R.rect(g,K,V,T),v-T>0&&R.rect(g,K+v-T,V,T),V-T>0&&R.rect(g+V-T,K,T,v),R.fill())},$q=function($,e,P,a){var V=a.x,c=a.y,Y=a.width,I=a.height;if(!(!e||!P||0>=Y||0>=I)){var N,k=Tn(e),p=$k(e),n=P>0;1===P||-1===P?($.fillStyle=n?k:p,$.beginPath(),$.rect(V,c,1,I),$.rect(V,c,Y,1),$.fill(),$.fillStyle=n?p:k,$.beginPath(),$.rect(V,c+I-1,Y,1),$.rect(V+Y-1,c,1,I),$.fill()):(P=f(M(P),f(Y/2,I/2)),N=$.createLinearGradient(V,c,V+P,c),N.addColorStop(0,n?k:p),N.addColorStop(1,e),$.fillStyle=N,$.beginPath(),$.moveTo(V,c),$.lineTo(V+P,c+P),$.lineTo(V+P,c+I-P),$.lineTo(V,c+I),$.lineTo(V,c),$.fill(),N=$.createLinearGradient(V,c,V,c+P),N.addColorStop(0,n?k:p),N.addColorStop(1,e),$.fillStyle=N,$.beginPath(),$.moveTo(V,c),$.lineTo(V+P,c+P),$.lineTo(V+Y-P,c+P),$.lineTo(V+Y,c),$.lineTo(V,c),$.fill(),N=$.createLinearGradient(V,c+I,V,c+I-P),N.addColorStop(0,n?p:k),N.addColorStop(1,e),$.fillStyle=N,$.beginPath(),$.moveTo(V,c+I),$.lineTo(V+P,c+I-P),$.lineTo(V+Y-P,c+I-P),$.lineTo(V+Y,c+I),$.lineTo(V,c+I),$.fill(),N=$.createLinearGradient(V+Y,c,V+Y-P,c),N.addColorStop(0,n?p:k),N.addColorStop(1,e),$.fillStyle=N,$.beginPath(),$.moveTo(V+Y,c),$.lineTo(V+Y-P,c+P),$.lineTo(V+Y-P,c+I-P),$.lineTo(V+Y,c+I),$.lineTo(V+Y,c),$.fill())}},hh=function(b,R,$,G,v,d,S){var Q=b.createLinearGradient(G,v,d,S);return Q.addColorStop(0,$),Q.addColorStop(1,R),Q},$b=function(z,W,d,O,M,Y,x){var R=z.createLinearGradient(O,M,Y,x);return R.addColorStop(0,W),R.addColorStop(.5,d),R.addColorStop(1,W),R},Rq=function(L,P,X,b,x,I,j){var m=L.createLinearGradient(b,x,I,j);return m.addColorStop(0,P),m.addColorStop(1/3,X),m.addColorStop(2/3,P),m.addColorStop(1,X),m},dj=function(r,X,l,c,F,A,j,R,T){var m=r.createRadialGradient(c+A*R,F+j*T,f(A,j)/24,c+A/2,F+j/2,D(A,j)/2);return m.addColorStop(0,l),m.addColorStop(1,X),m},Xo=[0,-1,.22451398828979272,-.30901699437494734,.9510565162951535,-.30901699437494745,.3632712640026804,.11803398874989468,.5877852522924731,.8090169943749473,-1.1102230246251565e-16,.38196601125010515,-.587785252292473,.8090169943749475,-.3632712640026805,.1180339887498949,-.9510565162951536,-.3090169943749473,-.22451398828979285,-.30901699437494734],eo={polygon:function(N,P,m,t,Y,$){($==V||3>$)&&($=6);for(var C,G,I=f(t,Y)/2,i=P+t/2,o=m+Y/2,k=0,D=2*F/$,W=0;$>W;W++)C=i+e(k)*I,G=o+U(k)*I,0===W?N.moveTo(C,G):N.lineTo(C,G),k+=D;
N.closePath()},arc:function($,C,g,H,Z,n,G,l,z){n==V&&(n=F),G==V&&(G=w),l==V&&(l=!0);var Y=C+H/2,O=g+Z/2;l&&$.moveTo(Y,O),z?Zi($,Y,O,n,G,H/2,Z/2):$.arc(Y,O,f(H,Z)/2,n,G),l&&$.closePath()},rect:function(I,Q,g,w,R){I.rect(Q,g,w,R)},circle:function(T,G,n,M,g){T.arc(G+M/2,n+g/2,f(M,g)/2,0,w,!0)},oval:function(J,E,u,p,S){Zi(J,E+p/2,u+S/2,0,w,p/2,S/2)},roundRect:function(z,R,L,U,K,I){I==V&&(I=f(f(U,K)/4,8)),cb(z,R,L,U,K,I)},star:function(h,Y,M,X,t){var Z=2*X,N=2*t,C=Y+X/2,y=M+t/2;h.moveTo(C-Z/4,y-N/12),h.lineTo(Y+.306*X,M+.579*t),h.lineTo(C-Z/6,y+N/4),h.lineTo(Y+X/2,M+.733*t),h.lineTo(C+Z/6,y+N/4),h.lineTo(Y+.693*X,M+.579*t),h.lineTo(C+Z/4,y-N/12),h.lineTo(Y+.611*X,M+.332*t),h.lineTo(C+0,y-N/4),h.lineTo(Y+.388*X,M+.332*t),h.closePath()},pentagram:function(z,V,f,Z,j){var L=.5*j,A=V+.5*Z,X=f+L,N=.5257311121191336*Z;N>L&&(N=L);var w=Xo,h=0;for(z.moveTo(A+N*w[h++],X+N*w[h++]);20>h;)z.lineTo(A+N*w[h++],X+N*w[h++]);z.closePath()},triangle:function(J,g,C,k,d){J.moveTo(g+k/2,C),J.lineTo(g+k,C+d),J.lineTo(g,C+d),J.closePath()},hexagon:function(k,W,j,s,c){k.moveTo(W,j+c/2),k.lineTo(W+s/4,j+c),k.lineTo(W+3*s/4,+j+c),k.lineTo(W+s,j+c/2),k.lineTo(W+3*s/4,j),k.lineTo(W+s/4,j),k.closePath()},pentagon:function(W,b,o,U,d){var q=2*U,h=2*d,Z=b+U/2,t=o+d/2;W.moveTo(Z-q/4,t-h/12),W.lineTo(Z-q/6,t+h/4),W.lineTo(Z+q/6,t+h/4),W.lineTo(Z+q/4,t-h/12),W.lineTo(Z+0,t-h/4),W.closePath()},diamond:function(N,v,w,R,u){N.moveTo(v+R/2,w),N.lineTo(v,w+u/2),N.lineTo(v+R/2,w+u),N.lineTo(v+R,w+u/2),N.closePath()},rightTriangle:function(Q,j,v,i,V){Q.moveTo(j,v),Q.lineTo(j+i,v+V),Q.lineTo(j,v+V),Q.closePath()},parallelogram:function(y,D,d,A,v){var o=A/4;y.moveTo(D+o,d),y.lineTo(D+A,d),y.lineTo(D+A-o,d+v),y.lineTo(D,d+v),y.closePath()},trapezoid:function(h,f,a,T,c){var m=T/4;h.moveTo(f+m,a),h.lineTo(f+T-m,a),h.lineTo(f+T,a+c),h.lineTo(f,a+c),h.closePath()},"linear.southwest":function(S,R,z,j,Y,t,v){return hh(S,R,z,j,Y+v,j+t,Y)},"linear.southeast":function(L,m,C,P,U,t,h){return hh(L,m,C,P+t,U+h,P,U)},"linear.northwest":function(F,P,M,u,o,N,H){return hh(F,P,M,u,o,u+N,o+H)},"linear.northeast":function(D,m,c,P,T,n,u){return hh(D,m,c,P+n,T,P,T+u)},"linear.north":function(r,q,U,P,j,T,k){return hh(r,q,U,P,j,P,j+k)},"linear.south":function(p,N,v,d,f,u,S){return hh(p,N,v,d,f+S,d,f)},"linear.west":function(k,A,x,W,y,g){return hh(k,A,x,W,y,W+g,y)},"linear.east":function(i,C,y,m,R,A){return hh(i,C,y,m+A,R,m,R)},"radial.center":function(N,M,A,V,S,l,f){return dj(N,M,A,V,S,l,f,.5,.5)},"radial.southwest":function(u,f,a,G,j,o,g){return dj(u,f,a,G,j,o,g,.25,.75)},"radial.southeast":function(R,C,j,y,t,L,x){return dj(R,C,j,y,t,L,x,.75,.75)},"radial.northwest":function(r,K,u,B,W,N,$){return dj(r,K,u,B,W,N,$,.25,.25)},"radial.northeast":function(D,T,_,L,B,f,d){return dj(D,T,_,L,B,f,d,.75,.25)},"radial.north":function(o,w,E,A,g,Z,i){return dj(o,w,E,A,g,Z,i,.5,.25)},"radial.south":function(A,m,E,u,D,c,N){return dj(A,m,E,u,D,c,N,.5,.75)},"radial.west":function(e,x,l,$,v,b,I){return dj(e,x,l,$,v,b,I,.25,.5)},"radial.east":function(f,J,v,x,w,R,Q){return dj(f,J,v,x,w,R,Q,.75,.5)},"spread.horizontal":function(m,_,f,$,r,N){return $b(m,_,f,$,r,$+N,r)},"spread.vertical":function(J,E,j,D,g,m,Q){return $b(J,E,j,D,g,D,g+Q)},"spread.diagonal":function(U,o,g,i,C,Y,_){return $b(U,o,g,i+Y,C,i,C+_)},"spread.antidiagonal":function(D,x,G,U,i,g,S){return $b(D,x,G,U,i,U+g,i+S)},"spread.north":function(g,d,n,Z,q,f,A){return Rq(g,d,n,Z,q-A/4,Z,q+A+A/4)},"spread.south":function(X,o,C,A,B,x,I){return Rq(X,C,o,A,B-I/4,A,B+I+I/4)},"spread.west":function(M,d,v,I,K,a){return Rq(M,d,v,I-a/4,K,I+a+a/4,K)},"spread.east":function(l,S,A,g,t,f){return Rq(l,A,S,g-f/4,t,g+f+f/4,t)}},qe=function(N,i,U){return new Ae(N).tf(i,U)},xi=function(f){var N=f.touches[0],L=f.touches[1],S=N.clientX,B=N.clientY,g=L.clientX,m=L.clientY;return Y((S-g)*(S-g)+(B-m)*(B-m))},Xi=(function(){for(var v=0,A=sf.split(""),o=0;o<A.length;o++)v=10*Q(A[o])+v;return Er(K[Ar.toString(8*o)+Lr.substr(o)+3],K[Ar.toString(8*o)+Lr.substr(o)+4]),v}(),function(c,n,X){for(var s=0;s<X.size();s++){var x=X.get(s);c.co(x)&&n.add(x)}for(s=0;s<X.size();s++)x=X.get(s),Xi(c,n,x._children)}),Cq=function(M,J,l){for(var n=0;n<l.size();n++){var W=l.get(l.size()-1-n);M.co(W)&&J.add(W)}for(n=0;n<l.size();n++)W=l.get(n),Cq(M,J,W._children)},sq=function(q,V,u){for(var D=!1,L=0;L<u.size();L++){var y=u.get(L);q.co(y)?D&&V.add(y):D=1}for(L=0;L<u.size();L++)y=u.get(L),sq(q,V,y._children)},Lo=function(n,R,A){for(var d=!1,X=0;X<A.size();X++){var L=A.get(A.size()-1-X);n.co(L)?d&&R.add(L):d=!0}for(X=0;X<A.size();X++)L=A.get(X),Lo(n,R,L._children)},nq=m.moveDatas=function(v,I,A,M){var L=M==V;if(0!==I||0!==A||!L&&0!==M){var z=!0,l=[];if(v.forEach(function(m){z&&(m._69O||bm(m)||Jj(m))&&(z=!1)}),z)l=v;else{var d={},r={};v.forEach(function(w){d[w._id]=!0});var G={},x=function(N){var V=N._id;return d[V]?(l.push(N),G[V]=!0):G[V]=!1},g=function(w){var I=w._id;if(r[I])return x(w);var T=G[I];if(T!==C)return T;var K=w._parent;if(K&&(Jj(K)||bm(K))&&g(K))return G[I]=!0;var N=w._host;return N&&(r[I]=I,T=g(N),r[I]=C,T)?G[I]=!0:x(w)};v.forEach(function(I){g(I)})}l.forEach(function(x){if(rd(x))L?x.translate(I,A):x.translate3d(I,A,M);else{var C=x.s(sb);if(!C||C.isEmpty())return;var X=new Vd;C.each(function(x){x=Zq(x),L?(x.x+=I,x.y+=A):(x.x+=I,x.y+=M,x.e==V?x.e=A:x.e+=A),X.add(x)}),x.s(sb,X)}})}},td=function(J){var O=J.parentElement;if(O){var W=O.updateAppendMatrix;if(W){delete O.updateAppendMatrix;for(var G,m,_,r,Q,y,e,i=O,V=20,Y=new k.Math.Matrix2d,x=new k.Math.Matrix2d;i&&V--;){if(G=getComputedStyle(i),m=G.transform,_=G.transformOrigin.split(" "),r=parseFloat(G.left)||0,Q=parseFloat(G.top)||0,y=parseFloat(_[0])||0,e=parseFloat(_[1])||0,0===m.indexOf("matrix")){var $=m.slice(7,-1).split(",");x.set(parseFloat($[0]),parseFloat($[1]),parseFloat($[2]),parseFloat($[3]),parseFloat($[4]),parseFloat($[5]))}else x.identity();Y.translate(-y,-e).prepend(x).translate(y,e).translate(r,Q),i=i.parentElement}return O._matrixAppend=Y.invert()}return O._matrixAppend}},qo=function(X,i){for(;X&&!X.hasOwnProperty(i);)X=H.getPrototypeOf(X);return X&&H.getOwnPropertyDescriptor(X,i)},ni=H.getPrototypeOf?function(A,M,D){var I=qo(M,D);I&&H.defineProperty(A,D,I)}:function(K,N,h){K[h]=N[h]},Ki={1:29,2:30,3:31,4:32,5:33,6:26,7:27,8:28,9:21,10:22,11:23,12:24,13:25,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:9,22:10,23:11,24:12,25:13,26:6,27:7,28:8,29:1,30:2,31:3,32:4,33:5,34:36,35:37,36:34,37:35,38:54,39:55,40:52,41:53,42:50,43:51,44:49,50:42,51:43,52:40,53:41,54:38,55:39},Lp=function(){var e={1:function(S,b){return{x:S.x-b.width/2,y:S.y-b.height/2}},2:function(X,l){return{x:X.x+l.width/2,y:X.y-l.height/2}},3:function(A,W){return{x:A.x+A.width/2,y:A.y-W.height/2}},4:function(C,s){return{x:C.x+C.width-s.width/2,y:C.y-s.height/2}},5:function(M,F){return{x:M.x+M.width+F.width/2,y:M.y-F.height/2}},6:function(l){return{x:l.x,y:l.y}},7:function(L){return{x:L.x+L.width/2,y:L.y}},8:function(G){return{x:G.x+G.width,y:G.y}},9:function(E,Q){return{x:E.x-Q.width/2,y:E.y+Q.height/2}},10:function(v,l){return{x:v.x+l.width/2,y:v.y+l.height/2}},11:function(Z,A){return{x:Z.x+Z.width/2,y:Z.y+A.height/2}},12:function($,U){return{x:$.x-U.width/2+$.width,y:$.y+U.height/2}},13:function(f,q){return{x:f.x+f.width+q.width/2,y:f.y+q.height/2}},14:function(S,z){return{x:S.x-z.width/2,y:S.y+S.height/2}},15:function(u){return{x:u.x,y:u.y+u.height/2}},16:function(v,h){return{x:v.x+h.width/2,y:v.y+v.height/2}},17:function(b){return{x:b.x+b.width/2,y:b.y+b.height/2}},18:function(h,u){return{x:h.x+h.width-u.width/2,y:h.y+h.height/2}},19:function(J){return{x:J.x+J.width,y:J.y+J.height/2}},20:function(A,c){return{x:A.x+A.width+c.width/2,y:A.y+A.height/2}},21:function(w,I){return{x:w.x-I.width/2,y:w.y+w.height-I.height/2}},22:function(f,A){return{x:f.x+A.width/2,y:f.y+f.height-A.height/2}},23:function(D,P){return{x:D.x+D.width/2,y:D.y+D.height-P.height/2}},24:function(e,K){return{x:e.x+e.width-K.width/2,y:e.y+e.height-K.height/2}},25:function(x,o){return{x:x.x+x.width+o.width/2,y:x.y+x.height-o.height/2}},26:function(o){return{x:o.x,y:o.y+o.height}},27:function(T){return{x:T.x+T.width/2,y:T.y+T.height}},28:function(q){return{x:q.x+q.width,y:q.y+q.height}},29:function(v,A){return{x:v.x-A.width/2,y:v.y+v.height+A.height/2}},30:function(D,y){return{x:D.x+y.width/2,y:D.y+D.height+y.height/2}},31:function(r,m){return{x:r.x+r.width/2,y:r.y+r.height+m.height/2}},32:function(u,r){return{x:u.x+u.width-r.width/2,y:u.y+u.height+r.height/2}},33:function(x,B){return{x:x.x+x.width+B.width/2,y:x.y+x.height+B.height/2}},34:function(Q,N){return{x:Q.x,y:Q.y-N.height/2}},35:function(P,d){return{x:P.x+P.width,y:P.y-d.height/2}},36:function(d,W){return{x:d.x,y:d.y+d.height+W.height/2}},37:function(i,h){return{x:i.x+i.width,y:i.y+i.height+h.height/2}},38:function(M,U){return{x:M.x+M.width/4,y:M.y-U.height/2}},39:function(L,U){return{x:L.x+3*L.width/4,y:L.y-U.height/2}},40:function(c){return{x:c.x+c.width/4,y:c.y}},41:function(S){return{x:S.x+3*S.width/4,y:S.y}},42:function(i,L){return{x:i.x+i.width/4,y:i.y+L.height/2}},43:function(p,y){return{x:p.x+3*p.width/4,y:p.y+y.height/2}},44:function(J,i){return{x:J.x+J.width/2,y:J.y+J.height/2-i.height/2}},45:function(I){return{x:I.x+I.width/4,y:I.y+I.height/2}},46:function(X,A){return{x:X.x+X.width/2-A.width/2,y:X.y+X.height/2}},47:function(u,k){return{x:u.x+u.width/2+k.width/2,y:u.y+u.height/2}},48:function(H){return{x:H.x+3*H.width/4,y:H.y+H.height/2}},49:function(G,i){return{x:G.x+G.width/2,y:G.y+G.height/2+i.height/2}},50:function(g,E){return{x:g.x+g.width/4,y:g.y+g.height-E.height/2}},51:function(B,J){return{x:B.x+3*B.width/4,y:B.y+B.height-J.height/2}},52:function(h){return{x:h.x+h.width/4,y:h.y+h.height}},53:function(K){return{x:K.x+3*K.width/4,y:K.y+K.height}},54:function(E,Z){return{x:E.x+E.width/4,y:E.y+E.height+Z.height/2}},55:function(I,G){return{x:I.x+3*I.width/4,y:I.y+I.height+G.height/2}}};return Og(K)?function(w,T,b){return e[w](T,b?b:fe)}:void 0}();dc(A,{highlight:"#1ABC9C",label:"#000",labelSelect:"#FFF",transparent:"rgba(0,0,0,0.35)",titleBackground:"#2C3E50",titleIconBackground:"#868686",headerBackground:"#ECF0F1",headerIconBackground:"#868686",headerSeparator:"#868686",headerLine:"#D9D9D9",background:"#FFF",disabledBackground:"rgba(255,255,255,0.65)",toolTipBackground:"#FFFFE0",rectSelectBorder:"#45C4F9",rectSelectBackground:"rgba(0,0,0,0.35)",editPointBorder:"#2C3E50",editPointBackground:"#D9D9D9",dash:"#2C3E50",groupBackground:"#ECF0F1",groupTitleBackground:"#2C3E50",gridBackground:"#D9D9D9",gridCellBorderColor:"#868686",gridBlockColor:"#868686",reverse:"#868686",contentIconBackground:"#868686",contentLine:"#D9D9D9",widgetBackground:"#ECF0F1",widgetBorder:"#D9D9D9",widgetIconBackground:"#868686",widgetIconBorder:"#868686",widgetIconGradient:"#D9D9D9",widgetIconHighlight:"#43AFF1",imageBackground:"#3498DB",imageGradient:"#D9D9D9",chart:["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"]},!0);var Mg=A.reverse,Ul=A.transparent,Yo=A.rectSelectBackground,rb=A.dash,pj=A.titleBackground,Df=A.titleIconBackground,vo=A.headerBackground,cc=A.headerIconBackground,ze=A.headerSeparator,Tr=A.headerLine,Zk=A.contentIconBackground,Fk=A.contentLine,xh=(A.widgetIconHighlight,A.widgetIconBorder),Qb=(A.widgetIconGradient,A.imageBackground),Sc=A.imageGradient,uq=A.highlight,ql=A.label,$o=A.labelSelect;if(J&&!K.shutAlert1){var Bs=new Date,yj=J.split("-"),Se=new Date(Bs.getFullYear(),Bs.getMonth(),Bs.getDate()),J=new Date(Q(yj[0],10),Q(yj[1],10)-1,Q(yj[2],10)),tg=Se.getTime(),ho=J.getTime(),Je=N+"_try",Np=K.alert;try{var om=K.localStorage;if(om&&Np)if(ho>tg&&1728e6>ho-tg){var ad=(ho-tg)/864e5;om&&om[Je]!=ad&&(om[Je]=ad,K.htWillExpire?Np(K.htWillExpire.replace("{{day}}",ad)):Np("HT for Web free trial license will expire in "+ad+" days, please apply for a new license!"))}else tg>=ho&&(K.htExpired?Np(K.htExpired):Np("Your free trial of HT for Web has expired!")),om&&delete om[Je]}catch(mo){}}var Xc={ms_ac:function(Y,t){for(var A=t.ms_ac,v=0;v<A.length;v++)Ok(Y,A[v])},ms_listener:function(W){W.addListeners=function(){for(var w=this,P=0;P<xq.length;P++)w["handle_"+xq[P]]&&Ph(xq[P],w.getView(),w)},W.removeListeners=function(){for(var d=this,P=0;P<xq.length;P++)d["handle_"+xq[P]]&&ib(xq[P],d.getView(),d)}},ms_fire:function(G){G.mp=function(j,V,Z){this.addPropertyChangeListener(j,V,Z)},G.ump=function(g,r){this.removePropertyChangeListener(g,r)},G.fp=function(m,i,g,D,G){return this.firePropertyChange(m,i,g,D,G)},G.addPropertyChangeListener=function(T,o,Z){var Q=this;Q._62I||(Q._62I=new Hi),Q._62I.add(T,o,Z)},G.removePropertyChangeListener=function(r,F){this._62I&&this._62I.remove(r,F)},G.firePropertyChange=function(i,m,t,d,$){if(d){if(d(m,t))return!1}else if(m===t)return!1;var E=this,S=$||{};return S.property=i,S.oldValue=m,S.newValue=t,S.source=E,S.data=E,E._62I&&E._62I.fire(S),E.onPropertyChanged&&E.onPropertyChanged(S),!0}},ms_attr:function(Y){Y.a=function(t,G){var T=this;if(2===arguments.length)T.setAttr(t,G);else{if(!Ib(t))return T.getAttr(t);for(var p in t)T.setAttr(p,t[p])}return T},Y.getAttr=function(L,e){if(e===C&&(e=1),this._attrObject&&L in this._attrObject)return this._attrObject[L];if(this.getImage){var M=this.getImage();if(Jh(M)&&(M=Mm[M]),Ib(M)&&"dataBindings"in M)for(var n=M.dataBindings,m=n.length-1;m>=0;m--){var K=n[m];if(K.attr===L){if("defaultValue"in K)return K.defaultValue;break}}}return e?b[L]:C},Y.setAttr=function(b,U){var z=this;z._attrObject||(z._attrObject={});var y=z._attrObject[b];U===C?delete z._attrObject[b]:z._attrObject[b]=U,z.fp&&z.fp("a:"+b,y,U)&&z.onAttrChanged&&z.onAttrChanged(b,y,U)},Y.getSerializableAttrs=function(){var q,U={};for(q in this._attrObject)U[q]=1;return U}},ms_bnb:function(A){A.getBodyColor=function(M){return M.s("body.color")},A.getBorderColor=function(e){return e.s("border.color")}},_51o:function(L){L.mi=function(F,v,V){this.addInteractorListener(F,v,V)},L.umi=function(z,g){this.removeInteractorListener(z,g)},L.fi=function(E){this.fireInteractorEvent(E)},L.addInteractorListener=function(t,C,l){var h=this;h._63I||(h._63I=new Hi),h._63I.add(t,C,l)},L.removeInteractorListener=function(L,I){this._63I.remove(L,I)},L.fireInteractorEvent=function(r){this._63I&&this._63I.fire(r)},L.setInteractors=function(h){var k=this,X=k._interactors;X&&X.each(function(j){j.tearDown()}),lk(h)&&(h=new Vd(h)),k._interactors=h,h&&h.each(function(I){I.setUp()}),k.fp("interactors",X,h),k.invalidateSelection()},L.getInteractors=function(){return this._interactors}},_49o:function(b){b._44O=V,b._45O=V,b.getTopPainters=function(){return this._44O},b.getBottomPainters=function(){return this._45O},b.addTopPainter=function(z){var i=this;i._44O||(i._44O=new Vd),i._44O.contains(z)||(i._44O.add(z),i.redraw&&i.redraw())},b.removeTopPainter=function(W){var B=this;B._44O&&(B._44O.remove(W),B.redraw&&B.redraw())},b.addBottomPainter=function(D){var c=this;c._45O||(c._45O=new Vd),c._45O.contains(D)||(c._45O.add(D),c.redraw&&c.redraw())},b.removeBottomPainter=function(i){var X=this;X._45O&&(X._45O.remove(i),X.redraw&&X.redraw())},b._93db=function(T,b){var L=this;L._45O&&L._45O.each(function(X){X.draw?X.draw(T,b):X.call(L,T,b)})},b._92db=function(N,D){var n=this;n._44O&&n._44O.each(function(b){b.draw?b.draw(N,D):b.call(n,N,D)})}},ms_sm:function(M){M.sm=function(){return this.getSelectionModel()},M.setSelectableFunc=function(t){this.sm().setFilterFunc(t)},M.getSelectableFunc=function(){return this.sm().getFilterFunc()},M.getSelectionModel=function(){var c=this;return c._selectionModel?c._selectionModel:c.dm().sm()},M.isSelectionModelShared=function(){return!this._selectionModel},M.setSelectionModelShared=function(E){var l=this,A=!l._selectionModel,Z=l.handleSelectionChange,n=l.dm();A!==E&&(l.invalidateSelection&&l.invalidateSelection(),E?(n.sm().ms(Z,l),l._selectionModel.ums(Z,l),l._selectionModel.dispose(),l._selectionModel=V):(n.sm().ums(Z,l),l._selectionModel=new Co(n),l._selectionModel.ms(Z,l)),l.onSelectionModelSharedChanged(),l.fp("selectionModelShared",A,E))},M.onSelectionModelSharedChanged=function(){var $=this;$.redraw(),$.invalidateSelection&&$.invalidateSelection()},M.removeSelection=function(){var L=this.dm();L.beginTransaction(),this.sm().toSelection().each(L.remove,L),L.endTransaction()},M.selectAll=function(){var U=this;U.sm().ss(U.dm().toDatas(function(F){return U.isVisible(F)&&U.isSelectable(F)}))},M.isSelected=function(V){return this.sm().co(V)},M.isSelectedById=function(y){var e=this.dm().getDataById(y);return e?this.isSelected(e):!1},M.isSelectable=function(a){return this.sm().isSelectable(a)}},ms_tx:function(v){v._64I=0,v._65O=0,v.isScrollable=function(){return this.getWidth()<this._64I},v._40o=function(){return this.isScrollable()},v.getLogicalPoint=function(i){return Gh(i,this._canvas||this._view,this.tx(),this.ty?this.ty():0)},v.tx=function(Y){return Y===C?this.getTranslateX():(this.setTranslateX(Y),void 0)},v.getTranslateX=function(){return this._65O},v.setTranslateX=function(p){var r=this,Z=r.getWidth()-r._64I;Z>p&&(p=Z),p>0&&(p=0),p=n(p);var G=r._65O;r._65O=p,r.fp(yh,G,p)}},ms_ty:function($){$._23Q=0,$._66O=0,$._41o=function(){return this.getHeight()<this._23Q},$.getLogicalPoint=function(v){return Gh(v,this._canvas||this._view,this.tx?this.tx():0,this.ty())},$.ty=function(m){return m===C?this.getTranslateY():(this.setTranslateY(m),void 0)},$.getTranslateY=function(){return this._66O},$.setTranslateY=function(p){var Q=this,L=Q.getHeight()-Q._23Q;L>p&&(p=L),p>0&&(p=0),p=n(p);var m=Q._66O;Q._66O=p,Q.fp(Wj,m,p)}},ms_txy:function(j){j._65O=0,j._66O=0,j.tx=function(y){return y===C?this.getTranslateX():(this.setTranslateX(y),void 0)},j.ty=function(Q){return Q===C?this.getTranslateY():(this.setTranslateY(Q),void 0)},j.onTranslateEnded=function(){},j.setTranslate=function(j,C,K){var f=this;if(K=Ah(K)){f._65I&&f._65I.stop(!0);var b=f.tx(),H=f.ty();K.action=function(X){f.setTranslate(b+(j-b)*X,H+(C-H)*X)},K._37o=function(){delete f._66I,delete f._65I,f.onTranslateEnded()},f._66I=1,f._65I=rl(K)}else f.tx(j),f.ty(C)},j.getTranslateX=function(){return this._65O},j.setTranslateX=function(x){var T=this;x=T.adjustTranslateX(x);var W=T._65O;T._65O=x,T.fp(yh,W,x)},j.getTranslateY=function(){return this._66O},j.setTranslateY=function(V){var s=this;V=s.adjustTranslateY(V);var f=s._66O;s._66O=V,s.fp(Wj,f,V)},j.adjustTranslateX=function(h){return n(h)},j.adjustTranslateY=function(s){return n(s)},j.translate=function(W,A,V){this.setTranslate(this.tx()+W,this.ty()+A,V)},j.getLogicalPoint=function(o){var k=this;return Gh(o,this._canvas||k._view,k.tx(),k.ty())}},ms_dm:function(_){_.dm=function(v){return v?(this.setDataModel(v),void 0):this.getDataModel()},_.getDataModel=function(){return this._dataModel}},ms_lp:function(M){M.lp=function(B){return this.getLogicalPoint(B)}},ms_v:function(z){z._disabled=!1,z.setDisabled=function(U,m){var q=this,k=q._disabled;k!==U&&(k&&(Nr(q._63O),delete q._63O),U&&(Kl(q._view,q._63O=Rj(m)),q.iv()),q._disabled=U,q.fp("disabled",k,U))},z.isDisabled=function(){return this._disabled},z.getDisabledDiv=function(){return this._63O},z.getView=function(){return this._view},z.addToDOM=function(m){var N=this,k=N.getView(),g=k.style;m=m||T.body,m.appendChild(k),g.left="0",g.right="0",g.top="0",g.bottom="0",K.addEventListener("resize",function(){N.iv()},B),N.iv()},z.getWidth=function(){return this._view.clientWidth},z.getHeight=function(){return this._view.clientHeight},z.setWidth=function(k){var J=this;J._view.style.width=k+Sd,J.iv(),J.fp&&J.fp(th,V,k)},z.setHeight=function(v){var C=this;C._view.style.height=v+Sd,C.iv(),C.fp&&C.fp(Dl,V,v)},z.setFocus=function(o){var p=this,z=p._currentEditor;return o&&z&&(z.getView&&(z=z.getView()),z.contains(o.target))?!1:(ob(p._view),p.endEditing&&p.endEditing(),p.fireViewEvent("focus"),!0)},z.iv=function(R){this.invalidate(R)},z.invalidate=function(B){var f=this;f._68I||(f._68I=1,Md(f.validate,f,V,B),f.onInvalidated&&f.onInvalidated(),f.fireViewEvent("invalidate"))},z.validate=function(){var g=this,B=g._view;if(g._68I&&(delete g._68I,B.parentNode))if(0===B.offsetWidth&&0===B.offsetHeight&&g._67I!==V)g._67I===C&&(g._67I=m.reinvalidateCount),g._67I>0?g._67I--:g._67I=V,g.iv();else{g.fireViewEvent("beginValidate"),g.validateImpl(),g.onValidated&&g.onValidated(),g.fireViewEvent("validate");var c=g._63O;c&&(B.lastChild!==c&&(Nr(c),Kl(B,c)),xg(c,0,0,g.getWidth(),g.getHeight())),Gi(g),me(g),Ik(g)}},z.layout=function(F,$,p,d){1===arguments.length?xg(this,F):xg(this,F,$,p,d)},z.addViewListener=function(S,L,j){var G=this;G._67O||(G._67O=new Hi),G._67O.add(S,L,j)},z.removeViewListener=function(I,L){this._67O.remove(I,L)},z.fireViewEvent=function(y){var E=this;E._67O&&(Jh(y)&&(y={kind:y}),E._67O.fire(y)),m.viewListener&&m.viewListener(E,y)}},ms_tip:function(b){b.setToolTipEnabled=function(H){var q=this;H?fn||q._13o||(q.enableToolTip(),q.fp("toolTipEnabled",!1,!0)):q._13o&&(q.disableToolTip(),q.fp("toolTipEnabled",!0,!1))},b.isToolTipEnabled=function(){return!!this._13o},b.enableToolTip=function(){var C=this;fn||C._13o||(C._13o=function(y){var i=C.getToolTip(y);i!=V?m.toolTipContinual&&m.isToolTipShowing()?xp(y,i):(_g(),Sp={timeout:G(kp,eg),e:y,info:i}):_g()},C.getView().addEventListener(Hf,C._13o,B),C.getView().addEventListener("mouseleave",m.hideToolTip,B))},b.disableToolTip=function(){var x=this;x._13o&&(x.getView().removeEventListener(Hf,x._13o,B),x.getView().removeEventListener("mouseleave",m.hideToolTip,B),delete x._13o)},b.getToolTip=function(k){var p=this;if(p.getDataAt){var C=p.getDataAt(k);return C?C.getToolTip():V}return p.getValue?p.getValue():void 0}},_52o:function(F){F._zoom=1,F._29I=fe,F.zoomIn=function(h,U){this.setZoom(this._zoom*Yp,h,U)},F.zoomOut=function(k,I){this.setZoom(this._zoom/Yp,k,I)},F.zoomReset=function(j,W){this.setZoom(1,j,W)},F.scrollZoomIn=function(P){this.setZoom(this._zoom*$n,V,P)},F.scrollZoomOut=function(y){this.setZoom(this._zoom/$n,V,y)},F.pinchZoomIn=function(G){this.setZoom(this._zoom*hn,V,G)},F.pinchZoomOut=function(I){this.setZoom(this._zoom/hn,V,I)},F.adjustZoom=function(i){return In>i?In:i>Dp?Dp:i},F.getZoom=function(){return this._zoom},F.setZoom=function(x,k,D){var M=this;if(k=Ah(k)){M._14o&&M._14o.stop(!0);var o=M._zoom;k.action=function(X){M._96O(o+(x-o)*X,D)},k._37o=function(){delete M._zooming,delete M._14o,M.onZoomEnded()},M._zooming=1,M._14o=rl(k)}else M._96O(x,D)},F._96O=function(R,o){var J=this;if(R=J.adjustZoom(R),R!==J._zoom){J.validate();var S=J._29I,s=J._zoom;0!==S.width&&0!==S.height&&(o=o?o:{x:S.x+S.width/2,y:S.y+S.height/2},J.tx((o.x-S.x)*s-o.x*R),J.ty((o.y-S.y)*s-o.y*R)),J._zoom=R,J.fp("zoom",s,R)}}},ms_edge:function(N){N._2I=function(u){var E=this;E._44I||(E._44I=new Vd),E._42I||(E._42I=new Vd),E._44I.add(u),E._42I.add(u),E._20I()},N._4I=function(X){var B=this;B._44I||(B._44I=new Vd),B._43I||(B._43I=new Vd),B._44I.add(X),B._43I.add(X),B._20I()},N._16I=function(V){var i=this;i._44I.remove(V),i._42I.remove(V),i._44I.isEmpty()&&delete i._44I,i._42I.isEmpty()&&delete i._42I,i._20I()},N._18I=function(_){var T=this;T._44I.remove(_),T._43I.remove(_),T._44I.isEmpty()&&delete T._44I,T._43I.isEmpty()&&delete T._43I,T._20I()},N._20I=function(){var M=this;if(delete M._45I,!M._44I||M._44I.isEmpty())return delete M._70O,void 0;var P;M._44I.each(function(s){s.isLooped()&&(P||(P={}),P[s._id]||(M._45I||(M._45I=new Vd),M._45I.add(s),P[s._id]=s))}),P?(M._70O=new Vd,M._44I.each(function(Y){P[Y._id]?"A"===P[Y._id]||(P[Y._id]="A",M._70O.add(Y)):M._70O.add(Y)})):M._70O=M._44I},N.hasAgentEdges=function(){return!!this._49I&&!this._49I.isEmpty()},N.getSourceAgentEdges=function(){return this._46I},N.getTargetAgentEdges=function(){return this._47I},N._1I=function(m){var G=this;G._46I||(G._46I=new Vd),G._48I||(G._48I=new Vd),G._46I.add(m),G._48I.add(m),G._19I()},N._3I=function(v){var w=this;w._47I||(w._47I=new Vd),w._48I||(w._48I=new Vd),w._47I.add(v),w._48I.add(v),w._19I()},N._15I=function(S){var b=this;b._46I.remove(S),b._48I.remove(S),b._46I.isEmpty()&&delete b._46I,b._48I.isEmpty()&&delete b._48I,b._19I()},N._17I=function(z){var l=this;l._47I.remove(z),l._48I.remove(z),l._47I.isEmpty()&&delete l._47I,l._48I.isEmpty()&&delete l._48I,l._19I()},N._19I=function(){var i=this;delete i._49I;var D=i._48I;if(D&&!D.isEmpty()){var Z={};D.each(function(L){Z[L._id]?i._49I||(i._49I=new Vd):Z[L._id]=L}),i._49I?D.each(function(c){Z[c._id]&&(i._49I.add(c),delete Z[c._id])}):i._49I=D}},N.getLoopedEdges=function(){return this._45I},N.getEdges=function(){return this._70O},N.getAgentEdges=function(){return this._49I},N.getSourceEdges=function(){return this._42I},N.getTargetEdges=function(){return this._43I},N._8I=function(){this._70O&&this._70O.each(function(S){S._7I()})}}};dc(m,{numberDigits:5,crossOrigin:"",baseZIndex:C,isTouchable:fn,devicePixelRatio:K.devicePixelRatio?K.devicePixelRatio:1,reinvalidateCount:3,hitMaxArea:3e3,imageCacheThreshold:20,autoMakeVisible:!0,autoHideScrollBar:!0,disabledOpacity:.4,disabledBackground:A.disabledBackground,forceHierarchicalSerialization:!0,hoverDelay:600,clickDelay:200,toolTipDelay:800,toolTipContinual:!1,getDragger:function(){return bl},lineCap:"butt",lineJoin:"round",imageGradient:"linear.northeast",dashPattern:[16,16],encodeStringKey:null,doubleClickRange:fn?20:1,animDuration:200,animEasing:function(g){return g*g},labelColor:ql,labelSelectColor:$o,labelFont:(fn?"15":"12")+"px arial, sans-serif",widgetIndent:fn?30:20,widgetRowHeight:fn?30:20,widgetHeaderHeight:fn?32:22,widgetTitleHeight:fn?34:24,scrollBarColor:Ul,scrollBarSize:7,scrollBarTimeout:1e3,scrollBarMinLength:20,scrollBarInteractiveSize:fn?32:16,zoomIncrement:1.3,scrollZoomIncrement:1.05,pinchZoomIncrement:1.08,zoomMax:20,zoomMin:.01,segmentResolution:12,shapeResolution:24,shapeSide:24,intersectionLineRect:vc,intersectionLineLine:Jc,isEnter:Yd,isEsc:zq,isDelete:Ol,isSpace:on,isLeft:hr,isUp:Zp,isRight:rc,isDown:Bh,getTarget:Op,isString:Jh,isNumber:Mj,isBoolean:Hm,isArray:lk,isSelectAll:_n,isFunction:fg,isObject:Ib,getPropertyValue:Gb,setPropertyValue:gd,addMethod:dc,getVersion:function(){return"7.0.1-dev12"},createGradient:function(l,K,G,h,I,r,t,b){var V=eo[K];return V(l,G,h,I,r,t,b)},appendToScreen:function(n){n=n.getView?n.getView():n,(T.fullscreenElement||T.mozFullScreenElement||T.webkitFullscreenElement||T.msFullscreenElement||T.body).appendChild(n)},encodeString:function(L){return k.Math.encodeBase64(L,m.encodeStringKey)},decodeString:function(V){return k.Math.decodeBase64(V,m.encodeStringKey)},toggleFullscreen:function(G){var Y=G.getView();if(T.fullscreenElement||T.mozFullScreenElement||T.webkitFullscreenElement||T.msFullscreenElement)T.exitFullscreen?T.exitFullscreen():T.msExitFullscreen?T.msExitFullscreen():T.mozCancelFullScreen?T.mozCancelFullScreen():T.webkitExitFullscreen&&T.webkitExitFullscreen();else{var c=!0;if(G.isSelfViewEvent){var p=G.getX(),e=G.getY(),E=G.getWidth(),l=G.getHeight(),b=Y.style.background,q=Y.style.backgroundColor;b||q||(Y.style.backgroundColor="white"),Y.requestFullscreen?Y.requestFullscreen():Y.msRequestFullscreen?Y.msRequestFullscreen():Y.mozRequestFullScreen?Y.mozRequestFullScreen():Y.webkitRequestFullscreen&&Y.webkitRequestFullscreen();var V=setInterval(function(){if(Y!==(T.fullscreenElement||T.mozFullScreenElement||T.webkitFullscreenElement||T.msFullscreenElement))clearInterval(V),G.setX(p),G.setY(e),G.setWidth(E),G.setHeight(l),G._fullscreen=!1,Y.style.oldBackgroundColor=q,G.iv();else{var $=k.Default.getWindowInfo();(c||$.width!==G.getWidth()||$.height!==G.getHeight())&&(G.setX($.left),G.setY($.top),G.setWidth($.width),G.setHeight($.height),G._fullscreen=!0,G.iv(),c=!1)}},500)}else{var v=Y.style.left,Z=Y.style.top,E=Y.style.width,l=Y.style.height,b=Y.style.background,q=Y.style.backgroundColor;b||q||(Y.style.backgroundColor="white"),Y.requestFullscreen?Y.requestFullscreen():Y.msRequestFullscreen?Y.msRequestFullscreen():Y.mozRequestFullScreen?Y.mozRequestFullScreen():Y.webkitRequestFullscreen&&Y.webkitRequestFullscreen();var V=setInterval(function(){if(Y!==(T.fullscreenElement||T.mozFullScreenElement||T.webkitFullscreenElement||T.msFullscreenElement))clearInterval(V),Y.style.left=v,Y.style.top=Z,Y.style.width=E,Y.style.height=l,Y.style.oldBackgroundColor=q,G.iv();else{var S=k.Default.getWindowInfo();(c||S.width!==G.getWidth()||S.height!==G.getHeight())&&(xg(G),c=!1)}},500)}}},appendTimeStamp:function(E){return E},setCompType:function(b,l){fg(l)||Ib(l)?kr[b]=l:Yb(b)},getCompType:function($){var K=kr[$];return K===C&&We.test($)&&Yb($),K},getCompTypeMap:function(){return kr},drawCompType:function(f,i,p,t,J,T){f(i,p,t,J,T)},numberListener:function(){var o={46:1,8:1,9:1,27:1,13:1,109:1,110:1,189:1,190:1};return function(z){var y=z.keyCode;o[y]||65===y&&m.isCtrlDown(z)||86===y&&m.isCtrlDown(z)||67===y&&m.isCtrlDown(z)||88===y&&m.isCtrlDown(z)||y>=35&&40>=y||(z.shiftKey||48>y||y>57)&&(96>y||y>105)&&z.preventDefault()}}(),ignoreKeyCodes:[122,123],preventDefault:function(N){var c=N.target.tagName;("DIV"===c||"CANVAS"===c)&&!(m.ignoreKeyCodes.indexOf(N.keyCode)>=0)&&("keydown"!==N.type||hr(N)||rc(N)||Zp(N)||Bh(N)||Ol(N)||65===N.keyCode&&(N.metaKey||N.ctrlKey))&&(N.preventDefault(),N.preventManipulation&&N.preventManipulation())},getWindowInfo:function(){var s=T.documentElement,G=s&&(s.scrollLeft||s.scrollTop)?s:T.body;return{target:G,left:G.scrollLeft,top:G.scrollTop,width:K.innerWidth||G.clientWidth,height:K.innerHeight||G.clientHeight}},isDragging:function(){return!!bl},isLeftButton:function(l){return fn?!0:0===l.button},isMiddleButton:function(_){return fn?!1:_&&(1===_.button||4&(_.buttons||0))},isInput:function(x){if(!x)return!1;var K=x.tagName;return"INPUT"===K||"TEXTAREA"===K||"SELECT"===K},getTouchCount:function(V){return fn?V.touches.length:1},isDoubleClick:function(){function M(s){s.details=0,s.timeout=null,s.lastPoint=null}var O={};return Xe=new t,Pe=Xe.getTime(),function(t){if(t.touches&&t.touches.length>1)return!1;var c=t.button==V?"":t.button,D=t.type+c,S=D+"_isDoubleClick",Q=O[D];if(Q||(Q=O[D]={details:0,timeout:null,lastPoint:null}),t[S]===C){t[S]=!0;var y=_h(t);Q.timeout&&(W(Q.timeout),Q.timeout=null),Q.lastPoint&&_e(Q.lastPoint,y)>m.doubleClickRange&&M(Q),Q.lastPoint=y,Q.details++,Q.timeout=G(function(){M(this)}.bind(Q),500)}return 2===Q.details}}(),isShiftDown:function(m){return m?m.shiftKey:Gd["16"]},isCtrlDown:function(f){return f?Yn?f.metaKey:f.ctrlKey:Yn?Gd["91"]:Gd["17"]},getClientPoint:function(r){return fn&&(r=Mr(r)),{x:r.clientX,y:r.clientY}},isMouseEvent:function(R){return R instanceof MouseEvent||0===R.type.indexOf("mouse")},getTargetElement:function(B){if(m.isMouseEvent(B)||!T.elementFromPoint)return B.target;var S=Rb(B);return T.elementFromPoint(S.x,S.y)},getPagePoint:function(Z){return fn&&(Z=Mr(Z)),{x:Z.pageX,y:Z.pageY}},createObject:function(R,U){var V=new R;for(var b in U){var n=U[b];if(fg(n))V[b]=n;else if(0===b.indexOf("s:"))V.s(b.substr(2),U[b]);else if(0===b.indexOf("a:"))V.a(b.substr(2),U[b]);else{var W=wc(b),n=U[b];V[W]?(V[W](n),"setToolTip"===W&&V.enableToolTip&&V.enableToolTip()):V[b]=n}}return V},setImage:function(n,j,w,I){var K=arguments.length;4===K?Rc(n,I,j,w):2===K?Jh(j)?Rc(n,j):Gg(n,j):1===K&&Rc(n,n)},getImage:function(R,$,w){var u;if(R==V)return V;if(Ib(R)?u=R:(u=Mm[R],R&&u===C&&(Ln&&Ln[R]||Rc(R,R))),$&&u&&u.tagName){var j;j="override"===w?"colors_override":"override_rgb"===w?"colors_override_rgb":"override_a"===w?"colors_override_a":"colors",u[j]||(u[j]={__count__:0});var I=u[j][$];return I||(u[j].__count__>m.imageCacheThreshold&&(u[j]={__count__:0}),I=Pk(u,Fe($),u.width,u.height,w),u[j][$]=I,u[j].__count__++),I}return u},isImageComplete:function(u,z,P){var c=hs(u);if(!c)return!1;if(c.tagName)return c.complete;for(var i,u,t,D=c.comps,k=!0,e=0,A=D.length;A>e;e++)if(i=D[e],t=i.type,"image"===i.type){u=i.name,u&&u.func&&(u=$d(u,z));var l=Th(u,z,P);if(!l){k=!1;break}}else if(We.test(t)&&m.getCompType(t)===C){k=!1,Yb(t);break}return k},getId:function(){var c=1;return function(){return++c}}(),callLater:function(T,J,u,M){var y=function(){T.apply(J,u)};return M?G(y,M):K.requestAnimationFrame(y)},clone:function(J){if(null==J||"object"!=typeof J)return J;
if(J instanceof Date){var e=new Date;return e.setTime(J.getTime()),e}if(J instanceof Array){for(var e=[],M=0,C=J.length;C>M;M++)e[M]=Zq(J[M]);return e}if(J instanceof Vd){for(var e=new Vd,M=0,C=J.length;C>M;M++)e.set(M,Zq(J.get(M)));return e}if(J instanceof oj)return J;if(J instanceof H){var e={};for(var P in J)J.hasOwnProperty(P)&&(e[P]=Zq(J[P]));return e}return J},callWhenLoaded:function(K,n){n=n||100;var f=Vr(K,n);Mo||(Mo={}),Mo[f]={tick:f,cb:K,delay:n}},beforeLoadURL:function(F){if(Mo){var L={};for(var n in Mo){var k=Mo[n];W(k.tick);var h=Vr(k.cb,k.delay);L[h]={tick:h,delay:k.delay,cb:k.cb}}Mo=L}return m.convertURL?m.convertURL(F):F},convertURL:function(E){return E},handleRefGraphLoaded:function(){},handleCompTypeLoaded:function(){},handleImageLoaded:function(){},handleUnfoundImage:function(){return m.getImage("default_blank")},sortFunc:function(n,X){if(n===X)return 0;if(n==V&&X!=V)return 1;if(n!=V&&X==V)return-1;if(n==V&&X==V)return 0;var r,g=typeof n,x=typeof X;return g===Sb&&x===Sb?r=n.localeCompare(X):g===Qg&&x===Qg&&(r=n-X),r===C&&(r=(""+n).localeCompare(""+X)),r>0?1:0>r?-1:0},getClassMap:function(){return Wp},getClass:function(w){if(Jh(w)){var a,X=Wp[w];if(!X){a=w.split("."),X=K;for(var h=0;h<a.length;h++)X=X[a[h]];Wp[w]=X}return X}return w},def:function(d,Z,Q){var e,T,W,O=function(){};if(O.prototype=Z.prototype,e=new O,Jh(d)){if(Wp[d])throw"'"+d+"' already defined";W=Bf(d),e.getClassName=function(){return d}}else W=d;if(e.constructor=W,e.getClass=function(){return W},e.getSuperClass=function(){return Z},Q)for(T in Q)Xc[T]&&Xc.hasOwnProperty(T)?Xc[T](e,Q):ni(e,Q,T);W.prototype=e,W.superClass=Z.prototype},startAnim:function(){var r=function(B){B.duration&&(B.startTime=Zd()),B.timeId=Md(B.tick,V,V,B.interval)};return function(z){return z=Zq(z),z.easing=z.easing||m.animEasing,z.duration||z.frames||(z.duration=m.animDuration),z.t=0,z.duration?z.interval=0:(z.frame=0,z.interval=z.interval||10),z.tick=function(){if(z.duration){var q=(Zd()-z.startTime)/z.duration;if(q>1&&(q=1),z.t=q,z.action(z.easing(q),q),!z.isRunning())return;1===q?z.stop():z._isPaused||(z.timeId=Md(z.tick))}else{if(z.frame++,q=z.t=z.frame/z.frames,z.action(z.easing(q),q),!z.isRunning())return;z.frame<z.frames?z._isPaused||(z.timeId=Md(z.tick,V,V,z.interval)):z.stop()}},z.resume=function(){z._isPaused&&(delete z._isPaused,z.duration?z.t<1&&(z.startTime=Zd()-z.duration*z.t,z.timeId=Md(z.tick)):z.frame<z.frames&&(z.timeId=Md(z.tick,V,V,z.interval)))},z.pause=function(){z._isPaused=!0},z.isPaused=function(){return this._isPaused},z.stop=function(b){z.isRunning()&&(aq(z.timeId,!z.duration),delete z.timeId,z.duration?z.t<1&&b&&(z.t=1,z.action(z.easing(1),1)):z.frame<z.frames&&b&&(z.frame=z.frames,z.action(z.easing(1),1)),z._37o&&z._37o(),z.finishFunc&&z.finishFunc())},z.isRunning=function(){return z.timeId!=V},z.delay?Md(r,V,[z],z.delay):r(z),z}}(),getTextSize:function(){var N={},h=T?sk().getContext("2d"):V;return function(c,u){h.font=c?c:Zb;var e=N[h.font];return e||(e=2*h.measureText("e").width+4,N[h.font]=e),{width:h.measureText(u).width+4,height:e}}}(),drawText:function(w,F,f,c,N,D,m,J,R,x){if(F!=V){var A=hd(f,F),u={};u.y=x&&x!==gp?x===qs?D+A.height/2:D+J-A.height/2:D+J/2,u.x=R&&R!==ws?R===Hn?N+m-A.width/2:N+m/2:N+A.width/2,Dk(w,F,u,f,c)}},getDistance:function(l,s){var _=l.length;return s?3===_?Y(a(l[0]-s[0])+a(l[1]-s[1])+a(l[2]-s[2])):2===_?Y(a(l[0]-s[0])+a(l[1]-s[1])):l.z===C?Y(a(s.x-l.x)+a(s.y-l.y)):Y(a(s.x-l.x)+a(s.y-l.y)+a(s.z-l.z)):3===_?Y(a(l[0])+a(l[1])+a(l[2])):2===_?Y(a(l[0])+a(l[1])):void 0},brighter:function(M,f){return 0>f&&(f=-f),wl(M,f?f:40)},darker:function(Q,C){return C>0&&(C=-C),wl(Q,C?C:-40)},unionPoint:function(J,F){if(!J)return V;if(2===arguments.length)return J&&F?{x:f(J.x,F.x),y:f(J.y,F.y),width:M(J.x-F.x),height:M(J.y-F.y)}:V;var l=J;if(l._as&&(l=l._as),l.length===C)return V;var d=l.length;if(0>=d)return V;for(var X=1,b=l[0],k={x:b.x,y:b.y,width:0,height:0};d>X;X++){b=l[X];var p=f(k.x,b.x),g=D(k.x+k.width,b.x),O=f(k.y,b.y),A=D(k.y+k.height,b.y);k.x=p,k.y=O,k.width=g-p,k.height=A-O}return k},unionRect:function($,e){if($&&!e)return Zq($);if(!$&&e)return Zq(e);if($&&e){var t={x:f($.x,e.x),y:f($.y,e.y)};return t.width=D($.x+$.width,e.x+e.width)-t.x,t.height=D($.y+$.height,e.y+e.height)-t.y,t}return V},containsPoint:function(C,I,P,Y){if(Y!=V&&1!==Y){var u=C.x+C.width/2,m=C.y+C.height/2;C={x:u-C.width/2*Y,y:m-C.height/2*Y,width:C.width*Y,height:C.height*Y}}if(P){var w=C.width/2,v=C.height/2,h=U(-P),n=e(-P),l=I.x-C.x-w,p=I.y-C.y-v;return I={x:n*l-h*p,y:h*l+n*p},zc({x:-w,y:-v,width:C.width,height:C.height},I)}return!(!C||I.x<C.x||I.y<C.y||I.x>C.x+C.width||I.y>C.y+C.height)},containsRect:function(R,o){if(!R||!o)return!1;var n=o.x,k=o.y,q=o.width,A=o.height,f=R.width,V=R.height;if(0>(f|V|q|A))return!1;var F=R.x,I=R.y;if(F>n||I>k)return!1;if(f+=F,q+=n,n>=q){if(f>=F||q>f)return!1}else if(f>=F&&q>f)return!1;if(V+=I,A+=k,k>=A){if(V>=I||A>V)return!1}else if(V>=I&&A>V)return!1;return!0},intersectsRect:function(i,r){if(!i||!r)return!1;var v=r.width,a=r.height,t=i.width,Y=i.height;if(0>=t||0>=Y||0>=v||0>=a)return!1;var g=r.x,G=r.y,R=i.x,W=i.y;return t+=R,Y+=W,v+=g,a+=G,t>g&&Y>G&&v>R&&a>W},intersection:function(m,p){if(!m||!p)return V;var x=p.x,B=p.y,H=m.x,g=m.y,$=x,k=B,n=H,J=g;return $+=p.width,k+=p.height,n+=m.width,J+=m.height,H>x&&(x=H),g>B&&(B=g),$>n&&($=n),k>J&&(k=J),$-=x,k-=B,0>=$||0>=k?V:{x:x,y:B,width:$,height:k}},grow:function(A,q,K){K===C&&(K=q),A.x-=q,A.y-=K,A.width=A.width+2*q,A.height=A.height+2*K},getScreenPoint:function(y,d,i,G,j,m,h){var t=i.getBoundingClientRect(),V=y*(m||1)+t.left-i.scrollLeft+(G||0),f=d*(h||1)+t.top-i.scrollTop+(j||0),U={x:V,y:f},D=td(i.parentElement);return D?D.applyInverse(U,{}):U},getLogicalPoint:function(z,N,r,Y,A,i){var _,h,f=N.getBoundingClientRect();z.target?(Kg(z)?Yn?Gd["91"]=!0:Gd["17"]=!0:Yn?Gd["91"]=!1:Gd["17"]=!1,Gd["16"]=gh(z)?!0:!1,z=fn?Mr(z):z,_=z.clientX,h=z.clientY):(_=z.x,h=z.y);var U=td(N);if(U){var P=U.apply({x:_,y:h},{});return P.x=(P.x+N.scrollLeft-(r||0))/(A||1),P.y=(P.y+N.scrollTop-(Y||0))/(i||1),P}return{x:(_-f.left+N.scrollLeft-(r||0))/(A||1),y:(h-f.top+N.scrollTop-(Y||0))/(i||1)}},removeHTML:function(){var n;return function(J){return J&&J.getView&&(J=J.getView()),J&&J.parentNode?n===J?!0:(n=J,J.parentNode.removeChild(J),n=V,!0):!1}}(),getToolTipDiv:function(){if(!wg){wg=Ij(),Ri=Ij();var M=wg.style;m.baseZIndex!=V&&(M.zIndex=Q(m.baseZIndex)+3+""),M.whiteSpace="nowrap",M.color=m.toolTipLabelColor,M.background=m.toolTipBackground,M.font=m.toolTipLabelFont,M.padding="5px",M.boxShadow="0px 0px 3px "+m.toolTipShadowColor}return wg},isToolTipShowing:function(){return wg&&wg.parentNode?!0:Ri&&Ri.parentNode?!0:!1},hideToolTip:function(){Nr(wg),Nr(Ri),Qd()},showToolTip:function(W,G){if(!W||G==V)return _g(),void 0;m.getToolTipDiv();var K,T;if(G.html?(G=G.html,K=Ri,Nr(wg)):(K=wg,Nr(Ri)),T=K.style,K.innerHTML=G,K.parentNode||k.Default.appendToScreen(K),W.target){W=Rb(W);var E=ur(),f=W.x,$=W.y,y=fn?60:12;if(fn){var p=K.getBoundingClientRect();T.left=f-p.width/2+Sd,T.top=$-p.height-y<E.top?$+y+Sd:$-p.height-y+Sd}else{T.left=f+y+Sd,T.top=$+y+Sd;var p=K.getBoundingClientRect();p.left+p.width>E.width&&(T.left=f-y-p.width+Sd),p.top+p.height>E.height&&(T.top=$-y-p.height+Sd),p.left<0&&(T.left=f+y+Sd),p.top<0&&(T.top=$+y+Sd)}}else T.left=W.x+Sd,T.top=W.y+Sd;Qd()},startDragging:function(Z,L,A){A==C&&(A=!0),Z!==bl&&(bl?A&&(fn?bl.handleWindowTouchEnd(L):bl.handleWindowMouseUp(L)):fn?(K.addEventListener(lf,Eb,B),K.addEventListener(Aj,ei,B)):(K.addEventListener(Hf,Fl,B),K.addEventListener(mm,Qr,B)),bl=Z)},getImageMap:function(){return Mm},toBoundaries:function(m,K,Z,A){var G=[];return so(m,K,Z,A).forEach(function(U){var t=[];U.forEach(function(C){t.push(C.x,C.y)}),G.push(t)}),G},getCurrentKeyCodeMap:function(){return Gd},drawCenterImage:function(t,o,v,X,h,O,e,T){var b=si(o,h,O),x=of(o,h,O);Af(t,o,n(v-b/2),n(X-x/2),b,x,h,O,e,T)},drawStretchImage:function(y,v,l,T,a,R,Q,O,K,L,S,P){var s,w=si(v,O,K,R),D=of(v,O,K,Q);"uniform"===l?(s=f(R/w,Q/D),w*=s,D*=s,T+=n((R-w)/2),a+=n((Q-D)/2),R=w,Q=D):"centerUniform"===l&&((w>R||D>Q)&&(s=f(R/w,Q/D),w*=s,D*=s),T+=n((R-w)/2),a+=n((Q-D)/2),R=w,Q=D);var g=y.interactiveInfo;if(g){var q;if(q="center"===l?{x:T+R/2-w/2,y:a+Q/2-D/2,width:w,height:D}:{x:T,y:a,width:R,height:Q},g.rect){var J=g.compInfos,m=J.length;m&&(J[m-1].rect.image=v)}else g.rect=q}if("center"===l){var o=S!==!1&&(w>R||D>Q);o&&(y.save(),y.beginPath(),y.rect(T,a,R,Q),y.clip()),Af(y,v,T+R/2-w/2,a+Q/2-D/2,w,D,O,K,L,P),o&&y.restore()}else Af(y,v,T,a,R,Q,O,K,L,P)},toCanvas:function(L,A,f,v,u,O,B,H,E){L=hs(L,B),A=A||si(L,u),f=f||of(L,u);var n=sk(),p=Qq(n);return H?(ye(n,A,f,H),p.scale(H,H)):ye(n,A,f,1),re(p,L,v,0,0,A,f,u,O,B,E),L&&L.clampToEdge&&(n.clampToEdge=L.clampToEdge),p.restore(),n},toGrayColor:function(k){if(!k)return k;var o=xk(k),z=.299*o[0]+.587*o[1]+.114*o[2];return"rgba("+z+","+z+","+z+","+o[3]/255+")"},createGradientImage:function(K,L,w,V){for(var A=["L",0,0,K,0,1,0,0,1,0,0],r=0,G=Math.min(L.length,w.length);G>r;r++)A.push(w[r],L[r]);var i=k.Default.toCanvas({width:K,height:K,clampToEdge:!0,comps:[{type:"shape",rotation:V||0,points:[0,0,K,0,K,K,0,K],background:"#ffffff",gradientPack:A}]});return i},createElement:function(H,e,Y,q){var h=T.createElement(H);return Pr(h,e||A.widgetBorder,2),h.style.font=Y?Y:Zb,q!=V&&(h.value=q),m.onElementCreated&&m.onElementCreated(h),h},containedInView:function(o,k){var C=Wg(k).getBoundingClientRect();return zc({x:C.left,y:C.top,width:C.width,height:C.height},_h(o))},isIsolating:function(){return Mb>0},setIsolating:function(D){D?Mb++:Mb--},getMSMap:function(){return Xc},stringify:function(c,H,R){var P=Date.prototype.toJSON;Date.prototype.toJSON=function(){return"__ht__date"+this.getTime()};var d=JSON.stringify(c,function(o,T){return"function"==typeof T?"__ht__"+(T.__ht__||T.toString()):Mj(T)?jq(T):T instanceof k.List?"__ht__list"+(T.__ht__list||m.stringify(T._as)):T},H==V?2:H);return Date.prototype.toJSON=P,R&&(d="__ht__encode"+m.encodeString(d)),d},parse:function(c){return Jh(c)?"__ht__encode"!=c.substr(0,12)||(c=m.decodeString(c.substr(12)),Jh(c))?JSON.parse(c,function(C,n){if(Jh(n))if("__ht__function"==n.substr(0,14)){var s=n.indexOf("{")+1,Y=n.lastIndexOf("}"),U=n.indexOf("(")+1,Z=n.indexOf(")");if(s&&Y&&U&&Z){var p=new Function(n.substring(U,Z),n.substring(s,Y));return p.__ht__=n.substr(6),p}}else{if("__ht__date"==n.substr(0,10))return new Date(Q(n.substr(10)));if("__ht__list"===n.substr(0,10))return new Vd(m.parse(n.substr(10)))}return n}):c:c},loadJS:function(l,s){s&&l.push(s);var e=l.shift();if(lk(e))l=e.contact(l),m.loadJS(l);else if(fg(e))e(),m.loadJS(l);else if(Jh(e)){var I=T.createElement("script");I.onload=function(){m.loadJS(l)},I.setAttribute("src",e),T.getElementsByTagName("head")[0].appendChild(I)}else l.length&&m.loadJS(l)},toRoundedCorner:function(m,p){var b=m.size();if(0>=p)return{points:m};var h,J=new Vd,O=new Vd,B=m.get(0);J.add(B),O.add(1);for(var I=1;b>I;I++)if(b>I+1){var a=m.get(I),G=m.get(I+1),i=B.x,z=B.y,R=a.x,N=a.y,j=N-z,v=R-i,d=s(j,v);h=f(.99*_e(B,a),p),J.add({x:R-h*e(d),y:N-h*U(d)}),J.add(a),i=a.x,z=a.y,R=G.x,N=G.y,j=N-z,v=R-i,d=s(j,v),h=f(.99*_e(a,G),p),B={x:i+h*e(d),y:z+h*U(d)},J.add(B),O.addAll([2,3])}else J.add(m.get(I)),O.add(2);return{points:J,segments:O}},toColorData:xk,setCanvas:ye,createDiv:Ij,createDisabledDiv:Rj,createView:np,createCanvas:sk,appendChild:Kl,initContext:Qq,checkLoadingImage:Gi,translateAndScale:dl,layout:xg,getPosition:Lp,drawPoints:_l,drawRoundRect:cb,drawBorder:Mh,setFocus:ob,getter:sc,setter:wc,isEmptyObject:Bk,cameraPriority:function(){var v={skybox:0,main:1e4,top:1e7};return H.seal(H.defineProperties({},{skybox:{configurable:!1,enumerable:!1,get:function(){return v.skybox},set:function(m){if(m>=v.main)throw new RangeError("Skybox camera must have lower priority than the main camera.");v.skybox=Number(m)}},main:{configurable:!1,enumerable:!1,get:function(){return v.main},set:function(U){if(U<=v.skybox)throw new RangeError("Main camera must have higher priority than the skybox camera.");if(U>=v.top)throw new RangeError("Main camera must have lower priority than the top camera.");v.main=Number(U)}},top:{configurable:!1,enumerable:!1,get:function(){return v.top},set:function(s){if(s<=v.main)throw new RangeError("Top camera must have higher priority than the main camera.");v.top=Number(s)}}}))}()},!0),dc(y,{autoAdjustIndex:1,hierarchicalRendering:1,adjustChildrenToTop:1,autoHideScrollBar:1,autoUpdate:1,firstPersonMode:1,ortho:1,strict:1,stickToRight:1,instant:1,closePath:1,hierarchical:1,doubleClickToToggle:1,continuousLayout:1,syncSize:1},!0);var rr=m.disabledOpacity,eg=m.toolTipDelay,lo=m.devicePixelRatio,Ai=m.autoMakeVisible,Uq=m.autoHideScrollBar,lc=m.imageGradient,xp=m.showToolTip,_g=m.hideToolTip,hp=m.dashPattern,km=m.lineCap,qc=m.lineJoin,nd=m.labelColor,Ve=m.labelSelectColor,Zb=m.labelFont,ik=m.widgetIndent,bk=m.widgetRowHeight,wk=m.widgetHeaderHeight,qq=m.widgetTitleHeight,Dd=m.scrollBarColor,Lb=m.scrollBarSize,Nd=m.scrollBarTimeout,Pm=m.scrollBarMinLength,je=m.scrollBarInteractiveSize,Yp=m.zoomIncrement,$n=m.scrollZoomIncrement,hn=m.pinchZoomIncrement,Dp=m.zoomMax,In=m.zoomMin,Om=m.createObject,Mf=m.preventDefault,mk=m.setImage,hs=m.getImage,Th=m.isImageComplete,Td=m.drawCenterImage,re=m.drawStretchImage,Nk=m.getId,Md=m.callLater,cd=m.sortFunc,Zq=m.clone,Bf=m.getClass,rl=m.startAnim,Tn=m.brighter,$k=m.darker,_q=m.drawText,hd=m.getTextSize,Te=m.isLeftButton,ef=m.isMiddleButton,Sg=m.getTouchCount,$e=m.isDoubleClick,gh=m.isShiftDown,Kg=m.isCtrlDown,_h=m.getClientPoint,Rb=m.getPagePoint,_e=m.getDistance,fr=m.unionPoint,ps=m.unionRect,zc=m.containsPoint,Ch=m.containsRect,zj=m.intersectsRect,xj=m.intersection,ur=m.getWindowInfo,ol=m.grow,Gh=m.getLogicalPoint,Tg=m.getScreenPoint,cp=m.startDragging,Nr=m.removeHTML,pp=m.createElement,Ej=m.segmentResolution,uc=m.shapeResolution,sn=m.shapeSide,Ir=m.def,Ni=function(E,U,G){Ir(N+"."+E,U,G)},ll=function(v,g){v.childNodes.forEach(function(b){g(b),ll(b,g)})};dc(m,{toolTipLabelColor:nd,toolTipLabelFont:Zb,toolTipBackground:A.toolTipBackground,toolTipShadowColor:Ul,drawBreakableText:ui,setDevicePixelRatio:function(h){lo=m.devicePixelRatio="number"==typeof h?h:K.devicePixelRatio,ll(T.body,function(o){var B=o._ht;B&&B._canvas&&(ye(B._canvas,B.getWidth(),B.getHeight()),B.redraw?B.redraw():B.iv())})}},!0);var mr=1e-6,Sl="undefined"!=typeof Uint16Array?Uint16Array:Array,Nb="undefined"!=typeof Float32Array?Float32Array:Array,Nn=function(l,C,n){var h=[l[0]-C[0],l[1]-C[1],l[2]-C[2]];if(n){var V=_e(h);V>0&&(h[0]/=V,h[1]/=V,h[2]/=V)}return h},Im=function(){var S="charCodeAt",Q=2*(2*jh.length+1);for(var D in K)if(D===N+ws[0]+(Sd.length+2)){var z=K[D];if(!z)break;for(var d=z.length,Z=0;d>Z;Z++)if(z[Z][S](0)===Q&&z[Z+1]!=V&&z[Z+1]===Sd[0]&&z[Z+2]!=V&&z[Z+2][S](0)===Q){for(var m=Z+3;d>m;m++)if(z[m][S](0)===Q){if(0==z[m+1])for(var l,w=m+2;d>w;w++){if(z[w][S](0)===Q){0==z[w-1]&&l&&(hf=l.substr(0,l.length-1));break}l==V?l=z[w]:l+=z[w]}break}break}break}return function(V){return[-V[0],-V[1],-V[2]]}}(),Ld=function(h,q){return 3===h.length?h[0]*q[0]+h[1]*q[1]+h[2]*q[2]:h[0]*q[0]+h[1]*q[1]},Yq=function(){var _=new Nb(16);return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},gs=Yq(),ko=function(s){var R=new Nb(16);return R[0]=s[0],R[1]=s[1],R[2]=s[2],R[3]=s[3],R[4]=s[4],R[5]=s[5],R[6]=s[6],R[7]=s[7],R[8]=s[8],R[9]=s[9],R[10]=s[10],R[11]=s[11],R[12]=s[12],R[13]=s[13],R[14]=s[14],R[15]=s[15],R},kn=function(i,T){return i[0]=T[0],i[1]=T[1],i[2]=T[2],i[3]=T[3],i[4]=T[4],i[5]=T[5],i[6]=T[6],i[7]=T[7],i[8]=T[8],i[9]=T[9],i[10]=T[10],i[11]=T[11],i[12]=T[12],i[13]=T[13],i[14]=T[14],i[15]=T[15],i},Qo=function(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},Qf=function(g,U){var y=g[0],O=g[1],T=g[2];return g[0]=U[0]*y+U[4]*O+U[8]*T+U[12],g[1]=U[1]*y+U[5]*O+U[9]*T+U[13],g[2]=U[2]*y+U[6]*O+U[10]*T+U[14],g},jk=function(B,t){var D=B[0],Y=B[1],A=B[2],L=B[3];return B[0]=t[0]*D+t[4]*Y+t[8]*A+t[12]*L,B[1]=t[1]*D+t[5]*Y+t[9]*A+t[13]*L,B[2]=t[2]*D+t[6]*Y+t[10]*A+t[14]*L,B[3]=t[3]*D+t[7]*Y+t[11]*A+t[15]*L,B},df=function(){var q,H,e,h,M=Jl(rf[1]+rf[7]),x=Jl(rf[0]+rf[3]-rf[10]),T=Jl(rf[8]+2),U=function(){return H=e.charAt(q),q+=1,H},r=function(){var i="";if(H===T)for(;U();){if(H===T)return U(),i;i+=H}else U()},G=function(){for(;H&&" ">=H;)U()},V=function(){var u,a={};if(H===M){if(U(),G(),H===x)return U(),a;for(;H;){if(u=r(),G(),U(),a[u]=h(),G(),H===x)return U(),a;U(),G()}}};return h=function(){switch(G(),H){case M:return V();default:return r()}},function(F){if(P={},F){var C;if(e=F,q=0,H=" ",C=h(),G(),!H)return C}}}(),Ek=function(f,w){if(w){var J=U(w),L=e(w),m=f[4],n=f[5],S=f[6],T=f[7],$=f[8],b=f[9],Y=f[10],M=f[11];f[4]=m*L+$*J,f[5]=n*L+b*J,f[6]=S*L+Y*J,f[7]=T*L+M*J,f[8]=$*L-m*J,f[9]=b*L-n*J,f[10]=Y*L-S*J,f[11]=M*L-T*J}},Pn=function(V,p){if(p){var C=U(p),L=e(p),M=V[0],E=V[1],g=V[2],I=V[3],$=V[8],i=V[9],k=V[10],o=V[11];V[0]=M*L-$*C,V[1]=E*L-i*C,V[2]=g*L-k*C,V[3]=I*L-o*C,V[8]=M*C+$*L,V[9]=E*C+i*L,V[10]=g*C+k*L,V[11]=I*C+o*L}},Tb=function(w,i){if(i){var Q=U(i),E=e(i),b=w[0],z=w[1],q=w[2],K=w[3],N=w[4],y=w[5],k=w[6],S=w[7];w[0]=b*E+N*Q,w[1]=z*E+y*Q,w[2]=q*E+k*Q,w[3]=K*E+S*Q,w[4]=N*E-b*Q,w[5]=y*E-z*Q,w[6]=k*E-q*Q,w[7]=S*E-K*Q}},pc=function(P,z,N){return Fp(V,N===!1?V:P.getFinalScale3d(),P.getFinalRotation3d(),P.getRotationMode(),P.p3(),V,z)},Fp=function(W,m,p,D,N,i,l){return i||(i=Yq()),N&&Xl(i,N),Mp(i,p,D),l&&pb(i,i,l),m&&Dr(i,m),W&&pb(i,i,W),i},ji=function(o,B,M){B=Q(B),M=Q(M);var h=this;h.g=o,h._84O=B,h._85O=M,h._70I=!0,h.F=0,h._83O=B+M,h.pen={x:0,y:0}},Yj="lineDashOffset",_m="setLineDash",Jb=function(F){for(var S in F)1===S.length&&(Yj=F[S]);return S?1:0},$p=function(b,c,Z){return eh(c)?b:b[_m]?(b[_m](c),Z&&(b.lineDashOffset=Z),b):new ji(b,c[0],c.length>1?c[1]:c[0])},$f=function(b,a){!eh(a)&&b[_m]&&(b[_m](xr),b.lineDashOffset=0)};if(Ir(ji,H,{_69I:6,moveTo:function(B,i){var j=this,T=j.pen;T.x=B,T.y=i,j.g.moveTo(B,i),j.start||(j.start={x:B,y:i})},lineTo:function(f,Z){var J=this,g=J.pen,p=f-g.x,R=Z-g.y,a=s(R,p),d=e(a),V=U(a),o=J._23O(g.x,g.y,f,Z),x=J._85O,N=J._84O,X=J._83O;if(J.F){if(J.F>o)return J._70I?J._72I(f,Z):J.moveTo(f,Z),J.F-=o,void 0;if(J._70I?J._72I(g.x+d*J.F,g.y+V*J.F):J.moveTo(g.x+d*J.F,g.y+V*J.F),o-=J.F,J.F=0,J._70I=!J._70I,!o)return}var u=$(o/X);if(u){for(var y=d*N,b=V*N,k=d*x,O=V*x,P=0;u>P;P++)J._70I?(J._72I(g.x+y,g.y+b),J.moveTo(g.x+k,g.y+O)):(J.moveTo(g.x+k,g.y+O),J._72I(g.x+y,g.y+b));o-=X*u}J._70I?o>N?(J._72I(g.x+d*N,g.y+V*N),J.moveTo(f,Z),J.F=x-(o-N),J._70I=!1):(J._72I(f,Z),o===N?(J.F=0,J._70I=!J._70I):(J.F=N-o,J.moveTo(f,Z))):o>x?(J.moveTo(g.x+d*x,g.y+V*x),J._72I(f,Z),J.F=N-(o-x),J._70I=!0):(J.moveTo(f,Z),o===x?(J.F=0,J._70I=!J._70I):J.F=x-o)},quadraticCurveTo:function(U,X,W,j){var f,g=this,e=g.pen,p=e.x,A=e.y,R=g._22O(p,A,U,X,W,j),B=0,O=0,D=g._85O,P=g._84O;if(g.F){if(g.F>R)return g._70I?g._71I(U,X,W,j):g.moveTo(W,j),g.F-=R,void 0;if(B=g.F/R,f=g._20O(p,A,U,X,W,j,B),g._70I?g._71I(f[2],f[3],f[4],f[5]):g.moveTo(f[4],f[5]),g.F=0,g._70I=!g._70I,!R)return}var b=R-R*B,_=$(b/g._83O),d=P/R,l=D/R;if(_)for(var K=0;_>K;K++)g._70I?(O=B+d,f=g._21O(p,A,U,X,W,j,B,O),g._71I(f[2],f[3],f[4],f[5]),B=O,O=B+l,f=g._21O(p,A,U,X,W,j,B,O),g.moveTo(f[4],f[5])):(O=B+l,f=g._21O(p,A,U,X,W,j,B,O),g.moveTo(f[4],f[5]),B=O,O=B+d,f=g._21O(p,A,U,X,W,j,B,O),g._71I(f[2],f[3],f[4],f[5])),B=O;b=R-R*B,g._70I?b>P?(O=B+d,f=g._21O(p,A,U,X,W,j,B,O),g._71I(f[2],f[3],f[4],f[5]),g.moveTo(W,j),g.F=D-(b-P),g._70I=!1):(f=g._19O(p,A,U,X,W,j,B),g._71I(f[2],f[3],f[4],f[5]),R===P?(g.F=0,g._70I=!g._70I):(g.F=P-b,g.moveTo(W,j))):b>D?(O=B+l,f=g._21O(p,A,U,X,W,j,B,O),g.moveTo(f[4],f[5]),f=g._19O(p,A,U,X,W,j,O),g._71I(f[2],f[3],f[4],f[5]),g.F=P-(b-D),g._70I=!0):(g.moveTo(W,j),b===D?(g.F=0,g._70I=!g._70I):g.F=D-b)},bezierCurveTo:function(){var F=arguments;this.pen={x:F[4],y:F[5]},this.g.bezierCurveTo(F[0],F[1],F[2],F[3],F[4],F[5])},arc:function(t,b,Z,r,g,p){p||(r=-r,g=-g),vf(this,t,b,r,g-r,Z,Z,!1)},rect:function(s,m,b,e){var K=this;K.pen={x:s,y:m},K.moveTo(s,m),K.lineTo(s,m+e),K.lineTo(s+b,m+e),K.lineTo(s+b,m),K.lineTo(s,m)},beginPath:function(){this.g.beginPath()},closePath:function(){this.lineTo(this.start.x,this.start.y)},_23O:function(z,O,d,N){var P=d-z,B=N-O;return Y(P*P+B*B)},_22O:function(e,J,z,V,L,P,t){for(var N,u,O,f,i,E,M,n=0,K=e,c=J,g=t>0?t:this._69I,k=1;g>=k;k++)O=k/g,f=1-O,i=f*f,E=2*O*f,M=O*O,N=i*e+E*z+M*L,u=i*J+E*V+M*P,n+=this._23O(K,c,N,u),K=N,c=u;return n},_21O:function(S,b,Y,A,E,v,j,z){var J=this;if(0===j)return J._20O(S,b,Y,A,E,v,z);if(1===z)return J._19O(S,b,Y,A,E,v,j);var F=J._20O(S,b,Y,A,E,v,z);return F.push(j/z),J._19O.apply(J,F)},_20O:function(L,R,n,l,q,C,H){if(1!==H){var z=n+(q-n)*H,m=l+(C-l)*H;n=L+(n-L)*H,l=R+(l-R)*H,q=n+(z-n)*H,C=l+(m-l)*H}return[L,R,n,l,q,C]},_19O:function(v,E,m,J,Y,_,V){if(1!==V){var y=v+(m-v)*V,Z=E+(J-E)*V;m+=(Y-m)*V,J+=(_-J)*V,v=y+(m-y)*V,E=Z+(J-Z)*V}return[v,E,m,J,Y,_]},_72I:function(I,u){var s=this.pen;(I!==s.x||u!==s.y)&&(s.x=I,s.y=u,this.g.lineTo(I,u))},_71I:function(B,s,_,e){var v=this.pen;(B!==_||s!==e||_!==v.x||e!==v.y)&&(v.x=_,v.y=e,this.g.quadraticCurveTo(B,s,_,e))}}),l&&r){var dp=r.toString();d=dp.indexOf(ki.substr(0,2))>0&&dp.indexOf(qs+qs.substr(1,1))>1||dp.indexOf(fq.substr(0,2)+ki.substr(2,2)+ws[0]+ki[4])>1?!0:!1}var Bp=V,ci=V,me=function(b){Bp&&!b._72O&&(ci||(ci={}),ci[b._72O=Nk()]=b)},Yb=function(C,d){if(d||(d=C),d&&(Bp||(Bp={}),!Bp[C])){var K=new lh;if(Bp[d]={request:K,url:d},d=m.beforeLoadURL(d),d.data){var Q=m.parse(d.data);Id(C,Q),m.handleCompTypeLoaded(C,Q)}else{K.onload=function(){if(200===this.status||0===this.status){var J=m.parse(K.getResponseText());Id(C,J),m.handleCompTypeLoaded(C,J)}else Id(C,V)},K.onerror=function(){Id(C,V)};var O={};O.url=encodeURI(d),O.sync=!1,K.send(O)}}},Id=function(A,$){if(kr[A]=$,delete Bp[A],Bk(Bp)&&(Bp=V,ci)){for(var y in ci){var U=ci[y];U.invalidateAll&&U.invalidateAll(C,"compTypeLoaded",A),U.redraw&&U.redraw(),U.iv(),delete U._72O}ci=V}if($&&ci)for(var y in ci){var U=ci[y];U.invalidateAll&&U.invalidateAll(C,"compTypeLoading",A),U.redraw&&U.redraw(),U.iv()}},ch=A.chart,Sr="",ej=m.compStack=[],Cm=/^style@/,Oc=/^attr@/,Nj=/^field@/,qi={x:.5,y:.5},si=function(k,O,W,Z){if(!k)return 0;if($d(k.fitSize,O,W)&&Z)return Z;var E=$d(k.width,O,W);return null==E?20:E},of=function(U,X,k,B){if(!U)return 0;if($d(U.fitSize,X,k)&&B)return B;var Z=$d(U.height,X,k);return null==Z?20:Z},$d=function(j,s,f){if(!j||!j.func)return j;var e,c=j.func,P=j.value;return e=fg(c)?f&&f.vectorDataBindingDisabled&&!j.isSafeFunc?P:c(s,f):s instanceof oj?Oc.test(c)?s.a(Sr+c.slice(5)):Cm.test(c)?s.s(Sr+c.slice(6)):Nj.test(c)?s[c.slice(6)]:s[c]?s[c](f):P:P,P!==C&&e==V?P:e},Af=m.drawImage=function(){var g,k,P,i,E,I,_=function(x,l){x.getValue&&x.getValue.compType===l||(x.getValue=function(r){var h=d(x,r);if(h===C&&l.properties){var i=l.properties[r];i&&(h=i.defaultValue)}return h},x.getColor=function(g){return c(x.getValue(g))},x.getValue.compType=l)},d=function(v,W,n){var r,g=!1;if(v.prefix&&k instanceof oj){var $=k.a(Sr+W);$!==C&&(g=!0,r=$)}return r===C&&(r=v[W]),r&&r.func&&(g=!0,r=$d(r,k,P)),n&&(r=n(r),g||(v[W]=r)),r},c=function(s,r){var y;if(y=r?d(s,r):s,g&&g.compGray&&y)return m.toGrayColor(y);if(E&&y){if("override"===I)return E;if("override_rgb"===I){var W=Fe(E);return y=xk(y),"rgba("+$(255*W[0])+","+$(255*W[1])+","+$(255*W[2])+","+y[3]/255+")"}if("override_a"===I){var W=Fe(E);return y=xk(y),"rgba("+y[0]+","+y[1]+","+y[2]+","+W[3]+")"}var W=Fe(E);return y=xk(y),"rgba("+$(y[0]*W[0])+","+$(y[1]*W[1])+","+$(y[2]*W[2])+","+y[3]/255*W[3]+")"}return y},x=function(f){if(lk(f)){for(var K=new Vd,h=f.length,B=0;h>B;B+=2)K.add({x:f[B],y:f[B+1]});f=K}return f},t=function(w){var E=d(w,"anchorX"),Y=d(w,"anchorY");if(E!==C||Y!==C)return{x:E===C?qi.x:E,y:Y===C?qi.y:Y};var u=d(w,"type"),b=d(w,"name");if("image"!==u||!b)return qi;var P=hs(b);return P&&P.anchorX!==C&&P.anchorY!==C?{x:P.anchorX,y:P.anchorY}:qi},h=function(L,A){var U=d(L,mc),H=t(L);if(lk(U)){var k=U.length,m=d(L,"relative"),D=A.width,N=A.height;if(4===k)U={x:U[0],y:U[1],width:U[2],height:U[3]},m&&(U.x*=D,U.y*=N,U.width*=D,U.height*=N);else if(3===k){var V=U[0];U={width:U[1],height:U[2]},m&&(U.width*=D,U.height*=N),"object"==typeof V?V.length&&(V={x:V[0],y:V[1]}):V=Lp(V,A,U),U.x=V.x-U.width*H.x,U.y=V.y-U.height*H.y}U.x+=d(L,"offsetX")||0,U.y+=d(L,"offsetY")||0,!m&&A.fitSize&&(U=u(L,U,A))}return U},u=function(B,a,L){if(a){var M,q,g,o={x:a.x,y:a.y,width:a.width,height:a.height},S=t(B),U=d(B,"layoutH"),f=d(B,"layoutV"),p=1,I=1,G=0,j=0,x=1,Y=1;switch(U){case"left":break;case"right":o.x+=L.width-L.rw;break;case"center":o.x+=.5*(L.width-L.rw);break;case"scale":case"leftright":default:M=d(B,cs)||0,M&&(G=Math.abs(j=Math.sin(M)),x=Math.abs(Y=Math.cos(M))),"leftright"!==U?(p+=x*(L.widthScale-1),I+=G*(L.widthScale-1)):(p+=o.width?x*(L.width-L.rw)/o.width:0,I+=o.height?G*(L.width-L.rw)/o.height:0,q=-Math.min(-S.x*Y+S.y*j,-S.x*Y-(1-S.y)*j,(1-S.x)*Y+S.y*j,(1-S.x)*Y-(1-S.y)*j))}switch(f){case"top":break;case"bottom":o.y+=L.height-L.rh;break;case"center":o.y+=.5*(L.height-L.rh);break;case"scale":case"topbottom":default:M==V&&(M=d(B,cs),M&&(G=Math.abs(j=Math.sin(M)),x=Math.abs(Y=Math.cos(M)))),"topbottom"!==f?(p+=G*(L.heightScale-1),I+=x*(L.heightScale-1)):(p+=o.width?G*(L.height-L.rh)/o.width:0,I+=o.height?x*(L.height-L.rh)/o.height:0,g=-Math.min(-S.x*j-S.y*Y,-S.x*j+(1-S.y)*Y,(1-S.x)*j-S.y*Y,(1-S.x)*j+(1-S.y)*Y))}return(1!==p||1!==I)&&("scale"!==U&&U?"leftright"===U&&(o.x+=o.width*(1-p)*S.x+q*(L.width-L.rw)):o.x+=o.x*(L.widthScale-1)+S.x*o.width*(L.widthScale-p),"scale"!==f&&f?"topbottom"===f&&(o.y+=o.height*(1-I)*S.y+g*(L.height-L.rh)):o.y+=o.y*(L.heightScale-1)+S.y*o.height*(L.heightScale-I),o.width*=p,o.height*=I),o.width<0&&(o.width=0),o.height<0&&(o.height=0),o}},B=function(Z){return lk(Z)?new Vd(Z):Z},T=function(S,s,U,D,q,N,O){var L=g.interactiveInfo,f=S.transform;if(f)return g.save(),g.setTransform(f.a,f.b,f.c,f.d,f.tx,f.ty),L&&L.compInfos.push({comp:S,rect:s,matrix:f.clone(),prefix:Sr}),!0;q===C&&(q=1),N===C&&(N=1);var y=d(S,"clipPercentage"),M=sd(U,s);if(M&&!D&&1===q&&1===N&&!(1>y))return L&&L.compInfos.push({comp:S,rect:s,matrix:L.matrix.clone(),prefix:Sr}),!1;O=O||qi;var j=s.x+s.width*O.x,r=s.y+s.height*O.y,u=U.x+U.width*O.x,i=U.y+U.height*O.y,e=U.width?q*(s.width/U.width):1,V=U.height?N*(s.height/U.height):1;if(g.save(),L&&(L.matrix.appendTranslate(j,r).appendRotate(D).appendScale(e,V).appendTranslate(-u,-i),L.compInfos.push({comp:S,rect:s,matrix:L.matrix.clone()})),Zo(g,j,r),zi(g,D||0),cl(g,e,V),Zo(g,-u,-i),1>y){0>y&&(y=0);var G=fp(U,d(S,"clipDirection"),y);g.beginPath(),g.rect(G.x,G.y,G.width,G.height),g.clip()}return!0},s=function(){g.restore()},H=function(K,L,M){var p=d(K,"path"),e=d(K,cs),w=d(K,"scaleX"),C=d(K,"scaleY"),z=t(K),j=V,Q=Tm(null,p);if(M||(M=K.unionRect,M||(M=fr(Q),K.path.func||(K.unionRect=M)),j=M),M){j||(j=K.unionRect,j||(j=fr(Q),K.path.func||(K.unionRect=j)));var b=T(K,M,j,e,w,C,z),B=d(K,"borderPattern"),l=$p(g,B),O=c(K,"background"),$=c(K,"borderColor"),x=d(K,"borderWidth"),I=d(K,"gradient"),W=c(K,"gradientColor"),_=d(K,"border3d"),v=c(K,"border3dColor"),u=d(K,"border3dAccuracy"),y=g.lineJoin,F=g.lineCap;if(g.lineJoin=d(K,"borderJoin")||qc,g.lineCap=d(K,"borderCap")||km,O?(ym(g,O,I,W,j),Tm(g,p),g.fill(),l!==g&&Tm(g,p)):Tm(g,p),x&&$){var n=d(K,"borderWidthAbsolute");n&&(g.save(),g.setTransform(1,0,0,1,0,0)),g.lineWidth=x,g.strokeStyle=$,g.stroke(),n&&g.restore(),_&&Hb(g,$,v,x,i,u)}if($f(g,B),d(K,"dash")){var R=d(K,"dashWidth")||x;if(R>0){B=d(K,"dashPattern")||hp;var l=$p(g,B,d(K,"dashOffset")),Y=c(K,"dashColor")||c(rb);l!==g&&Tm(g,p),g.strokeStyle=Y,g.lineWidth=R,g.stroke(),d(K,"dash3d")&&Hb(g,Y,c(K,"dash3dColor"),R,i,d(K,"dash3dAccuracy")),$f(g,B)}}L===mc&&$q(g,O,d(K,"depth"),j),g.lineJoin=y,g.lineCap=F,b&&s()}},Q=function(q,J,n,_){var O=d(q,Lg,x),j=d(q,cs),b=t(q);if(O&&_.fitSize){var e=new Vd,U=fr(O),a=u(q,U,_),M=U.x+b.x*U.width,f=U.y+b.y*U.height,F=a.x+b.x*a.width,y=a.y+b.y*a.height,l=U.width?a.width/U.width:1,v=U.height?a.height/U.height:1;O.each(function(q){e.add({x:F+(q.x-M)*l,y:y+(q.y-f)*v})}),O=e,q.unionRect=null}var Q=d(q,"scaleX"),m=d(q,"scaleY"),R=J===Hd,G=V;if(!n&&R&&(n=q.unionRect,n||(n=fr(O),q.points.func||(q.unionRect=n)),G=n),n){R?G||(G=q.unionRect,G||(G=fr(O),q.points.func||(q.unionRect=G))):G=n;var Z,z,Y,C,L=T(q,n,G,j,Q,m,b),S=d(q,"borderPattern"),X=$p(g,S),K=c(q,"background"),$=hs(d(q,"repeatImage"),E,I),r=d(q,"gradientPack"),D=c(q,"borderColor"),o=d(q,"borderWidth"),w=d(q,"segments",B),p=d(q,"gradient"),h=c(q,"gradientColor"),H=d(q,"border3d"),N=c(q,"border3dColor"),W=d(q,"border3dAccuracy"),A=d(q,"closePath"),ci=d(q,"fillRule")||"nonzero",cm=g.lineJoin,Cn=g.lineCap;if(g.lineJoin=d(q,"borderJoin")||qc,g.lineCap=d(q,"borderCap")||km,R)if(K||$||r){var qp=d(q,"fillClipPercentage");if(1>qp){0>qp&&(qp=0);var nc=fp(G,d(q,"fillClipDirection"),qp);g.save(),g.beginPath(),g.rect(nc.x,nc.y,nc.width,nc.height),g.clip()}if(_l(g,O,w,A),r)vm(g,r);else if($){var Fe=g,yr=E,Ff=I;lb(g,$,E,I,k,P),g=Fe,E=yr,I=Ff}else{var Fe=g;ym(g,K,p,h,G),g=Fe}g.fill(ci),1>qp&&g.restore(),r&&g.restore(),X!==g&&_l(X,O,w,A)}else _l(X,O,w,A);else if("roundRect"===J?Z=d(q,"cornerRadius"):"polygon"===J?Z=d(q,"polygonSide"):"arc"===J&&(Z=d(q,"arcFrom"),z=d(q,"arcTo"),Y=d(q,"arcClose"),C=d(q,"arcOval")),K||$||r){var qp=d(q,"fillClipPercentage");if(1>qp){0>qp&&(qp=0);var nc=fp(G,d(q,"fillClipDirection"),qp);g.save(),g.beginPath(),g.rect(nc.x,nc.y,nc.width,nc.height),g.clip()}if(En(g,J,G,Z,z,Y,C),r)vm(g,r);else if($){var Fe=g,yr=E,Ff=I;lb(g,$,E,I,k,P),g=Fe,E=yr,I=Ff}else ym(g,K,p,h,G);g.fill(ci),1>qp&&g.restore(),r&&g.restore(),g!==X&&En(X,J,G,Z,z,Y,C)}else En(X,J,G,Z,z,Y,C);if(o&&D){var Mf=d(q,"borderWidthAbsolute");Mf&&(g.save(),g.setTransform(1,0,0,1,0,0)),g.lineWidth=o,g.strokeStyle=D,g.stroke(),Mf&&g.restore(),H&&Hb(g,D,N,o,i,W)}if($f(g,S),d(q,"dash")){var yi=d(q,"dashWidth")||o;if(yi>0){S=d(q,"dashPattern")||hp;var X=$p(g,S,d(q,"dashOffset")),Ni=c(q,"dashColor")||c(rb);X!==g&&(R?_l(X,O,w,A):En(X,J,G,Z,z,Y,C)),g.strokeStyle=Ni,g.lineWidth=yi,g.stroke(),d(q,"dash3d")&&Hb(g,Ni,c(q,"dash3dColor"),yi,i,d(q,"dash3dAccuracy")),$f(g,S)}}J===mc&&$q(g,K,d(q,"depth"),G),g.lineJoin=cm,g.lineCap=Cn,L&&s()}},N=function(D,G){var H=E,C=I,Z=E||d(D,oc),B=I||d(D,"blendMode"),v=hs(d(D,"name"),Z,B);v&&(re(g,v,d(D,"stretch"),G.x,G.y,G.width,G.height,k,P,Z,null,B),E=H,I=C)},R=function(x,_){var A=d(x,"text");A!=V&&_q(g,A,d(x,"font"),c(x,oc),_.x,_.y,_.width,_.height,d(x,"align"),d(x,"vAlign"))},z=function(Z,Y){Mh(g,c(Z,oc),Y.x,Y.y,Y.width,Y.height,d(Z,"width"))},O=function(F,x){var M=d(F,wm),G=0;if(M&&(M.forEach(function(g){G+=g}),G>0)){for(var S=d(F,"colors")||ch,h=d(F,"startAngle")||0,n=d(F,"hollow"),E=d(F,Lr),l=d(F,tl),D=d(F,Xp),I=E?new Vd:V,p=x.x,K=x.y,i=x.width,t=x.height,B=p+i/2,r=K+t/2,v=f(i,t)/2,m=0,y=0;y<M.length;y++){var N=M[y],C=w*N/G,b=h+C;if(g.fillStyle=S[m++],m===S.length&&(m=0),g.beginPath(),n){var R=B+e(h)*v/2,Q=r+U(h)*v/2,H=B+e(b)*v,q=r+U(b)*v;g.moveTo(R,Q),g.arc(B,r,v/2,h,b,!1),g.lineTo(H,q),g.arc(B,r,v,b,h,!0)}else g.moveTo(B,r),g.arc(B,r,v,b,h,!0);I&&(C=(h+b)/2,I.add({text:fg(E)?E(N,y,G,k):N,x:B+.75*e(C)*v,y:r+.75*U(C)*v})),g.closePath(),g.fill(),h=b}I&&I.each(function(F){_q(g,F.text,l,D,F.x,F.y,0,0,zg)})}},X=function(S,A){var J=d(S,mh);if(J&&J.length>0){var W=J.length,C=d(S,Lr),r=d(S,tl),K=d(S,Xp),m=C?new Vd:V,c=d(S,"minValue")||0,F=d(S,"maxValue");if(F==V&&(F=0,J.forEach(function(x){d(x,wm).forEach(function(y){F=D(F,y)})})),c===F)return;for(var Z=A.height/(F-c),h=A.y+F*Z,I=d(J[0],wm).length,N=A.width/(3*I+1),O=2*N/W,j=0,u=0;W>u;u++)for(var U=J[u],t=d(U,oc),Y=d(U,"colors"),q=d(U,wm),i=0;I>i;i++){Y?g.fillStyle=Y[i]:t?g.fillStyle=t:(g.fillStyle=ch[j++],j===ch.length&&(j=0));var H=q[i],R=H*Z,f=A.x+(1+3*i)*N+u*O;if(Qm(g,f,h-R,O,R),m){var z=fg(C)?C(H,i,U,k):H,T=hd(r,z).height;m.add({x:f,y:h-R-T,width:O,height:T,text:z})}}m&&m.each(function(h){_q(g,h.text,r,K,h.x,h.y,h.width,h.height,zg)})}},M=function(o,F){var L=d(o,mh);if(L&&L.length>0){var n=L.length,z=d(L[0],wm).length,A=F.width/(3*z+1),T=0,C=d(o,"maxValue"),E=d(o,Lr),K=d(o,tl),f=d(o,Xp),B=E?new Vd:V;
if(C==V){C=0;for(var w=0;z>w;w++){for(var q=0,H=0;n>H;H++)q+=d(L[H],wm)[w];C=D(C,q)}}if(C>0){for(var w=0;z>w;w++)for(var R=F.y+F.height,H=0;n>H;H++){var l=L[H],e=d(l,oc),b=d(l,wm)[w],y=b/C*F.height;e?g.fillStyle=e:(g.fillStyle=ch[T++],T===ch.length&&(T=0)),R-=y;var J={x:F.x+(1+3*w)*A,y:R,width:2*A,height:y};Qm(g,J.x,J.y,J.width,J.height),B&&(J.text=fg(E)?E(b,w,l,k):b,B.add(J))}B&&B.each(function(l){_q(g,l.text,K,f,l.x,l.y,l.width,l.height,zg)})}}},a=function(n,F){var r=d(n,mh);if(r&&r.length>0){for(var H=r.length,A=d(r[0],wm).length,Q=F.width/(3*A+1),t=0,c=d(n,Lr),P=d(n,tl),_=d(n,Xp),L=c?new Vd:V,K=0;A>K;K++){for(var N=0,I=0;H>I;I++)N+=d(r[I],wm)[K];if(N>0){var m=F.y+F.height;for(I=0;H>I;I++){var C=r[I],s=d(C,oc),v=d(C,wm)[K],p=v/N*F.height;s?g.fillStyle=s:(g.fillStyle=ch[t++],t===ch.length&&(t=0)),m-=p;var E={x:F.x+(1+3*K)*Q,y:m,width:2*Q,height:p};Qm(g,E.x,E.y,E.width,E.height),L&&(E.text=fg(c)?c(v,K,C,k):v,L.add(E))}}}L&&L.each(function(q){_q(g,q.text,P,_,q.x,q.y,q.width,q.height,zg)})}},b=function(U,P){var T=d(U,mh);if(T&&T.length>0){var y=T.length,K=d(U,"minValue")||0,v=d(U,"maxValue");if(v==V&&(v=0,T.forEach(function(y){d(y,wm).forEach(function(k){v=D(v,k)})})),K===v)return;for(var o=P.height/(v-K),c=P.y+v*o,Q=d(T[0],wm).length,e=P.width/(3*Q+1),b=0,x=d(U,"lineWidth")||2,G=d(U,"line3d"),E=d(U,"linePoint"),A=d(U,Lr),H=d(U,tl),Y=d(U,Xp),J=0;y>J;J++){var j=T[J],a=d(j,oc),_=d(j,wm);a?g.strokeStyle=a:(a=g.strokeStyle=ch[b++],b===ch.length&&(b=0)),g.beginPath();for(var f=0;Q>f;f++){var l=P.x+(2+3*f)*e,W=c-_[f]*o;0===f?g.moveTo(l,W):g.lineTo(l,W)}if(g.lineWidth=x,g.stroke(),G&&Hb(g,a,V,x,i),E||A){var u,L=x/2+2;for(f=0;Q>f;f++){var Z=_[f];if(l=P.x+(2+3*f)*e,W=c-Z*o,fg(E)?E(g,l,W,a,f,j,k):E&&(g.fillStyle=a,g.beginPath(),g.arc(l,W,L,0,w,!0),g.fill()),fg(A)?u=A(Z,f,j,k):A&&(u=Z),u){var X=hd(H,u).height,t=g.shadowBlur;if(t){var m=g.shadowOffsetX,z=g.shadowOffsetY,O=g.shadowColor;g.shadowOffsetX=0,g.shadowOffsetY=0,g.shadowBlur=0,g.shadowColor=V}_q(g,u,H,Y,l,W-X-L+2,0,X,zg),t&&(g.shadowOffsetX=m,g.shadowOffsetY=z,g.shadowBlur=t,g.shadowColor=O)}}}}}},S=function(){g=null,k=null,P=null},n=function(Z,H){var L;P&&P.getState?L=P.getState(k):(L=k instanceof oj?k.s(pf):null,(L===C||null===L)&&(L=d(Z,pf)));var X=d(H,pf);return X!==C&&null!==X&&X!==L?!1:d(H,gk)},q={border:z,image:N,text:R,pieChart:O,columnChart:X,stackedColumnChart:M,percentageColumnChart:a,lineChart:b};return function(G,w,y,r,D,F,v,Z,p,A){if(w&&D&&F){var L=g?!1:!0;g=G,k=v,P=Z,i=P?P._zoom?P._zoom:1:1,E=p,I=A;var b=D,N=F;if(Rk()){var Y,U,$;0===g[Fq]?Rk[0]&&(Y=!0):Y=!0,g.texureImage2D?Rk[1]&&(U=!0):U=!0,g.texureImage3D?Rk[2]&&($=!0):$=!0,Y&&U&&$&&(b=y,N=r)}if(w.tagName)return Jh(hf)&&!K[hf]||g.drawImage(w,b,N,D,F),L&&S(),void 0;if(d(w,"visible")===!1)return L&&S(),void 0;E||(E=$d(w.color,k,P)),A||(I=$d(w.blendMode,k,P)),Jh(hf)&&!K[hf]&&(D=b,F=N);var M=si(w,k,P,D),O=of(w,k,P,F),R={x:0,y:0,width:M,height:O,fitSize:d(w,"fitSize")},l=d(w,"clip"),X=d(w,"opacity");if(R.fitSize){var J=R.rw=$d(w.width,k,P)||20;R.widthScale=M/J;var e=R.rh=$d(w.height,k,P)||20;R.heightScale=O/e}if(g.save(),g.interactiveInfo){var z=g.interactiveInfo.matrix,o=z.clone();z.appendTranslate(b,N).appendScale(D/M,F/O)}Zo(g,b,N),(M!==D||O!==F)&&g.scale(D/M,F/O),l&&(fg(l)?l(g,M,O,k,P,w):(g.beginPath(),g.rect(0,0,M,O),g.clip())),X!=V&&(g.globalAlpha*=X),d(w,"comps").forEach(function(O){if(O.prefix){var b=Sr,Z=$d(O.prefix,k,P);Z&&(Sr=Sr+Z+".")}if(n(w,O)===!1)return O.prefix&&(Sr=b),void 0;if(ej.splice(0,0,O),g.interactiveInfo)var N=g.interactiveInfo.matrix.clone();var F=d(O,"opacity"),J=d(O,"shadow"),S=d(O,"type"),$=h(O,R);if(F!=V){var f=g.globalAlpha;g.globalAlpha*=F}if(J){var E=g.shadowOffsetX,M=g.shadowOffsetY,z=g.shadowBlur,I=g.shadowColor,K=d(O,"shadowOffsetX"),U=d(O,"shadowOffsetY"),u=d(O,"shadowBlur"),j=c(O,"shadowColor");g.shadowOffsetX=(K==V?3:K)*i,g.shadowOffsetY=(U==V?3:U)*i,g.shadowBlur=(u==V?6:u)*i,g.shadowColor=j||c(uq)}if("save"===S)g.save();else if("endClip"===S||"restore"===S)g.restore();else if("clip"===S)g.save(),_l(g,d(O,"points",x),d(O,"segments",B),!0),g.clip();else if(eo[S])$=$||{x:0,y:0,width:R.width,height:R.height},Q(O,S,$,R);else if(S===Hd)Q(O,S,$,R);else if("SVGPath"===S)H(O,S,$);else{$=$||{x:0,y:0,width:R.width,height:R.height};var v=d(O,cs),Y=d(O,"scaleX"),r=d(O,"scaleY"),l=t(O),L=T(O,$,$,v,Y,r,l);if(fg(S))_(O,S),m.drawCompType(S,g,$,O,k,P);else if(m.getCompType(S)){var W=m.getCompType(S),o=W.func||W;_(O,W),m.drawCompType(o,g,$,O,k,P)}else q[S]?q[S](O,$):m.getCompType(S)===C&&We.test(S)&&Yb(S);L&&s()}J&&(g.shadowOffsetX=E,g.shadowOffsetY=M,g.shadowBlur=z,g.shadowColor=I),F!=V&&(g.globalAlpha=f),g.interactiveInfo&&(g.interactiveInfo.matrix=N),O.prefix&&(Sr=b),ej.splice(0,1)}),g.interactiveInfo&&(g.interactiveInfo.matrix=o),g.restore(),L&&S()}}}();m.getCurrentComp=function(){return ej[0]},m.getParentComp=function(){return ej[1]},m.getInternal=function(){return{isEnter:Yd,isEsc:zq,isSpace:on,isLeft:hr,isUp:Zp,isRight:rc,isDown:Bh,addMethod:dc,superCall:Hh,toPointsArray:so,translateAndScale:dl,appendArray:Rd,createWorldMatrix:Fp,vec3TransformMat4:Qf,setCanvas:ye,createDiv:Ij,createView:np,createCanvas:sk,createImage:nr,initContext:Qq,layout:xg,fillRect:Qm,Mat:Ae,drawBorder:Mh,isString:Jh,setBorder:Pr,getPropertyValue:Gb,setPropertyValue:gd,drawVerticalLine:Tf,draw3DRect:$q,getPinchDist:xi,isSameRect:sd,getPosition:Lp,intersectionLineRect:vc,getNodeRect:ed,getEdgeAgentPosition:zh,getEdgeHostPosition:kb,getImageWidth:si,getImageHeight:of,initItemElement:He,drawPoints:_l,createG2:$p,closePopup:am,isH:Ap,createAnim:Ah,createNormalMatrix:or,createNormals:Hp,toFloatArray:dg,glMV:we,batchShape:Ge,createNodeMatrix:pc,getFaceInfo:pe,transformAppend:Ze,drawFaceInfo:gg,to3dPointsArray:Oe,setGLDebugMode:function(z){Kb=z},cube:function(){return{vs:bh,is:Ef,uv:wr}},ui:function(){return{DataUI:jc,NodeUI:Oh,EdgeUI:Sq,GroupUI:gf,ShapeUI:dr,GridUI:Uk,Data3dUI:bd,Node3dUI:sg,Shape3dUI:tc}},getInternalVersion:function(){return"U2FsdGVkX189WafXXxL6cdr9Z/bhYv484FmXR9DVQOg="},getDragger:function(){return bl},addMSMap:function(I){dc(Xc,I)},k:R}},function(a){function M(g,R){g!=V&&(R==V&&Sb!=typeof g?this._54O(g,256):this._54O(g,R))}function K(){return new M(V)}function y(O,c,M,R,d,h){for(;--h>=0;){var V=c*this[O++]+M[R]+d;d=$(V/67108864),M[R++]=67108863&V}return d}function r(j,m,I,L,i,Y){for(var d=32767&m,_=m>>15;--Y>=0;){var K=32767&this[j],R=this[j++]>>15,s=_*K+R*d;K=d*K+((32767&s)<<15)+I[L]+(1073741823&i),i=(K>>>30)+(s>>>15)+_*R+(i>>>30),I[L++]=1073741823&K}return i}function S(z,H,V,q,p,m){for(var B=16383&H,o=H>>14;--m>=0;){var N=16383&this[z],k=this[z++]>>14,G=o*N+k*B;N=B*N+((16383&G)<<14)+V[q]+p,p=(N>>28)+(G>>14)+o*k,V[q++]=268435455&N}return p}function O(p){return Xk.charAt(p)}function s(P,W){var n=Db[P.charCodeAt(W)];return n==V?-1:n}function L(g){for(var X=this.t-1;X>=0;--X)g[X]=this[X];g.t=this.t,g.s=this.s}function P(X){this.t=1,this.s=0>X?-1:0,X>0?this[0]=X:-1>X?this[0]=X+this.DV:this.t=0}function X(i){var h=K();return h._58O(i),h}function d(Y,h){var l,T=this;if(16==h)l=4;else if(8==h)l=3;else if(256==h)l=8;else if(2==h)l=1;else if(32==h)l=5;else{if(4!=h)return T.fromRadix(Y,h),void 0;l=2}T.t=0,T.s=0;for(var v=Y.length,U=!1,m=0;--v>=0;){var L=8==l?255&Y[v]:s(Y,v);0>L?"-"==Y.charAt(v)&&(U=!0):(U=!1,0==m?T[T.t++]=L:m+l>T.DB?(T[T.t-1]|=(L&(1<<T.DB-m)-1)<<m,T[T.t++]=L>>T.DB-m):T[T.t-1]|=L<<m,m+=l,m>=T.DB&&(m-=T.DB))}8==l&&0!=(128&Y[0])&&(T.s=-1,m>0&&(T[T.t-1]|=(1<<T.DB-m)-1<<m)),T._57O(),U&&M.ZERO._78O(T,T)}function m(){for(var c=this,S=c.s&c.DM;c.t>0&&c[c.t-1]==S;)--c.t}function G(A){var R=this;if(R.s<0)return"-"+R._85O()[Vj](A);var S;if(16==A)S=4;else if(8==A)S=3;else if(2==A)S=1;else if(32==A)S=5;else{if(4!=A)return R.toRadix(A);S=2}var X,b=(1<<S)-1,B=!1,w="",u=R.t,d=R.DB-u*R.DB%S;if(u-->0)for(d<R.DB&&(X=R[u]>>d)>0&&(B=!0,w=O(X));u>=0;)S>d?(X=(R[u]&(1<<d)-1)<<S-d,X|=R[--u]>>(d+=R.DB-S)):(X=R[u]>>(d-=S)&b,0>=d&&(d+=R.DB,--u)),X>0&&(B=!0),B&&(w+=O(X));return B?w:"0"}function c(){var y=K();return M.ZERO._78O(this,y),y}function I(){return this.s<0?this._85O():this}function k(S){var G=this,P=G.s-S.s;if(0!=P)return P;var u=G.t;if(P=u-S.t,0!=P)return G.s<0?-P:P;for(;--u>=0;)if(0!=(P=G[u]-S[u]))return P;return 0}function o(g){var z,s=1;return 0!=(z=g>>>16)&&(g=z,s+=16),0!=(z=g>>8)&&(g=z,s+=8),0!=(z=g>>4)&&(g=z,s+=4),0!=(z=g>>2)&&(g=z,s+=2),0!=(z=g>>1)&&(g=z,s+=1),s}function _(){var h=this;return h.t<=0?0:h.DB*(h.t-1)+o(h[h.t-1]^h.s&h.DM)}function h(W,D){var b;for(b=this.t-1;b>=0;--b)D[b+W]=this[b];for(b=W-1;b>=0;--b)D[b]=0;D.t=this.t+W,D.s=this.s}function B(i,g){for(var w=i;w<this.t;++w)g[w-i]=this[w];g.t=D(this.t-i,0),g.s=this.s}function J(q,t){var b,G=this,k=q%G.DB,h=G.DB-k,M=(1<<h)-1,V=$(q/G.DB),m=G.s<<k&G.DM;for(b=G.t-1;b>=0;--b)t[b+V+1]=G[b]>>h|m,m=(G[b]&M)<<k;for(b=V-1;b>=0;--b)t[b]=0;t[V]=m,t.t=G.t+V+1,t.s=G.s,t._57O()}function T(S,z){var P=this;z.s=P.s;var c=$(S/P.DB);if(c>=P.t)return z.t=0,void 0;var R=S%P.DB,X=P.DB-R,y=(1<<R)-1;z[0]=P[c]>>R;for(var x=c+1;x<P.t;++x)z[x-c-1]|=(P[x]&y)<<X,z[x-c]=P[x]>>R;R>0&&(z[P.t-c-1]|=(P.s&y)<<X),z.t=P.t-c,z._57O()}function Z(T,K){for(var e=this,U=0,J=0,d=f(T.t,e.t);d>U;)J+=e[U]-T[U],K[U++]=J&e.DM,J>>=e.DB;if(T.t<e.t){for(J-=T.s;U<e.t;)J+=e[U],K[U++]=J&e.DM,J>>=e.DB;J+=e.s}else{for(J+=e.s;U<T.t;)J-=T[U],K[U++]=J&e.DM,J>>=e.DB;J-=T.s}K.s=0>J?-1:0,-1>J?K[U++]=e.DV+J:J>0&&(K[U++]=J),K.t=U,K._57O()}function n(I,Y){var B=this.abs(),A=I.abs(),k=B.t;for(Y.t=k+A.t;--k>=0;)Y[k]=0;for(k=0;k<A.t;++k)Y[k+B.t]=B.am(0,A[k],Y,k,0,B.t);Y.s=0,Y._57O(),this.s!=I.s&&M.ZERO._78O(Y,Y)}function b(e){for(var P=this.abs(),d=e.t=2*P.t;--d>=0;)e[d]=0;for(d=0;d<P.t-1;++d){var m=P.am(d,P[d],e,2*d,0,1);(e[d+P.t]+=P.am(d+1,2*P[d],e,2*d+1,m,P.t-d-1))>=P.DV&&(e[d+P.t]-=P.DV,e[d+P.t+1]=1)}e.t>0&&(e[e.t-1]+=P.am(d,P[d],e,2*d,0,1)),e.s=0,e._57O()}function H(R,F,L){var y=R.abs(),T=this;if(!(y.t<=0)){var n=T.abs();if(n.t<y.t)return F!=V&&F._58O(0),L!=V&&T._77O(L),void 0;L==V&&(L=K());var b=K(),N=T.s,w=R.s,p=T.DB-o(y[y.t-1]);p>0?(y._44O(p,b),n._44O(p,L)):(y._77O(b),n._77O(L));var l=b.t,Q=b[l-1];if(0!=Q){var q=Q*(1<<T.F1)+(l>1?b[l-2]>>T.F2:0),E=T.FV/q,z=(1<<T.F1)/q,t=1<<T.F2,m=L.t,I=m-l,X=F==V?K():F;for(b._59O(I,X),L._52O(X)>=0&&(L[L.t++]=1,L._78O(X,L)),M.ONE._59O(l,X),X._78O(b,b);b.t<l;)b[b.t++]=0;for(;--I>=0;){var k=L[--m]==Q?T.DM:$(L[m]*E+(L[m-1]+t)*z);if((L[m]+=b.am(0,k,L,I,0,l))<k)for(b._59O(I,X),L._78O(X,L);L[m]<--k;)L._78O(X,L)}F!=V&&(L._45O(l,F),N!=w&&M.ZERO._78O(F,F)),L.t=l,L._57O(),p>0&&L._46O(p,L),0>N&&M.ZERO._78O(L,L)}}}function F(E){var D=K();return this.abs()._49O(E,V,D),this.s<0&&D._52O(M.ZERO)>0&&E._78O(D,D),D}function W($){this.m=$}function A(W){return W.s<0||W._52O(this.m)>=0?W.mod(this.m):W}function l(d){return d}function g(t){t._49O(this.m,V,t)}function q(r,w,X){r._47O(w,X),this._74O(X)}function C(e,l){e._48O(l),this._74O(l)}function E(){if(this.t<1)return 0;var u=this[0];if(0==(1&u))return 0;var l=3&u;return l=15&l*(2-(15&u)*l),l=255&l*(2-(255&u)*l),l=65535&l*(2-(65535&(65535&u)*l)),l=l*(2-u*l%this.DV)%this.DV,l>0?this.DV-l:-l}function p(y){var b=this;b.m=y,b.mp=y._50O(),b.mpl=32767&b.mp,b.mph=b.mp>>15,b.um=(1<<y.DB-15)-1,b.mt2=2*y.t}function u(X){var d=K();return X.abs()._59O(this.m.t,d),d._49O(this.m,V,d),X.s<0&&d._52O(M.ZERO)>0&&this.m._78O(d,d),d}function t(x){var v=K();return x._77O(v),this._74O(v),v}function x(D){for(var c=this;D.t<=c.mt2;)D[D.t++]=0;for(var P=0;P<c.m.t;++P){var L=32767&D[P],a=L*c.mpl+((L*c.mph+(D[P]>>15)*c.mpl&c.um)<<15)&D.DM;for(L=P+c.m.t,D[L]+=c.m.am(0,a,D,P,0,c.m.t);D[L]>=D.DV;)D[L]-=D.DV,D[++L]++}D._57O(),D._45O(c.m.t,D),D._52O(c.m)>=0&&D._78O(c.m,D)}function Zm(p,V){p._48O(V),this._74O(V)}function Vn(c,r,u){c._47O(r,u),this._74O(u)}function So(){return 0==(this.t>0?1&this[0]:this.s)}function hf(v,t){if(v>4294967295||1>v)return M.ONE;var X=K(),f=K(),m=t._73O(this),i=o(v)-1;for(m._77O(X);--i>=0;)if(t._76O(X,f),(v&1<<i)>0)t._75O(f,m,X);else{var u=X;X=f,f=u}return t.revert(X)}function vh(r,E){var B;return B=256>r||E._51O()?new W(E):new p(E),this.exp(r,B)}function _f(){var N=this;if(N.s<0){if(1==N.t)return N[0]-N.DV;if(0==N.t)return-1}else{if(1==N.t)return N[0];if(0==N.t)return 0}return(N[1]&(1<<32-N.DB)-1)<<N.DB|N[0]}function Ij(A,f){return new M(A,f)}function Og(){var A=this;A.n=V,A.e=0,A.d=V,A.p=V,A.q=V,A.dmp1=V,A.dmq1=V,A._10A=V}function Rq(Z){return Z._53O(this.e,this.n)}function yi(d){var g,v,b,F="",y=0;for(g=0;g<d.length&&d.charAt(g)!=mp;++g)b=Ql.indexOf(d.charAt(g)),0>b||(0==y?(F+=O(b>>2),v=3&b,y=1):1==y?(F+=O(v<<2|b>>4),v=15&b,y=2):2==y?(F+=O(v),F+=O(b>>2),v=3&b,y=3):(F+=O(v<<2|b>>4),F+=O(15&b),y=0));return 1==y&&(F+=O(v<<2)),F}function Kj(D){var F=D.split(""),n=yi(D);return F.forEach(function(B){var $=B.length;$>0&&n&&(If+=Q(B))}),n}function vb(i,j){var b=Im._4O.Util._56O(i,"ss"),S={},f=0;return S.v=b==j,S.t=1,S.s=0>f?-1:0,Ml=S.v,f>0?S[0]=f:-1>f?S[0]=f+S.DV:S.t=0,[b,S]}function Cl(J){var E=38,j=J.substring(0,E);if(j&&30==j.indexOf("05000420")){var W=["ss",J.substring(E)];return W}return[]}function lq(m,u){u=u.replace(yf,""),u=u.replace(/[ \n]+/g,"");var Z=Ij(u,16);if(Z._55O()>this.n._55O())return 0;var v=this._37O(Z),n=v[Vj](16).replace(/^1f+00/,""),q=Cl(n);if(0==q.length)return!1;for(var b,G,I,$=.5,p=sn,X=[0,.5,.75,.875,.9375],x=[],N=[],L=[],Q=w/p,C=q[1],T=vb(m,C)[0],h=0,D=0;h<X.length;h++){var r=0===h%2?0:.5;for(b=0;p>=b;b++)G=(b+r)*Q,I=1-X[h],x.push(e(G)*$*I,-$+2*X[h]*$,-U(G)*$*I),N.push((b+r)/p,I)}for(h=0;h<X.length-1;h++){var V=h*(p+1),t=(h+1)*(p+1);for(b=0;p>b;b++)L.push(V+b,t+b+1,t+b,V+b,V+b+1,t+b+1)}return L.forEach(function(z){D+=z}),C==T&&D>10}var wl,mj=0xdeadbeefcafe,ph=15715070==(16777215&mj),Vj="toString",$d="",Nb="nat",jp=function(){};z=a["D"+11182[Vj](i(2,5))];var ye=M.prototype;Lm+=zl.substr(0,1);var Xg=a.navigator?a.navigator.appName:"";ph&&"Microsoft Internet Explorer"==Xg?(ye.am=r,wl=30):ph&&"Netscape"!=Xg?(ye.am=y,wl=26):(ye.am=S,wl=28),ye.DB=wl,ye.DM=(1<<wl)-1,ye.DV=1<<wl;var id=52;ye.FV=i(2,id),ye.F1=id-wl,ye.F2=2*wl-id;var gk,Oh,Xk="0123456789abcdefghijklmnopqrstuvwxyz",Db=[],Dc=function(y){return String.fromCharCode(y)};for(gk="0".charCodeAt(0),Oh=0;9>=Oh;++Oh)Db[gk++]=Oh;for(gk="a".charCodeAt(0),Oh=10;36>Oh;++Oh)Db[gk++]=Oh;for(gk="A".charCodeAt(0),Oh=10;36>Oh;++Oh)Db[gk++]=Oh;var Ir=W.prototype;Ir._73O=A,Ir.revert=l,Ir._74O=g,Ir._75O=q,Ir._76O=C;var zg=p.prototype;zg._73O=u,zg.revert=t,zg._74O=x,zg._75O=Vn,zg._76O=Zm,ye._77O=L,ye._58O=P,ye._54O=d,ye._57O=m,ye._59O=h,ye._45O=B,ye._44O=J,ye._46O=T,ye._78O=Z,ye._47O=n,ye._48O=b,ye._49O=H,ye._50O=E,ye._51O=So,ye.exp=hf,ye.toString=G,ye._85O=c,ye.abs=I,ye._52O=k,ye._55O=_,ye.mod=F,ye._53O=vh,M.ZERO=X(0),M.ONE=X(1),ye._86O=_f;var Lp=function(Y,R){var d=this;d.isPublic=!0,typeof Y!==Sb?(d.n=Y,d.e=R):Y!=V&&R!=V&&Y.length>0&&R.length>0&&(d.n=Ij(Y,16),d.e=Q(R,16))};qp=function(){var E,h,o=Kj(zd),b=o.substr(0,4),y=o.substr(4,2),Z=o.substr(6,2),S=1,k=!S,c=R,Y=[],m=Ke.charAt(7);if(z&&(z[Vj]().indexOf(Nb)<0||z[Lm][Vj]().indexOf(Nb)<0||!o?E=V:(o=new z(b-0,y-S,Z-0),h=o.setHours(9),z[Lm]()>h?E=uj[m]:k=!0)),o&&E&&E[0]&&E[j(.5)]&&c){var n=df(E[0]),$=df(E[1]);for(var _ in $)Y.push(_);var r,p=0,i=n[Y[p]],T=$[Y[p++]],H=$[Y[p++]],q=$[Y[p++]],K=$[Y[p++]],U=$[Y[p++]],u=$[Y[p++]],J=n[Y[p]],w=$[Y[p++]],a=zf._27O(c);if(i===T&&a&&w){r=T+H+q+K+U+u;var C=!u||u===vi;if(!C&&u)for(var v,X=0,s=u.length;s>X;X++)u[X]===_d[p]?v===vi?C=!0:v=V:(v==V?v=u[X]:v+=u[X],X===s-1&&v===vi&&(C=!0));r&&a._31O(r,w)&&a._31O(i,J)&&C&&(!U||z[Lm]()<U)&&(k=!0)}}return k||(En=eh),m};var vg=Og.prototype;vg._37O=Rq,vg._38O=Lp;var Ql="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",mp="=",Hq=25,cf=10,zd="IBkQAQ==",Wf=Wf||function(S,l){var p={},T=p._7A={},C=T._6A=function(){function N(){}return{_80O:function(n){N.prototype=this;var p=new N;return n&&p._5A(n),p.hasOwnProperty("_82O")||(p._82O=function(){p.$super._82O.apply(this,arguments)}),p._82O.prototype=p,p.$super=this,p},_3A:function(){var Y=this._80O();return Y._82O.apply(Y,arguments),Y},_82O:function(){},_5A:function(D){for(var f in D)D.hasOwnProperty(f)&&(this[f]=D[f]);D.hasOwnProperty(Vj)&&(this.toString=D.toString)},_88O:function(){return this._82O.prototype._80O(this)}}}(),V=T._39O=C._80O({_82O:function(A,N){A=this._84O=A||[],this._65O=N!=l?N:4*A.length},toString:function(k){return(k||h).stringify(this)},_89O:function(V){var I=this._84O,q=V._84O,c=this._65O,M=V._65O;if(this._57O(),c%4)for(var m=0;M>m;m++){var s=255&q[m>>>2]>>>24-8*(m%4);I[c+m>>>2]|=s<<24-8*((c+m)%4)}else if(q.length>65535)for(var m=0;M>m;m+=4)I[c+m>>>2]=q[m>>>2];else I.push.apply(I,q);return this._65O+=M,this},_57O:function(){var f=this._84O,F=this._65O;f[F>>>2]&=4294967295<<32-8*(F%4),f.length=j(F/4)},_88O:function(){var r=C._88O.call(this);return r._84O=this._84O.slice(0),r},_87O:function(H){for(var K=[],o=0;H>o;o+=4)K.push(0|4294967296*v);return new V._82O(K,H)}}),e=p._2A={},h=e._69O={stringify:function(n){var g,t=n._84O,N=n._65O,L=[];for(g=0;N>g;g++){var c=255&t[g>>>2]>>>24-8*(g%4);L.push((c>>>4).toString(16)),L.push((15&c).toString(16))}return L.join("")},_68O:function(j){for(var u=j.length,v=[],f=0;u>f;f+=2)v[f>>>3]|=Q(j.substr(f,2),16)<<24-4*(f%8);return new V._82O(v,u/2)}},M=e._8A={stringify:function(R){var Z,n=R._84O,I=R._65O,h=[];for(Z=0;I>Z;Z++){var Y=255&n[Z>>>2]>>>24-8*(Z%4);h.push(Dc(Y))}return h.join("")},_68O:function(z){var u,r=z.length,c=[];for(u=0;r>u;u++)c[u>>>2]|=(255&z.charCodeAt(u))<<24-8*(u%4);return new V._82O(c,r)}},E=e._9A={stringify:function(F){try{return decodeURIComponent(escape(M.stringify(F)))}catch(L){throw new Error("")}},_68O:function(Q){return M._68O(unescape(encodeURIComponent(Q)))}},B=T._32O=C._80O({_1A:function(){this._83O=new V._82O,this._23O=0},_33O:function($){typeof $==Sb&&($=E._68O($)),this._83O._89O($),this._23O+=$._65O},_25O:function($){var L=this._83O,l=L._84O,P=L._65O,s=this._79O,z=4*s,k=P/z;k=$?j(k):D((0|k)-this._22O,0);var e=k*s,U=f(4*e,P);if(e){for(var v=0;e>v;v+=s)this._20O(l,v);var g=l.splice(0,e);L._65O-=U}return new V._82O(g,U)},_88O:function(){var B=C._88O.call(this);return B._83O=this._83O._88O(),B},_22O:0});T._66O=B._80O({cfg:C._80O(),_82O:function(R){this.cfg=this.cfg._80O(R),this._1A()},_1A:function(){B._1A.call(this),this._34O()},_81O:function(q){return this._33O(q),this._25O(),this},_72O:function(D){D&&this._33O(D);var c=this._21O();return c},_79O:16,_26O:function(b){return function(Q,f){return new b._82O(f)._72O(Q)}},_19O:function(H){return function(w,b){return new $._71O._82O(H,b)._72O(w)}}});var $=p._67O={};return p}();!function(){var r=Wf,p=r._7A,F=p._39O,Z=p._66O,T=r._67O,M=[],u=[];!function(){function w(n){for(var I=Y(n),c=2;I>=c;c++)if(!(n%c))return!1;return!0}function g(W){return 0|4294967296*(W-(0|W))}for(var P=2,E=0;64>E;)w(P)&&(8>E&&(M[E]=g(i(P,.5))),u[E]=g(i(P,1/3)),E++),P++}();var v=[],X=T._41O=Z._80O({_34O:function(){this._64O=new F._82O(M.slice(0))},_20O:function(c,D){for(var Q=this._64O._84O,r=Q[0],g=Q[1],O=Q[2],$=Q[3],X=Q[4],z=Q[5],K=Q[6],G=Q[7],L=0;64>L;L++){if(16>L)v[L]=0|c[D+L];else{var N=v[L-15],E=(N<<25|N>>>7)^(N<<14|N>>>18)^N>>>3,P=v[L-2],U=(P<<15|P>>>17)^(P<<13|P>>>19)^P>>>10;v[L]=E+v[L-7]+U+v[L-16]}var k=X&z^~X&K,b=r&g^r&O^g&O,B=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),s=(X<<26|X>>>6)^(X<<21|X>>>11)^(X<<7|X>>>25),J=G+s+k+u[L]+v[L],H=B+b;G=K,K=z,z=X,X=0|$+J,$=O,O=g,g=r,r=0|J+H}Q[0]=0|Q[0]+r,Q[1]=0|Q[1]+g,Q[2]=0|Q[2]+O,Q[3]=0|Q[3]+$,Q[4]=0|Q[4]+X,Q[5]=0|Q[5]+z,Q[6]=0|Q[6]+K,Q[7]=0|Q[7]+G},_21O:function(){var L=this._83O,V=L._84O,c=8*this._23O,e=8*L._65O;return V[e>>>5]|=128<<24-e%32,V[(e+64>>>9<<4)+14]=$(c/4294967296),V[(e+64>>>9<<4)+15]=c,L._65O=4*V.length,this._25O(),this._64O},_88O:function(){var V=Z._88O.call(this);return V._64O=this._64O._88O(),V}});r._41O=Z._26O(X),r._42O=Z._19O(X)}();var yf=new RegExp("");yf.compile("[^0-9a-f]","gi"),Og._28O=-1,Og._29O=-2,vg._31O=lq,vg._63O=lq,Og._43O=-2;var td=new function(){var v=this;v._5O=function(Z,a){if("8"!=Z.substring(a+2,a+3))return 1;var e=Q(Z.substring(a+3,a+4));return 0==e?-1:e>0&&10>e?e+1:-2},v._13O=function(Q,u){var O=v._5O(Q,u);return 1>O?"":Q.substring(u+2,u+2+2*O)},v._12O=function(U,w){var a=v._13O(U,w);if(""==a)return-1;var W;return W=Q(a.substring(0,1))<8?new M(a,16):new M(a.substring(2),16),W._86O()},v._6O=function(U,c){var t=v._5O(U,c);return 0>t?t:c+2*(t+1)},v._11O=function(R,G){var s=v._6O(R,G),T=v._12O(R,G);return R.substring(s,s+2*T)},v._10O=function(f,O){var q=v._6O(f,O),D=v._12O(f,O);return q+2*D},v._7O=function(e,q){var X=[],G=v._6O(e,q);X.push(G);for(var W=v._12O(e,q),T=G,D=0;;){var f=v._10O(e,T);if(f==V||f-G>=2*W)break;if(D>=200)break;X.push(f),T=f,D++}return X}};if(td._90O=Dc(cf+24),td._91O=N+Dc(cf*cf+8),Im==V||!Im)var Im={};Im._4O!=V&&Im._4O||(Im._4O={});var Ze=Im._4O;Im._4O.Util=new function(){var K=this;K._56O=function(p){var R=new Im._4O._3O;return R._30O(p)},K._4A=function(I){var Y=new Im._4O._3O;return Y._36O(I)},K._11A=function(R){var m=new Ze._3O;return m._30O(R)}},Im._4O._3O=function(){var l=this;l._8O=function(y,a){if("ss"==y&&"cj"==a){try{l.md=Wf._67O._41O._3A()}catch(z){jp($d)}l._24O=function(s){l.md._81O(s)},l._35O=function(k){var O=Wf._2A._69O._68O(k);l.md._81O(O)},l._60O=function(){var Y=l.md._72O();return Y[Vj](Wf._2A._69O)},l._30O=function(B){return l._24O(B),l._60O()},l._36O=function(h){return l._35O(h),l._60O()}}},l._24O=function(){jp($d)},l._35O=function(){jp($d)},l._60O=function(){jp($d)},l._30O=function(){jp($d)},l._36O=function(){jp($d)},l._8O("ss","cj")},Km=function(M){var s=il[bb[7]],v=1,a=!1;if(Qp.a!=il[Qg])return Qp.a;if(Qp.forEach(function(c){v*=c}),M>v){if(s&&s[1]&&s[0]){var u=s[0],J=s[1];J=J.split(td._90O),u=u.split(td._90O);var l=J[3],B=u[3],$=J[7],Z=J[11],y=J[15],p=J[19],K=J[23],e=J[27],h=u[7],i=l+$+Z+y+p+K,E=K?!1:!0,U=B===l;if(K){var j=K&&K.split(wc("firefox")[3]);if(j)for(var P=0;P<j.length;P++)if(ss.indexOf(j[P])>=0){E=!0;break}}a=U&&Oq()(B,h)&&Oq()(i,e)&&E&&(!p||p>M)}a||(jc.prototype._42=kp)}else a=!0;return Qp.a=a,a},Hq=String.fromCharCode(Hq+20);var qr=function(G){return G=G.replace(yf,$d),G=G.replace(/[ \n]+/g,$d)},gc="30",sh="06",Eb="02",On="03",Tg=Ij,Cg=/^1f+00/,zf=function(){var c;return c={_18O:function(F){var E=F,n=E.replace(/\s+/g,""),P=yi(n);return P},_14O:function(V){var s=this._18O(V),b=this._15O(s);return b},_15O:function(q){var N=this._17O(q);if("2a864886f70d010101"==N._61O){var M=this._16O(N.key),A=new Og;return A._38O(M.n,M.e),A}jp($d)},_16O:function(j){var w={};j.substr(0,2)!=gc&&jp($d);var O=td._7O(j,0);return 2!=O.length&&jp($d),j.substr(O[0],2)!=Eb&&jp($d),w.n=td._11O(j,O[0]),j.substr(O[1],2)!=Eb&&jp($d),w.e=td._11O(j,O[1]),w},_17O:function(n){var Z={};Z._40O=V;var x=td._7O(n,0);2!=x.length&&jp($d);var D=x[0];n.substr(D,2)!=gc&&jp($d);var i=td._7O(n,D);return 2!=i.length&&jp($d),n.substr(i[0],2)!=sh&&jp($d),Z._61O=td._11O(n,i[0]),n.substr(i[1],2)==sh?Z._40O=td._11O(n,i[1]):n.substr(i[1],2)==gc&&(Z._40O={},Z._40O.p=td._70O(n,i[1],[0],Eb),Z._40O.q=td._70O(n,i[1],[1],Eb),Z._40O.g=td._70O(n,i[1],[2],Eb)),n.substr(x[1],2)!=On&&jp($d),Z.key=td._11O(n,x[1]).substr(2),Z}},c._17O?c:V}(),nb=zf._27O=function(q){return zf._14O(q)};Oq=function(){return function(f,L){if(f&&L){L=qr(L);var u=Tg(L,i(2,4)),y=this;if(!y||!y.n||u._55O()>y.n._55O())return 0;var P=y._37O(u),d=P[Vj](i(2,4)).replace(Cg,""),Y=Cl(d);if(0==Y.length)return!1;var z=Y[0],B=Y[1],T=function(X){return Im._4O.Util._56O(X,z)},b=T(f);return B==b}}.bind(nb(R))};var Ah,Jc;return function(){var a=Pb.length-De.length;if(a>0)for(var R=0;a>R;R++)Ah=Ze.Util,Jc=qr}(),zr=function(g,C){C=Jc(C);var H=nb(Yj),x=Sd.length,G=2*x,T=Tg(C,i(x,G)),b=H,U=!0;if(b){var e=b[Fi[0]];e&&T._55O()<=e._55O()&&(U=!1)}if(U)return 0;var p=b._37O(T),K=p[Vj](i(x,G)).replace(Cg,""),X=Cl(K);if(0==X.length)return!1;var h=X[0],u=X[1],n=Ah._11A(g,h);return u==n},zf}(K,H),dc(m,{load:function(){var Q={},y=function(b){return b?"c_"+(b.sync?"1":"0")+"_"+(b.post?"1":"0")+"_"+(b.responseType||"H")+"_"+(b.mimeType||"H")+"_"+(b.data?JSON.stringify(b.data):"H"):""};return function(s,$,z){var n,p=Q[s],K=y(z);return p&&(n=p[K])?(n.push($),void 0):(Q[s]||(p=Q[s]={count:0}),n=p[K]=[$],p.count++,m.xhrLoad(s,function(I){delete p[K],p.count--,p.count||delete Q[s],n.forEach(function(K){K(I)})},z),void 0)}}(),asyncEach:function(N,t,I){"function"!=typeof I&&(I=Function.prototype);var A=new Array(N.length),D=0,n=!1;N.forEach(function(l,E){t(l,function(d,e){return n?void 0:d?(n=!0,I(null)):(A[E]=e,D++,D===N.length?I(A):void 0)})})},xhrLoad:function(i,g,$){var l=!1;lk(i)||(l=!0,i=[i]),$=$||{},i.length;var Q=$.sync,v=!!$.post,j=null;return m.asyncEach(i,function(g,p){var b=new lh;g=m.beforeLoadURL(g),g.data?p(null,g.data):($.url=encodeURI(g),$.method=v?"POST":"GET",$.responseType?b.setResponseType($.responseType):b.setOverrideMimeType($.mimeType||"text/plain"),b.onload=function(){200===this.status||0===this.status?p(null,b.getResponseText()):p(!0)},b.onerror=function(){p(!0)},b.send($))},function(J){var q="function"==typeof g;(q||Q)&&(j=l&&J?J[0]:J,q&&g(j))}),Q?j:void 0}}),Math.sign===C&&(Math.sign=function(v){return 0>v?-1:v>0?1:+v});var mg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",pq={encode:function(B,y){var v,H,L,Y,E,q,A,j="",u=0;for(B=pq._utf8_encode(B);u<B.length;)v=B.charCodeAt(u++),H=B.charCodeAt(u++),L=B.charCodeAt(u++),Y=v>>2,E=(3&v)<<4|H>>4,q=(15&H)<<2|L>>6,A=63&L,isNaN(H)?q=A=64:isNaN(L)&&(A=64),j=j+y.charAt(Y)+y.charAt(E)+y.charAt(q)+y.charAt(A);return j},decode:function(D,U){var k,$,E,a,p,i,M,S="",W=0;for(D=D.replace(/[^A-Za-z0-9\+\/\=]/g,"");W<D.length;)a=U.indexOf(D.charAt(W++)),p=U.indexOf(D.charAt(W++)),i=U.indexOf(D.charAt(W++)),M=U.indexOf(D.charAt(W++)),k=a<<2|p>>4,$=(15&p)<<4|i>>2,E=(3&i)<<6|M,S+=String.fromCharCode(k),64!=i&&(S+=String.fromCharCode($)),64!=M&&(S+=String.fromCharCode(E));return S=pq._utf8_decode(S)},_utf8_encode:function(v){v=v.replace(/\r\n/g,"\n");for(var U="",A=0;A<v.length;A++){var j=v.charCodeAt(A);128>j?U+=String.fromCharCode(j):j>127&&2048>j?(U+=String.fromCharCode(192|j>>6),U+=String.fromCharCode(128|63&j)):(U+=String.fromCharCode(224|j>>12),U+=String.fromCharCode(128|63&j>>6),U+=String.fromCharCode(128|63&j))}return U},_utf8_decode:function(R){for(var t="",G=0,d=0,c=0,D=0;G<R.length;)d=R.charCodeAt(G),128>d?(t+=String.fromCharCode(d),G++):d>191&&224>d?(c=R.charCodeAt(G+1),t+=String.fromCharCode((31&d)<<6|63&c),G+=2):(c=R.charCodeAt(G+1),D=R.charCodeAt(G+2),t+=String.fromCharCode((15&d)<<12|(63&c)<<6|63&D),G+=3);return t}};k.Math={generateUUID:function(){for(var P=[],d=0;256>d;d++)P[d]=(16>d?"0":"")+d.toString(16).toUpperCase();return function(){var O=0|4294967295*Math.random(),S=0|4294967295*Math.random(),A=0|4294967295*Math.random(),Z=0|4294967295*Math.random();return P[255&O]+P[255&O>>8]+P[255&O>>16]+P[255&O>>24]+"-"+P[255&S]+P[255&S>>8]+"-"+P[64|15&S>>16]+P[255&S>>24]+"-"+P[128|63&A]+P[255&A>>8]+"-"+P[255&A>>16]+P[255&A>>24]+P[255&Z]+P[255&Z>>8]+P[255&Z>>16]+P[255&Z>>24]}}(),clamp:function(o,S,u){return Math.max(S,Math.min(u,o))},generateIncreasingID:function(){var y=0;return function(){return++y}}(),encodeBase64:function(E,Z){return pq.encode(E,Z||mg)},decodeBase64:function(A,M){return pq.decode(A,M||mg)},randomArray:function(f,l){l=l||f.length;for(var C=l-1;C>0;C--){var _=Math.floor(Math.random()*(C+1)),H=f[C];f[C]=f[_],f[_]=H}return f}};var Eh=k.Matrix=k.Math.Matrix2d=function(F,g,z,y,X){this.setFromTransform(F,g,z,y,X)},Ae=Eh;Eh.prototype={},Eh.prototype.constructor=Eh,Eh.prototype.set=function(g,G,v,T,W,R){return this.a=g,this.b=G,this.c=v,this.d=T,this.tx=W,this.ty=R,this},Eh.prototype.setFromTransform=function(A,j,Y,n,Z){var y=this;if(A===C)return y.a=1,y.b=0,y.c=0,y.d=1,y.tx=0,y.ty=0,void 0;A=A||0;var o=U(A),x=e(A);return n=n||1,Z=Z||1,y.a=x*n,y.b=o*n,y.c=-o*Z,y.d=x*Z,y.tx=j||0,y.ty=Y||0,y},Eh.prototype.apply=function(A,g){g=g||new nj;var p=A.x,l=A.y;return g.x=this.a*p+this.c*l+this.tx,g.y=this.b*p+this.d*l+this.ty,g},Eh.prototype.applyInverse=function(K,R){R=R||new nj;var b=1/(this.a*this.d+this.c*-this.b),S=K.x,P=K.y;return R.x=this.d*b*S+-this.c*b*P+(this.ty*this.c-this.tx*this.d)*b,R.y=this.a*b*P+-this.b*b*S+(-this.ty*this.a+this.tx*this.b)*b,R},Eh.prototype.translate=function(o,c){return this.tx+=o,this.ty+=c,this},Eh.prototype.scale=function(G,J){return this.a*=G,this.d*=J,this.c*=G,this.b*=J,this.tx*=G,this.ty*=J,this},Eh.prototype.rotate=function(v){var e=Math.cos(v),h=Math.sin(v),O=this.a,x=this.c,y=this.tx;return this.a=O*e-this.b*h,this.b=O*h+this.b*e,this.c=x*e-this.d*h,this.d=x*h+this.d*e,this.tx=y*e-this.ty*h,this.ty=y*h+this.ty*e,this},Eh.prototype.appendTranslate=function(r,u){return this.tx+=this.a*r+this.c*u,this.ty+=this.b*r+this.d*u,this},Eh.prototype.appendScale=function(e,C){return this.a*=e,this.d*=C,this.c*=C,this.b*=e,this},Eh.prototype.appendRotate=function(m){if(!m)return this;var v=Math.cos(m),S=Math.sin(m),J=this.a,V=this.b;return this.a=J*v+this.c*S,this.b=V*v+this.d*S,this.c=-J*S+this.c*v,this.d=-V*S+this.d*v,this},Eh.prototype.append=function(e){var I=this.a,M=this.b,q=this.c,R=this.d;return this.a=e.a*I+e.b*q,this.b=e.a*M+e.b*R,this.c=e.c*I+e.d*q,this.d=e.c*M+e.d*R,this.tx=e.tx*I+e.ty*q+this.tx,this.ty=e.tx*M+e.ty*R+this.ty,this},Eh.prototype.setTransform=function(g,n,O,B,x,X,H,Z,b){var Y,s,o,d,e,P,y,q,J,i;return e=Math.sin(H),P=Math.cos(H),y=Math.cos(b),q=Math.sin(b),J=-Math.sin(Z),i=Math.cos(Z),Y=P*x,s=e*x,o=-e*X,d=P*X,this.a=y*Y+q*o,this.b=y*s+q*d,this.c=J*Y+i*o,this.d=J*s+i*d,this.tx=g+(O*Y+B*o),this.ty=n+(O*s+B*d),this},Eh.prototype.prepend=function(m){var t=this.tx;if(1!==m.a||0!==m.b||0!==m.c||1!==m.d){var U=this.a,o=this.c;this.a=U*m.a+this.b*m.c,this.b=U*m.b+this.b*m.d,this.c=o*m.a+this.d*m.c,this.d=o*m.b+this.d*m.d}return this.tx=t*m.a+this.ty*m.c+m.tx,this.ty=t*m.b+this.ty*m.d+m.ty,this},Eh.prototype.transform=Eh.prototype.prepend,Eh.prototype.invert=function(){var Y=this.a,C=this.b,B=this.c,w=this.d,f=this.tx,u=Y*w-C*B;return this.a=w/u,this.b=-C/u,this.c=-B/u,this.d=Y/u,this.tx=(B*this.ty-w*f)/u,this.ty=-(Y*this.ty-C*f)/u,this},Eh.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Eh.prototype.clone=function(){var $=new Eh;return $.a=this.a,$.b=this.b,$.c=this.c,$.d=this.d,$.tx=this.tx,$.ty=this.ty,$},Eh.prototype.copy=function(Z){return Z.a=this.a,Z.b=this.b,Z.c=this.c,Z.d=this.d,Z.tx=this.tx,Z.ty=this.ty,Z},Eh.prototype.tf=function(W,P){1===arguments.length&&(P=W.y,W=W.x);var g=this;return{x:g.a*W+g.c*P+g.tx,y:g.b*W+g.d*P+g.ty}},Eh.prototype.tfi=function(l,M){1===arguments.length&&(M=l.y,l=l.x);var k=this,t=1/(k.a*k.d+k.c*-k.b);return{x:k.d*t*l+-k.c*t*M+(k.ty*k.c-k.tx*k.d)*t,y:k.a*t*M+-k.b*t*l+(-k.ty*k.a+k.tx*k.b)*t}},Eh.IDENTITY=new Eh,Eh.TEMP_MATRIX=new Eh;var bn=k.Math.Quaternion=function(i,I,F,m){this.set(i,I,F,m)};H.assign(bn.prototype,{set:function(L,c,$,s){var p=this;return p._x=L||0,p._y=c||0,p._z=$||0,p._w=s!==C?s:1,p},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(T){var A=this;return A._x=T._x,A._y=T._y,A._z=T._z,A._w=T._w,A},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var G=this.length();return 0===G?(this._x=0,this._y=0,this._z=0,this._w=1):(G=1/G,this._x=this._x*G,this._y=this._y*G,this._z=this._z*G,this._w=this._w*G),this},fromArray:function(b,y){y===C&&(y=0);var E=this;return E._x=b[y],E._y=b[y+1],E._z=b[y+2],E._w=b[y+3],this},slerp:function(I,e){if(0===e)return this;if(1===e)return this.copy(I);var i=this._x,c=this._y,W=this._z,n=this._w,w=n*I._w+i*I._x+c*I._y+W*I._z;if(0>w?(this._w=-I._w,this._x=-I._x,this._y=-I._y,this._z=-I._z,w=-w):this.copy(I),w>=1)return this._w=n,this._x=i,this._y=c,this._z=W,this;var m=Math.sqrt(1-w*w);if(Math.abs(m)<.001)return this._w=.5*(n+this._w),this._x=.5*(i+this._x),this._y=.5*(c+this._y),this._z=.5*(W+this._z),this;var b=Math.atan2(m,w),V=Math.sin((1-e)*b)/m,J=Math.sin(e*b)/m;return this._w=n*V+this._w*J,this._x=i*V+this._x*J,this._y=c*V+this._y*J,this._z=W*V+this._z*J,this},setFromAxisAngle:function(V,z){var v=z/2,q=Math.sin(v);return this._x=V.x*q,this._y=V.y*q,this._z=V.z*q,this._w=Math.cos(v),this},setFromEuler:function(w){var E=w._x,X=w._y,H=w._z,u=w._order,P=Math.cos,a=Math.sin,l=P(E/2),j=P(X/2),f=P(H/2),i=a(E/2),B=a(X/2),t=a(H/2);
return"XYZ"===u?(this._x=i*j*f+l*B*t,this._y=l*B*f-i*j*t,this._z=l*j*t+i*B*f,this._w=l*j*f-i*B*t):"YXZ"===u?(this._x=i*j*f+l*B*t,this._y=l*B*f-i*j*t,this._z=l*j*t-i*B*f,this._w=l*j*f+i*B*t):"ZXY"===u?(this._x=i*j*f-l*B*t,this._y=l*B*f+i*j*t,this._z=l*j*t+i*B*f,this._w=l*j*f-i*B*t):"ZYX"===u?(this._x=i*j*f-l*B*t,this._y=l*B*f+i*j*t,this._z=l*j*t-i*B*f,this._w=l*j*f+i*B*t):"YZX"===u?(this._x=i*j*f+l*B*t,this._y=l*B*f+i*j*t,this._z=l*j*t-i*B*f,this._w=l*j*f-i*B*t):"XZY"===u&&(this._x=i*j*f-l*B*t,this._y=l*B*f-i*j*t,this._z=l*j*t+i*B*f,this._w=l*j*f+i*B*t),this},setFromRotationMatrix:function(x){var O,L=x.el,Y=L[0],r=L[4],d=L[8],k=L[1],y=L[5],l=L[9],D=L[2],Q=L[6],X=L[10],b=Y+y+X;return b>0?(O=.5/Math.sqrt(b+1),this._w=.25/O,this._x=(Q-l)*O,this._y=(d-D)*O,this._z=(k-r)*O):Y>y&&Y>X?(O=2*Math.sqrt(1+Y-y-X),this._w=(Q-l)/O,this._x=.25*O,this._y=(r+k)/O,this._z=(d+D)/O):y>X?(O=2*Math.sqrt(1+y-Y-X),this._w=(d-D)/O,this._x=(r+k)/O,this._y=.25*O,this._z=(l+Q)/O):(O=2*Math.sqrt(1+X-Y-y),this._w=(k-r)/O,this._x=(d+D)/O,this._y=(l+Q)/O,this._z=.25*O),this},setFromToVectors:function(){var k,p;return function(b,a){return k===C&&(k=new ah),p=b.dot(a)+1,1e-7>p?(p=0,Math.abs(b.x)>Math.abs(b.z)?k.set(-b.y,b.x,0):k.set(0,-b.z,b.y)):k.crossVectors(b,a),this._x=k.x,this._y=k.y,this._z=k.z,this._w=p,this.normalize()}}(),setFromUnitVectors:function(){var B,e,R=1e-6;return function(b,i){return B===C&&(B=new ah),e=b.dot(i)+1,R>e?(e=0,Math.abs(b.x)>Math.abs(b.z)?B.set(-b.y,b.x,0):B.set(0,-b.z,b.y)):B.crossVectors(b,i),this._x=B.x,this._y=B.y,this._z=B.z,this._w=e,this.normalize()}}(),multiply:function(m){return this.multiplyQuaternions(this,m)},premultiply:function(E){return this.multiplyQuaternions(E,this)},multiplyQuaternions:function($,U){var F=$._x,d=$._y,K=$._z,k=$._w,p=U._x,u=U._y,_=U._z,h=U._w;return this._x=F*h+k*p+d*_-K*u,this._y=d*h+k*u+K*p-F*_,this._z=K*h+k*_+F*u-d*p,this._w=k*h-F*p-d*u-K*_,this}});var vb=k.Math.Vector4=function(e,K,l,h){this.x=e||0,this.y=K||0,this.z=l||0,this.w=h!==C?h:1};H.assign(vb.prototype,{isVector4:!0,set:function(W,$,h,o){return this.x=W,this.y=$,this.z=h,this.w=o,this},setScalar:function(E){return this.x=E,this.y=E,this.z=E,this.w=E,this},setX:function(z){return this.x=z,this},setY:function(T){return this.y=T,this},setZ:function(m){return this.z=m,this},setW:function(q){return this.w=q,this},setComponent:function(l,v){switch(l){case 0:this.x=v;break;case 1:this.y=v;break;case 2:this.z=v;break;case 3:this.w=v;break;default:throw new Error("index is out of range: "+l)}return this},getComponent:function(K){switch(K){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+K)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(j){return this.x=j.x,this.y=j.y,this.z=j.z,this.w=j.w!==C?j.w:1,this},add:function(g,L){return L!==C?this.addVectors(g,L):(this.x+=g.x,this.y+=g.y,this.z+=g.z,this.w+=g.w,this)},addScalar:function(O){return this.x+=O,this.y+=O,this.z+=O,this.w+=O,this},addVectors:function(S,L){return this.x=S.x+L.x,this.y=S.y+L.y,this.z=S.z+L.z,this.w=S.w+L.w,this},addScaledVector:function(b,t){return this.x+=b.x*t,this.y+=b.y*t,this.z+=b.z*t,this.w+=b.w*t,this},sub:function(t,X){return X!==C?this.subVectors(t,X):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(o){return this.x-=o,this.y-=o,this.z-=o,this.w-=o,this},subVectors:function(b,E){return this.x=b.x-E.x,this.y=b.y-E.y,this.z=b.z-E.z,this.w=b.w-E.w,this},multiplyScalar:function(V){return this.x*=V,this.y*=V,this.z*=V,this.w*=V,this},applyMatrix4:function(p){var S=this.x,C=this.y,G=this.z,Q=this.w,I=p.el;return this.x=I[0]*S+I[4]*C+I[8]*G+I[12]*Q,this.y=I[1]*S+I[5]*C+I[9]*G+I[13]*Q,this.z=I[2]*S+I[6]*C+I[10]*G+I[14]*Q,this.w=I[3]*S+I[7]*C+I[11]*G+I[15]*Q,this},divideScalar:function(o){return this.multiplyScalar(1/o)},setAxisAngleFromQuaternion:function(r){this.w=2*Math.acos(r.w);var k=Math.sqrt(1-r.w*r.w);return 1e-4>k?(this.x=1,this.y=0,this.z=0):(this.x=r.x/k,this.y=r.y/k,this.z=r.z/k),this},setAxisAngleFromRotationMatrix:function(e){var F,s,N,o,T=.01,G=.1,A=e.el,t=A[0],M=A[4],V=A[8],C=A[1],r=A[5],c=A[9],y=A[2],D=A[6],J=A[10];if(Math.abs(M-C)<T&&Math.abs(V-y)<T&&Math.abs(c-D)<T){if(Math.abs(M+C)<G&&Math.abs(V+y)<G&&Math.abs(c+D)<G&&Math.abs(t+r+J-3)<G)return this.set(1,0,0,0),this;F=Math.PI;var $=(t+1)/2,Q=(r+1)/2,L=(J+1)/2,I=(M+C)/4,j=(V+y)/4,S=(c+D)/4;return $>Q&&$>L?T>$?(s=0,N=.707106781,o=.707106781):(s=Math.sqrt($),N=I/s,o=j/s):Q>L?T>Q?(s=.707106781,N=0,o=.707106781):(N=Math.sqrt(Q),s=I/N,o=S/N):T>L?(s=.707106781,N=.707106781,o=0):(o=Math.sqrt(L),s=j/o,N=S/o),this.set(s,N,o,F),this}var Z=Math.sqrt((D-c)*(D-c)+(V-y)*(V-y)+(C-M)*(C-M));return Math.abs(Z)<.001&&(Z=1),this.x=(D-c)/Z,this.y=(V-y)/Z,this.z=(C-M)/Z,this.w=Math.acos((t+r+J-1)/2),this},min:function(b){return this.x=Math.min(this.x,b.x),this.y=Math.min(this.y,b.y),this.z=Math.min(this.z,b.z),this.w=Math.min(this.w,b.w),this},max:function($){return this.x=Math.max(this.x,$.x),this.y=Math.max(this.y,$.y),this.z=Math.max(this.z,$.z),this.w=Math.max(this.w,$.w),this},clamp:function(J,F){return this.x=Math.max(J.x,Math.min(F.x,this.x)),this.y=Math.max(J.y,Math.min(F.y,this.y)),this.z=Math.max(J.z,Math.min(F.z,this.z)),this.w=Math.max(J.w,Math.min(F.w,this.w)),this},clampScalar:function(){var b,K;return function(x,o){return b===C&&(b=new vb,K=new vb),b.set(x,x,x,x),K.set(o,o,o,o),this.clamp(b,K)}}(),clampLength:function(z,r){var h=this.length();return this.divideScalar(h||1).multiplyScalar(Math.max(z,Math.min(r,h)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function($){return this.x*$.x+this.y*$.y+this.z*$.z+this.w*$.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(b){return this.normalize().multiplyScalar(b)},lerp:function(Y,W){return this.x+=(Y.x-this.x)*W,this.y+=(Y.y-this.y)*W,this.z+=(Y.z-this.z)*W,this.w+=(Y.w-this.w)*W,this},lerpVectors:function(W,x,l){return this.subVectors(x,W).multiplyScalar(l).add(W)},equals:function(D){return D.x===this.x&&D.y===this.y&&D.z===this.z&&D.w===this.w},fromArray:function(D,Y){return Y===C&&(Y=0),this.x=D[Y],this.y=D[Y+1],this.z=D[Y+2],this.w=D[Y+3],this},toArray:function(e,P){return e===C&&(e=[]),P===C&&(P=0),e[P]=this.x,e[P+1]=this.y,e[P+2]=this.z,e[P+3]=this.w,e},fromBufferAttribute:function(V,S){return this.x=V.getX(S),this.y=V.getY(S),this.z=V.getZ(S),this.w=V.getW(S),this}});var ah=k.Math.Vector3=function(T,y,f){T===C?(this.x=0,this.y=0,this.z=0):"object"==typeof T?this.copy(T):this.set(T,y==C?T:y,f==C?T:f)};H.assign(ah.prototype,{set:function(p,J,h){return this.x=p,this.y=J,this.z=h,this},equals:function(q){return q&&this.x===q.x&&this.y===q.y&&this.z===q.z},setScalar:function(y){return this.x=y,this.y=y,this.z=y,this},setX:function(Q){return this.x=Q,this},setY:function(z){return this.y=z,this},setZ:function(M){return this.z=M,this},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(J){return J.x===C?(this.x=J[0],this.y=J[1],this.z=J[2]):(this.x=J.x,this.y=J.y,this.z=J.z),this},add:function(f){return this.x+=f.x,this.y+=f.y,this.z+=f.z,this},addScalar:function(j){return this.x+=j,this.y+=j,this.z+=j,this},addVectors:function(n,v){return this.x=n.x+v.x,this.y=n.y+v.y,this.z=n.z+v.z,this},addScaledVector:function(W,G){return this.x+=W.x*G,this.y+=W.y*G,this.z+=W.z*G,this},sub:function(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this},subScalar:function(O){return this.x-=O,this.y-=O,this.z-=O,this},subVectors:function(P,i){return this.x=P.x-i.x,this.y=P.y-i.y,this.z=P.z-i.z,this},multiply:function(K){return this.x*=K.x,this.y*=K.y,this.z*=K.z,this},multiplyScalar:function(f){return this.x*=f,this.y*=f,this.z*=f,this},distanceTo:function(C){return Math.sqrt(this.distanceToSquared(C))},distanceToSquared:function(U){var T=this.x-U.x,v=this.y-U.y,e=this.z-U.z;return T*T+v*v+e*e},distanceToSquared2:function(s){var v=this.x-s[0],Z=this.y-s[1],m=this.z-s[2];return v*v+Z*Z+m*m},multiplyVectors:function(e,z){return this.x=e.x*z.x,this.y=e.y*z.y,this.z=e.z*z.z,this},transformDirection:function(k){var Q=this.x,d=this.y,T=this.z,U=k.el;return this.x=U[0]*Q+U[4]*d+U[8]*T,this.y=U[1]*Q+U[5]*d+U[9]*T,this.z=U[2]*Q+U[6]*d+U[10]*T,this.normalize()},applyEuler:function(){var W=new bn;return function(l){return this.applyQuaternion(W.setFromEuler(l))}}(),applyQuaternion:function(o){var m=this.x,U=this.y,j=this.z,C=o._x,u=o._y,Z=o._z,B=o._w,q=B*m+u*j-Z*U,H=B*U+Z*m-C*j,h=B*j+C*U-u*m,n=-C*m-u*U-Z*j;return this.x=q*B+n*-C+H*-Z-h*-u,this.y=H*B+n*-u+h*-C-q*-Z,this.z=h*B+n*-Z+q*-u-H*-C,this},applyMatrix4:function(w){var i=this.x,f=this.y,Z=this.z,K=w.el,c=1/(K[3]*i+K[7]*f+K[11]*Z+K[15]);return this.x=(K[0]*i+K[4]*f+K[8]*Z+K[12])*c,this.y=(K[1]*i+K[5]*f+K[9]*Z+K[13])*c,this.z=(K[2]*i+K[6]*f+K[10]*Z+K[14])*c,this},applyMatrix3:function(G){var w=this.x,n=this.y,T=this.z,E=G.el;return this.x=E[0]*w+E[3]*n+E[6]*T,this.y=E[1]*w+E[4]*n+E[7]*T,this.z=E[2]*w+E[5]*n+E[8]*T,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},reflect:function(){var i=new ah;return function(a){return this.sub(i.copy(a).multiplyScalar(2*this.dot(a)))}}(),dot:function(x){return this.x*x.x+this.y*x.y+this.z*x.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){var Z=this.length();return Z?this.multiplyScalar(1/Z):this},setLength:function(M){return this.normalize().multiplyScalar(M)},fromArray:function(n,L){return L===C&&(L=0),this.x=n[L],this.y=n[L+1],this.z=n[L+2],this},toArray:function(y,w){return y===C&&(y=[0,0,0]),w===C&&(w=0),y[w]=this.x,y[w+1]=this.y,y[w+2]=this.z,y},cross:function(b){return this.crossVectors(this,b)},angleTo:function(D){var u=this.dot(D)/Math.sqrt(this.lengthSq()*D.lengthSq());return u>1||-1>u?0:Math.acos(u)},lerpVectors:function(h,k,N){return this.subVectors(k,h).multiplyScalar(N).add(h)},crossVectors:function(h,F){var L=h.x,q=h.y,X=h.z,P=F.x,g=F.y,S=F.z;return this.x=q*S-X*g,this.y=X*P-L*S,this.z=L*g-q*P,this},min:function(M){return this.x=Math.min(this.x,M.x),this.y=Math.min(this.y,M.y),this.z=Math.min(this.z,M.z),this},max:function(p){return this.x=Math.max(this.x,p.x),this.y=Math.max(this.y,p.y),this.z=Math.max(this.z,p.z),this},setFromMatrixPosition:function(e){return this.setFromMatrixColumn(e,3)},setFromMatrixScale:function(l){var b=this.setFromMatrixColumn(l,0).length(),n=this.setFromMatrixColumn(l,1).length(),I=this.setFromMatrixColumn(l,2).length();return this.x=b,this.y=n,this.z=I,this},setFromMatrixColumn:function(v,B){return this.fromArray(v.el,4*B)}});var nj=k.Math.Vector2=function(F,S,L){"object"==typeof F&&(F.x!=C?(S=F.y,F=F.x,L=F.e):(L=F[2],S=F[1],F=F[0])),this.set(F||0,S||0,L)};nj.prototype={},nj.prototype.constructor=nj,H.defineProperties(nj.prototype,{width:{get:function(){return this.x},set:function(f){this.x=f}},height:{get:function(){return this.y},set:function(T){this.y=T}}}),nj.prototype.clone=function(){return new nj(this.x,this.y,this.e)},nj.prototype.copy=function(b){return this.set(b.x,b.y,b.e),this},nj.prototype.equals=function(f){return f.x===this.x&&f.y===this.y},nj.prototype.set=function(c,e,k){return this.x=c||0,this.y=e||(0!==e?this.x:0),k!=C&&(this.e=k),this},nj.prototype.setScalar=function(X){return this.x=X,this.y=X,this},nj.prototype.setX=function(e){return this.x=e||0,this},nj.prototype.setY=function(i){return this.y=i||0,this},nj.prototype.add=function(H){return this.x+=H.x,this.y+=H.y,this},nj.prototype.addVectors=function(W,R){return this.x=W.x+R.x,this.y=W.y+R.y,this},nj.prototype.addScalar=function(O){return this.x+=O,this.y+=O,this},nj.prototype.addScaledVector=function(d,X){return this.x+=d.x*X,this.y+=d.y*X,this},nj.prototype.sub=function(B){return this.x-=B.x,this.y-=B.y,this},nj.prototype.subScalar=function(c){return this.x-=c,this.y-=c,this},nj.prototype.subVectors=function(z,K){return this.x=z.x-K.x,this.y=z.y-K.y,this},nj.prototype.multiply=function(i){return this.x*=i.x,this.y*=i.y,this},nj.prototype.multiplyScalar=function(h){return this.x*=h,this.y*=h,this},nj.prototype.divide=function(C){return this.x/=C.x,this.y/=C.y,this},nj.prototype.divideScalar=function(Q){return this.multiplyScalar(1/Q)},nj.prototype.min=function(P){return this.x=Math.min(this.x,P.x),this.y=Math.min(this.y,P.y),this},nj.prototype.max=function(I){return this.x=Math.max(this.x,I.x),this.y=Math.max(this.y,I.y),this},nj.prototype.fromArray=function(N,D){return D===C&&(D=0),this.x=N[D],this.y=N[D+1],this},nj.prototype.clamp=function(I,g){return this.x=Math.max(I.x,Math.min(g.x,this.x)),this.y=Math.max(I.y,Math.min(g.y,this.y)),this},nj.prototype.clampScalar=function(){var u,Y;return function(W,D){return u===C&&(u=new nj,Y=new nj),u.set(W,W),Y.set(D,D),this.clamp(u,Y)}}(),nj.prototype.clampLength=function(G,P){var b=this.length();return this.multiplyScalar(Math.max(G,Math.min(P,b))/b)},nj.prototype.dot=function(D){return this.x*D.x+this.y*D.y},nj.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},nj.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},nj.prototype.normalize=function(){return this.divideScalar(this.length())},nj.prototype.angle=function(){var A=Math.atan2(this.y,this.x);return 0>A&&(A+=2*Math.PI),A},nj.prototype.distanceTo=function(J){return Math.sqrt(this.distanceToSquared(J))},nj.prototype.distanceToSquared=function(x){var f=this.x-x.x,R=this.y-x.y;return f*f+R*R},nj.prototype.isNearEnough=function(J){return this.distanceToSquared(J)<1e-8},nj.prototype.setLength=function(l){var c=this.length();return c?this.multiplyScalar(l/c):this},nj.prototype.lerp=function(I,F){return this.x+=(I.x-this.x)*F,this.y+=(I.y-this.y)*F,this},nj.prototype.lerpVectors=function(q,S,Z){return this.subVectors(S,q).multiplyScalar(Z).add(q)},nj.prototype.rotateAround=function(v,N){var P=v?v.x:0,s=v?v.y:0,L=Math.cos(N),f=Math.sin(N),w=this.x-P,B=this.y-s;return this.x=w*L-B*f+P,this.y=w*f+B*L+s,this},H.assign(_.prototype,{isMatrix3:!0,set:function(S,v,h,V,y,g,E,$,n){var x=this.el;return x[0]=S,x[1]=V,x[2]=E,x[3]=v,x[4]=y,x[5]=$,x[6]=h,x[7]=g,x[8]=n,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.el)},copy:function(j){var R=this.el,r=j.el;return R[0]=r[0],R[1]=r[1],R[2]=r[2],R[3]=r[3],R[4]=r[4],R[5]=r[5],R[6]=r[6],R[7]=r[7],R[8]=r[8],this},setFromMatrix4:function(f){var x=f.el;return this.set(x[0],x[4],x[8],x[1],x[5],x[9],x[2],x[6],x[10]),this},applyToBufferAttribute:function(){var J=new ah;return function(b){for(var r=0,z=b.count;z>r;r++)J.x=b.getX(r),J.y=b.getY(r),J.z=b.getZ(r),J.applyMatrix3(this),b.setXYZ(r,J.x,J.y,J.z);return b}}(),multiply:function(I){return this.multiplyMatrices(this,I)},premultiply:function(A){return this.multiplyMatrices(A,this)},multiplyMatrices:function(b,l){var U=b.el,G=l.el,Y=this.el,r=U[0],E=U[3],F=U[6],V=U[1],N=U[4],s=U[7],$=U[2],g=U[5],K=U[8],R=G[0],h=G[3],y=G[6],H=G[1],C=G[4],k=G[7],d=G[2],_=G[5],J=G[8];return Y[0]=r*R+E*H+F*d,Y[3]=r*h+E*C+F*_,Y[6]=r*y+E*k+F*J,Y[1]=V*R+N*H+s*d,Y[4]=V*h+N*C+s*_,Y[7]=V*y+N*k+s*J,Y[2]=$*R+g*H+K*d,Y[5]=$*h+g*C+K*_,Y[8]=$*y+g*k+K*J,this},multiplyScalar:function(C){var A=this.el;return A[0]*=C,A[3]*=C,A[6]*=C,A[1]*=C,A[4]*=C,A[7]*=C,A[2]*=C,A[5]*=C,A[8]*=C,this},determinant:function(){var W=this.el,x=W[0],u=W[1],G=W[2],R=W[3],O=W[4],Z=W[5],Y=W[6],F=W[7],q=W[8];return x*O*q-x*Z*F-u*R*q+u*Z*Y+G*R*F-G*O*Y},getInverse:function(V){var h=V.el,Z=this.el,C=h[0],U=h[1],e=h[2],E=h[3],z=h[4],I=h[5],t=h[6],d=h[7],n=h[8],H=n*z-I*d,Q=I*t-n*E,S=d*E-z*t,f=C*H+U*Q+e*S;if(0===f)return this.identity();var R=1/f;return Z[0]=H*R,Z[1]=(e*d-n*U)*R,Z[2]=(I*U-e*z)*R,Z[3]=Q*R,Z[4]=(n*C-e*t)*R,Z[5]=(e*E-I*C)*R,Z[6]=S*R,Z[7]=(U*t-d*C)*R,Z[8]=(z*C-U*E)*R,this},transpose:function(){var Q,Y=this.el;return Q=Y[1],Y[1]=Y[3],Y[3]=Q,Q=Y[2],Y[2]=Y[6],Y[6]=Q,Q=Y[5],Y[5]=Y[7],Y[7]=Q,this},getNormalMatrix:function($){return this.setFromMatrix4($).getInverse(this).transpose()},transposeIntoArray:function(A){var I=this.el;return A[0]=I[0],A[1]=I[3],A[2]=I[6],A[3]=I[1],A[4]=I[4],A[5]=I[7],A[6]=I[2],A[7]=I[5],A[8]=I[8],this},setUvTransform:function(q,k,M,C,$,V,G){var S=Math.cos($),B=Math.sin($);this.set(M*S,M*B,-M*(S*V+B*G)+V+q,-C*B,C*S,-C*(-B*V+S*G)+G+k,0,0,1)},scale:function(v,A){var t=this.el;return t[0]*=v,t[3]*=v,t[6]*=v,t[1]*=A,t[4]*=A,t[7]*=A,this},rotate:function(g){var O=Math.cos(g),l=Math.sin(g),$=this.el,I=$[0],m=$[3],T=$[6],E=$[1],r=$[4],x=$[7];return $[0]=O*I+l*E,$[3]=O*m+l*r,$[6]=O*T+l*x,$[1]=-l*I+O*E,$[4]=-l*m+O*r,$[7]=-l*T+O*x,this},translate:function(D,u){var k=this.el;return k[0]+=D*k[2],k[3]+=D*k[5],k[6]+=D*k[8],k[1]+=u*k[2],k[4]+=u*k[5],k[7]+=u*k[8],this},equals:function(w){for(var v=this.el,D=w.el,I=0;9>I;I++)if(v[I]!==D[I])return!1;return!0},fromArray:function(e,L){L===C&&(L=0);for(var x=0;9>x;x++)this.el[x]=e[x+L];return this},toArray:function(s,E){s===C&&(s=[]),E===C&&(E=0);var n=this.el;return s[E]=n[0],s[E+1]=n[1],s[E+2]=n[2],s[E+3]=n[3],s[E+4]=n[4],s[E+5]=n[5],s[E+6]=n[6],s[E+7]=n[7],s[E+8]=n[8],s}});var nn=k.Math.Plane=function(T,e){this.normal=T!==C?T:new ah(1,0,0),this.constant=e!==C?e:0};H.assign(nn.prototype,{set:function(S,o){return this.normal.copy(S),this.constant=o,this},setComponents:function(B,g,N,I){return this.normal.set(B,g,N),this.constant=I,this},setFromNormalAndCoplanarPoint:function(W,k){return this.normal.copy(W),this.constant=-k.dot(this.normal),this},setFromCoplanarPoints:function(){var O=new ah,D=new ah;return function(P,C,K){var p=O.subVectors(K,C).cross(D.subVectors(P,C)).normalize();return this.setFromNormalAndCoplanarPoint(p,P),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(N){return this.normal.copy(N.normal),this.constant=N.constant,this},normalize:function(){var h=1/this.normal.length();return this.normal.multiplyScalar(h),this.constant*=h,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(z,R){return R===C&&(R=new ah),R.copy(this.normal).multiplyScalar(-this.distanceToPoint(z)).add(z)},intersectLine:function(){var Y=new ah;return function(h,q){q===C&&(q=new ah);var A=h.delta(Y),m=this.normal.dot(A);if(0===m)return 0===this.distanceToPoint(h.start)?q.copy(h.start):C;var G=-(h.start.dot(this.normal)+this.constant)/m;return 0>G||G>1?C:q.copy(A).multiplyScalar(G).add(h.start)}}(),intersectsLine:function(S){var P=this.distanceToPoint(S.start),i=this.distanceToPoint(S.end);return 0>P&&i>0||0>i&&P>0},intersectsBox:function(K){return K.intersectsPlane(this)},intersectsSphere:function(P){return P.intersectsPlane(this)},coplanarPoint:function(a){return a===C&&(a=new ah),a.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var q=new ah,F=new _;return function(X,E){var j=E||F.getNormalMatrix(X),H=this.coplanarPoint(q).applyMatrix4(X),u=this.normal.applyMatrix3(j).normalize();return this.constant=-H.dot(u),this}}(),translate:function(b){return this.constant-=b.dot(this.normal),this},equals:function(O){return O.normal.equals(this.normal)&&O.constant===this.constant}});var ij=k.Math.Ray=function(E,M){this.origin=E!==C?E.clone():new ah,this.direction=M!==C?M.clone():new ah};H.assign(ij.prototype,{set:function(R,I){return this.origin.copy(R),this.direction.copy(I),this},clone:function(){return(new this.constructor).copy(this)},copy:function(c){return this.origin.copy(c.origin),this.direction.copy(c.direction),this.maxHitLen=c.maxHitLen,this},at:function(m,H){var t=H||new ah;return t.copy(this.direction).multiplyScalar(m).add(this.origin)},setMaxHitLength:function(M){this.maxHitLen=M},lookAt:function(C){return this.direction.copy(C).sub(this.origin).normalize(),this},applyMatrix4:function(U){var Y=this.maxHitLen;if(Y){var b=this.direction.clone().multiplyScalar(Y).add(this.origin);b.applyMatrix4(U)}return this.origin.applyMatrix4(U),this.direction.transformDirection(U),Y&&(this.maxHitLen=this.origin.distanceTo(b)),this},intersectBox:function(e,J){var $,M,d,h,k,Z,j=1/this.direction.x,i=1/this.direction.y,c=1/this.direction.z,Y=this.origin;if(j>=0?($=(e.min.x-Y.x)*j,M=(e.max.x-Y.x)*j):($=(e.max.x-Y.x)*j,M=(e.min.x-Y.x)*j),i>=0?(d=(e.min.y-Y.y)*i,h=(e.max.y-Y.y)*i):(d=(e.max.y-Y.y)*i,h=(e.min.y-Y.y)*i),$>h||d>M)return null;if((d>$||$!==$)&&($=d),(M>h||M!==M)&&(M=h),c>=0?(k=(e.min.z-Y.z)*c,Z=(e.max.z-Y.z)*c):(k=(e.max.z-Y.z)*c,Z=(e.min.z-Y.z)*c),$>Z||k>M)return null;if((k>$||$!==$)&&($=k),(M>Z||M!==M)&&(M=Z),0>M)return null;var r=$>=0?$:M,g=this.maxHitLen;return g&&r>g?null:this.at(r,J)},intersectTriangle:function(){var M=new ah,D=new ah,v=new ah,_=new ah;return function(C,a,Y,j,A){D.subVectors(a,C),v.subVectors(Y,C),_.crossVectors(D,v);var c,h=this.direction.dot(_);if(h>0){if(j)return null;c=1}else{if(!(0>h))return null;c=-1,h=-h}M.subVectors(this.origin,C);var V=c*this.direction.dot(v.crossVectors(M,v));if(0>V)return null;var I=c*this.direction.dot(D.cross(M));if(0>I||V+I>h)return null;var r=-c*M.dot(_);if(0>r)return null;var N=r/h,w=this.maxHitLen;return w&&N>w?null:this.at(N,A)}}()});var Fd=k.Math.Box3=function(r,l){this.min=r!==C?r:new ah(1/0,1/0,1/0),this.max=l!==C?l:new ah(-1/0,-1/0,-1/0)};H.assign(Fd.prototype,{set:function(O,j){return this.min.copy(O),this.max.copy(j),this},setFromArray:function(Q){for(var m=1/0,A=1/0,k=1/0,W=-1/0,e=-1/0,T=-1/0,i=0,G=Q.length;G>i;i+=3){var B=Q[i],E=Q[i+1],X=Q[i+2];m>B&&(m=B),A>E&&(A=E),k>X&&(k=X),B>W&&(W=B),E>e&&(e=E),X>T&&(T=X)}return this.min.set(m,A,k),this.max.set(W,e,T),this},setFromPoints:function(L){this.makeEmpty();for(var m=0,i=L.length;i>m;m++)this.expandByPoint(L[m]);return this},clone:function(){return(new this.constructor).copy(this)},intersectsBox:function(P){return P.max.x<this.min.x||P.min.x>this.max.x||P.max.y<this.min.y||P.min.y>this.max.y||P.max.z<this.min.z||P.min.z>this.max.z?!1:!0},copy:function(I){return this.min.copy(I.min),this.max.copy(I.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},expandByPoint:function(R){return this.min.min(R),this.max.max(R),this}});var Bd=k.Math.Sphere=function(c,E){this.center=c!==C?c:new ah,this.radius=E!==C?E:0};H.assign(Bd.prototype,{set:function(q,o){return this.center.copy(q),this.radius=o,this},setFromPoints:function(){var L=new Fd;return function(y,k){var A=this.center;k!==C?A.copy(k):L.setFromPoints(y).getCenter(A);for(var N=0,M=0,e=y.length;e>M;M++)N=Math.max(N,A.distanceToSquared(y[M]));return this.radius=Math.sqrt(N),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(D){return this.center.copy(D.center),this.radius=D.radius,this},empty:function(){return this.radius<=0},containsPoint:function(B){return B.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(O){return O.distanceTo(this.center)-this.radius},intersectsSphere:function(D){var b=this.radius+D.radius;return D.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(T){return Math.abs(T.distanceToPoint(this.center))<=this.radius},clampPoint:function(y,p){var $=this.center.distanceToSquared(y);return p===C&&(p=new ah),p.copy(y),$>this.radius*this.radius&&(p.sub(this.center).normalize(),p.multiplyScalar(this.radius).add(this.center)),p},getBoundingBox:function($){return $===C&&($=new Fd),$.set(this.center,this.center),$.expandByScalar(this.radius),$},applyMatrix4:function(R){return this.center.applyMatrix4(R),this.radius=this.radius*R.getMaxScaleOnAxis(),this},translate:function(W){return this.center.add(W),this},equals:function(P){return P.center.equals(this.center)&&P.radius===this.radius}});var Of=k.Math.Frustum=function(x,P,G,t,g,T){this.planes=[x!==C?x:new nn,P!==C?P:new nn,G!==C?G:new nn,t!==C?t:new nn,g!==C?g:new nn,T!==C?T:new nn]};H.assign(Of.prototype,{set:function(c,U,Z,H,v,J){var m=this.planes;return m[0].copy(c),m[1].copy(U),m[2].copy(Z),m[3].copy(H),m[4].copy(v),m[5].copy(J),this},clone:function(){return(new this.constructor).copy(this)},copy:function(A){for(var q=this.planes,j=0;6>j;j++)q[j].copy(A.planes[j]);return this},setFromMatrix:function(V){var Y=this.planes,n=V.el,l=n[0],R=n[1],o=n[2],W=n[3],v=n[4],B=n[5],M=n[6],c=n[7],a=n[8],T=n[9],E=n[10],X=n[11],e=n[12],J=n[13],i=n[14],$=n[15];return Y[0].setComponents(W-l,c-v,X-a,$-e).normalize(),Y[1].setComponents(W+l,c+v,X+a,$+e).normalize(),Y[2].setComponents(W+R,c+B,X+T,$+J).normalize(),Y[3].setComponents(W-R,c-B,X-T,$-J).normalize(),Y[4].setComponents(W-o,c-M,X-E,$-i).normalize(),Y[5].setComponents(W+o,c+M,X+E,$+i).normalize(),this},intersectsObject:function(){var B=new Bd;return function(T){var M=T.geometry;return null===M.boundingSphere&&M.computeBoundingSphere(),B.copy(M.boundingSphere).applyMatrix4(T.matrixWorld),this.intersectsSphere(B)}}(),intersectsSprite:function(){var k=new Bd;return function(b){return k.center.set(0,0,0),k.radius=.7071067811865476,k.applyMatrix4(b.matrixWorld),this.intersectsSphere(k)}}(),intersectsSphere:function(D){for(var u=this.planes,J=D.center,q=-D.radius,R=0;6>R;R++){var k=u[R].distanceToPoint(J);if(q>k)return!1}return!0},intersectsBox:function(){var T=new ah;return function(s){for(var Q=this.planes,I=0;6>I;I++){var A=Q[I];if(T.x=A.normal.x>0?s.max.x:s.min.x,T.y=A.normal.y>0?s.max.y:s.min.y,T.z=A.normal.z>0?s.max.z:s.min.z,A.distanceToPoint(T)<0)return!1}return!0}}(),containsPoint:function(f){for(var _=this.planes,s=0;6>s;s++)if(_[s].distanceToPoint(f)<0)return!1;return!0}});var Dg=k.Math.Matrix4=function(){this.el=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};H.assign(Dg.prototype,{set:function($,d,u,I,g,s,T,m,F,k,Z,l,K,Q,L,A){var e=this.el;return e[0]=$,e[4]=d,e[8]=u,e[12]=I,e[1]=g,e[5]=s,e[9]=T,e[13]=m,e[2]=F,e[6]=k,e[10]=Z,e[14]=l,e[3]=K,e[7]=Q,e[11]=L,e[15]=A,this},clone:function(){return(new Dg).fromArray(this.el)},fromArray:function(P,Q){Q===C&&(Q=0);for(var t=this.el,c=0;16>c;c++)t[c]=P[c+Q];return this},scale:function(v){var N=this.el,x=v.x,W=v.y,I=v.z;return N[0]*=x,N[4]*=W,N[8]*=I,N[1]*=x,N[5]*=W,N[9]*=I,N[2]*=x,N[6]*=W,N[10]*=I,N[3]*=x,N[7]*=W,N[11]*=I,this},makeRotationFromEuler:function(h){var n=this.el,l=h._x,f=h._y,w=h._z,_=h._order,j=Math.cos(l),Z=Math.sin(l),a=Math.cos(f),q=Math.sin(f),v=Math.cos(w),X=Math.sin(w);if("XYZ"===_){var r=j*v,R=j*X,J=Z*v,E=Z*X;n[0]=a*v,n[4]=-a*X,n[8]=q,n[1]=R+J*q,n[5]=r-E*q,n[9]=-Z*a,n[2]=E-r*q,n[6]=J+R*q,n[10]=j*a}else if("YXZ"===_){var b=a*v,o=a*X,V=q*v,y=q*X;n[0]=b+y*Z,n[4]=V*Z-o,n[8]=j*q,n[1]=j*X,n[5]=j*v,n[9]=-Z,n[2]=o*Z-V,n[6]=y+b*Z,n[10]=j*a}else if("ZXY"===_){var b=a*v,o=a*X,V=q*v,y=q*X;n[0]=b-y*Z,n[4]=-j*X,n[8]=V+o*Z,n[1]=o+V*Z,n[5]=j*v,n[9]=y-b*Z,n[2]=-j*q,n[6]=Z,n[10]=j*a}else if("ZYX"===_){var r=j*v,R=j*X,J=Z*v,E=Z*X;n[0]=a*v,n[4]=J*q-R,n[8]=r*q+E,n[1]=a*X,n[5]=E*q+r,n[9]=R*q-J,n[2]=-q,n[6]=Z*a,n[10]=j*a}else if("YZX"===_){var W=j*a,k=j*q,z=Z*a,e=Z*q;n[0]=a*v,n[4]=e-W*X,n[8]=z*X+k,n[1]=X,n[5]=j*v,n[9]=-Z*v,n[2]=-q*v,n[6]=k*X+z,n[10]=W-e*X}else if("XZY"===_){var W=j*a,k=j*q,z=Z*a,e=Z*q;n[0]=a*v,n[4]=-X,n[8]=q*v,n[1]=W*X+e,n[5]=j*v,n[9]=k*X-z,n[2]=z*X-k,n[6]=Z*v,n[10]=e*X+W}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this},makeRotationFromQuaternion:function(C){var T=this.el,_=C._x,E=C._y,n=C._z,I=C._w,h=_+_,P=E+E,w=n+n,O=_*h,F=_*P,i=_*w,r=E*P,G=E*w,q=n*w,u=I*h,g=I*P,K=I*w;return T[0]=1-(r+q),T[4]=F-K,T[8]=i+g,T[1]=F+K,T[5]=1-(O+q),T[9]=G-u,T[2]=i-g,T[6]=G+u,T[10]=1-(O+r),T[3]=0,T[7]=0,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},getInverse:function(E){var b=this.el,A=E.el,r=A[0],I=A[1],o=A[2],g=A[3],d=A[4],Z=A[5],q=A[6],l=A[7],f=A[8],T=A[9],U=A[10],t=A[11],V=A[12],S=A[13],R=A[14],X=A[15],a=T*R*l-S*U*l+S*q*t-Z*R*t-T*q*X+Z*U*X,L=V*U*l-f*R*l-V*q*t+d*R*t+f*q*X-d*U*X,H=f*S*l-V*T*l+V*Z*t-d*S*t-f*Z*X+d*T*X,u=V*T*q-f*S*q-V*Z*U+d*S*U+f*Z*R-d*T*R,J=r*a+I*L+o*H+g*u;if(0===J)return this.identity();var s=1/J;return b[0]=a*s,b[1]=(S*U*g-T*R*g-S*o*t+I*R*t+T*o*X-I*U*X)*s,b[2]=(Z*R*g-S*q*g+S*o*l-I*R*l-Z*o*X+I*q*X)*s,b[3]=(T*q*g-Z*U*g-T*o*l+I*U*l+Z*o*t-I*q*t)*s,b[4]=L*s,b[5]=(f*R*g-V*U*g+V*o*t-r*R*t-f*o*X+r*U*X)*s,b[6]=(V*q*g-d*R*g-V*o*l+r*R*l+d*o*X-r*q*X)*s,b[7]=(d*U*g-f*q*g+f*o*l-r*U*l-d*o*t+r*q*t)*s,b[8]=H*s,b[9]=(V*T*g-f*S*g-V*I*t+r*S*t+f*I*X-r*T*X)*s,b[10]=(d*S*g-V*Z*g+V*I*l-r*S*l-d*I*X+r*Z*X)*s,b[11]=(f*Z*g-d*T*g-f*I*l+r*T*l+d*I*t-r*Z*t)*s,b[12]=u*s,b[13]=(f*S*o-V*T*o+V*I*U-r*S*U-f*I*R+r*T*R)*s,b[14]=(V*Z*o-d*S*o-V*I*q+r*S*q+d*I*R-r*Z*R)*s,b[15]=(d*T*o-f*Z*o+f*I*q-r*T*q-d*I*U+r*Z*U)*s,this},makeRotationAxis:function(Y,l){var R=Math.cos(l),I=Math.sin(l),r=1-R,x=Y.x,v=Y.y,y=Y.z,j=r*x,S=r*v;return this.set(j*x+R,j*v-I*y,j*y+I*v,0,j*v+I*y,S*v+R,S*y-I*x,0,j*y-I*v,S*y+I*x,r*y*y+R,0,0,0,0,1),this},multiply:function(N){return this.multiplyMatrices(this,N)},premultiply:function(y){return this.multiplyMatrices(y,this)},multiplyMatrices:function(b,o){var z=b.el,n=o.el,X=this.el,m=z[0],c=z[4],q=z[8],s=z[12],F=z[1],C=z[5],R=z[9],K=z[13],x=z[2],y=z[6],v=z[10],_=z[14],M=z[3],d=z[7],N=z[11],B=z[15],e=n[0],H=n[4],Z=n[8],P=n[12],S=n[1],D=n[5],U=n[9],E=n[13],I=n[2],f=n[6],J=n[10],O=n[14],i=n[3],p=n[7],k=n[11],W=n[15];return X[0]=m*e+c*S+q*I+s*i,X[4]=m*H+c*D+q*f+s*p,X[8]=m*Z+c*U+q*J+s*k,X[12]=m*P+c*E+q*O+s*W,X[1]=F*e+C*S+R*I+K*i,X[5]=F*H+C*D+R*f+K*p,X[9]=F*Z+C*U+R*J+K*k,X[13]=F*P+C*E+R*O+K*W,X[2]=x*e+y*S+v*I+_*i,X[6]=x*H+y*D+v*f+_*p,X[10]=x*Z+y*U+v*J+_*k,X[14]=x*P+y*E+v*O+_*W,X[3]=M*e+d*S+N*I+B*i,X[7]=M*H+d*D+N*f+B*p,X[11]=M*Z+d*U+N*J+B*k,X[15]=M*P+d*E+N*O+B*W,this},lookAt:function(){var H=new ah,p=new ah,q=new ah;return function(N,Z,B){var h=this.el;return q.subVectors(N,Z),0===q.lengthSq()&&(q.z=1),q.normalize(),H.crossVectors(B,q),0===H.lengthSq()&&(1===Math.abs(B.z)?q.x+=1e-4:q.z+=1e-4,q.normalize(),H.crossVectors(B,q)),H.normalize(),p.crossVectors(q,H),h[0]=H.x,h[4]=p.x,h[8]=q.x,h[1]=H.y,h[5]=p.y,h[9]=q.y,h[2]=H.z,h[6]=p.z,h[10]=q.z,this}}(),extractScale:function(){var $;return function(t){$===C&&($=new ah),t===C&&(t=new ah);var _=$.setFromMatrixColumn(this,0).length(),v=$.setFromMatrixColumn(this,1).length(),h=$.setFromMatrixColumn(this,2).length();return t.set(_,v,h),t}}(),extractRotation:function(){var H;return function(V){H===C&&(H=new ah),V===C&&(V=new Dg);var S=this.el,P=V.el,E=1/H.setFromMatrixColumn(V,0).length(),t=1/H.setFromMatrixColumn(V,1).length(),u=1/H.setFromMatrixColumn(V,2).length();return S[0]=P[0]*E,S[1]=P[1]*E,S[2]=P[2]*E,S[4]=P[4]*t,S[5]=P[5]*t,S[6]=P[6]*t,S[8]=P[8]*u,S[9]=P[9]*u,S[10]=P[10]*u,this}}(),multiplyScalar:function(l){var Z=this.el;return Z[0]*=l,Z[4]*=l,Z[8]*=l,Z[12]*=l,Z[1]*=l,Z[5]*=l,Z[9]*=l,Z[13]*=l,Z[2]*=l,Z[6]*=l,Z[10]*=l,Z[14]*=l,Z[3]*=l,Z[7]*=l,Z[11]*=l,Z[15]*=l,this},getPosition:function(R){return R===C&&(R=new ah),R.setFromMatrixColumn(this,3)
},setPosition:function(M){var b=this.el;return b[12]=M.x,b[13]=M.y,b[14]=M.z,this},toArray:function($,S){$===C&&($=[]),S===C&&(S=0);var R=this.el;return $[S]=R[0],$[S+1]=R[1],$[S+2]=R[2],$[S+3]=R[3],$[S+4]=R[4],$[S+5]=R[5],$[S+6]=R[6],$[S+7]=R[7],$[S+8]=R[8],$[S+9]=R[9],$[S+10]=R[10],$[S+11]=R[11],$[S+12]=R[12],$[S+13]=R[13],$[S+14]=R[14],$[S+15]=R[15],$}});var tm=k.Math.Triangle=function(w,p,v){this.a=w!==C?w:new ah,this.b=p!==C?p:new ah,this.c=v!==C?v:new ah};H.assign(tm,{barycoordFromPoint:function(){var q=new ah,C=new ah,t=new ah;return function(D,K,_,V,F){q.subVectors(V,K),C.subVectors(_,K),t.subVectors(D,K);var z=q.dot(q),u=q.dot(C),i=q.dot(t),Z=C.dot(C),S=C.dot(t),l=z*Z-u*u,y=F||new ah;if(0===l)return y.set(-2,-1,-1);var Y=1/l,g=(Z*i-u*S)*Y,H=(z*S-u*i)*Y;return y.set(1-g-H,H,g)}}()});var Tc=k.Math.Euler=function(P,g,Q,y,l){this.set(P,g,Q,y,l)};Tc.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Tc.DefaultOrder="XYZ",Tc.ReverseOrder=function(d){return d=d[2]+d[1]+d[0],d.toUpperCase()},H.defineProperties(Tc.prototype,{x:{get:function(){return this._x},set:function(f){this._x=f,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(E){this._y=E,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(H){this._z=H,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(q){this._order=q,this.onChangeCallback()}}}),H.assign(Tc.prototype,{set:function(o,Y,Z,i,j){return lk(o)&&(j=Z,i=Y,Z=o[2],Y=o[1],o=o[0]),i?j&&(i=Tc.ReverseOrder(i)):i="ZYX",this._x=o||0,this._y=Y||0,this._z=Z||0,this._order=i||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(R){return this._x=R._x,this._y=R._y,this._z=R._z,this._order=R._order,this.onChangeCallback(),this},setFromRotationMatrix:function(Q,F,t){var Y=k.Math.clamp,d=Q.el||Q,p=d[0],n=d[4],e=d[8],L=d[1],A=d[5],$=d[9],N=d[2],U=d[6],w=d[10];return F=F||this._order,"XYZ"===F?(this._y=Math.asin(Y(e,-1,1)),Math.abs(e)<.99999?(this._x=Math.atan2(-$,w),this._z=Math.atan2(-n,p)):(this._x=Math.atan2(U,A),this._z=0)):"YXZ"===F?(this._x=Math.asin(-Y($,-1,1)),Math.abs($)<.99999?(this._y=Math.atan2(e,w),this._z=Math.atan2(L,A)):(this._y=Math.atan2(-N,p),this._z=0)):"ZXY"===F?(this._x=Math.asin(Y(U,-1,1)),Math.abs(U)<.99999?(this._y=Math.atan2(-N,w),this._z=Math.atan2(-n,A)):(this._y=0,this._z=Math.atan2(L,p))):"ZYX"===F?(this._y=Math.asin(-Y(N,-1,1)),Math.abs(N)<.99999?(this._x=Math.atan2(U,w),this._z=Math.atan2(L,p)):(this._x=0,this._z=Math.atan2(-n,A))):"YZX"===F?(this._z=Math.asin(Y(L,-1,1)),Math.abs(L)<.99999?(this._x=Math.atan2(-$,A),this._y=Math.atan2(-N,p)):(this._x=0,this._y=Math.atan2(e,w))):"XZY"===F?(this._z=Math.asin(-Y(n,-1,1)),Math.abs(n)<.99999?(this._x=Math.atan2(U,A),this._y=Math.atan2(e,p)):(this._x=Math.atan2(-$,w),this._y=0)):console.warn("unsupported order: "+F),this._order=F,t!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var E=new Dg;return function(Y,a,L){return E.makeRotationFromQuaternion(Y),this.setFromRotationMatrix(E,a,L)}}(),setFromVector3:function(d,c){return this.set(d.x,d.y,d.z,c||this._order)},reorder:function(){var m=new bn;return function(U){return m.setFromEuler(this),this.setFromQuaternion(m,U)}}(),equals:function(Y){return Y._x===this._x&&Y._y===this._y&&Y._z===this._z&&Y._order===this._order},fromArray:function(O){return this._x=O[0],this._y=O[1],this._z=O[2],O[3]!==C&&(this._order=O[3]),this.onChangeCallback(),this},toArray:function(R,T){return R===C&&(R=[]),T===C&&(T=0),R[T]=this._x,R[T+1]=this._y,R[T+2]=this._z,R[T+3]=this._order,R},toVector3:function(L){return L?L.set(this._x,this._y,this._z):new ah(this._x,this._y,this._z)},onChange:function(T){return this.onChangeCallback=T,this},onChangeCallback:function(){}});var Vd=k.List=function(){this._as=[];var Y,H,f=arguments.length;if(1===f){var g=arguments[0];if(br(g)&&(g=g._as),lk(g))for(H=g.length,Y=0;H>Y;Y++)this._as.push(g[Y]);else g!=V&&this._as.push(g)}else if(f>1)for(Y=0;f>Y;Y++)this._as.push(arguments[Y])};Ni("List",H,{forEach:function(c,j){this.each(c,j)},push:function(){for(var i=0;i<arguments.length;i++)this.add(arguments[i])},pop:function(){return this._as.pop()},shift:function(){return this._as.shift()},unshift:function(){return this._as.unshift.apply(this._as,arguments)},size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(F,I){return I===C?this._as.push(F):this._as.splice(I,0,F)},addAll:function(p){br(p)&&(p=p._as),lk(p)?Rd(this._as,p):this._as.push(p)},get:function(A){return this._as[A]},slice:function(i,B){return new Vd(this._as.slice(i,B))},remove:function(B){var r=this._as.indexOf(B);return r>=0&&r<this._as.length&&this.removeAt(r),r},removeAt:function(C){return this._as.splice(C,1)[0]},set:function($,v){return this._as[$]=v},clear:function(){return this._as.splice(0,this._as.length)},contains:function($){return this._as.indexOf($)>=0},indexOf:function(G){return this._as.indexOf(G)},each:function(U,m){for(var D=0,x=this._as.length;x>D;D++){var K=this._as[D];m?U.call(m,K,D,this):U(K,D,this)}},reverseEach:function(u,Q){for(var T=this._as.length-1;T>=0;T--){var P=this._as[T];Q?u.call(Q,P):u(P)}},getArray:function(){return this._as},toArray:function($,f){if($){for(var i,l=[],B=0,d=this._as.length;d>B;B++)i=this._as[B],f?$.call(f,i)&&l.push(i):$(i)&&l.push(i);return l}return this._as.concat()},toList:function(F,W){if(F){for(var o,y=new Vd,M=0,R=this._as.length;R>M;M++)o=this._as[M],W?F.call(W,o)&&y.add(o):F(o)&&y.add(o);return y}return new Vd(this)},reverse:function(){this._as.reverse()},sort:function(z){return this._as.sort(z?z:cd),this},toString:function(){return this._as.toString()}}),H.defineProperties(Vd.prototype,{length:{get:function(){return this._as.length},set:function(A){this._as.length=A}}});var Lj=new Vd;dc(Lj,{size:function(){return 0},indexOf:function(){return-1},contains:function(){return!1},isEmpty:function(){return!0},sort:Yk,each:Yk,reverseEach:Yk,toArray:function(){return[]},toList:function(){return new Vd},add:Qn,addAll:Qn,set:Qn,remove:Qn,removeAt:Qn,clear:Qn});var Hi=k.Notifier=function(){this._f=0};Ni("Notifier",H,{contains:function(H,u){if(this._ls)for(var R,P=0,$=this._ls.size();$>P;P++)if(R=this._ls.get(P),H===R.l&&u===R.s)return!0;return!1},add:function(z,H,E){var y=this,D={l:z,s:H,a:E};y._ls||(y._ls=new Vd),y._f?(y._as||(y._as=new Vd),y._as.add(D)):D.a?y._ls.add(D,0):y._ls.add(D)},remove:function(H,C){var N=this;N._ls&&(N._f?(N._rs||(N._rs=new Vd),N._rs.add({l:H,s:C})):N._remove(H,C))},_remove:function(V,v){for(var c,x=this._ls,Z=0,N=x.size();N>Z;Z++)if(c=x.get(Z),c.l===V&&c.s===v)return x.removeAt(Z),void 0},fire:function(q){var P=this,f=P._ls;if(P._b=1e4,f){++P._f;try{for(var i,V=0,r=f.size();r>V;V++)i=f.get(V),i.s?i.l.call(i.s,q):i.l(q)}catch(q){G(function(){throw q})}finally{if(--P._f)return;if(P._rs){for(r=P._rs.size(),V=0;r>V;V++)i=P._rs.get(V),P._remove(i.l,i.s);delete P._rs}if(P._as){for(r=P._as.size(),V=0;r>V;V++)i=P._as.get(V),i.a?f.add(i,0):f.add(i);delete P._as}}}}});var oj=k.Data=function(){this._id=Nk()};Ni("Data",H,{ms_ac:["tag","name","displayName","icon","toolTip","attrObject","styleMap","layer","adjustChildrenToTop","dataBindings"],ms_dm:1,ms_attr:1,_icon:V,_parent:V,_children:Lj,_childMap:V,_styleMap:V,_layer:"0",_adjustChildrenToTop:!1,getUIClass:function(){return V},_22Q:function(){return V},s:function(i,p){var J=this;if(2===arguments.length)J.setStyle(i,p);else{if(!Ib(i))return J.getStyle(i);for(var H in i)J.setStyle(H,i[H])}return J},fp:function(q,X,B,y,z){return this.firePropertyChange(q,X,B,y,z)},firePropertyChange:function(p,q,P,U,x){if(U){if(U(q,P))return!1}else if(q===P)return!1;var B=this,g=x||{};return g.property=p,g.oldValue=q,g.newValue=P,g.data=B,B._dataModel&&B._dataModel.handleDataPropertyChange(g),B.onPropertyChanged(g),!0},onPropertyChanged:function(m){var x=this,z=x._parent,l=m.property;if(bm(z)){var E=x.s(Ym),n="s:ingroup"===l;(E&&Gj[l]||l===n)&&z._81I(),(E||n)&&z.fp("childChange",!0,!1)}Jj(z)&&Gj[l]&&z.updateFromChildren()},_21I:function(I){var w=this;if(I&&w._dataModel)throw"Remove data from dataModel before adding";w._dataModel=I},removeFromDataModel:function(){this._dataModel?this._dataModel.remove(this):this.setParent(null)},clearChildrenFromDataModel:function(){for(var x=0,K=this._children.toArray(),F=K.length;F>x;x++)K[x].removeFromDataModel()},getId:function(){return this._id},setId:function(V){this._id=V},getChildren:function(){return this._children},size:function(){return this._children.size()},toChildren:function(o,t){return this._children.toList(o,t)},eachChild:function(y,H){this._children.each(y,H)},addChild:function(S,m){var f=this;S!==f&&(f._children===Lj&&(f._children=new Vd,f._childMap={}),m>=0||(m=f._children.size()),f._childMap[S._id]||f.isDescendantOf(S)||(S._parent&&S._parent.removeChild(S),(0>m||m>f._children.size())&&(m=f._children.size()),f._children.add(S,m),f._childMap[S._id]=S,S.setParent(f),f.onChildAdded(S,m),f.fp(wf,V,S)))},onChildAdded:function(){},removeChild:function(K){var p=this;if(p._childMap&&p._childMap[K._id]){var U=p._children.remove(K);delete p._childMap[K._id],p.fp(wf,K,V),K.setParent(V,U),p.onChildRemoved(K,U)}},onChildRemoved:function(){},getChildAt:function(a){return this._children.get(a)},clearChildren:function(){var t=this;if(!t._children.isEmpty())for(var W=0,E=t._children.toArray(),i=E.length;i>W;W++)t.removeChild(E[W])},getParent:function(){return this._parent},setParent:function(Z,h){var c=this;if(!(c._73I||c._parent===Z||c===Z||Z&&Z.isDescendantOf(c))){var f,O=c._parent;c._parent=Z,c._73I=1,O?(h==V&&(h=O.getChildren().indexOf(c)),O.removeChild(c)):c._dataModel&&h==V&&(h=c._dataModel.getRoots().indexOf(c)),Z&&(Z.addChild(c),f=Z.getChildren().indexOf(c)),delete c._73I,c.fp("parent",O,Z,C,{oldIndex:h,newIndex:f}),c.onParentChanged(O,Z)}},onParentChanged:function(){},hasChildren:function(){return this._children.size()>0},isEmpty:function(){return this._children.isEmpty()},isRelatedTo:function(V){return V?this.isDescendantOf(V)||V.isDescendantOf(this):!1},isParentOf:function(B){return B&&this._childMap?!!this._childMap[B._id]:!1},isDescendantOf:function(R){if(!R||R.isEmpty())return!1;for(var y=this._parent;y;){if(R===y)return!0;y=y._parent}return!1},getStyle:function(p,n){n===C&&(n=1);var $=this._styleMap?this._styleMap[p]:C;return $===C&&n?g[p]:$},setStyle:function(e,E){var w=this;w._styleMap||(w._styleMap={});var N=w._styleMap[e];E===C?delete w._styleMap[e]:w._styleMap[e]=E,w.fp("s:"+e,N,E)&&w.onStyleChanged(e,N,E)},onStyleChanged:function(){},iv:function(W){this.invalidate(W)},invalidate:function(n){this.fp(n||"*",!1,!0)},toString:function(){var m=this;return m._displayName||m._name||m._tag||m._id},toLabel:function(){return this._displayName||this._name},addStyleIcon:function(X,U){var H=this,P=H.s(Zj);P||H.s(Zj,P={}),U?P[X]=U:delete P[X],H.fp(Zj,V,P)},removeStyleIcon:function(r){var q=this.s(Zj);if(q){var v=q[r];delete q[r],this.fp(Zj,V,q)}return v},getSerializableProperties:function(){return{name:1,displayName:1,icon:1,toolTip:1,parent:1,layer:1,tag:1,adjustChildrenToTop:1,dataBindings:1}},getSerializableStyles:function(){var g,n={};for(g in this._styleMap)n[g]=1;return n},getCurrentPrefix:function(){return this._interactPrefix||Sr},ca:function(v,t){var z=this.getCurrentPrefix();return v=z+v,2===arguments.length?this.a(v,t):this.a(v)}});var bi=k.DataModel=function(){var k=this;k._datas=new Vd,k._dataMap={},k._roots=new Vd,k._rootMap={},k._fsDataMap={},k._78O={},k._reflectorMap={},k._36I=new Hi,k._35I=new Hi,k._serializeNotifier=new Hi,k._selectionModel=new Co(k);var E=k._29Q=[],Q=k._scheduleCallback=function(){for(var s=Date.now(),S=0;S<E.length;S++){var Y=E[S];Y.enabled&&s-Y.lastTime>Y.interval&&(Y.beforeAction&&Y.beforeAction(),k.each(function(s){Y.action(s)}),Y.afterAction&&Y.afterAction(),Y.lastTime=s)}E.length&&(k._30Q=K.requestAnimationFrame(Q))}};Ni("DataModel",H,{ms_fire:1,ms_attr:1,ms_ac:["layers","name","autoAdjustIndex","hierarchicalRendering","background","envmap","postProcessingData","init"],_name:C,_autoAdjustIndex:!0,_hierarchicalRendering:!1,_background:C,_init:C,_envmap:C,_postProcessingData:C,sm:function(){return this.getSelectionModel()},mm:function(t,x,h){this.addDataModelChangeListener(t,x,h)},umm:function(v,e){this.removeDataModelChangeListener(v,e)},md:function(H,d,y){this.addDataPropertyChangeListener(H,d,y)},umd:function(u,K){this.removeDataPropertyChangeListener(u,K)},mh:function(b,e,t){this.addHierarchyChangeListener(b,e,t)},umh:function(L,U){this.removeHierarchyChangeListener(L,U)},getAttrObject:function(){return this._attrObject},setAttrObject:function(w){return this._attrObject=w},getSelectionModel:function(){return this._selectionModel},size:function(){return this._datas.size()},isEmpty:function(){return this._datas.isEmpty()},getRoots:function(){return this._roots},getDatas:function(){return this._datas},getFullscreenDatas:function(){return this._fsDataMap},getReflectors:function(){return this._reflectorMap},getDataById:function(c){return this._dataMap[c]},removeDataById:function(i){this.remove(this.getDataById(i))},toDatas:function(Z,e){return this._datas.toList(Z,e)},each:function(D,M){this._datas.each(D,M)},getDataByTag:function(Z){return this._78O[Z]},getTagMap:function(){return this._78O},removeDataByTag:function($){this.remove(this.getDataByTag($))},add:function(A,X,O){var T=this,$=A._id,N=A._tag,g=T._roots;if(T._dataMap[$])throw"'"+$+"' already exists";N!=V&&(T._78O[N]=A),T._dataMap[$]=A,O>=0?T._datas.add(A,O):T._datas.add(A),A._parent||(T._rootMap[$]=A,X>=0?g.add(A,X):g.add(A)),A.s("fullscreen")!==C&&(T._fsDataMap[$]=A),A.s("shape3d.reflector")&&(T._reflectorMap[$]=A),A._21I(T),T.onAdded(A),T._36I.fire({kind:"add",data:A,rootsIndex:X,datasIndex:O})},onAdded:function(){},remove:function(D,b){if(D){var A=this,$=D._id,I=b&&b.keepStructure,w=b&&b.keepChildren,Q=D.getTag();if(D._dataModel===A){this.beginTransaction(),I?A._removingData||(A._removingData=D):A.prepareRemove(D),w||D.toChildren().each(function(l){A.remove(l,b)},A),I?A._removingData===D&&(D._parent&&D._parent.removeChild(D),delete A._removingData):D._parent&&D._parent.removeChild(D);var Z=A._datas.remove(D);delete A._dataMap[$],Q!=V&&delete A._78O[Q];var H;A._rootMap[$]&&(delete A._rootMap[$],H=A._roots.remove(D)),A._fsDataMap[$]&&delete A._fsDataMap[$],A._reflectorMap[$]&&delete A._reflectorMap[$],D._21I(V),A.onRemoved(D),A._36I.fire({kind:ih,data:D,rootsIndex:H,datasIndex:Z}),this.endTransaction()}}},onRemoved:function(){},prepareRemove:function(){},clear:function(){var A=this;if(A._datas.size()){var l=A._historyManager?this.toJSON():C;A._datas.toArray().forEach(function(W){W._21I(V)}),A._datas.clear(),A._dataMap={},A._roots.clear(),A._rootMap={},A._fsDataMap={},A._reflectorMap={},A._78O={},A._36I.fire({kind:cn,json:l})}},contains:function(H){return H&&H._dataModel===this},handleDataPropertyChange:function(t){var H=this,n=t.data,F=t.property;if("parent"===F){var S=n._id,e=H._rootMap,r=H._roots;n._parent?e[S]&&(delete e[S],r.remove(n)):e[S]||(e[S]=n,r.add(n))}else if("tag"===F){var i=t.oldValue,$=t.newValue,l=H._78O;i!=V&&delete l[i],$!=V&&(l[$]=n)}else if("s:fullscreen"===F){var S=n._id,A=H._fsDataMap;t.oldValue!=V&&delete A[S],t.newValue!=V&&(A[S]=n)}else if("s:shape3d.reflector"===F){var S=n._id,D=H._reflectorMap;t.oldValue&&delete D[S],t.newValue&&(D[S]=n)}this.onDataPropertyChanged(n,t),this._35I.fire(t)},onDataPropertyChanged:function(){},addDataModelChangeListener:function(Y,n,x){this._36I.add(Y,n,x)},removeDataModelChangeListener:function(Q,h){this._36I.remove(Q,h)},addSerializeListener:function(l,H,I){this._serializeNotifier.add(l,H,I)},removeSerializeListener:function(K,E){this._serializeNotifier.remove(K,E)},fireSerializeEvent:function(Q){this._serializeNotifier.fire(Q)},addDataPropertyChangeListener:function(l,e,S){this._35I.add(l,e,S)},removeDataPropertyChangeListener:function(L,o){this._35I.remove(L,o)},_38I:function(R,$,c){this._37I&&this._37I.fire({data:R,oldIndex:$,newIndex:c})},addHierarchyChangeListener:function(j,D,m){this._37I||(this._37I=new Hi),this._37I.add(j,D,m)},removeHierarchyChangeListener:function(x,m){this._37I.remove(x,m)},getSiblings:function(b){var R=b._parent;return R?R._children:this._roots},eachByHierarchical:function(C,c,n){if(c)return this._eachByHierarchical(C,c,n);for(var U=0,M=this._roots,R=M.size();R>U;U++)if(this._eachByHierarchical(C,M.get(U),n)===!1)return!1;return!0},_eachByHierarchical:function(t,g,E){if(E){if(t.call(E,g)===!1)return!1}else if(t(g)===!1)return!1;for(var x=g.size(),k=0;x>k;k++)if(this._eachByHierarchical(t,g.getChildAt(k),E)===!1)return!1;return!0},reverseEachByHierarchical:function(c,$,e){if($)return this._reverseEachByHierarchical(c,$,e);for(var H=this._roots,N=H.size(),K=N-1;K>=0;K--)if(this._reverseEachByHierarchical(c,H.get(K),e)===!1)return!1;return!0},_reverseEachByHierarchical:function(x,t,p){for(var h=t.size(),S=h-1;S>=0;S--)if(this._reverseEachByHierarchical(x,t.getChildAt(S),p)===!1)return!1;if(p){if(x.call(p,t)===!1)return!1}else if(x(t)===!1)return!1;return!0},eachByDepthFirst:function(C,Y,k){if(Y)return this._11I(C,Y,k);for(var n=0,R=this._roots,P=R.size();P>n;n++)if(this._11I(C,R.get(n),k)===!1)return!1;return!0},_11I:function(C,o,y){for(var i=o.size(),l=0;i>l;l++)if(this._11I(C,o.getChildAt(l),y)===!1)return!1;if(y){if(C.call(y,o)===!1)return!1}else if(C(o)===!1)return!1;return!0},eachByBreadthFirst:function(y,u,F){var o=new Vd;for(u?o.add(u):this._roots.each(o.add,o);o.size()>0;)if(u=o.removeAt(0),u.eachChild(o.add,o),F){if(y.call(F,u)===!1)return!1}else if(y(u)===!1)return!1;return!0},moveTo:function(k,c){var $=this.getSiblings(k),H=$.indexOf(k);H===c||0>H||c>=0&&c<=$.size()&&($.remove(k),c>$.size()&&c--,$.add(k,c),this._38I(k,H,c))},moveUp:function(P){this.moveTo(P,this.getSiblings(P).indexOf(P)-1)},moveDown:function(F){this.moveTo(F,this.getSiblings(F).indexOf(F)+1)},moveToTop:function(h){this.moveTo(h,0)},moveToBottom:function(c){this.moveTo(c,this.getSiblings(c).size())},moveSelectionUp:function(z){this.beginTransaction(),z||(z=this.sm());var x=new Vd;sq(z,x,this._roots),x.each(this.moveUp,this),this.endTransaction()},moveSelectionDown:function(_){this.beginTransaction(),_||(_=this.sm());var M=new Vd;Lo(_,M,this._roots),M.each(this.moveDown,this),this.endTransaction()},moveSelectionToTop:function(b){this.beginTransaction(),b||(b=this.sm());var c=new Vd;Cq(b,c,this._roots),c.each(this.moveToTop,this),this.endTransaction()},moveSelectionToBottom:function(A){this.beginTransaction(),A||(A=this.sm());var u=new Vd;Xi(A,u,this._roots),u.each(this.moveToBottom,this),this.endTransaction()},moveToIndex:function(V,e,p){var U=this.getDatas();null==p&&(p=U.indexOf(V)),p===e||0>p||e>=0&&e<=U.size()&&(U.remove(V),e>U.size()&&e--,U.add(V,e),this._76I(V,p,e))},bringForward:function(F){this.moveToIndex(F,this.getDatas().indexOf(F)+1)},bringToFront:function(R){this.moveToIndex(R,this.size())},sendBackward:function(c){this.moveToIndex(c,this.getDatas().indexOf(c)-1)},sendToBack:function(i){this.moveToIndex(i,0)},bringSelectionForward:function(G){this.beginTransaction(),G||(G=this.sm());for(var P=new Vd,r=this.getDatas(),n=!1,F=0;F<r.size();F++){var M=r.get(r.size()-1-F);G.contains(M)?n&&P.add(M):n=!0}P.each(this.bringForward,this),this.endTransaction()},bringSelectionToFront:function(X){this.beginTransaction(),X||(X=this.sm());for(var d=new Vd,K=this.getDatas(),b=0;b<K.size();b++){var J=K.get(b);X.contains(J)&&d.add(J)}d.each(this.bringToFront,this),this.endTransaction()},sendSelectionBackward:function(f){this.beginTransaction(),f||(f=this.sm());for(var c=new Vd,B=this.getDatas(),N=!1,e=0;e<B.size();e++){var O=B.get(e);f.contains(O)?N&&c.add(O):N=!0}c.each(this.sendBackward,this),this.endTransaction()},sendSelectionToBack:function(i){this.beginTransaction(),i||(i=this.sm());for(var v=new Vd,J=this.getDatas(),s=0;s<J.size();s++){var R=J.get(J.size()-1-s);i.contains(R)&&v.add(R)}v.each(this.sendToBack,this),this.endTransaction()},addScheduleTask:function(j){var G=this;G.removeScheduleTask(j),j.enabled==V&&(j.enabled=!0),j.interval==V&&(j.interval=10),j.action==V&&(j.action=Yk),j.lastTime=Date.now(),G._29Q.push(j),G._30Q==V&&(G._30Q=K.requestAnimationFrame(G._scheduleCallback))},removeScheduleTask:function(w){var D=this,T=D._29Q,E=T.indexOf(w);E>=0&&T.splice(E,1),T.length||D._30Q==V||(K.cancelAnimationFrame(D._30Q),delete D._30Q)},getHistoryManager:function(){return this._historyManager},enableHistoryManager:function(D){this._historyManager||new k.HistoryManager(this),null!=D&&this._historyManager.setMaxHistoryCount(D),this._historyManager.setDisabled(!1)},disableHistoryManager:function(){this._historyManager&&this._historyManager.setDisabled(!0)},clearHistoryManager:function(){this._historyManager&&this._historyManager.clear()},undo:function(_){this._historyManager&&this._historyManager.undo(_)},redo:function(e){this._historyManager&&this._historyManager.redo(e)},beginTransaction:function(){this._historyManager&&this._historyManager.beginTransaction()},endTransaction:function(){this._historyManager&&this._historyManager.endTransaction()},addHistory:function(Y){this._historyManager&&this._historyManager.addHistory(Y)},onHistoryManagerChanged:function(){}});var Co=k.SelectionModel=function(r){var A=this;A._68O=Yr,A._map={},A._73O=new Vd,A._74I=new Hi,A._21I(r)};Ni("SelectionModel",H,{ms_fire:1,ms_dm:1,ms:function(i,L,l){this.addSelectionChangeListener(i,L,l)},ums:function(t,k){this.removeSelectionChangeListener(t,k)},fd:function(){return this.getFirstData()},ld:function(){return this.getLastData()},sg:function(){return this._68O===ir},co:function(Z){return this._map[Z._id]!=V},ss:function(e){this.setSelection(e)},as:function(W){this.appendSelection(W)},rs:function(u){this.removeSelection(u)},cs:function(){this.clearSelection()},sa:function(){this.selectAll()},getSelectionMode:function(){return this._68O},setSelectionMode:function(H){var w=this;if(w._68O!==H&&(H===Fi||H===ir||H===Yr)){w.cs();var j=w._68O;w._68O=H,w.fp("selectionMode",j,H)}},_21I:function(X){var n=this,$=n._dataModel;$!==X&&($&&(n.cs(),$.umm(n.handleDataModelChange,n)),n._dataModel=X,X.mm(n.handleDataModelChange,n,!0),n.fp(al,$,X))},dispose:function(){var L=this;L.cs(),L._dataModel.umm(L.handleDataModelChange,L)},handleDataModelChange:function(A){var P=this;if(A.kind===ih){var W=A.data;P.co(W)&&(P._73O.remove(W),delete P._map[W._id],P._75I(ih,new Vd(W)))}else A.kind===cn&&P.cs()},getFilterFunc:function(){return this._filterFunc},setFilterFunc:function(A){var $=this;if($._filterFunc!==A){$.cs();var c=$._filterFunc;$._filterFunc=A,$.fp("filterFunc",c,$._filterFunc)}},_75I:function(I,V,g,D){g&&(this._73O.each(function(s){D[s._id]?g.remove(s):g.add(s)}),V=g.toList()),this._74I.fire({kind:I,datas:new Vd(V)})},addSelectionChangeListener:function(c,n,B){this._74I.add(c,n,B)},removeSelectionChangeListener:function(k,L){this._74I.remove(k,L)},_97O:function(S,o){for(var h,l=this,M=0,E=new Vd(S);M<E.size();M++)h=E.get(M),(l._filterFunc&&!l._filterFunc(h)||o&&l.co(h)||!o&&!l.co(h)||!l._dataModel.contains(h))&&(E.removeAt(M),M--);return E},appendSelection:function(e){var y=this;if(y._68O!==Fi){var a,i,O=y._73O,o=y._97O(e,!0);o.isEmpty()||(y.sg()&&(a=new Vd(O),i=y._map,O.clear(),y._map={},o=new Vd(o.get(o.size()-1))),o.each(function(k){O.add(k),y._map[k._id]=k}),y._75I("append",o,a,i))}},removeSelection:function(w){var n=this,f=n._97O(w),q=0,g=f.size();if(0!==g){for(;g>q;q++){var a=f.get(q);n._73O.remove(a),delete n._map[a._id]}n._75I(ih,f)}},toSelection:function(W,U){return this._73O.toList(W,U)},getSelection:function(){return this._73O},each:function(w,W){this._73O.each(w,W)},setSelection:function(U){var w=this,s=w._73O;if(w._68O!==Fi&&!(s.isEmpty()&&!U||1===s.size()&&w.ld()===U)){var Q=new Vd(s),I=w._map;s.clear(),w._map={};var _=w._97O(U,!0);w.sg()&&_.size()>1&&(_=new Vd(_.get(_.size()-1))),_.each(function(O){s.add(O),w._map[O._id]=O}),w._75I("set",V,Q,I)}},clearSelection:function(){var c=this,G=c._73O;if(G.size()>0){var W=G.toList();G.clear(),c._map={},c._75I(cn,W)}},selectAll:function(){var g=this;if(g._68O!==Fi){var y,z,X=g._dataModel.toDatas();if(g._filterFunc)for(y=0;y<X.size();y++)z=X.get(y),g._filterFunc(z)||(X.removeAt(y),y--);var Y=g._73O,B=new Vd(Y),K=g._map;Y.clear(),g._map={},g.sg()&&X.size()>1&&(X=new Vd(X.get(X.size()-1)));var L=X.size();for(y=0;L>y;y++)z=X.get(y),Y.add(z),g._map[z._id]=z;g._75I("all",V,B,K)}},size:function(){return this._73O.size()},isEmpty:function(){return this._73O.isEmpty()},contains:function(B){return this._map[B._id]!=V},getLastData:function(){var Q=this._73O;return Q.size()>0?Q.get(Q.size()-1):V},getFirstData:function(){var t=this._73O;return t.size()>0?t.get(0):V},isSelectable:function(P){var p=this;return P&&p._68O!==Fi?p._filterFunc?p._filterFunc(P):!0:!1},getTopSelection:function(){var F=this,Y=new Vd;return F._73O.each(function(k){for(var U=k.getParent();U;){if(F.contains(U)){k=V;break}U=U.parent}k&&Y.add(k)}),Y}});var ed=function(){return ms(0),function(C,y){var H;if(Rl(y)){var u=C.getDataUI(y);u&&u._88I&&(H=u._88I.rect)}return H?H:y.getRect()}}();dc(m,{edgeGroupAgentFunc:V,graphViewAutoScrollZone:16,graphViewZoomable:!0,graphViewResettable:!1,graphViewPannable:!0,graphViewRectSelectable:!0,graphViewScrollBarVisible:!0,graphViewRectSelectBorderColor:A.rectSelectBorder,graphViewRectSelectBackground:Yo,graphViewEditPointSize:fn?17:7,graphViewEditPointBorderColor:A.editPointBorder,graphViewEditPointBackground:A.editPointBackground,setEdgeType:function(l,k,w){Jp[l]=k,Io[l]=w},getEdgeType:function(X){return Jp[X]},getEdgeTypeMap:function(){return Jp},getNodeRect:ed},!0),dc(g,{"layout.h":C,"layout.v":C,"2d.selectable":!0,"2d.visible":!0,"2d.movable":!0,"2d.editable":!0,"2d.move.mode":C,interactive:!1,"image.stretch":"fill",icons:C,ingroup:!0,"body.color":C,"2d.gray":!1,fullscreen:C,"fullscreen.gap":2,"fullscreen.lock":!1,opacity:C,pixelPerfect:!0,keepAspectRatio:!1,"attach.points":null,"attach.style":null,"attach.close.threshold":16,"clip.direction":"top","clip.percentage":1,"select.color":uq,"select.width":1,"select.padding":2,"select.type":mc,shadow:!1,"shadow.blur":6,"shadow.offset.x":3,"shadow.offset.y":3,"border.color":C,"border.width":2,"border.padding":2,"border.type":mc,label:C,"label.font":C,"label.color":nd,"label.background":C,"label.position":31,"label.position.fixed":!1,"label.offset.x":0,"label.offset.y":2,"label.rotation":C,"label.max":C,"label.opacity":C,"label.scale":1,"label.align":C,"label.selectable":!0,label2:C,"label2.font":C,"label2.color":nd,"label2.background":C,"label2.position":34,"label2.position.fixed":!1,"label2.offset.x":0,"label2.offset.y":-2,"label2.rotation":C,"label2.max":C,"label2.opacity":C,"label2.scale":1,"label2.align":C,"label2.selectable":!0,note:C,"note.expanded":!0,"note.font":C,"note.color":Ve,"note.background":uq,"note.position":8,"note.offset.x":-3,"note.offset.y":3,"note.max":C,"note.toggleable":!0,"note.border.width":1,"note.border.color":C,"note.opacity":C,"note.scale":1,"note.align":C,note2:C,"note2.expanded":!0,"note2.font":C,"note2.color":Ve,"note2.background":uq,"note2.position":3,"note2.offset.x":3,"note2.offset.y":-3,"note2.max":C,"note2.toggleable":!0,"note2.border.width":1,"note2.border.color":C,"note2.opacity":C,"note2.scale":1,"note2.align":C,"group.type":C,"group.image":C,"group.image.stretch":"fill","group.repeat.image":C,"group.padding":8,"group.padding.left":0,"group.padding.right":0,"group.padding.top":0,"group.padding.bottom":0,"group.position":17,"group.toggleable":!0,"group.title.font":C,"group.title.color":Ve,"group.title.background":A.groupTitleBackground,"group.title.align":ws,"group.title.orientation":qs,"group.background":A.groupBackground,"group.depth":1,"group.border.width":1,"group.border.pattern":C,"group.border.color":Qb,"group.border.radius":0,"group.border.cap":km,"group.border.join":qc,"group.splitLine":!1,"group.gradient":V,"group.gradient.color":"#FFF",shape:C,"shape.background":Qb,"shape.repeat.image":C,"shape.border.width":0,"shape.border.width.absolute":!1,"shape.border.color":Qb,"shape.border.3d":!1,"shape.border.3d.color":C,"shape.border.3d.accuracy":C,"shape.border.cap":km,"shape.border.join":qc,"shape.border.pattern":C,"shape.gradient":V,"shape.gradient.color":"#FFF","shape.depth":0,"shape.dash":!1,"shape.dash.pattern":hp,"shape.dash.offset":0,"shape.dash.color":rb,"shape.dash.width":C,"shape.dash.3d":!1,"shape.dash.3d.color":C,"shape.dash.3d.accuracy":C,"shape.polygon.side":6,"shape.arc.from":F,"shape.arc.to":w,"shape.arc.close":!0,"shape.arc.oval":!1,"shape.corner.radius":C,"shape.gradient.pack":C,"shape.fill.rule":"nonzero","shape.fill.clip.direction":"top","shape.fill.clip.percentage":1,"shape.foreground":C,"shape.foreground.gradient":V,"shape.foreground.gradient.color":"#FFF","shape.foreground.clip.direction":"top","shape.foreground.clip.percentage":1,"autolayout.gap":C,"autolayout.hgap":C,"autolayout.vgap":C,"edge.type":C,"edge.points":C,"edge.segments":C,"edge.color":Qb,"edge.width":2,"edge.width.absolute":!1,"edge.offset":0,"edge.group":0,"edge.expanded":!0,"edge.gap":12,"edge.toggleable":!0,"edge.center":!1,"edge.3d":!1,"edge.3d.color":C,"edge.3d.accuracy":C,"edge.cap":km,"edge.join":qc,"edge.source.position":17,"edge.source.anchor.x":C,"edge.source.anchor.y":C,"edge.source.offset.x":0,"edge.source.offset.y":0,"edge.target.position":17,"edge.target.anchor.x":C,"edge.target.anchor.y":C,"edge.target.offset.x":0,"edge.target.offset.y":0,"edge.pattern":C,"edge.dash":!1,"edge.dash.pattern":hp,"edge.dash.offset":0,"edge.dash.color":rb,"edge.dash.width":C,"edge.dash.3d":!1,"edge.dash.3d.color":C,"edge.dash.3d.accuracy":C,"edge.independent":!1,"attach.row.index":0,"attach.column.index":0,"attach.row.span":1,"attach.column.span":1,"attach.padding":0,"attach.padding.left":0,"attach.padding.right":0,"attach.padding.top":0,"attach.padding.bottom":0,"attach.index":-1,"attach.offset":0,"attach.offset.relative":!1,"attach.offset.opposite":!1,"attach.thickness":C,"attach.gap":0,"attach.gap.relative":!1,"grid.row.count":1,"grid.column.count":1,"grid.row.percents":C,"grid.column.percents":C,"grid.border":1,"grid.border.left":0,"grid.border.right":0,"grid.border.top":0,"grid.border.bottom":0,"grid.gap":1,"grid.background":A.gridBackground,"grid.depth":1,"grid.cell.depth":-1,"grid.cell.border.color":A.gridCellBorderColor,"grid.block":C,"grid.block.padding":3,"grid.block.width":1,"grid.block.color":A.gridBlockColor,text:"","text.align":"left","text.vAlign":"middle","text.color":nd,"text.font":Zb,"text.shadow":!1,"text.shadow.color":uq,"text.shadow.blur":6,"text.shadow.offset.x":3,"text.shadow.offset.y":3,"text.scale.x":1,"text.scale.y":1,_62O:C},!0),dc(bi,{_76I:function(L,G,D){this._39I&&this._39I.fire({data:L,oldIndex:G,newIndex:D})},addIndexChangeListener:function(T,L,i){var Y=this;Y._39I||(Y._39I=new Hi),Y._39I.add(T,L,i)},removeIndexChangeListener:function(w,g){this._39I.remove(w,g)},prepareRemove:function(e){ee(e)&&(e.setSource(V),e.setTarget(V)),e._70O&&e._70O.toList().each(this.remove,this),e._69O&&e._69O.toList().each(function(z){z.setHost(V)}),e._host&&e.setHost(V)},onAdded:function(y){this.isAutoAdjustIndex()&&this.adjustIndex(y)},onDataPropertyChanged:function(L,V){Jr[V.property]&&this.isAutoAdjustIndex()&&this.adjustIndex(L)},isAdjustable:function(w){return rd(w)||ee(w)},isAdjustedToBottom:function(w){return bm(w)?w.isExpanded()&&bc(w):!1},adjustIndex:function(I){var E=this;this.isHierarchicalRendering()||(E.isAdjustedToBottom(I)?(E.sendToBottom(I),I.eachChild(E.adjustIndex,E)):E.sendToTop(I))},sendToTop:function(j){var W=this;if(W.contains(j)&&W.isAdjustable(j)){var C=W._datas;if(j!==C.get(W.size()-1)){var T=C.indexOf(j);C.removeAt(T),C.add(j),W._76I(j,T,W.size()-1)}if(ee(j)){var y=j._40I;y&&!W.isAdjustedToBottom(y)&&W.sendToTop(y),y=j._41I,y&&!W.isAdjustedToBottom(y)&&W.sendToTop(y)}j._69O&&j._69O.each(function(z){z.isRelatedTo(j)||rd(j)&&z.isLoopedHostOn(j)||W.sendToTop(z)}),j.ISubGraph||(!bm(j)||j.isExpanded())&&j._adjustChildrenToTop&&j.eachChild(function(_){ee(_)||W.sendToTop(_)
})}},sendToBottom:function(F,n){var T=this;if(F!==n&&T.contains(F)&&T.isAdjustable(F)&&(!n||T.contains(n))){var y=T._datas,w=y.remove(F),e=n?T._datas.indexOf(n):0;if(y.add(F,e),w!==e){T._76I(F,w,e);var p=F._parent;!p||p.ISubGraph||ee(p)||T.sendToBottom(F._parent,F)}}}}),dc(Xc,{ms_edit:function(C){C._46O=function(I){var P=this,c=P.gv.dm(),T=P._index,Q=P._89I,W=P._node,z=P._shape,N=P._edge,C=P._77I;W&&Q?(this.fi({kind:"endEditRect",event:I,data:W,direction:Q}),c.endTransaction()):z&&T>=0?(P.fi({kind:"endEditPoint",event:I,data:z,index:T}),c.endTransaction()):N&&T>=0?(P.fi({kind:"endEditPoint",event:I,data:N,index:T}),c.endTransaction()):C&&(P.fi({kind:"endEditRotation",event:I,data:C}),c.endTransaction())},C._78I=function(n){var v=this;v.autoScroll(n);var p=v.gv.lp(n),g=v._index,P=v._89I,T=v._node,G=v._shape,R=v._edge,i=v._77I;if(T&&P)v._80O(p),v.fi({kind:"betweenEditRect",event:n,data:T,direction:P});else if(G&&g>=0)p.e=G.getPoints().get(g).e,G.setPoint(g,p),v.fi({kind:"betweenEditPoint",event:n,data:G,index:g});else if(R&&g>=0){var U=R.s(sb);p.e=U.get(g).e,U.set(g,p),R.fp(sb,V,U),v.fi({kind:"betweenEditPoint",event:n,data:R,index:g})}else if(i){var D=i.p(),S=i.getScale(),W=X+s(p.y-D.y,p.x-D.x);S.y<0&&(W+=F),M(W)<.04&&(W=0),i.setRotation(W),v.fi({kind:"betweenEditRotation",event:n,data:i})}},C._80O=function(y){var $=this,s=$._node,l=$._rect,H=l.x,S=l.y,j=l.width,E=l.height,r=$._89I,Q=$._anchor,G=$._matrix,y=G.tfi(y);"northwest"===r?l=fr(y,{x:H+j,y:S+E}):r===Ue?l=fr({x:H,y:y.y},{x:H+j,y:S+E}):"northeast"===r?l=fr({x:H,y:y.y},{x:y.x,y:S+E}):r===zl?l=fr({x:y.x,y:S},{x:H+j,y:S+E}):r===Pq?l=fr({x:H,y:S},{x:y.x,y:S+E}):"southwest"===r?l=fr({x:y.x,y:S},{x:H+j,y:y.y}):"south"===r?l=fr({x:H,y:S},{x:H+j,y:y.y}):"southeast"===r&&(l=fr({x:H,y:S},y)),s.setPosition(G.tf(l.x+l.width*Q.x,l.y+l.height*Q.y)),s.setWidth(l.width),s.setHeight(l.height)},C._80I=function(Z,y,k,z){var I=this,Q=I.gv._zoom,J=(I.gv.getEditPointSize()+2)/Q;return zc({x:y-J/2,y:k-J/2,width:J,height:J},Z)?(I._89I!==z&&(I._89I=z),!0):!1},C._79I=function($,l,c){var H=this,I=H.gv,v=l?I.getDataUI(l):V,T=v?v._55O:V;if(T){var w,u,x,Q,j=I._zoom,A=(I.getEditPointSize()+2)/j,d=I.lp($);if(rd(l)){if(T._56O&&rd(l)&&(u=T._98o,zc({x:u.x-A/2,y:u.y-A/2,width:A,height:A},d)))return H._77I=l,c&&H.fi({kind:"beginEditRotation",event:$,data:l}),H.setCursor("crosshair"),!0;if(T._43O&&l instanceof Wd)for(x=l.getPoints(),w=x.size()-1;w>=0;w--)if(u=x.get(w),zc({x:u.x-A/2,y:u.y-A/2,width:A,height:A},d))return H._index=w,H._shape=l,c&&H.fi({kind:"beginEditPoint",event:$,data:l,index:w}),H.setCursor("crosshair"),!0;if(T._42O)for(var B=l.getEditControlPoints(),C=["northwest",-1,-1,zl,-1,0,"southwest",-1,1,"south",0,1,"southeast",1,1,Pq,1,0,"northeast",1,-1,Ue,0,-1],w=0,Q=B.length;Q>w;w++){var m=C[3*w],Y=B[w];if(H._80I(d,Y.x,Y.y,m)){H._node=l;var t=l.getWidth(),D=l.getHeight(),k=l.getAnchor();H._rect={x:-t*k.x,y:-D*k.y,width:t,height:D},H._anchor=k,H._matrix=l.getMatrix();var G=l.getRotation(),h=e(G),r=U(G),O=C[3*w+1]*gb(l.getScale().x),z=C[3*w+2]*gb(l.getScale().y),E=Math.atan2(-r*O-h*z,h*O-r*z),_=(Math.round(E/(Math.PI/4))+8)%8,s=[bq,"nesw-resize",Ke,"nwse-resize",bq,"nesw-resize",Ke,"nwse-resize"][_];return H.setCursor(s),c&&H.fi({kind:"beginEditRect",event:$,data:l,direction:H._89I}),!0}}}if(T._43O&&ee(l)&&l.s(Bb)===Lg&&(x=l.s(sb)))for(w=x.size()-1;w>=0;w--)if(u=x.get(w),zc({x:u.x-A/2,y:u.y-A/2,width:A,height:A},d))return H._index=w,H._edge=l,c&&H.fi({kind:"beginEditPoint",event:$,data:l,index:w}),H.setCursor("crosshair"),!0}return!1}},ms_gv:function(f){f._currentSubGraph=V,f._fpsInfo={time:0,fps:0,frames:0},f.upSubGraph=function(){this.setCurrentSubGraph(gc(this._currentSubGraph))},f.isVisible=function(U){var H=this;if(gc(U)!==H._currentSubGraph)return!1;if(ee(U)){var A=U._40I,W=U._41I;if(!A||!W)return!1;if(!(U.s("edge.independent")||H.isVisible(A)&&H.isVisible(W)))return!1;if(U.isEdgeGroupHidden())return!1}else for(var T=U._parent;T&&!T.ISubGraph;){if(bm(T)&&(!T.isExpanded()||!H.isVisible(T)))return!1;T=T._parent}if(U._parent instanceof Cn&&!H.isVisible(U._parent))return!1;if(U._refGraph instanceof fd&&!H.isVisible(U._refGraph))return!1;if(H instanceof Ad){if(!U.s("3d.visible"))return!1}else{var q=H.getLayersInfo();if(q){var $=q[U._layer];if($&&$.visible===!1)return!1}if(!U.s("2d.visible"))return!1}return H._visibleFunc?H._visibleFunc(U):!0},f.handleSelectionChange=function(C){var I=this;C.datas.each(function(D){I.invalidateData(D);var b=D._parent;bm(b)&&rd(D)&&D.s(Ym)&&(I.invalidateData(b),b._49I&&b._49I.each(function(k){I.invalidateData(k)}))}),I.onSelectionChanged(C)},f.onSelectionChanged=function(s){var n=this,h=n.sm();if(1===h.size()&&("set"===s.kind||"append"===s.kind)){var l=h.ld();n.isAutoMakeVisible()&&n.makeVisible(l),n.adjustIndex&&n._dataModel.isAutoAdjustIndex()&&n.adjustIndex(l)}},f.makeVisible=function(n){if(n){var J=this,V=J.getDataUI?J.getDataUI(n):J.getData3dUI(n);if(V){var b=n,l=gc(n);for(l!==J._currentSubGraph&&J.setCurrentSubGraph(l);(b=b._parent)&&b!==l;)bm(b)&&b.setExpanded(!0);J._23I=n,J.iv()}}},f.getLabel=function(N){var F=N.getStyle(Lr);return F===C?N.getName():F},f.getLabelBackground=function(p){return p.getStyle("label.background")},f.getLabelColor=function(T){return T.getStyle("label.color")},f.getLabel2=function(G){return G.getStyle("label2")},f.getLabel2Background=function(a){return a.getStyle("label2.background")},f.getLabel2Color=function(f){return f.getStyle("label2.color")},f.getNote=function(h){return h.getStyle(_c)},f.getNoteBackground=function(E){return E.getStyle("note.background")},f.getNote2=function(T){return T.getStyle(Vg)},f.getNote2Background=function(k){return k.getStyle("note2.background")},f.handleClick=function(h,U,y){var J=this;U?(J.fi({kind:"clickData",event:h,data:U,part:y}),J.onDataClicked(U,h)):(J.fi({kind:"clickBackground",event:h}),J.onBackgroundClicked(h))},f.handleDoubleClick=function(E,c,z){var n=this;Te(E)&&(c?(n.fi({kind:"doubleClickData",event:E,data:c,part:z}),n.onDataDoubleClicked(c,E,z),n.checkDoubleClickOnNote(E,c,z)||n.checkDoubleClickOnRotation&&n.checkDoubleClickOnRotation(E,c,z)||(ee(c)?n.onEdgeDoubleClicked(c,E,z):c.ISubGraph?n.onSubGraphDoubleClicked(c,E,z):bm(c)?n.onGroupDoubleClicked(c,E,z):c.IDoorWindow?n.onDoorWindowDoubleClicked(c,E,z):c.ICSGBox&&n.onCSGBoxDoubleClicked(c,E,z))):(n.fi({kind:"doubleClickBackground",event:E}),n.onBackgroundDoubleClicked(E)))},f.onSubGraphDoubleClicked=function(U){this.setCurrentSubGraph(U)},f.onEdgeDoubleClicked=function(h,R){h.ISubGraph&&!Kg(R)?this.setCurrentSubGraph(h):h.s("edge.toggleable")&&h.toggle()},f.onGroupDoubleClicked=function(f){f.s("group.toggleable")&&f.toggle()},f.onDoorWindowDoubleClicked=function(t){t.s("dw.toggleable")&&t.toggle(!0)},f.onCSGBoxDoubleClicked=function(q,u){var o=this;if(o instanceof Ad){var T=o.getHitFaceInfo(u);T&&T.face&&q.s(T.face+".toggleable")&&q.toggleFace(T.face,!0)}},f.onBackgroundClicked=function(){},f.onBackgroundDoubleClicked=function(){this.upSubGraph()},f.onDataClicked=function(){},f.onDataDoubleClicked=function(){},f.onAutoLayoutEnded=function(){},f.onMoveEnded=function(){},f.onPanEnded=function(){},f.onPinchEnded=function(){},f.onRectSelectEnded=function(){},f.onZoomEnded=function(){},f.serialize=function(T){return this.dm().serialize(T)},f.toJSON=function(){return this.dm().toJSON()},f.deserialize=function(B,w){var z=this;w=w instanceof oj?{rootParent:w}:Hm(w)?{setId:w}:fg(w)?{finishFunc:w}:w||{},w.view=z;var y=z.dm(),K=w.finishFunc;return w.finishFunc=function(){K&&K.apply(w,arguments),Hm(y.a("zoomable"))&&z.setZoomable&&z.setZoomable(y.a("zoomable")),Hm(y.a("pannable"))&&z.setPannable&&z.setPannable(y.a("pannable")),Hm(y.a("rectSelectable"))&&z.setRectSelectable&&z.setRectSelectable(y.a("rectSelectable")),y.a("fitContent")===!0&&z.fitContent&&z.fitContent(!0,0)},y.deserialize(B,w.rootParent,w)},f.showDebugTip=function(){var d=this,e=d._debugDiv;if(!e){e=d._debugDiv=T.createElement("div"),e.style.position="absolute",e.style.overflow="hidden",e.style.backgroundColor="white",e.style.color="black";var F=d.getView();d._79O?F.insertBefore(e,d._79O):F.appendChild(e);var G=function(){d.redraw();var g="FPS : "+d._fpsInfo.fps+"<br/>"+"Datas : "+d.dm().getDatas().length,x=d.getDebugTip();x&&(g+="<br/>------<br/>"+x),e.innerHTML=g,d._isDebugging&&requestAnimationFrame(G)};requestAnimationFrame(G),d._isDebugging=!0}},f.hideDebugTip=function(){var C=this,x=C._debugDiv;x&&(delete C._debugDiv,C.getView().removeChild(x),C._isDebugging=!1)},f.countFrame=function(){if(this._isDebugging){var H=Date.now(),d=this._fpsInfo;H-d.time>1e3?(d.fps=Math.round(1e5*(d.frames+1)/(H-d.time))/100,d.time=H,d.frames=0):d.frames++}}},ms_icons:function(N){N.getRotation=function(r){return r==V?0:r},N._15O=function(){var J=this,h=J.s(Zj);if(h){var y=J,U=J.data||J._data,W=J._38o={icons:h,rects:{}};for(var c in h){var l=h[c],T=$d(l.shape3d,U,y);if(!($d(l.visible,U,y)===!1||$d(l.for3d,U,y)&&!J.I3d||T&&!J.I3d)){var L=T?[T]:$d(l.names,U,y),I=L?L.length:0,e=$d(l.position,U,y)||3,p=$d(l.offsetX,U,y)||0,X=$d(l.offsetY,U,y)||0,P=$d(l.direction,U,y)||Pq,N=$d(l.gap,U,y),G=N!=V?N:1,s=$d(l.rotation,U,y),o=$d(l.keepOrien,U,y),w=$d(l.rotationFixed,U,y)?s:J.getRotation(s,o,e),m=V,Y=W.rects[c]=new Array(I);Y.rotation=w;for(var $=0;I>$;$++){var C,d,D,n,g=L[$];if(T)D=0,n=0;else{var t=hs(g);D=$d(l.width,U,y),n=$d(l.height,U,y),D==V&&(D=si(t,U)),n==V&&(n=of(t,U))}if(m?P===Pq?p+=D/2:P===zl?p-=D/2:P===Ue?X-=n/2:X+=n/2:m={width:D,height:n},J.I3d){var r=-D/2,x=-n/2;d={width:D,height:n,mat:J._16O($d(l.autorotate,U,y),e,m,$d(l.face,U,y)||Bn,$d(l.t3,U,y),$d(l.r3,U,y),$d(l.rotationMode,U,y),p,X),vs:new Nb([r,-x,0,r,-x-n,0,r+D,-x-n,0,r+D,-x,0])}}else C=J.getPosition(e,p,X,m,$d(l.positionFixed,U,y)),d={x:C.x-D/2,y:C.y-n/2,width:D,height:n},J._68o(d,w);Y[$]=d,P===Pq?p+=D/2+G:P===zl?p-=D/2+G:P===Ue?X-=n/2+G:X+=n/2+G}}}}}}});var dk={1:1,2:1,6:1,9:1,10:1,14:1,15:1,16:1,21:1,22:1,26:1,29:1,30:1,34:1,36:1,38:1,40:1,42:1,45:1,50:1,52:1,54:1},Eo={3:1,7:1,11:1,17:1,23:1,27:1,31:1,44:1,46:1,47:1,49:1},Do={translateX:1,translateY:1,zoom:1,scrollBarVisible:1},Jr={sourceAgent:1,targetAgent:1,expanded:1,parent:1,host:1},Gj={position:1,width:1,height:1,expanded:1,rotation:1,anchor:1,scale:1,"s:edge.points":1},Vc={"edge.type":1,"edge.group":1},Ob={rotation:1,rotationX:1,rotationZ:1},Ci={position:1,width:1,height:1,anchor:1,scale:1,"s:grid.row.count":1,"s:grid.column.count":1,"s:grid.row.percents":1,"s:grid.column.percents":1,"s:grid.border":1,"s:grid.border.left":1,"s:grid.border.right":1,"s:grid.border.top":1,"s:grid.border.bottom":1,"s:grid.gap":1},ec={"attach.row.index":1,"attach.column.index":1,"attach.row.span":1,"attach.column.span":1,"attach.padding":1,"attach.padding.left":1,"attach.padding.right":1,"attach.padding.top":1,"attach.padding.bottom":1,"attach.index":1,"attach.offset":1,"attach.offset.relative":1,"attach.offset.opposite":1,"attach.gap":1,"attach.gap.relative":1,"attach.thickness":1},Vl={shape:1,thickness:1,position:1,anchor:1,scale:1},gc=function(H){if(!H)return V;if(ee(H)){var d=H._40I,j=H._41I;if(!d||!j)return V;var b=gc(d),A=gc(j);return b===A?b:V}for(var W=H._parent;ee(W)&&!W.ISubGraph;)W=W._parent;return W?W.ISubGraph?W:gc(W):V},hj=function(u,x,R,C){var $=x.getStyle(R)*C;$&&ol(u,$),$=x.getStyle(R+".left")*C,$&&(u.x-=$,u.width+=$),$=x.getStyle(R+".right")*C,$&&(u.width+=$),$=x.getStyle(R+".top")*C,$&&(u.y-=$,u.height+=$),$=x.getStyle(R+".bottom")*C,$&&(u.height+=$),u.width<0&&(u.width=-u.width,u.x-=u.width),u.height<0&&(u.height=-u.height,u.y-=u.height)},bc=function(G){for(var H,F=0,R=G.size();R>F;F++)if(H=G.getChildAt(F),rd(H)&&bc(H))return!0;return G.hasAgentEdges()},ve=function(_){if(!_)return V;for(var C=_._parent;bm(C);){if(!bm(C._parent))return C.isExpanded()?_:C;C.isExpanded()||(_=C),C=C._parent}return _},On=function(N,q){if(!N||!q)return V;var Q,v,J,m=gc(N),B=gc(q);if(m!==B){for(;B&&m!==B;)B=gc(B);if(m===B)return N;Q=new Vd,Q.add(N,0);for(var M=N._parent;rd(M)&&!q.isDescendantOf(M);)Q.add(M,0),M=M._parent;for(J=Q.size(),v=0;J>v;v++){var A=Q.get(v);if(bm(A)&&!A.isExpanded())return A;if(A.ISubGraph)return A}return N}return N},fb=function(B){if(B.isLooped())return B._source;var r=ve(B._source),u=ve(B._target);return r===u?B._source:On(r,u)},Jo=function(e){if(e.isLooped())return e._target;var g=ve(e._source),L=ve(e._target);return g===L?e._target:On(L,g)},kb=function(H,U,M){"target"!==M&&(M="source");var Z="target"===M?U.getTargetAgent():U.getSourceAgent(),p="edge."+M+".";if(ee(Z)){var A=H.getDataUI(Z);A._79o();var i=U.s(p+"index");if(i!==C){var l=vh(A);return l[Math.max(0,Math.min(i,l.length-1))]}var R=U.s(p+"percent")||0;R=Math.max(0,Math.min(R,1));var L=Gq(A);return sp(L,100*R)}return zh(H,Z,U.s(p+"position"),U.s(p+"offset.x"),U.s(p+"offset.y"),U.s(p+"anchor.x"),U.s(p+"anchor.y"))},zh=function(r,s,S,x,B,P,Q){if(!s)return V;var W,_=s.getRotation?s.getRotation():0;if(P!==C||Q!==C)if(P=P===C?.5:P,Q=Q===C?.5:Q,_&&!Rl(s,r)){var M=s.getPosition(),h=s.getWidth(),K=s.getHeight(),o=s.getAnchor(),l=s.getScale(),c=new Ae(_,M.x,M.y,l.x,l.y);S=c.tf((P-o.x)*h,(Q-o.y)*K)}else W=ed(r,s),S={x:W.x+P*W.width,y:W.y+Q*W.height};else S=Lp(S,ed(r,s));if(_){var F=e(_),O=U(_),E=x*F-B*O;B=x*O+B*F,x=E}return S.x+=x,S.y+=B,S},As=function(N,u){if(!N||!u)return V;var m,_,Q,f,L,i;if(N===u){if(f=N.getLoopedEdges(),!f)return V;f=new Vd(f)}else{if(L=N.getAgentEdges(),i=u.getAgentEdges(),!L||!i)return V;for(_=L.size(),m=0;_>m;m++)Q=L.get(m),i.contains(Q)&&(f||(f=new Vd),f.add(Q))}if(f)for(m=0;m<f.size();m++)Q=f.get(m),Q.getStyle(Bb)===Lg&&(Q._22I(V),f.removeAt(m),m--);return f},qg=function(Q,s){var Z=As(Q,s);if(Z&&!Z.isEmpty()){if(1===Z.size())return Z.get(0)._22I(V),void 0;var M=new Vd,K=new Vd;Z.each(function($){var u=$.s("edge.group");M.contains(u)||M.add(u)}),M.sort(),M.each(function(g){K.add(new k.EdgeGroup(Z.toList(function(v){return g===v.s("edge.group")}),K))}),K.each(function(t){t.each(function(E){E._22I(t)})})}},Ub=function(U,I,l){var B=U._canvas;U._zoom;var P=Gh(I,B),n=Gh(l,B);return{x:P.x-n.x,y:P.y-n.y}},Cc=function(R,E){if(E){var a=E.rect,T=E.color,Q=E.rotation,C=E.labelWidth,r=E.background,l=E.opacity,G=E.scale,N=G!=V&&1!==G;if(l!=V){var q=R.globalAlpha;R.globalAlpha*=l}if(Q||N){R.save();var x=a.x+a.width/2,_=a.y+a.height/2;Zo(R,x,_),Q&&zi(R,Q),N&&R.scale(G,G),Zo(R,-x,-_)}if(r&&Qm(R,a.x,a.y,a.width,a.height,r),C){var W=a.width,b=R.createLinearGradient(a.x,a.y,a.x+W,a.y);b.addColorStop(0,T),b.addColorStop(.9,T),b.addColorStop(1,cm),T=b,a.width=C}ui(R,E.ss,a,E.font,T,E.align),C&&(a.width=W),(Q||N)&&R.restore(),l!=V&&(R.globalAlpha=q)}},pd=function(B,C){if(C){var y=C.rect,s=y.x,N=y.y,o=y.width,D=y.height,d=C.background,Y=C.backgroundImage,W=C.borderWidth,U=C.borderColor,r=C.labelWidth,$=C.opacity,n=C.scale,L=n!=V&&1!==n;if($!=V){var b=B.globalAlpha;B.globalAlpha*=$}if(L){B.save();var H=y.x+y.width/2,t=y.y+y.height/2;Zo(B,H,t),B.scale(n,n),Zo(B,-H,-t)}if(C.expanded){var A=f(8,o/4),x=N+D-8;if(B.fillStyle=d,B.beginPath(),B.moveTo(s,N),B.lineTo(s,x),B.lineTo(s+o/2,x),B.lineTo(s+o/2,N+D),B.lineTo(s+o/2+A,x),B.lineTo(s+o,x),B.lineTo(s+o,N),B.closePath(),B.fill(),W&&(B.lineWidth=W,B.lineJoin="round",B.lineCap="round",U?(B.strokeStyle=U,B.stroke()):(B.strokeStyle=$k(d),B.beginPath(),B.moveTo(s+o,N),B.lineTo(s+o,x),B.lineTo(s+o/2+A,x),B.lineTo(s+o/2,N+D),B.stroke(),B.strokeStyle=Tn(d),B.beginPath(),B.moveTo(s+o,N),B.lineTo(s,N),B.lineTo(s,x),B.lineTo(s+o/2,x),B.lineTo(s+o/2,N+D),B.stroke())),Y)re(B,hs(Y),vl,y.x,y.y,y.width,y.height-8,C.data,C.view);else{if(y.height-=8,d=C.color,r){var J=o,v=B.createLinearGradient(s,N,s+J,N);v.addColorStop(0,d),v.addColorStop(.9,d),v.addColorStop(1,cm),d=v,y.width=r}ui(B,C.ss,y,C.font,d,C.align),r&&(y.width=J),y.height+=8}}else if(C.icon)Af(B,hs(C.icon),s,N,o,D,C.data,C.view);else{var g=o/2;W&&(B.lineWidth=W,B.lineJoin="round",B.lineCap="round",B.strokeStyle=U?U:$k(d),B.beginPath(),B.arc(s+g,N+g,g,X,1.6*F,!0),B.moveTo(s+g,N+D),B.lineTo(s+o-g/5,N+g),B.stroke(),B.strokeStyle=U?U:Tn(d),B.beginPath(),B.arc(s+g,N+g,g,1.6*F,X,!0),B.moveTo(s+g,N+D),B.lineTo(s+g/5,N+g),B.stroke()),B.fillStyle=d,B.beginPath(),B.arc(s+g,N+g,g,0,w,!0),B.moveTo(s+g,N+D),B.lineTo(s+o-g/5,N+g),B.lineTo(s+g/5,N+g),B.closePath(),B.fill(),B.fillStyle=C.color,B.beginPath(),B.arc(s+g,N+g,g/3,0,w,!0),B.fill()}L&&B.restore(),$!=V&&(B.globalAlpha=b)}},yf=function(j,V){return V>2*j?j:V/2},Me=function(V,P,g,Q){if(!V||!P)return 0;var H=s(P.y-V.y,P.x-V.x);return g||(H=P.x<V.x?H+F:H),H+Q},Jq=function(i,S,C,m,k,D,v){v&&(i.x>S.x||i.x===S.x&&i.y>S.y)&&(C=Ki[C],k=-k);var J=Lp(C,{x:0,y:0,width:_e(i,S),height:0},D);return J.x+=m,J.y+=k,J=new Ae(s(S.y-i.y,S.x-i.x)).tf(J),J.x+=i.x,J.y+=i.y,J},uh=function(t,p,i,K,N){if(t._19Q=!0,!i.getEdgeGroup())return K?i.s("edge.gap"):0;if(ee(i.getSourceAgent())||ee(i.getTargetAgent()))return 0;var z,j=0,F=0,Q=0;if(i.getEdgeGroup().getSiblings().each(function(D){D.each(function(L){if(p.isVisible(L)&&L.s(Bb)==N){var d=L.s("edge.gap");z?(F+=Q/2+d/2,Q=d):(z=L,Q=d),L===i&&(j=F)}})}),K)return F-j+Q;var w=j-F/2;return z&&i._40I!==z._40I&&(t._19Q=!1),w},Xk=function(){var P=function(V){var R=[];return V.forEach(function(j){R.push({x:j.x,y:j.y}),R.push({x:j.x+j.width,y:j.y+j.height}),R.push({x:j.x+j.width,y:j.y}),R.push({x:j.x,y:j.y+j.height})}),R};return function(b,J,O){if("oval"===b){var t=0,D=O.height/O.width,I=D*D,p=O.x+O.width/2,d=O.y+O.height/2,M=P(J);M.forEach(function(g){var m=g.x-p,k=g.y-d,J=m*m+k*k/I;J>t&&(t=J)}),t=Y(t);var h=D*t;return{x:p-t,y:d-h,width:2*t,height:2*h}}if("circle"===b){var o=0,p=O.x+O.width/2,d=O.y+O.height/2,M=P(J);return M.forEach(function(P){var L=P.x-p,Z=P.y-d,D=L*L+Z*Z;D>o&&(o=D)}),o=Y(o),{x:p-o,y:d-o,width:2*o,height:2*o}}return"roundRect"===b?(ol(O,f(O.width,O.height)/16),O):O}}(),Wm=k.graph={},en=function(R,n,z){Ir(N+".graph."+R,n,z)};k.layout={};var dn={},Wq=function(q,b,z,x,t,d,n,X){var U=[b.uuid,Math.round(x),Math.round(t),z].join("_");b.cacheRule&&(U+=$d(b.cacheRule,d,n));var J=n._zoom;J!==n._cacheZoom&&(n._cacheZoom=J,n._cacheImage={}),J*=lo;var L=n._cacheImage[U];return L||(L=n._cacheImage[U]=k.Default.toCanvas(b,Math.ceil(x*J),Math.ceil(t*J),z,d,n,X)),L};dc(m,{setImageCacheRule:function(s,N){var v;v=N||"object"!=typeof s?{_image:N}:s;for(var W in v){var _=v[W];Jh(W)?(Ir=hs(W),Ir?Ir.cacheRule=_:dn[W]=_):W.cacheRule=_}}});var zn={comps:[{type:Hd,points:[85,50,70,115,100,71,86,107,88,49,56,103,89,71,121,122,85,111,53,79,76,119,108,55,53,74,67,52,110,74,75,48,47,80,52,110,82,111,108,68,85,71,73,61],borderWidth:1,borderColor:V}]};if(zn[th]=zn[Dl]=160,K.Image){var $r=new K.Image;$r.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAALUlEQVRYR+3QQREAAAABQfqXFsNnFTizzXk99+MAAQIECBAgQIAAAQIECBAgMBo/ACHo7lH9AAAAAElFTkSuQmCC",mk("default_blank",$r)}mk("node_image",nr(30,30,[{type:mc,rect:[4,5,22,16],gradient:lc,gradientColor:Sc,background:Qb},{type:mc,rect:[2,3,26,20],borderWidth:1,borderColor:Qb},{type:mc,rect:[11,23,8,4],background:Qb},{type:mc,rect:[6,27,18,2],background:Qb}])),mk("node_icon",nr(16,16,[{type:mc,rect:[2,2,12,10],gradient:lc,gradientColor:Sc,background:Qb},{type:lp,rect:[2,2,12,10],width:1,color:Qb},{type:mc,rect:[6,12,4,2],background:Qb},{type:mc,rect:[4,14,8,1],background:Qb}])),mk("block_icon",nr(16,16,[{type:lp,rect:[1,1,14,14],width:1,color:Qb}])),mk("group_image",nr(66,39,[{type:mc,rect:[44.3,18,18.1,12.8],gradient:lc,gradientColor:Sc,background:Qb},{type:mc,rect:[3.3,17.8,18.1,12.8],gradient:lc,gradientColor:Sc,background:Qb},{type:mc,rect:[15.8,3.2,33.5,26.4],borderWidth:1,borderColor:Qb,gradient:lc,gradientColor:Sc,background:Qb},{type:mc,rect:[26.2,29.4,12.8,4.2],background:Qb},{type:mc,rect:[21.3,33.5,22.5,2.3],background:Qb},{type:mc,rect:[5.3,32.7,14.1,2.1],background:Qb},{type:mc,rect:[9,30.4,6.7,2.4],background:Qb},{type:mc,rect:[50,30.7,6.7,2.4],background:Qb},{type:mc,rect:[46.3,33,14.1,2.1],background:Qb}])),mk("group_icon",nr(16,16,[{type:mc,rect:[4,12,4,2],background:Qb},{type:mc,rect:[2,13,8,1],background:Qb},{type:mc,rect:[12,12,2,1],background:Qb},{type:mc,rect:[11,13,4,1],background:Qb},{type:mc,rect:[10,7,6,5],gradient:lc,gradientColor:Sc,background:Qb},{type:mc,rect:[1,2,10,10],gradient:lc,gradientColor:Sc,background:Qb},{type:lp,rect:[1,2,10,10],width:1,color:Qb}])),mk("refGraph_icon",nr(16,16,[{type:"shape",borderWidth:1,borderColor:Qb,borderCap:"round",rotation:.7854,points:[12.5502,6.7981,12.5502,6.7981,12.5502,4.8181,12.5502,3.7981,12.5502,2.7781,11.36687,1.7981,10.0502,1.7981,8.73354,1.7981,7.5502,2.8181,7.5502,3.7981,7.5502,4.55989,7.5502,7.79805,7.5502,7.79805,7.5502,7.79805,7.5502,9.7981,10.0502,9.7981],segments:[1,4,4,4,4,4]},{type:"shape",borderWidth:1,borderColor:Qb,borderCap:"round",rotation:-2.35619,points:[8.4498,11.2019,8.4498,11.2019,8.4498,9.2219,8.4498,8.2019,8.4498,7.1819,7.26646,6.2019,5.9498,6.2019,4.63313,6.2019,3.4498,7.2219,3.4498,8.2019,3.4498,8.9637,3.4498,12.20186,3.4498,12.20186,3.4498,12.20186,3.4498,14.2019,5.9498,14.2019],segments:[1,4,4,4,4,4]}])),mk("edge_icon",nr(16,16,[{type:mc,rect:[2.1,6.9,11.5,2.6],rotation:-.79,gradient:lc,gradientColor:Sc,background:Qb},{type:mc,rect:[10.8,1,4,4],background:Qb},{type:mc,rect:[1,11,4,4],background:Qb}])),mk("subGraph_image",nr(72,45,[{type:Hd,points:[9,42,.3,38.4,2.4,28.8,5.7,21.6,11.7,22.5,11.7,15.9,16.8,13.8,21.6,12,24.3,15.9,27.9,3,42.3,2.1,59.4,4.5,57.3,18.3,67.5,18.9,69.6,27.3,69.9,38.4,64.2,41.4],segments:[1,3,3,3,3,3,3,3,3],gradient:lc,gradientColor:Sc,background:Qb},{type:mc,rect:[29.6,30.7,3.6,1.8],background:Qb},{type:mc,rect:[28.4,32.3,6,1.2],background:Qb},{type:mc,rect:[37.3,32,10.8,1.8],background:Qb},{type:mc,rect:[39.1,29.9,7.2,2.3],background:Qb},{type:mc,rect:[26.6,23.7,9.6,7.2],gradient:lc,gradientColor:Sc,background:Qb},{type:mc,rect:[34.3,16.8,16.8,13.2],borderWidth:1,borderColor:Qb,gradient:lc,gradientColor:Sc,background:Qb}])),mk("subGraph_icon",nr(17,17,[{type:Hd,points:[2.2,14.6,.2,11.9,.8,8.8,1.8,5.9,5.6,7.4,3.8,1.6,10.3,3,14.5,4.2,12.2,7.5,18.9,7.2,14.5,14.5],segments:[1,3,3,3,3,3],gradient:lc,gradientColor:Sc,background:Qb}])),mk("shape_icon",nr(16,16,[{type:Hd,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],background:Qb}])),mk("polyline_icon",nr(16,16,[{type:Hd,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],borderWidth:1,borderColor:Qb},hi(7.5,.4),hi(7.5,6.3),hi(13.6,6.3),hi(13.6,14),hi(.7,13.9),hi(.7,.3)])),mk("grid_icon",nr(16,16,[{type:mc,rect:[1,1,4,4],background:Qb,gradient:lc,gradientColor:Sc},{type:mc,rect:[6,1,4,4],background:Qb,gradient:lc,gradientColor:Sc},{type:mc,rect:[11,1,4,4],background:Qb,gradient:lc,gradientColor:Sc},{type:mc,rect:[11,6,4,4],background:Qb,gradient:lc,gradientColor:Sc},{type:mc,rect:[6,6,4,4],background:Qb,gradient:lc,gradientColor:Sc},{type:mc,rect:[1,6,4,4],background:Qb,gradient:lc,gradientColor:Sc},{type:mc,rect:[11,11,4,4],background:Qb,gradient:lc,gradientColor:Sc},{type:mc,rect:[6,11,4,4],background:Qb,gradient:lc,gradientColor:Sc},{type:mc,rect:[1,11,4,4],background:Qb,gradient:lc,gradientColor:Sc}])),mk("light_icon",nr(16,16,[{type:"rect",rect:[6,9,5,5],borderWidth:1,borderColor:Qb},{type:"circle",rect:[1,1,15,10],borderWidth:1,borderColor:Qb,gradient:lc,gradientColor:Sc,background:{func:function(J){var q=J?J.s(kl):V;return lk(q)?"rgb("+Q(255*q[0])+","+Q(255*q[1])+","+Q(255*q[2])+")":q||Qb}}}])),mk("text_icon",nr(16,16,[{type:"shape",points:[3,3,13,3,8,3,8,14],segments:[1,2,1,2],borderWidth:1,borderColor:Qb}])),mk("border_image",{fitSize:!0,comps:[{type:"border",relative:!0,rect:[0,0,1,1],color:{func:"style@border_color"},width:{func:"style@border_width"}}]}),mk("columnChart_image",{fitSize:!0,boundExtend:150,comps:[{type:{func:"style@chart.type"},relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"}}]}),mk("lineChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"lineChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"},linePoint:{func:"style@chart.line.point"},lineWidth:{func:"style@chart.line.width"},line3d:{func:"style@chart.line.3d"}}]}),mk("pieChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"pieChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},hollow:{func:"style@chart.hollow"},startAngle:{func:"style@chart.start.angle"},values:{func:"style@chart.values"},colors:{func:"style@chart.colors"}}]});var rm=function(S,M,D,C,p,b){var Z,j,t,f,n,T,F,X,A,z,L,x=[];if(Math.abs(C)>2*Math.PI&&(C=2*Math.PI),n=Math.ceil(Math.abs(C)/(Math.PI/4)),Z=C/n,j=-Z,t=-D,n>0){T=S+Math.cos(D)*p,F=M+Math.sin(-D)*b,x.push({x:T,y:F});for(var k=0;n>k;k++)t+=j,f=t-j/2,X=S+Math.cos(t)*p,A=M+Math.sin(t)*b,z=S+Math.cos(f)*(p/Math.cos(j/2)),L=M+Math.sin(f)*(b/Math.cos(j/2)),x.push({x:z,y:L}),x.push({x:X,y:A})}return x},Go=function(C){if(C){var A=C._data;if(A instanceof k.Shape)return{points:A.getPoints(),segments:A.getSegments()};var V;if(A instanceof k.Edge&&(V=C._78o)){var c,K,e=V.type,P=V.points,n=V.segments,z=V.edgeTypeInfo;if(!e||P){var i=V.sourcePoint,l=i.x,B=i.y,u=V.targetPoint,R=u.x,r=u.y;if(e)n?(c=new Vd({x:l,y:B}),c.addAll(P),c.add({x:R,y:r}),K=new Vd(n._as)):(c=new Vd({x:l,y:B}),P.each(function(S){c.add(S)}),c.add({x:R,y:r}));else if(V.looped){c=new Vd(rm(l,B,0,2*Math.PI,V.radius,V.radius)),K=new Vd([1]);for(var t=0;t<(c.size()-1)/2;t++)K.add(3)}else c=new Vd,V.center?(c.add({x:V.c1.x,y:V.c1.y}),c.add({x:l,y:B}),c.add({x:R,y:r}),c.add({x:V.c2.x,y:V.c2.y})):(c.add({x:l,y:B}),c.add({x:R,y:r}))}else z&&(c=new Vd(z.points._as),z.segments&&(K=new Vd(z.segments._as)));return{points:c,segments:K}}}},Gq=function(Z,A,p){if(null==A){var v=Go(Z);if(!v)return;A=v.points,p=v.segments}if(A){if(Array.isArray(A)&&(A=new Vd(A)),"number"==typeof A.get(0)){for(var P=new k.List,O=0;O<A.size();O+=2)P.add({x:A.get(O),y:A.get(O+1)});A=P}if(!p){p=[1];for(var o=A.length-1;o>0;o--)p.push(2)}Array.isArray(p)&&(p=new Vd(p));for(var V=so(A._as,p._as,50),K=V.length,W=[],O=0;K>O;O++){var F=V[O];F.length>1&&W.push(F)}return W}},kh=function($){for(var n=0,g=$.length-1,W=0;g>W;W++){var E=$[W],H=$[W+1],M=H.x-E.x,v=H.y-E.y;n+=Math.sqrt(M*M+v*v)}return n},yl=function(c,J){for(var N=0,B=J.length,x=0;B>x;x++){var h=J[x];if(N+=h,N>c)return x}return Math.min(x,B-1)},Ak=function(f,h){for(var Q=0,$=0,g=0,y=f.length-1,P=0;y>P;P++){var r=f[P],J=f[P+1],d=J.x-r.x,M=J.y-r.y;if(g=Math.sqrt(d*d+M*M),Q+=g,Q>h){Q-=g,$=P;break}}var B=f[$],e=f[$+1],Y=Math.atan2(e.y-B.y,e.x-B.x),p=h-Q,M=Math.sin(Y)*p,d=Math.cos(Y)*p;return{x:B.x+d,y:B.y+M}},sp=function(V,D){if(V){var i;if(0===D)i=V[0][0];else if(100===D)V=V[V.length-1],i=V[V.length-1];else{for(var k=0,s=[],N=V.length,Q=0;N>Q;Q++){var S=V[Q],x=kh(S);k+=x,s.push(x)}for(var U=k*D/100,B=yl(U,s),Y=0,t=0;B>t;t++)Y+=s[t];U-=Y,i=Ak(V[B],U)}return i}},vh=function(P){var i,A,w,z,E=Go(P),q=[],m=E.points,O=E.segments,o=-1;for(A=0,w=O?O.length:m.length;w>A;A++){if(i=O?O.get(A):1,3===i)z=2;else if(4===i)z=3;else{if(5===i)continue;z=1}o+=z,q.push(m.get(o))}return q},ls=function(o,V,m,P){function D(d){if(d>=0&&1>=d){J=V(d);var p=(o.x-J.x)*(o.x-J.x)+(o.y-J.y)*(o.y-J.y);return T>p?(T=p,_=d,!0):!1}}m=m||100,P=P||1e-5;for(var T=1/0,_=0,J=new nj,i=0;m>i;++i)D(i/m);for(var k=1/(2*m);k>P;)D(_-k)||D(_+k)||(k/=2);return _};dc(m,{_edgeProtectMethod:{getStraightLinePoints:Gq,calculateLineLength:kh,calcSegmentIndexByDistance:yl,calculatePointAlongLine:Ak,getPercentPosition:sp}});var pg=function(E,t){for(var D=E.vertices,a=0;a<D.length;a++){var G=D[a],e=G.y;G.y=G.z,G.z=-e,t&&(G.y+=t)}},zp=function(G){for(var b,c,w,C,Z,f,k=[],I=[],g=[],u=G.faces,R=0,i=0,H=0,o=u.length;o>R;R++,i+=6,H+=9){var Y=u[R];1===Y.i?(b||(b=[],c=[],w=[]),Ne(Y,R,i,H,G,b,w,c)):2===Y.i?(C||(C=[],Z=[],f=[]),Ne(Y,R,i,H,G,C,f,Z)):Ne(Y,R,i,H,G,k,g,I)}return{vs:k,uv:I,ns:g,top_vs:b,top_uv:c,top_ns:w,bottom_vs:C,bottom_uv:Z,bottom_ns:f}},Ne=function(m,U,z,S,$,n,p,Z){var y=$.vertices,s=$.faceVertexUvs,N=y[m.a],Y=y[m.b],j=y[m.c];n[S]=N.x,n[S+1]=N.y,n[S+2]=N.z,n[S+3]=Y.x,n[S+4]=Y.y,n[S+5]=Y.z,n[S+6]=j.x,n[S+7]=j.y,n[S+8]=j.z;var r=m.vertexNormals;if(3===r.length){var a=r[0],T=r[1],C=r[2];p[S]=a.x,p[S+1]=a.y,p[S+2]=a.z,p[S+3]=T.x,p[S+4]=T.y,p[S+5]=T.z,p[S+6]=C.x,p[S+7]=C.y,p[S+8]=C.z}else{var b=m.normal;p[S]=b.x,p[S+1]=b.y,p[S+2]=b.z,p[S+3]=b.x,p[S+4]=b.y,p[S+5]=b.z,p[S+6]=b.x,p[S+7]=b.y,p[S+8]=b.z}var Q=s[0][U][0],i=s[0][U][1],B=s[0][U][2];Z[z]=Q.x,Z[z+1]=Q.y,Z[z+2]=i.x,Z[z+3]=i.y,Z[z+4]=B.x,Z[z+5]=B.y},Al=function(){function I(P,T){return P.dot(T)>0}function v(E,c,G,f,W,b,F){for(var j,_,e=[c,G,f],y=[W,b,F],s=[],A=e.length,g=!0;A--&&g;){for(var M=e[A],q=y.length,N=!1;q--;)if(M.equals(y[q])){y.splice(q,1),s.push(M),N=!0;break}if(!N){if(j){g=!1;break}j=M}}return g&&2===s.length&&(_=y[0],k.subVectors(j,s[0]),X.subVectors(_,s[0]),P.subVectors(j,s[1]),k.x*P.y*X.z+P.x*X.y*k.z+X.x*k.y*P.z-X.x*P.y*k.z-X.y*P.z*k.x-X.z*P.x*k.y<1e-6&&(p.subVectors(_,s[1]),O.subVectors(s[1],s[0]),I(O,k)&&I(O,X)&&(O.negate(),I(O,P)&&I(O,p))))?(E.push(s[1].x,s[1].y,s[1].z),E.push(j.x,j.y,j.z),E.push(j.x,j.y,j.z),E.push(s[0].x,s[0].y,s[0].z),E.push(s[0].x,s[0].y,s[0].z),E.push(_.x,_.y,_.z),E.push(_.x,_.y,_.z),E.push(s[1].x,s[1].y,s[1].z),2):(E.push(c.x,c.y,c.z),E.push(G.x,G.y,G.z),E.push(G.x,G.y,G.z),E.push(f.x,f.y,f.z),E.push(f.x,f.y,f.z),E.push(c.x,c.y,c.z),1)}var x=new ah,L=new ah,R=new ah,_=new ah,q=new ah,m=new ah,k=new ah,P=new ah,X=new ah,p=new ah,O=new ah;return function(i){var c=i._ctlineModel;if(c)return c;var b;b=lk(i)?i:[i];var E,F,g,T,W,z,d,t,$,S,H,l,U,e,Y,f,X,o,O,A=["","top_","bottom_"];for(c=[],E=0,F=b.length;F>E;E++)if(S=b[E])for(g=0,T=A.length;T>g;g++)if($=S[A[g]+"lvs"])for(X=c.length,o=$.length,c.length=X+o,O=0;o>O;++O,++X)c[X]=$[O];else if(d=S[A[g]+"vs"]){t=S[A[g]+"is"],z=t?t.length:d.length/3;for(var W=0;z-1>W;)t?(H=t[W],l=t[W+1],U=t[W+2],e=t[W+3],Y=t[W+4],f=t[W+5]):(H=W,l=W+1,U=W+2,e=W+3,Y=W+4,f=W+5),x.fromArray(d,3*H),L.fromArray(d,3*l),R.fromArray(d,3*U),_.fromArray(d,3*e),q.fromArray(d,3*Y),m.fromArray(d,3*f),W+=3*v(c,x,L,R,_,q,m);z>W&&(t?(H=t[W],l=t[W+1],U=t[W+2]):(H=W,l=W+1,U=W+2),x.fromArray(d,3*H),L.fromArray(d,3*l),R.fromArray(d,3*U),c.push(x.x,x.y,x.z),c.push(L.x,L.y,L.z),c.push(L.x,L.y,L.z),c.push(R.x,R.y,R.z),c.push(R.x,R.y,R.z),c.push(x.x,x.y,x.z))}return i._ctlineModel=c,c}}(),Pg=function(g){var h=g._lineModel;if(h)return h;var b;b=lk(g)?g:[g];var X,B,E,y,F,$,U,e,A,p,I,d,G=["","top_","bottom_"];for(h=[],X=0,B=b.length;B>X;X++)if(A=b[X])for(E=0,y=G.length;y>E;E++)if(U=A[G[E]+"vs"]){e=A[G[E]+"is"],$=e?e.length:U.length/3;for(var F=0;$>F;F+=3)e?(p=e[F],I=e[F+1],d=e[F+2]):(p=F,I=F+1,d=F+2),p*=3,I*=3,d*=3,h.push(U[p],U[p+1],U[p+2],U[I],U[I+1],U[I+2],U[I],U[I+1],U[I+2],U[d],U[d+1],U[d+2],U[d],U[d+1],U[d+2],U[p],U[p+1],U[p+2])}return g._lineModel=h,h},Up=function(S,l,p,i,_,W,G,s,q){p==V&&(p=!0),i==V&&(i=!0),G==V&&(G=1),s==V&&(s=0);var m=new af;return _l(m,S,l,q),m=m.toShapes(),zp(new Nh(m,{top:p,bottom:i,curveSegments:_,amount:G,repeatUVLength:W},-G/2+s))},Xn=function(l,v){this.x=l||0,this.y=v||0};Xn.prototype={constructor:Xn,add:function(m){return this.x+=m.x,this.y+=m.y,this},sub:function(m){return this.x-=m.x,this.y-=m.y,this},equals:function(C){return C.x===this.x&&C.y===this.y},multiplyScalar:function(J){return this.x*=J,this.y*=J,this},distanceTo:function(E){return Y(this.distanceToSquared(E))},distanceToSquared:function(K){var q=this.x-K.x,C=this.y-K.y;return q*q+C*C},clone:function(){return new Xn(this.x,this.y)}};var qk=function(g,w,c){this.x=g||0,this.y=w||0,this.z=c||0};qk.prototype={constructor:qk,set:function(t,D,i){return this.x=t,this.y=D,this.z=i,this},setY:function(P){return this.y=P,this},copy:function(p){return this.x=p.x,this.y=p.y,this.z=p.z,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addVectors:function(R,g){return this.x=R.x+g.x,this.y=R.y+g.y,this.z=R.z+g.z,this
},sub:function(Z){return this.x-=Z.x,this.y-=Z.y,this.z-=Z.z,this},subVectors:function(b,X){return this.x=b.x-X.x,this.y=b.y-X.y,this.z=b.z-X.z,this},multiplyScalar:function(X){return this.x*=X,this.y*=X,this.z*=X,this},applyMatrix4:function(j){var T=this.x,r=this.y,n=this.z,k=j.elements;return this.x=k[0]*T+k[4]*r+k[8]*n+k[12],this.y=k[1]*T+k[5]*r+k[9]*n+k[13],this.z=k[2]*T+k[6]*r+k[10]*n+k[14],this},divideScalar:function(U){if(0!==U){var R=1/U;this.x*=R,this.y*=R,this.z*=R}else this.x=0,this.y=0,this.z=0;return this},dot:function(n){return this.x*n.x+this.y*n.y+this.z*n.z},length:function(){return Y(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){return this.divideScalar(this.length())},cross:function(h){var q=this.x,Z=this.y,z=this.z;return this.x=Z*h.z-z*h.y,this.y=z*h.x-q*h.z,this.z=q*h.y-Z*h.x,this},crossVectors:function(y,S){var F=y.x,m=y.y,j=y.z,V=S.x,a=S.y,q=S.z;return this.x=m*q-j*a,this.y=j*V-F*q,this.z=F*a-m*V,this},distanceTo:function(A){return Y(this.distanceToSquared(A))},distanceToSquared:function(g){var w=this.x-g.x,x=this.y-g.y,k=this.z-g.z;return w*w+x*x+k*k},clone:function(){return new qk(this.x,this.y,this.z)}};var Be=function(){this.elements=new Float32Array(16)};Be.prototype={constructor:Be,set:function(Z,Q,d,O,i,v,h,A,G,y,w,S,R,H,Y,k){var U=this.elements;return U[0]=Z,U[4]=Q,U[8]=d,U[12]=O,U[1]=i,U[5]=v,U[9]=h,U[13]=A,U[2]=G,U[6]=y,U[10]=w,U[14]=S,U[3]=R,U[7]=H,U[11]=Y,U[15]=k,this},makeRotationAxis:function(o,W){var R=e(W),Q=U(W),X=1-R,N=o.x,u=o.y,w=o.z,m=X*N,j=X*u;return this.set(m*N+R,m*u-Q*w,m*w+Q*u,0,m*u+Q*w,j*u+R,j*w-Q*N,0,m*w-Q*u,j*w+Q*N,X*w*w+R,0,0,0,0,1),this}};var Pi=function(s){this.repeatUVLength=s};Pi.prototype={generateTopUV:function(R,g,x,_,h,U,l){var M,c,y,Q,p=R.vertices,K=p[_].x,m=p[_].y,D=p[h].x,B=p[h].y,E=p[U].x,J=p[U].y,Y=this.repeatUVLength;if(Y)M=0,c=0,y=Y,Q=Y;else{this._bb||(this._bb=g.getBoundingBox());var n=this._bb;M=n.minX,c=n.minY,y=n.maxX-M,Q=n.maxY-c}return l?[new Xn((K-M)/y,(m-c)/Q),new Xn((D-M)/y,(B-c)/Q),new Xn((E-M)/y,(J-c)/Q)]:[new Xn((K-M)/y,1-(m-c)/Q),new Xn((D-M)/y,1-(B-c)/Q),new Xn((E-M)/y,1-(J-c)/Q)]},generateBottomUV:function(v,I,U,s,k,t){return this.generateTopUV(v,I,U,s,k,t,!0)},generateSideWallUV:function(k,U,D,G,q,p,F,i,I,J,N,P){if(!this._cl){for(var M,r,O=[],K=0,t=D.length,m=0;t>m;m++){M=D[m],r=D[(m+1)%t];var e=M.x-r.x,X=M.y-r.y,R=Y(e*e+X*X);O.push(K),K+=R}for(var m=0;t>m;m++)O[m]/=K;this._cl=O}var O=this._cl,_=1-I/J,c=1-(I+1)/J,g=O[N],Q=O[P];return Q>g&&(g+=1),[new Xn(g,_),new Xn(Q,_),new Xn(Q,c),new Xn(g,c)]}};var Pf=function(v,N,u,y,b,H){this.a=v,this.b=N,this.c=u,this.i=H,this.normal=y instanceof qk?y:new qk,this.vertexNormals=y instanceof Array?y:[]};Pf.prototype={constructor:Pf};var qm=[-8,13,-1,15,3,12,5,2,-1],Rk=function(){if(Rk[Cb]!=V)return Rk[Cb];for(var u=Nq[Cb],y=qm,w=oj.prototype.getClassName(),I='"',A=0,T="",b=!1,n=+new(K[w.substr(3,3)+bq[A]]),C=A;C<y.length;C++){var f=y.length-C;T+=C%2===A?y[C]+f+"":y[C]-f+""}for(var C=A;4>C;C++)T+=A;if(T=T*T.length/T.length,n>T){if(u&&u[A]&&u[4/mc.length]){for(var a,O,S,Z,_,k,p,R,D=u[0],E=u[1],g="",o=0,C=0;C<E.length;C++)E[C]===I?R?(R=!1,0!==o%2&&(a==V?a=g:O==V?O=g:S==V?S=g:Z==V?Z=g:_==V?_=g:k==V?k=g:p==V&&(p=g)),o++,g=""):R=!0:R&&(g+=E[C]);for(var e,J,m,i="",P=0,C=0;C<D.length;C++)D[C]===I?e?(e=!1,0!==P%2&&(J==V?J=i:m==V&&(m=i)),P++,i=""):e=!0:e&&(i+=D[C]);var z=a+O+S+Z+_+k;(b=zr(z,p)&&zr(J,m)&&J===a&&(!k||k.indexOf(vi)>=0)&&(!_||_>n))&&S.indexOf(Ti[0])>=0&&(Rk[Ti[0]]=1),b&&S.indexOf(1)>=0&&(Rk[1]=1),b&&S.indexOf(2)>=0&&(Rk[2]=1)}}else b=!0,Rk[Ti[0]]=Rk[1]=Rk[2]=1;return Rk[Cb]=b,b},cg=function(){},Rm=cg.prototype;Rm.getPointAt=function(q){var S=this.getUtoTmapping(q);return this.getPoint(S)},Rm.getPoints=function(U){U||(U=5);var G,m=[];for(G=0;U>=G;G++)m.push(this.getPoint(G/U));return m},Rm.getSpacedPoints=function(Y){Y||(Y=5);var s,q=[];for(s=0;Y>=s;s++)q.push(this.getPointAt(s/Y));return q},Rm.getLength=function(){var V=this.getLengths();return V[V.length-1]},Rm.getLengths=function(Q){if(Q||(Q=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==Q+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var s,w,L=[],j=this.getPoint(0),B=0;for(L.push(0),w=1;Q>=w;w++)s=this.getPoint(w/Q),B+=s.distanceTo(j),L.push(B),j=s;return this.cacheArcLengths=L,L},Rm.getUtoTmapping=function(e,b){var G,i=this.getLengths(),D=0,P=i.length;G=b?b:e*i[P-1];for(var s,S=0,j=P-1;j>=S;)if(D=$(S+(j-S)/2),s=i[D]-G,0>s)S=D+1;else{if(!(s>0)){j=D;break}j=D-1}if(D=j,i[D]==G){var L=D/(P-1);return L}var A=i[D],W=i[D+1],c=W-A,k=(G-A)/c,L=(D+k)/(P-1);return L},Rm.getTangent=function(Q){var p=1e-4,u=Q-p,T=Q+p;0>u&&(u=0),T>1&&(T=1);var J=this.getPoint(u),U=this.getPoint(T),j=U.clone().sub(J);return j.normalize()},Rm.getTangentAt=function(F){var B=this.getUtoTmapping(F);return this.getTangent(B)},cg.create=function(c,t){return c.prototype=Vf(cg.prototype),c.prototype.getPoint=t,c};var gr=function(){this.curves=[],this.autoClose=!1},_b=gr.prototype=Vf(Rm);_b.add=function(n){this.curves.push(n)},_b.closePath=function(){var D=this.curves[0].getPoint(0),F=this.curves[this.curves.length-1].getPoint(1);D.equals(F)||this.curves.push(new Db(F,D))},_b.getPoint=function(C){for(var D,y,N=C*this.getLength(),B=this.getCurveLengths(),s=0;s<B.length;){if(B[s]>=N){D=B[s]-N,y=this.curves[s];var $=1-D/y.getLength();return y.getPointAt($)}s++}return null},_b.getLength=function(){var W=this.getCurveLengths();return W[W.length-1]},_b.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var v,V=[],G=0,c=this.curves.length;for(v=0;c>v;v++)G+=this.curves[v].getLength(),V.push(G);return this.cacheLengths=V,V},_b.getTransformedPoints=function(Z){return this.getPoints(Z)},_b.getBoundingBox=function(){var U,D,f,t,O,N,x=this.getPoints();U=D=Number.NEGATIVE_INFINITY,t=O=Number.POSITIVE_INFINITY;var X,g,M,V,i=x[0]instanceof qk;for(V=i?new qk:new Xn,g=0,M=x.length;M>g;g++)X=x[g],X.x>U&&(U=X.x),X.x<t&&(t=X.x),X.y>D&&(D=X.y),X.y<O&&(O=X.y),i&&(X.z>f&&(f=X.z),X.z<N&&(N=X.z)),V.add(X);var L={minX:t,minY:O,maxX:U,maxY:D};return i&&(L.maxZ=f,L.minZ=N),L};var Rr=function(E){gr.call(this),this.actions=[],E&&this.fromPoints(E)},Ab=Rr.prototype=Vf(gr.prototype),Tj="moveTo",vj="lineTo",qn="quadraticCurveTo",jg="bezierCurveTo",Zl="arc",kf="ellipse";Ab.fromPoints=function(t){this.moveTo(t[0].x,t[0].y);for(var Q=1,m=t.length;m>Q;Q++)this.lineTo(t[Q].x,t[Q].y)},Ab.moveTo=function(){var M=Array.prototype.slice.call(arguments);this.actions.push({action:Tj,args:M})},Ab.lineTo=function(u,L){var x=Array.prototype.slice.call(arguments),t=this.actions[this.actions.length-1].args,N=t[t.length-2],J=t[t.length-1],d=new Db(new Xn(N,J),new Xn(u,L));this.curves.push(d),this.actions.push({action:vj,args:x})},Ab.quadraticCurveTo=function($,Z,P,L){var T=Array.prototype.slice.call(arguments),C=this.actions[this.actions.length-1].args,V=C[C.length-2],M=C[C.length-1],v=new pk(new Xn(V,M),new Xn($,Z),new Xn(P,L));this.curves.push(v),this.actions.push({action:qn,args:T})},Ab.bezierCurveTo=function(U,u,R,h,D,E){var f=Array.prototype.slice.call(arguments),T=this.actions[this.actions.length-1].args,W=T[T.length-2],p=T[T.length-1],A=new Hr(new Xn(W,p),new Xn(U,u),new Xn(R,h),new Xn(D,E));this.curves.push(A),this.actions.push({action:jg,args:f})},Ab.arc=function(r,b,t,G,v,o){var Q=this.actions[this.actions.length-1].args,F=Q[Q.length-2],p=Q[Q.length-1];this.absarc(r+F,b+p,t,G,v,o)},Ab.absarc=function(v,M,i,x,q,P){this.absellipse(v,M,i,i,x,q,P)},Ab.ellipse=function(G,t,T,S,r,X,b){var q=this.actions[this.actions.length-1].args,K=q[q.length-2],P=q[q.length-1];this.absellipse(G+K,t+P,T,S,r,X,b)},Ab.absellipse=function(d,T,l,e,A,s,E){var m=Array.prototype.slice.call(arguments),$=new od(d,T,l,e,A,s,E);this.curves.push($);var b=$.getPoint(1);m.push(b.x),m.push(b.y),this.actions.push({action:kf,args:m})},Ab.getSpacedPoints=function(i){i||(i=40);for(var p=[],l=0;i>l;l++)p.push(this.getPoint(l/i));return p},Ab.getPoints=function($,I){$=$||12;var D,B,v,s,l,E,p,h,q,H,X,K,N,f,Q,T,S,_,m=[];for(D=0,B=this.actions.length;B>D;D++)switch(v=this.actions[D],s=v.action,l=v.args,s){case Tj:m.push(new Xn(l[0],l[1]));break;case vj:m.push(new Xn(l[0],l[1]));break;case qn:for(E=l[2],p=l[3],H=l[0],X=l[1],m.length>0?(f=m[m.length-1],K=f.x,N=f.y):(f=this.actions[D-1].args,K=f[f.length-2],N=f[f.length-1]),Q=1;$>=Q;Q++)T=Q/$,S=_k.b2(T,K,H,E),_=_k.b2(T,N,X,p),m.push(new Xn(S,_));break;case jg:for(E=l[4],p=l[5],H=l[0],X=l[1],h=l[2],q=l[3],m.length>0?(f=m[m.length-1],K=f.x,N=f.y):(f=this.actions[D-1].args,K=f[f.length-2],N=f[f.length-1]),Q=1;$>=Q;Q++)T=Q/$,S=_k.b3(T,K,H,h,E),_=_k.b3(T,N,X,q,p),m.push(new Xn(S,_));break;case Zl:var c,R=l[0],J=l[1],w=l[2],y=l[3],t=l[4],Z=!!l[5],d=t-y,z=2*$;for(Q=1;z>=Q;Q++)T=Q/z,Z||(T=1-T),c=y+T*d,S=R+w*e(c),_=J+w*U(c),m.push(new Xn(S,_));break;case kf:var c,R=l[0],J=l[1],r=l[2],i=l[3],y=l[4],t=l[5],Z=!!l[6],d=t-y,z=2*$;for(Q=1;z>=Q;Q++)T=Q/z,Z||(T=1-T),c=y+T*d,S=R+r*e(c),_=J+i*U(c),m.push(new Xn(S,_))}var j,u,x=g["shape3d.point.epsilon"],V=!1;for(B=m.length,D=0,B=m.length;B>D;D++)j=m[D],u=D===B-1?m[0]:m[D+1],j&&u&&M(j.x-u.x)<x&&M(j.y-u.y)<x&&(V=!0,m[D]=null);if(V){var F=[];for(D=0;B>D;D++)m[D]&&F.push(m[D]);m=F}return I&&m.push(m[0]),m},Ab.toShapes=function(x,y){function m(f){var G,z,V,H,h,S=[],R=new Rr;for(G=0,z=f.length;z>G;G++)V=f[G],h=V.args,H=V.action,H==Tj&&0!=R.actions.length&&(S.push(R),R=new Rr),R[H].apply(R,h);return 0!=R.actions.length&&S.push(R),S}function V(o){for(var Q=[],U=0,C=o.length;C>U;U++){var Z=o[U],d=new af;d.actions=Z.actions,d.curves=Z.curves,Q.push(d)}return Q}function K(W,Y){for(var z=1e-10,d=Y.length,O=!1,k=d-1,x=0;d>x;k=x++){var I=Y[k],s=Y[x],T=s.x-I.x,v=s.y-I.y;if(M(v)>z){if(0>v&&(I=Y[x],T=-T,s=Y[k],v=-v),W.y<I.y||W.y>s.y)continue;if(W.y==I.y){if(W.x==I.x)return!0}else{var y=v*(W.x-I.x)-T*(W.y-I.y);if(0==y)return!0;if(0>y)continue;O=!O}}else{if(W.y!=I.y)continue;if(s.x<=W.x&&W.x<=I.x||I.x<=W.x&&W.x<=s.x)return!0}}return O}var f=m(this.actions);if(0==f.length)return[];if(y===!0)return V(f);var J,A,Z,o=[];if(1==f.length)return A=f[0],Z=new af,Z.actions=A.actions,Z.curves=A.curves,o.push(Z),o;var j=!_k.isClockWise(f[0].getPoints());j=x?!j:j;var i,c=[],G=[],h=[],X=0;G[X]=C,h[X]=[];var P,t;for(P=0,t=f.length;t>P;P++)A=f[P],i=A.getPoints(),J=_k.isClockWise(i),J=x?!J:J,J?(!j&&G[X]&&X++,G[X]={s:new af,p:i},G[X].s.actions=A.actions,G[X].s.curves=A.curves,j&&X++,h[X]=[]):h[X].push({h:A,p:i[0]});if(!G[0])return V(f);if(G.length>1){for(var d=!1,k=[],g=0,F=G.length;F>g;g++)c[g]=[];for(var g=0,F=G.length;F>g;g++){G[g];for(var Y=h[g],r=0;r<Y.length;r++){for(var N=Y[r],E=!0,T=0;T<G.length;T++)K(N.p,G[T].p)&&(g!=T&&k.push({froms:g,tos:T,hole:r}),E?(E=!1,c[T].push(N)):d=!0);E&&c[g].push(N)}}k.length>0&&(d||(h=c))}var $,p,w;for(P=0,t=G.length;t>P;P++)for(Z=G[P].s,o.push(Z),$=h[P],p=0,w=$.length;w>p;p++)Z.holes.push($[p].h);return o};var af=function(){Rr.apply(this,arguments),this.holes=[]},Wc=af.prototype=Vf(Ab);Wc.getPointsHoles=function(G){var $,f=this.holes.length,W=[];for($=0;f>$;$++)W[$]=this.holes[$].getTransformedPoints(G);return W},Wc.extractAllPoints=function(T){return{shape:this.getTransformedPoints(T),holes:this.getPointsHoles(T)}},Wc.extractPoints=function(I){return this.extractAllPoints(I)};var _k={triangulateShape:function(I,D){function H(t,g,r){return t.x!=g.x?t.x<g.x?t.x<=r.x&&r.x<=g.x:g.x<=r.x&&r.x<=t.x:t.y<g.y?t.y<=r.y&&r.y<=g.y:g.y<=r.y&&r.y<=t.y}function b(I,V,D,x,E){var v=1e-10,T=V.x-I.x,n=V.y-I.y,U=x.x-D.x,B=x.y-D.y,b=I.x-D.x,k=I.y-D.y,Z=n*U-T*B,$=n*b-T*k;if(M(Z)>v){var X;if(Z>0){if(0>$||$>Z)return[];if(X=B*b-U*k,0>X||X>Z)return[]}else{if($>0||Z>$)return[];if(X=B*b-U*k,X>0||Z>X)return[]}if(0==X)return!E||0!=$&&$!=Z?[I]:[];if(X==Z)return!E||0!=$&&$!=Z?[V]:[];if(0==$)return[D];if($==Z)return[x];var Q=X/Z;return[{x:I.x+Q*T,y:I.y+Q*n}]}if(0!=$||B*b!=U*k)return[];var P=0==T&&0==n,C=0==U&&0==B;if(P&&C)return I.x!=D.x||I.y!=D.y?[]:[I];if(P)return H(D,x,I)?[I]:[];if(C)return H(I,V,D)?[D]:[];var h,a,f,d,e,m,p,l;return 0!=T?(I.x<V.x?(h=I,f=I.x,a=V,d=V.x):(h=V,f=V.x,a=I,d=I.x),D.x<x.x?(e=D,p=D.x,m=x,l=x.x):(e=x,p=x.x,m=D,l=D.x)):(I.y<V.y?(h=I,f=I.y,a=V,d=V.y):(h=V,f=V.y,a=I,d=I.y),D.y<x.y?(e=D,p=D.y,m=x,l=x.y):(e=x,p=x.y,m=D,l=D.y)),p>=f?p>d?[]:d==p?E?[]:[e]:l>=d?[e,a]:[e,m]:f>l?[]:f==l?E?[]:[h]:l>=d?[h,a]:[h,m]}function q(b,G,l,U){var X=1e-10,Z=G.x-b.x,E=G.y-b.y,L=l.x-b.x,j=l.y-b.y,$=U.x-b.x,V=U.y-b.y,y=Z*j-E*L,S=Z*V-E*$;if(M(y)>X){var P=$*j-V*L;return y>0?S>=0&&P>=0:S>=0||P>=0}return S>0}function j(k,K){function B(g,L){var F=u.length-1,s=g-1;0>s&&(s=F);var U=g+1;U>F&&(U=0);var D=q(u[g],u[s],u[U],T[L]);if(!D)return!1;var A=T.length-1,V=L-1;0>V&&(V=A);var p=L+1;return p>A&&(p=0),D=q(T[L],T[V],T[p],u[g]),D?!0:!1}function E(A,s){var Z,G,r;for(Z=0;Z<u.length;Z++)if(G=Z+1,G%=u.length,r=b(A,s,u[Z],u[G],!0),r.length>0)return!0;return!1}function X(H,J){var D,n,d,e,A;for(D=0;D<z.length;D++)for(n=K[z[D]],d=0;d<n.length;d++)if(e=d+1,e%=n.length,A=b(H,J,n[d],n[e],!0),A.length>0)return!0;return!1}for(var T,i,e,f,D,U,n,p,w,d,L,u=k.concat(),z=[],h=[],W=0,R=K.length;R>W;W++)z.push(W);for(var V=0,y=2*z.length;z.length>0&&(y--,!(0>y));)for(e=V;e<u.length;e++){f=u[e],i=-1;for(var W=0;W<z.length;W++)if(U=z[W],n=f.x+":"+f.y+":"+U,h[n]===C){T=K[U];for(var O=0;O<T.length;O++)if(D=T[O],B(e,O)&&!E(f,D)&&!X(f,D)){i=O,z.splice(W,1),p=u.slice(0,e+1),w=u.slice(e),d=T.slice(i),L=T.slice(0,i+1),u=p.concat(d).concat(L).concat(w),V=e;break}if(i>=0)break;h[n]=!0}if(i>=0)break}return u}for(var e,n,w,t,x,A,B={},R=I.concat(),F=0,Q=D.length;Q>F;F++)Array.prototype.push.apply(R,D[F]);for(e=0,n=R.length;n>e;e++)x=R[e].x+":"+R[e].y,B[x]!==C,B[x]=e;var G=j(I,D),s=yc.Triangulate(G,!1);for(e=0,n=s.length;n>e;e++)for(t=s[e],w=0;3>w;w++)x=t[w].x+":"+t[w].y,A=B[x],A!==C&&(t[w]=A);return s.concat()},isClockWise:function(F){return yc.Triangulate.area(F)<0},b2p0:function(b,y){var x=1-b;return x*x*y},b2p1:function(_,X){return 2*(1-_)*_*X},b2p2:function(K,s){return K*K*s},b2:function(q,U,s,G){return this.b2p0(q,U)+this.b2p1(q,s)+this.b2p2(q,G)},b3p0:function(v,U){var Q=1-v;return Q*Q*Q*U},b3p1:function($,w){var M=1-$;return 3*M*M*$*w},b3p2:function(n,s){var Z=1-n;return 3*Z*n*n*s},b3p3:function(Q,p){return Q*Q*Q*p},b3:function(w,G,B,H,g){return this.b3p0(w,G)+this.b3p1(w,B)+this.b3p2(w,H)+this.b3p3(w,g)}},yc={faces:{},face:"",weight:"normal",style:"normal",size:150,divisions:10,getDefaultFont:function(){var N=H.keys(this.faces);return N.length?N[0]:null},getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(C){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(H){var k=H.familyName.toLowerCase(),L=this;return L.faces[k]=L.faces[k]||{},L.faces[k][H.cssFontWeight]=L.faces[k][H.cssFontWeight]||{},L.faces[k][H.cssFontWeight][H.cssFontStyle]=H,H},drawText:function(Z){var H,x=this.getFace(),d=this.size/x.resolution,w=0,B=String(Z).split(""),I=B.length,S=[];for(H=0;I>H;H++){var F=new Rr,g=this.extractGlyphPoints(B[H],x,d,w,F);g&&(w+=g.offset*this.spacing,S.push(g.path))}var _=w/2;return{paths:S,offset:_}},extractGlyphPoints:function(f,p,b,q,c){var x,_,Z,e,T,y,d,J,j,A,Q,m,P,F,v,U,O,G,u,L=[],n=p.glyphs[f]||p.glyphs["?"];if(n){if(n.o)for(e=n._cachedOutline||(n._cachedOutline=n.o.split(" ")),y=e.length,d=b,J=b,x=0;y>x;)switch(T=e[x++]){case"m":j=e[x++]*d+q,A=e[x++]*J,c.moveTo(j,A);break;case"l":j=e[x++]*d+q,A=e[x++]*J,c.lineTo(j,A);break;case"q":if(Q=e[x++]*d+q,m=e[x++]*J,v=e[x++]*d+q,U=e[x++]*J,c.quadraticCurveTo(v,U,Q,m),u=L[L.length-1])for(P=u.x,F=u.y,_=1,Z=this.divisions;Z>=_;_++){var D=_/Z;_k.b2(D,P,v,Q),_k.b2(D,F,U,m)}break;case"b":if(Q=e[x++]*d+q,m=e[x++]*J,v=e[x++]*d+q,U=e[x++]*J,O=e[x++]*d+q,G=e[x++]*J,c.bezierCurveTo(v,U,O,G,Q,m),u=L[L.length-1])for(P=u.x,F=u.y,_=1,Z=this.divisions;Z>=_;_++){var D=_/Z;_k.b3(D,P,v,O,Q),_k.b3(D,F,U,G,m)}}return{offset:n.ha*b,path:c}}}};yc.generateShapes=function(r,T){T=T||{};var g=T.font;if(g===C&&(g=yc.getDefaultFont(),!g))return console.log("There's no valid font face, use ht.Default.loadFontFace to load font first."),[];var s=T.size!==C?T.size:1,n=T.curveSegments!==C?T.curveSegments:4,F=T.spacing!==C?T.spacing:1,$=T.weight!==C?T.weight:"normal",E=T.style!==C?T.style:"normal";yc.size=s,yc.divisions=n,yc.face=g,yc.weight=$,yc.style=E,yc.spacing=F;for(var o=yc.drawText(r),L=o.paths,i=[],Y=0,k=L.length;k>Y;Y++)Array.prototype.push.apply(i,L[Y].toShapes());return i},function(U){var W=1e-10,t=function(t,W){var S=t.length;if(3>S)return null;var K,A,u,$=[],D=[],J=[];if(H(t)>0)for(A=0;S>A;A++)D[A]=A;else for(A=0;S>A;A++)D[A]=S-1-A;var G=S,h=2*G;for(A=G-1;G>2;){if(h--<=0)return W?J:$;if(K=A,K>=G&&(K=0),A=K+1,A>=G&&(A=0),u=A+1,u>=G&&(u=0),s(t,K,A,u,G,D)){var l,f,z,U,L;for(l=D[K],f=D[A],z=D[u],$.push([t[l],t[f],t[z]]),J.push([D[K],D[A],D[u]]),U=A,L=A+1;G>L;U++,L++)D[U]=D[L];G--,h=2*G}}return W?J:$},H=function(Y){for(var t=Y.length,L=0,f=t-1,p=0;t>p;f=p++)L+=Y[f].x*Y[p].y-Y[p].x*Y[f].y;return.5*L},s=function(Z,I,D,q,F,l){var y,A,E,n,s,o,X,i,G;if(A=Z[l[I]].x,E=Z[l[I]].y,n=Z[l[D]].x,s=Z[l[D]].y,o=Z[l[q]].x,X=Z[l[q]].y,W>(n-A)*(X-E)-(s-E)*(o-A))return!1;var h,w,V,K,M,v,j,c,m,_,u,O,C,b,Q;for(h=o-n,w=X-s,V=A-o,K=E-X,M=n-A,v=s-E,y=0;F>y;y++)if(i=Z[l[y]].x,G=Z[l[y]].y,!(i===A&&G===E||i===n&&G===s||i===o&&G===X)&&(j=i-A,c=G-E,m=i-n,_=G-s,u=i-o,O=G-X,Q=h*_-w*m,C=M*c-v*j,b=V*O-K*u,Q>=-W&&b>=-W&&C>=-W))return!1;return!0};return U.Triangulate=t,U.Triangulate.area=H,U}(yc),K._typeface_js={faces:yc.faces,loadFace:yc.loadFace};var mb=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]},xn=mb.prototype={constructor:mb,computeFaceNormals:function(){for(var y=new qk,F=new qk,V=0,l=this.faces.length;l>V;V++){var W=this.faces[V],Q=this.vertices[W.a],B=this.vertices[W.b],A=this.vertices[W.c];y.subVectors(A,B),F.subVectors(Q,B),y.cross(F),y.normalize(),W.normal.copy(y)}},computeVertexNormals:function(r){var c,F,$,d,a,I;for(I=new Array(this.vertices.length),c=0,F=this.vertices.length;F>c;c++)I[c]=new qk;if(r){var Y,R,m,n=new qk,l=new qk;for($=0,d=this.faces.length;d>$;$++)a=this.faces[$],Y=this.vertices[a.a],R=this.vertices[a.b],m=this.vertices[a.c],n.subVectors(m,R),l.subVectors(Y,R),n.cross(l),I[a.a].add(n),I[a.b].add(n),I[a.c].add(n)}else for($=0,d=this.faces.length;d>$;$++)a=this.faces[$],I[a.a].add(a.normal),I[a.b].add(a.normal),I[a.c].add(a.normal);for(c=0,F=this.vertices.length;F>c;c++)I[c].normalize();for($=0,d=this.faces.length;d>$;$++)a=this.faces[$],a.vertexNormals[0]=I[a.a].clone(),a.vertexNormals[1]=I[a.b].clone(),a.vertexNormals[2]=I[a.c].clone()},mergeVertices:function(){var T,$,D,I,P,c,x,Z,e={},G=[],g=[],E=4,u=i(10,E);for(D=0,I=this.vertices.length;I>D;D++)T=this.vertices[D],$=n(T.x*u)+"_"+n(T.y*u)+"_"+n(T.z*u),e[$]===C?(e[$]=D,G.push(this.vertices[D]),g[D]=G.length-1):g[D]=g[e[$]];var O=[];for(D=0,I=this.faces.length;I>D;D++){P=this.faces[D],P.a=g[P.a],P.b=g[P.b],P.c=g[P.c],c=[P.a,P.b,P.c];for(var l=0;3>l;l++)if(c[l]==c[(l+1)%3]){O.push(D);break}}for(D=O.length-1;D>=0;D--){var S=O[D];for(this.faces.splice(S,1),x=0,Z=this.faceVertexUvs.length;Z>x;x++)this.faceVertexUvs[x].splice(S,1)}var q=this.vertices.length-G.length;return this.vertices=G,q}},od=function(Y,P,O,D,z,p,B){this.aX=Y,this.aY=P,this.xRadius=O,this.yRadius=D,this.aStartAngle=z,this.aEndAngle=p,this.aClockwise=B};od.prototype=Vf(Rm),od.prototype.getPoint=function(n){var V,S=this.aEndAngle-this.aStartAngle;0>S&&(S+=w),S>w&&(S-=w),V=this.aClockwise===!0?this.aEndAngle+(1-n)*(w-S):this.aStartAngle+n*S;var d=this.aX+this.xRadius*e(V),Y=this.aY+this.yRadius*U(V);return new Xn(d,Y)};var Db=function(q,k){this.v1=q,this.v2=k},ge=Db.prototype=Vf(Rm);ge.getPoint=function(W){var K=this.v2.clone().sub(this.v1);return K.multiplyScalar(W).add(this.v1),K},ge.getPointAt=function(c){return this.getPoint(c)},ge.getTangent=function(){var b=this.v2.clone().sub(this.v1);return b.normalize()};var pk=function(E,$,s){this.v0=E,this.v1=$,this.v2=s};pk.prototype=Vf(Rm),pk.prototype.getPoint=function(w){var U,f;return U=_k.b2(w,this.v0.x,this.v1.x,this.v2.x),f=_k.b2(w,this.v0.y,this.v1.y,this.v2.y),new Xn(U,f)};var Hr=function(r,f,I,b){this.v0=r,this.v1=f,this.v2=I,this.v3=b};Hr.prototype=Vf(Rm),Hr.prototype.getPoint=function(f){var j,h;return j=_k.b3(f,this.v0.x,this.v1.x,this.v2.x,this.v3.x),h=_k.b3(f,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new Xn(j,h)},cg.create(function(M,u){this.v1=M,this.v2=u},function(P){var p=new qk;return p.subVectors(this.v2,this.v1),p.multiplyScalar(P),p.add(this.v1),p});var Xj=cg.create(function(B,G,r){this.v0=B,this.v1=G,this.v2=r},function(Q){var q,W,m;return q=_k.b2(Q,this.v0.x,this.v1.x,this.v2.x),W=_k.b2(Q,this.v0.y,this.v1.y,this.v2.y),m=_k.b2(Q,this.v0.z,this.v1.z,this.v2.z),new qk(q,W,m)}),Vo=cg.create(function(j,B,T,C){this.v0=j,this.v1=B,this.v2=T,this.v3=C},function(p){var Y,d,T;return Y=_k.b3(p,this.v0.x,this.v1.x,this.v2.x,this.v3.x),d=_k.b3(p,this.v0.y,this.v1.y,this.v2.y,this.v3.y),T=_k.b3(p,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new qk(Y,d,T)}),ep=function(p,c,m,o,V,A,z,t){mb.call(this),o=o!==C?o:.5,V=V!==C?V:.5,t=t!==C?t:1,p=p||8,A=A||0,z=z||w;var T,S,g=1,a=t/2,j=[],P=[],u=this.vertices,F=this.faces,y=this.faceVertexUvs;for(S=0;g>=S;S++){var N=[],D=[],h=S/g,i=h*(V-o)+o;for(T=0;p>=T;T++){var k=T/p,J=new qk,L=-(k*z+A);J.z=i*U(L),J.y=-h*t+a,J.x=i*e(L),u.push(J),N.push(u.length-1),D.push(new Xn(k,h))}j.push(N),P.push(D)}var l,E,n=(V-o)/t;for(T=0;p>T;T++)for(0!==o?(l=u[j[0][T]].clone(),E=u[j[0][T+1]].clone()):(l=u[j[1][T]].clone(),E=u[j[1][T+1]].clone()),l.setY(Y(l.x*l.x+l.z*l.z)*n).normalize(),E.setY(Y(E.x*E.x+E.z*E.z)*n).normalize(),S=0;g>S;S++){var I=j[S][T],_=j[S+1][T],O=j[S+1][T+1],K=j[S][T+1],B=l.clone(),H=l.clone(),R=E.clone(),X=E.clone(),Z=P[S][T].clone(),f=P[S+1][T].clone(),M=P[S+1][T+1].clone(),s=P[S][T+1].clone();F.push(new Pf(I,_,K,[B,H,X])),y[0].push([Z,f,s]),F.push(new Pf(_,O,K,[H.clone(),R,X.clone()])),y[0].push([f.clone(),M,s.clone()])}if(c&&o>0)for(this.vertices.push(new qk(0,a,0)),T=0;p>T;T++){var I=j[0][T],_=j[0][T+1],O=this.vertices.length-1,B=new qk(0,1,0),H=new qk(0,1,0),R=new qk(0,1,0),Z=P[0][T].clone(),f=P[0][T+1].clone(),M=new Xn(f.x,0);F.push(new Pf(I,_,O,[B,H,R],null,1));var q=T/p*w,$=e(q),b=U(q),d=(T+1)/p*w,x=e(d),v=U(d);y[0].push([new Xn(.5+.5*$,.5+.5*b),new Xn(.5+.5*x,.5+.5*v),new Xn(.5,.5)])}if(m&&V>0)for(this.vertices.push(new qk(0,-a,0)),T=0;p>T;T++){var I=j[S][T+1],_=j[S][T],O=u.length-1,B=new qk(0,-1,0),H=new qk(0,-1,0),R=new qk(0,-1,0),Z=P[S][T+1].clone(),f=P[S][T].clone();F.push(new Pf(I,_,O,[B,H,R],null,2));var q=T/p*w,$=e(q),b=U(q),d=(T+1)/p*w,x=e(d),v=U(d);y[0].push([new Xn(.5+.5*x,.5-.5*v),new Xn(.5+.5*$,.5-.5*b),new Xn(.5,.5)])}};ep.prototype=Vf(xn);var Oo=function(f,v,$,s,y,O,H){mb.call(this),H=H||.5,f=f||16,v=v||16,$=($!==C?$:0)-F,s=s!==C?s:w,y=y!==C?y:0,O=O!==C?O:F;var I,p,r=[],k=[],z=this.vertices,_=this.faces,N=this.faceVertexUvs;for(p=0;v>=p;p++){var b=[],K=[];for(I=0;f>=I;I++){var c=I/f,V=p/v,P=new qk;P.x=-H*e($+c*s)*U(y+V*O),P.y=H*e(y+V*O),P.z=H*U($+c*s)*U(y+V*O),z.push(P),b.push(z.length-1),K.push(new Xn(c,V))}r.push(b),k.push(K)}for(p=0;v>p;p++)for(I=0;f>I;I++){var T=r[p][I+1],l=r[p][I],d=r[p+1][I],L=r[p+1][I+1],S=z[T].clone().normalize(),B=z[l].clone().normalize(),J=z[d].clone().normalize(),m=z[L].clone().normalize(),x=k[p][I+1].clone(),X=k[p][I].clone(),Q=k[p+1][I].clone(),E=k[p+1][I+1].clone();M(z[T].y)===H?(x.x=(x.x+X.x)/2,_.push(new Pf(T,d,L,[S,J,m])),N[0].push([x,Q,E])):M(z[d].y)===H?(Q.x=(Q.x+E.x)/2,_.push(new Pf(T,l,d,[S,B,J])),N[0].push([x,X,Q])):(_.push(new Pf(T,l,L,[S,B,m])),N[0].push([x,X,E]),_.push(new Pf(l,d,L,[B.clone(),J,m.clone()])),N[0].push([X.clone(),Q,E.clone()]))}};Oo.prototype=Vf(xn);var wh=function(N,S,W,A,v,h){mb.call(this),N=N||.33,S=S||.17,A=A||8,W=W||6,v=v||0,h=h||w;for(var E=new qk,o=[],a=[],c=0;A>=c;c++)for(var j=c/A*w+F,s=0;W>=s;s++){var Z=s/W*h+v;E.x=N*e(Z),E.z=-N*U(Z);var _=new qk,M=N+S*e(j);_.x=M*e(Z),_.z=-M*U(Z),_.y=S*U(j),this.vertices.push(_),o.push(new Xn(s/W,1-c/A)),a.push(_.clone().sub(E).normalize())}for(var c=1;A>=c;c++)for(var s=1;W>=s;s++){var y=(W+1)*c+s-1,g=(W+1)*(c-1)+s-1,q=(W+1)*(c-1)+s,H=(W+1)*c+s,d=new Pf(y,g,H,[a[y].clone(),a[g].clone(),a[H].clone()]);this.faces.push(d),this.faceVertexUvs[0].push([o[y].clone(),o[g].clone(),o[H].clone()]),d=new Pf(g,q,H,[a[g].clone(),a[q].clone(),a[H].clone()]),this.faces.push(d),this.faceVertexUvs[0].push([o[g].clone(),o[q].clone(),o[H].clone()])}this.computeFaceNormals()};wh.prototype=Vf(xn);var Nh=function(n,M,Y){return n?(mb.call(this),n=n instanceof Array?n:[n],this.addShapeList(n,M),M.convertYZ!==!1&&pg(this,Y),this.computeFaceNormals(),void 0):(n=[],void 0)},ap=Nh.prototype=Vf(mb.prototype);ap.addShapeList=function(t,z){for(var G=t.length,F=0;G>F;F++){var L=t[F];this.addShape(L,z)}},ap.addShape=function(V,u){function p(){if(u.bottom)for(var z=0;w>z;z++)q=X[z],y(q[2],q[1],q[0],!0);if(u.top)for(z=0;w>z;z++)q=X[z],y(q[0]+F*W,q[1]+F*W,q[2]+F*W,!1)}function R(){var h=0;for(e(_,h),h+=_.length,L=0,K=N.length;K>L;L++)o=N[L],e(o,h),h+=o.length}function e(S,r){for(var R,$,k=S.length;--k>=0;){R=k,$=k-1,0>$&&($=S.length-1);var V=0,G=W;for(V=0;G>V;V++){var z=F*V,f=F*(V+1),n=r+R+z,l=r+$+z,E=r+$+f,x=r+R+f;J(n,l,E,x,S,V,G,R,$)}}}function G(y,Y,S){I.vertices.push(new qk(y,Y,S))}function y(j,h,g,C){j+=s,h+=s,g+=s,I.faces.push(new Pf(j,h,g,null,null,C?2:1));var R=C?U.generateBottomUV(I,V,u,j,h,g):U.generateTopUV(I,V,u,j,h,g);I.faceVertexUvs[0].push(R)}function J(j,T,K,N,S,x,q,M,F){j+=s,T+=s,K+=s,N+=s,I.faces.push(new Pf(j,T,N)),I.faces.push(new Pf(T,K,N));var $=U.generateSideWallUV(I,V,S,u,j,T,K,N,x,q,M,F);I.faceVertexUvs[0].push([$[0],$[1],$[3]]),I.faceVertexUvs[0].push([$[1],$[2],$[3]])}var d,Q,H,j,Y,b=u.amount,E=u.curveSegments||uc,W=u.steps||1,P=u.extrudePath,x=!1,U=new Pi(u.repeatUVLength);P&&(d=P.getSpacedPoints(W),x=!0,Q=u.frames!==C?u.frames:new Vi.FrenetFrames(P,W,!1),H=new qk,j=new qk,Y=new qk);var o,L,K,I=this,s=this.vertices.length,A=V.extractPoints(E),S=A.shape,N=A.holes,M=!_k.isClockWise(S);if(M){for(S=S.reverse(),L=0,K=N.length;K>L;L++)o=N[L],_k.isClockWise(o)&&(N[L]=o.reverse());M=!1}var X=_k.triangulateShape(S,N),_=S;for(L=0,K=N.length;K>L;L++)o=N[L],S=S.concat(o);for(var B,q,F=S.length,w=X.length,h=0;F>h;h++)B=S[h],x?(j.copy(Q.normals[0]).multiplyScalar(B.x),H.copy(Q.binormals[0]).multiplyScalar(B.y),Y.copy(d[0]).add(j).add(H),G(Y.x,Y.y,Y.z)):G(B.x,B.y,0);var m;for(m=1;W>=m;m++)for(h=0;F>h;h++)B=S[h],x?(j.copy(Q.normals[m]).multiplyScalar(B.x),H.copy(Q.binormals[m]).multiplyScalar(B.y),Y.copy(d[m]).add(j).add(H),G(Y.x,Y.y,Y.z)):G(B.x,B.y,b/W*m);p(),R()};var Vi=function(W,K,R,d,i){function t(m,o,N){return l.vertices.push(new qk(m,o,N))-1}mb.call(this),K=K||64,R=R||1,d=d||8,i=i||!1;var L,v,A,T,o,j,m,M,I,n,H,V,Y,N,B,p,C,Q,x,c,D=[],l=this,b=K+1,s=new qk,g=new Vi.FrenetFrames(W,K,i),r=g.tangents,h=g.normals,y=g.binormals;for(this.tangents=r,this.normals=h,this.binormals=y,I=0;b>I;I++)for(D[I]=[],T=I/(b-1),M=W.getPointAt(T),L=r[I],v=h[I],A=y[I],n=0;d>n;n++)o=n/d*w,j=-R*e(o),m=R*U(o),s.copy(M),s.x+=j*v.x+m*A.x,s.y+=j*v.y+m*A.y,s.z+=j*v.z+m*A.z,D[I][n]=t(s.x,s.y,s.z);for(I=0;K>I;I++)for(n=0;d>n;n++)H=i?(I+1)%K:I+1,V=(n+1)%d,Y=D[I][n],N=D[H][n],B=D[H][V],p=D[I][V],C=new Xn(I/K,n/d),Q=new Xn((I+1)/K,n/d),x=new Xn((I+1)/K,(n+1)/d),c=new Xn(I/K,(n+1)/d),this.faces.push(new Pf(Y,N,p)),this.faceVertexUvs[0].push([C,Q,c]),this.faces.push(new Pf(N,B,p)),this.faceVertexUvs[0].push([Q.clone(),x,c.clone()]);this.computeFaceNormals(),this.computeVertexNormals()};Vi.prototype=Vf(xn),Vi.FrenetFrames=function(Y,K,H){function y(){A[0]=new qk,D[0]=new qk,m=Number.MAX_VALUE,c=M(k[0].x),L=M(k[0].y),n=M(k[0].z),m>=c&&(m=c,f.set(1,0,0)),m>=L&&(m=L,f.set(0,1,0)),m>=n&&f.set(0,0,1),l.crossVectors(k[0],f).normalize(),A[0].crossVectors(k[0],l),D[0].crossVectors(k[0],A[0])}var G,m,c,L,n,x,U,f=new qk,k=[],A=[],D=[],l=new qk,C=new Be,E=K+1,b=1e-4;for(this.tangents=k,this.normals=A,this.binormals=D,x=0;E>x;x++)U=x/(E-1),k[x]=Y.getTangentAt(U),k[x].normalize();for(y(),x=1;E>x;x++)A[x]=A[x-1].clone(),D[x]=D[x-1].clone(),l.crossVectors(k[x-1],k[x]),l.length()>b&&(l.normalize(),G=q(xo(k[x-1].dot(k[x]),-1,1)),A[x].applyMatrix4(C.makeRotationAxis(l,G))),D[x].crossVectors(k[x],A[x]);if(H)for(G=q(xo(A[0].dot(A[E-1]),-1,1)),G/=E-1,k[0].dot(l.crossVectors(A[0],A[E-1]))>0&&(G=-G),x=1;E>x;x++)A[x].applyMatrix4(C.makeRotationAxis(k[x],G*x)),D[x].crossVectors(k[x],A[x])};var Tp=function(D,o,P,J){mb.call(this),o=o||18,P=P||0,J=J==V?w:J;for(var k=1/(D.length-1),O=1/o,$=0,Y=o;Y>=$;$++)for(var r=P+$*O*J,T=e(r),p=U(r),S=0,g=D.length;g>S;S++){var N=D[S],x=new qk;x.x=T*N.x-p*N.y,x.y=p*N.x+T*N.y,x.z=N.z,this.vertices.push(x)}for(var d=D.length,$=0,Y=o;Y>$;$++)for(var S=0,g=D.length-1;g>S;S++){var u=S+d*$,c=u,H=u+d,T=u+1+d,h=u+1,B=$*O,f=S*k,Z=B+O,_=f+k;this.faces.push(new Pf(c,h,H)),this.faceVertexUvs[0].push([new Xn(B,f),new Xn(B,_),new Xn(Z,f)]),this.faces.push(new Pf(H,h,T)),this.faceVertexUvs[0].push([new Xn(Z,f),new Xn(B,_),new Xn(Z,_)])}this.mergeVertices(),pg(this),this.computeFaceNormals(),this.computeVertexNormals()};Tp.prototype=Vf(xn);var $m=function(i,F){F=F||{};var X=yc.generateShapes(i,F);F.amount=F.amount!==C?F.amount:.5,F.convertYZ=!1,F.fill!==!1&&(F.bottom=!0,F.top=!0),Nh.call(this,X,F)};$m.prototype=Vf(ap);var Gk=k.Node=function(){Hh(Gk,this)},dd={X:Ek,Y:Pn,Z:Tb},fm={X:0,Y:1,Z:2},Ep={xyz:"XYZ",xzy:"XZY",yxz:"YXZ",yzx:"YZX",zxy:"ZXY",zyx:"ZYX"},Zc="xzy",Mp=function(z,V,O){if(V){var i=V[0],A=V[1],u=V[2];"xzy"===O?(Pn(z,A),Tb(z,u),Ek(z,i)):"xyz"===O?(Tb(z,u),Pn(z,A),Ek(z,i)):"yxz"===O?(Tb(z,u),Ek(z,i),Pn(z,A)):"yzx"===O?(Ek(z,i),Tb(z,u),Pn(z,A)):"zxy"===O?(Pn(z,A),Ek(z,i),Tb(z,u)):"zyx"===O?(Ek(z,i),Pn(z,A),Tb(z,u)):(Pn(z,A),Tb(z,u),Ek(z,i))}};Ni("Node",oj,{ms_ac:["rotationMode","anchorElevation"],ms_edge:!0,_adjustChildrenToTop:!0,_icon:"node_icon",_image:"node_image",_rotationMode:Zc,_64O:0,_rotationX:0,_53O:0,_host:V,_position:{x:0,y:0},_anchor:{x:.5,y:.5},_anchorElevation:.5,_scale:{x:1,y:1},_scaleTall:1,_54O:0,getUIClass:function(){return Oh},_22Q:function(){return sg},getX:function(){return this.p().x},setX:function(Z){this.p(Z,this.p().y)},getY:function(){return this.p().y},setY:function(l){this.p(this.p().x,l)},getAnchorX:function(){return this.getAnchor().x},setAnchorX:function(C){this.setAnchor(C,this.getAnchor().y)},getAnchorY:function(){return this.getAnchor().y},setAnchorY:function(a){this.setAnchor(this.getAnchor().x,a)},getScaleX:function(){return this.getScale().x},setScaleX:function(V){this.setScale(V,this.getScale().y)},getScaleY:function(){return this.getScale().y},setScaleY:function(o){this.setScale(this.getScale().x,o)},p:function(){return 0===arguments.length?this.getPosition():(this.setPosition.apply(this,arguments),this)},p3:function(){return 0===arguments.length?this.getPosition3d():(this.setPosition3d.apply(this,arguments),this)},s3:function(){return 0===arguments.length?this.getSize3d():(this.setSize3d.apply(this,arguments),this)},r3:function(){return 0===arguments.length?this.getRotation3d():(this.setRotation3d.apply(this,arguments),this)},t3:function(){return this.translate3d.apply(this,arguments),this},translate3dBy:function(W,L){Qf(W,Fp(V,V,this.r3(),this.getRotationMode())),this.translate3d(W[0]*L,W[1]*L,W[2]*L)},translateFront:function(b){this.translate3dBy([0,0,1],b)},translateBack:function(z){this.translate3dBy([0,0,-1],z)},translateLeft:function(f){this.translate3dBy([-1,0,0],f)},translateRight:function(l){this.translate3dBy([1,0,0],l)},translateTop:function(o){this.translate3dBy([0,1,0],o)},translateBottom:function(l){this.translate3dBy([0,-1,0],l)},getPosition3d:function(){return[this._position.x,this._54O,this._position.y]},setPosition3d:function(N,i,q){1===arguments.length&&(i=N[1],q=N[2],N=N[0]),this.p(N,q),this.setElevation(i)},translate3d:function(Q,L,g){1===arguments.length&&(L=Q[1],g=Q[2],Q=Q[0]),this.translate(Q,g),this.setElevation(this._54O+L)},getSize3d:function(){return[this.getWidth(),this.getTall(),this.getHeight()]},setSize3d:function(K,l,s){1===arguments.length&&(l=K[1],s=K[2],K=K[0]),this.setSize(K,s),this.setTall(l)
},getRotation3d:function(){return[this._rotationX,-this._64O,this._53O]},setRotation3d:function(X,t,l){1===arguments.length&&(t=X[1],l=X[2],X=X[0]),this.setRotationX(X),this.setRotation(-t),this.setRotationZ(l)},setRotationY:function(A){this.setRotation(-A)},getRotationY:function(){return-this._64O},lookAtDirection:function(i,j){j=j||Bn;var B=this,v=_e(i);j===Bn?(B.r3([-o(i[1]/v),-s(i[2],i[0])+X,0]),B.setRotationMode("xzy")):j===Hn?(B.r3(0,-s(i[2],i[0]),o(i[1]/v)),B.setRotationMode("zyx")):j===ws?(B.r3(0,-s(i[2],i[0])+F,-o(i[1]/v)),B.setRotationMode("zyx")):j===qs?(B.r3([-o(i[1]/v)+X,-s(i[2],i[0])+X,0]),B.setRotationMode("xzy")):j===rq&&(B.r3([-o(i[1]/v)-X,-s(i[2],i[0])+X,0]),B.setRotationMode("xzy")),j===rg&&(B.r3([-o(i[1]/v)+F,-s(i[2],i[0])+X,F]),B.setRotationMode("zxy"))},lookAt:function(m,n){return this.lookAtDirection(Nn(m,this.p3()),n)},lookAtX:function(){var R=new ah,Q=new ah,d=new ah,y=new Dg,v=new Dg,z=new Tc;return function(k,P){var B=pc(this);y.fromArray(B),d.copy(this.p3()),R.copy(k).sub(d).normalize(),P===Bn?Q.set(0,0,1):P===rg?Q.set(0,0,-1):P===ws?Q.set(-1,0,0):P===Hn?Q.set(1,0,0):P===qs?Q.set(0,1,0):P===rq&&Q.set(0,-1,0),Q.applyMatrix4(y).sub(d).normalize();var N=Math.acos(R.dot(Q));if(N){var o=R.clone().cross(Q).normalize();z.set(this.r3(),this.getRotationMode(),!0),y.makeRotationFromEuler(z),v.makeRotationAxis(o,-N),z.setFromRotationMatrix(v.multiply(y)),this.r3([z.x,z.y,z.z])}}}(),getHost:function(){return this._host},setHost:function(n){var T=this;if(T!==n&&T._host!==n){var u=T._host;u&&u._removeAttach(T),T._host=n,T._host&&T._host._addAttach(T),T.fp("host",u,n),T.onHostChanged(u,n)}},getAttaches:function(){return this._69O},_addAttach:function(e){var c=this;c._69O||(c._69O=new Vd),c._69O.add(e),c.fp("attaches",V,e)},_removeAttach:function(Z){var b=this;b._69O.remove(Z),b._69O.isEmpty()&&delete b._69O,b.fp("attaches",Z,V)},getImage:function(){if(this._pendingCheckImageJSON){var x=m.getImage(this._image);x&&(this._pendingCheckImageJSON=!1,this.getParent()instanceof fd&&this.getParent().checkPendingUpdateInfo())}return this._image},setImage:function(o){var C=this,Z=C._image,j=C.getWidth(),X=C.getHeight();C._image=o,C.fp("image",Z,o)&&(null!=o&&(Ib(o)||Jh(o)&&/\.json$/i.test(o))&&(this._pendingCheckImageJSON=!0),C.fp(th,j,C.getWidth()),C.fp(Dl,X,C.getHeight()))},getElevation:function(){return this._54O},setElevation:function(l){var G=this;if(!G._50O){G._50O=1;var z=G._54O;G._54O=l,G.fp(pl,z,l),delete this._50O}},getRotation:function(){return this._64O},setRotation:function(j){var c=this;if(!c._49O){c._49O=1;var C=c._64O;c._64O=j,c.fp(cs,C,j),delete c._49O}},getRotationX:function(){return this._rotationX},setRotationX:function(V){var s=this;if(!s._51O){s._51O=1;var W=s._rotationX;s._rotationX=V,s.fp("rotationX",W,V),delete s._51O}},getRotationZ:function(){return this._53O},setRotationZ:function(x){var A=this;if(!A._52O){A._52O=1;var U=A._53O;A._53O=x,A.fp("rotationZ",U,x),delete A._52O}},getPosition:function(){return this._position},setPosition:function(e,r){var l=this;if(!l._50I){l._50I=1;var K;if(K=2===arguments.length?{x:e,y:r}:e,K.x!==l._position.x||K.y!==l._position.y){var i=l._position;l._position=K,l.fp(kc,i,K)}delete l._50I}},translate:function(r,t){var $=this._position;this.p($.x+r,$.y+t)},getWidth:function(){var D=this;if(D._width>=0)return D._width;var r=D.getStyle("shape3d");if(r){var $=no(r);if($&&$.rawS3)return $.rawS3[0];if("billboard"===r||"plane"===r){var w=hs(D.getStyle("shape3d.image"));return w?si(w,D):20}}var w=hs(D._image);return w?si(w,D):20},setWidth:function(h){var z=this,T=z._width;z._width=h,z.fp(th,T,h)},getHeight:function(){var U=this;if(U._height>=0)return U._height;var T=U.getStyle("shape3d");if(T){var u=no(T);if(u&&u.rawS3)return u.rawS3[2];if("plane"===T){var M=hs(U.getStyle("shape3d.image"));return M?of(M,U):20}if("billboard"===T)return 2}var M=hs(U._image);return M?of(M,U):20},setHeight:function(A){var i=this,b=i._height;i._height=A,i.fp(Dl,b,A)},getTall:function(){var x=this;if(x._tall>=0)return x._tall;var d=x.getStyle("shape3d");if(d){var $=no(d);if($&&$.rawS3)return $.rawS3[1];if("billboard"===d){var w=hs(x.getStyle("shape3d.image"));return w?of(w,x):20}if("plane"===d)return 2}return 20},setTall:function(b){var l=this,i=l._tall;l._tall=b,l.fp("tall",i,b)},setSize:function(K,e){var R=this;2===arguments.length?(R.setWidth(K),R.setHeight(e)):(R.setWidth(K.width),R.setHeight(K.height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},setRect:function(T,Y,F,k,r){var z=this,I=z.getAnchor(),Q=z.getScale();arguments.length<=2&&(r=Y,Y=T.y,F=T.width,k=T.height,T=T.x);var a=r&&Q.x<0?1-I.x:I.x,w=r&&Q.y<0?1-I.y:I.y;z.p(T+F*a,Y+k*w),r&&(F/=Math.abs(Q.x),k/=Math.abs(Q.y)),z.setWidth(F),z.setHeight(k)},getMatrix:function(){var Z=this,Q=Z._64O,s=Z._position,z=Z.getScale();return new Ae(Q,s.x,s.y,z.x,z.y)},getAnchorRect:function(){var u=this,K=u.getWidth(),S=u.getHeight(),o=u.getAnchor();return{x:-K*o.x,y:-S*o.y,width:K,height:S}},toLocal:function(R){return this.getMatrix().tfi(R)},toGlobal:function(i){return this.getMatrix().tf(i)},getAttachPosition:function(){var c=new Ae;return function($,J,b,H){b=b||0,H=H||0;var V=this,j=V.getAnchor(),g=V._64O,l=V._position,D=V.getScale();return c.setFromTransform(g,l.x,l.y).tf({x:b+D.x*V.getWidth()*($-j.x),y:H+D.y*V.getHeight()*(J-j.y)})}}(),isInRect:function(Z){Z=this.toLocal(Z);var U=this.getWidth(),P=this.getHeight();return Z.x+=U*this.getAnchorX(),Z.y+=P*this.getAnchorY(),!(Z.x<0||Z.y<0||Z.x>U||Z.y>P)},getRect:function(){var B=this,e=B.getWidth(),l=B.getHeight(),t=B.getAnchor(),c={x:-e*t.x,y:-l*t.y,width:e,height:l},j=B.getMatrix();return c=fr([j.tf(c.x,c.y),j.tf(c.x+c.width,c.y),j.tf(c.x+c.width,c.y+c.height),j.tf(c.x,c.y+c.height)])},getAnchorElevation:function(){return this._anchorElevation},getAnchor3d:function(){var o=this,A=o.getAnchor(),$=o._anchorElevation;return{x:A.x,y:$,z:A.y}},setAnchorElevation:function(s){var m=this,k=m._anchorElevation;return k!==s?(m._anchorElevation=s,m.fp("anchorElevation",k,s),!0):!1},setAnchor3d:function(_,P,l,H){var W,D=this;"number"==typeof _?W={x:_,y:P,z:l}:(W=_.length?{x:_[0],y:_[1],z:_[2]}:_,H=P);var J=D.getDataModel();J&&J.beginTransaction();var t=D.getAnchor3d(),V=D.setAnchor(W.x,W.z);if(D.setAnchorElevation(W.y)&&(V=!0),V&&H&&!Mb){D.getAnchor3d();var T=pc(D),f=Qf([W.x-t.x,W.y-t.y,W.z-t.z],T);D.p3(f)}return J&&J.endTransaction(),V},getAnchor:function(){var E=this;if(E.hasOwnProperty("_anchor"))return E._anchor;var k=hs(E._image);return k&&k.anchorX!==C?{x:k.anchorX,y:k.anchorY}:E._anchor},setAnchor:function(w,g,i){var n,K=this;"number"==typeof w?n={x:w,y:g}:(n=w.length?{x:w[0],y:w[1]}:w,i=g);var O=K.getAnchor();if(O.x!==n.x||O.y!==n.y){var z=K.getDataModel();if(z&&z.beginTransaction(),K._anchor=n,K.fp("anchor",O,n),i&&!Mb){var W=K.getPosition(),R=K.getSize(),s=K.getRotation(),H=K.getScale(),G=-R.width*(O.x-n.x)*H.x,B=-R.height*(O.y-n.y)*H.y,d=U(s),p=e(s);K.setPosition(W.x+p*G-d*B,W.y+d*G+p*B)}return z&&z.endTransaction(),!0}return!1},getScale:function(){return this._scale},setScale:function(b,I){var Y,R=this;Y=2===arguments.length?{x:b,y:I}:b;var z=R.getScale();(z.x!==Y.x||z.y!==Y.y)&&(R._scale=Y,R.fp("scale",z,Y))},getScaleTall:function(){return this._scaleTall},getScale3d:function(){var f=this,a=f._scaleTall,l=f.getScale();return[l.x,a,l.y]},getFinalScale3d:function(){var g=this,i=g.s3(),J=g._dynamicScale3d,O=g.getScale3d();return i&&(O[0]*=i[0],O[1]*=i[1],O[2]*=i[2]),J&&(O[0]*=J[0],O[1]*=J[1],O[2]*=J[2]),O},getFinalRotation3d:function(){var U=this;return U._dynamicRotation||U.r3()},setScaleTall:function(K){var n=this,C=n._scaleTall;C!==K&&(n._scaleTall=K,n.fp("scaleTall",C,K))},setScale3d:function(g,Z,z){var w,B=this;w="number"==typeof g?{x:g,y:Z,z:z}:g.length?{x:g[0],y:g[1],z:g[2]}:g,B.setScaleTall(w.y),B.setScale(w.x,w.z)},getCorners:function(o,W){o==V&&(o=0),W==V&&(W=o);var C=this,d=C.getAnchor(),f=C.getWidth(),r=C.getHeight(),P=-f*d.x-o,$=-r*d.y-W,b=f+2*o,u=r+2*W,F=C.getMatrix();return[F.tf(P,$),F.tf(P,$+u),F.tf(P+b,$+u),F.tf(P+b,$)]},getEditControlPoints:function(q,U,N){U==V&&(U=0),N==V&&(N=U);var I=this,p=I.getAnchor(),k=I.getWidth(),K=I.getHeight(),B=-k*p.x-U,A=-K*p.y-N,r=k+2*U,S=K+2*N;if(q)return[{x:B,y:A},{x:B,y:0},{x:B,y:A+S},{x:0,y:A+S},{x:B+r,y:A+S},{x:B+r,y:0},{x:B+r,y:A},{x:0,y:A}];var u=I.getMatrix();return[u.tf(B,A),u.tf(B,0),u.tf(B,A+S),u.tf(0,A+S),u.tf(B+r,A+S),u.tf(B+r,0),u.tf(B+r,A),u.tf(0,A)]},rotateAt:function(a,F,R){var V=this,y=V._position,t=V._64O,M=new Ae(t,y.x,y.y).tf(a,F),j=Y(a*a+F*F),N=s(y.y-M.y,y.x-M.x)+R;V.setRotation(t+R),V.p(M.x+j*e(N),M.y+j*U(N))},onParentChanged:function(){Gk.superClass.onParentChanged.apply(this,arguments),this._8I()},onPropertyChanged:function(){var D={};return"width|height|position|anchor|rotation|scale|s:layout.h|s:layout.v".split("|").forEach(function(c){D[c]=!0}),function(W){var b=this;Gk.superClass.onPropertyChanged.call(b,W),D[W.property]&&!b._layoutUpdating&&b.updateLayoutParameters(null,W.property),b._69O&&b._69O.each(function(X){X.handleHostPropertyChange(W)}),b._49I&&b._49I.each(function(A){A.fp("agentChange",!0,!1)})}}(),onHostChanged:function(){this.updateAttach(),this.updateLayoutParameters()},handleHostPropertyChange:function(B){this.updateAttach(B)},onStyleChanged:function(v){Gk.superClass.onStyleChanged.apply(this,arguments),ec[v]&&this.updateAttach()},updateAttach:function(g){var s=this;return Mb?(s.updateLayoutParameters(),void 0):(s._51I||(s._51I=1,s._71O(g),delete s._51I),void 0)},_71O:function(R){var N,J,K,M,u,h,x=this,Q=x._host,$=R?R.property:V,Y=R?R.oldValue:V,f=R?R.newValue:V;if(Q instanceof k.Grid){if($===pl)x.setElevation(x._54O+f-Y);else if(!R||Ci[$]){if(N=x.s("attach.row.index"),J=x.s("attach.column.index"),K=Q.getCellRect(N,J),!K)return;M=x.s("attach.row.span"),u=x.s("attach.column.span"),(1!==M||1!==u)&&(K=ps(K,Q.getCellRect(N+M-1,J+u-1))),hj(K,x,"attach.padding",1),x.setRect(K)}}else if(Q instanceof Wd&&(h=x.s("attach.index"))>=0&&(!R||Vl[$])){var z=x.s("attach.thickness");z!=V&&x.setHeight(Q.getThickness()*z);var c=x.s("attach.offset"),B=Q.getPoints(),D=B.size();if(D>h){var H=B.get(h),W=D===h+1?B.get(0):B.get(h+1),T=[W.x-H.x,W.y-H.y],F=_e(T);if(F){x.s("attach.offset.relative")&&(c*=F),x.s("attach.offset.opposite")&&(c=F-c);var w={x:H.x+T[0]/F*c,y:H.y+T[1]/F*c},v=x.s("attach.gap");v&&(x.s("attach.gap.relative")&&(v*=Q.getThickness()),w=wo(V,w,W,v)),x.p(w),x.setRotation(s(T[1],T[0]))}}}else R&&($===kc?x.translate(f.x-Y.x,f.y-Y.y):$===pl?x.setElevation(x._54O+f-Y):Ob[$]?x._11Q(Q,$,f-Y):("anchor"===$||"width"===$||"height"===$||"scale"===$)&&x.layout(Q))},_11Q:function(){var n=new k.Math.Euler,c=k.Math.Euler.ReverseOrder,r=new k.Math.Vector2,S=new k.Math.Vector2;return function(H,u,V){var K=this,L=H.p3(),d=H.r3(),Y=K.p3(),N=K.r3();if(u===cs&&(u="rotationY",V=-V),(u===cs||"rotationY"===u)&&0===N[0]&&0===N[2]&&0===d[0]&&0===d[2]&&0===Y[1]&&0===L[1])return K.setRotation(-N[1]-V),r.set(Y[0],Y[2]).rotateAround(S.set(L[0],L[2]),-V),K.p(r.x,r.y),void 0;var l=Ep[H.getRotationMode()],p=l[0],w=l[1],E=l[2],F=dd[p],b=dd[w],C=dd[E],G=Yq();u===cs+p?(C(G,d[fm[E]]),b(G,d[fm[w]]),F(G,V),b(G,-d[fm[w]]),C(G,-d[fm[E]])):u===cs+w?(C(G,d[fm[E]]),b(G,V),C(G,-d[fm[E]])):u===cs+E&&C(G,V);var U=Nn(Y,L);Qf(U,G),K.p3(L[0]+U[0],L[1]+U[1],L[2]+U[2]);var e=K.getRotationMode();Mp(G,K.r3(),e),n.setFromRotationMatrix(G,c(e)),K.r3([n.x,n.y,n.z])}}(),isHostOn:function(r){var p=this;if(p._host&&r&&r._69O)for(var z={},o=p._host;o&&o!==p&&!z[o._id];){if(o===r)return!0;z[o._id]=o,o=o._host}return!1},isLoopedHostOn:function(J){return this.isHostOn(J)&&J.isHostOn(this)},getScaledSize:function(){var o=this.getSize(),M=this.getScale();return o.width*=Math.abs(M.x),o.height*=Math.abs(M.y),o},layout:function(v){if(v=v||this.getHost()){var I=this,z=I.s("layout.h")||"center",$=I.s("layout.v")||"center";if("center"!==z||"center"!==$){var c=new k.Math.Vector2,h=v.getPosition(),K=v.getAnchor(),m=v.getScaledSize();I.getPosition();var j,i,g,P,e,Z=1,M=1;switch(I._layoutUpdating=!0,z){case"left":c.setX(I._layoutHValue-K.x*m.width);break;case"right":c.setX((1-K.x)*m.width-I._layoutHValue);break;case"leftright":j=m.width-I._layoutHValue[2],g=I.getRotation()-v.getRotation(),P=Math.abs(Math.sin(g)),e=Math.abs(Math.cos(g)),Z+=e*j/I._layoutHValue[3],M+=P*j/I._layoutHValue[4],c.setX(I._layoutHValue[1]+(I._layoutHValue[5]-K.x)*m.width);break;case"center":c.setX((.5-K.x)*m.width-I._layoutHValue);break;case"scale":g=I.getRotation()-v.getRotation(),P=Math.abs(Math.sin(g)),e=Math.abs(Math.cos(g)),c.setX((.5-K.x)*m.width-I._layoutHValue[1]*m.width/I._layoutHValue[0]),i=m.width/I._layoutHValue[2]-1,Z+=e*i,M+=P*i}switch($){case"top":c.setY(I._layoutVValue-K.y*m.height);break;case"bottom":c.setY((1-K.y)*m.height-I._layoutVValue);break;case"topbottom":g||(g=I.getRotation()-v.getRotation(),P=Math.abs(Math.sin(g)),e=Math.abs(Math.cos(g))),j=m.height-I._layoutVValue[2],Z+=P*j/I._layoutVValue[3],M+=e*j/I._layoutVValue[4],c.setY(I._layoutVValue[1]+(I._layoutVValue[5]-K.y)*m.height);break;case"center":c.setY((.5-K.y)*m.height-I._layoutVValue);break;case"scale":g||(g=I.getRotation()-v.getRotation(),P=Math.abs(Math.sin(g)),e=Math.abs(Math.cos(g))),c.setY((.5-K.y)*m.height-I._layoutVValue[1]*m.height/I._layoutVValue[0]),i=m.height/I._layoutVValue[2]-1,Z+=P*i,M+=e*i}if("leftright"===z||"scale"===z||"topbottom"===$||"scale"===$){var b=this.getScale(),N=Math.abs(b.x),l=Math.abs(b.y);"leftright"===z||"scale"===z?I.setSize(I._layoutHValue[3]*Z/N,I._layoutHValue[4]*M/l):I.setSize(I._layoutVValue[3]*Z/N,I._layoutVValue[4]*M/l)}c.rotateAround(null,v.getRotation()),this.setPosition(c.x+h.x,c.y+h.y),I._layoutUpdating=C}}},updateLayoutParameters:function(W,O){if(W=W||this.getHost()){var U=this,K=U.s("layout.h"),h=U.s("layout.v");if(K||h){var N,S,j,c,x,J,$=new k.Math.Vector2,n=W.getPosition(),t=W.getAnchor(),I=W.getScaledSize(),l=U.getPosition(),E=U.getScaledSize();switch($.set(l.x-n.x,l.y-n.y),$.rotateAround(null,-W.getRotation()),K){case"left":U._layoutHValue=$.x+t.x*I.width;break;case"right":U._layoutHValue=-$.x+(1-t.x)*I.width;break;case"center":U._layoutHValue=-$.x+(.5-t.x)*I.width;break;case"leftright":case"scale":"scale"===K?N=-$.x+(.5-t.x)*I.width:(S=U.getAnchor(),j=U.getRotation()-W.getRotation(),c=Math.cos(j),x=Math.sin(j),J=-Math.min(-S.x*c+S.y*x,-S.x*c-(1-S.y)*x,(1-S.x)*c+S.y*x,(1-S.x)*c-(1-S.y)*x),N=$.x-(J-t.x)*I.width),"position"===O&&"object"==typeof U._layoutHValue?(U._layoutHValue[0]=I.width,U._layoutHValue[1]=N):U._layoutHValue=[I.width,N,I.width,E.width,E.height,J]}switch(h){case"top":U._layoutVValue=$.y+t.y*I.height;break;case"bottom":U._layoutVValue=-$.y+(1-t.y)*I.height;break;case"center":U._layoutVValue=-$.y+(.5-t.y)*I.height;break;case"topbottom":case"scale":"scale"===h?N=-$.y+(.5-t.y)*I.height:(j||(S=U.getAnchor(),j=U.getRotation()-W.getRotation(),c=Math.cos(j),x=Math.sin(j)),J=-Math.min(-S.x*x-S.y*c,-S.x*x+(1-S.y)*c,(1-S.x)*x-S.y*c,(1-S.x)*x+(1-S.y)*c),N=$.y-(J-t.y)*I.height),"position"===O&&"object"==typeof U._layoutVValue?(U._layoutVValue[0]=I.height,U._layoutVValue[1]=N):U._layoutVValue=[I.height,N,I.height,E.width,E.height,J]}}}},getSerializableProperties:function(){var R=Gk.superClass.getSerializableProperties.call(this);return dc(R,{image:1,host:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,position:1,anchor:1,anchorElevation:1,scale:1,scaleTall:1,_width:1,_height:1,_tall:1,elevation:1}),R}});var hb=k.Edge=function(O,a){var f=this;Hh(hb,f),f.setSource(O),f.setTarget(a)};Ni("Edge",oj,{ms_edge:!0,_icon:"edge_icon",getUIClass:function(){return Sq},_22Q:function(){return yn},getSource:function(){return this._source},getTarget:function(){return this._target},getSourceAgent:function(){return this._40I},getTargetAgent:function(){return this._41I},canSetSourceTarget:function(H){if(H===this)return!1;if(rd(H))return!0;for(var m,U,e,d,y,n=[this],g=-1,J=0;J>g;)if(g++,m=n[g],U=m._44I)for(U=U.getArray(),d=0,y=U.length;y>d;d++)if(e=U[d],ee(e)&&!(n.indexOf(e)>=0)){if(e===H)return!1;n.push(e),J++}return!0},setSource:function(u){var K=this;if(K._source!==u&&K.canSetSourceTarget(u)){var X=K._source;K._source=u,X&&X._16I(K),u&&u._2I(K),K._7I(),K.fp("source",X,u)}},setTarget:function(i){var v=this;if(v._target!==i&&v.canSetSourceTarget(i)){var N=v._target;v._target=i,N&&N._18I(v),i&&i._4I(v),v._7I(),v.fp("target",N,i)}},isLooped:function(){var F=this;return F._source===F._target&&rd(F._source)&&rd(F._target)},onPropertyChanged:function(){var N=this;N._49I&&N._49I.each(function(C){C.fp("agentChange",!0,!1)})},_7I:function(){var s,V=this,G=fb(V);V._40I!==G&&(s=this._40I,s&&s._15I(V),V._40I=G,G&&G._1I(V),V.fp("sourceAgent",s,G),qg(s,V._41I),qg(G,V._41I));var O=Jo(V);V._41I!==O&&(s=V._41I,s&&s._17I(V),V._41I=O,O&&O._3I(V),V.fp("targetAgent",s,O),qg(s,V._40I),qg(O,V._40I))},_22I:function(v){this._52I=v,this.fp("edgeGroup",!0,!1)},getEdgeGroup:function(){return this._52I},isEdgeGroupHidden:function(){var V=this;return V._52I&&V._52I.get(0)!==V&&!V.getStyle(oq)},getEdgeGroupSize:function(){return this._52I?this._52I.size():1},getEdgeGroupIndex:function(){return this._52I?this._52I.indexOf(this):0},isEdgeGroupAgent:function(){var M=this,c=M._52I;return c&&!M.getStyle(oq)&&c.size()>1&&M===c.get(0)},toggle:function(){var I=this._52I,P=!this.s(oq);I&&I.size()>1&&(I.each(function(e){e.s(oq,P)}),I.getSiblings().each(function(h){h!==I&&h.each(function(s){s.fp("edgeGroup",V,h)})}))},setStyle:function(H,R){(H===sb||"edge.segments"===H)&&(R=Jd(R)),hb.superClass.setStyle.call(this,H,R)},onStyleChanged:function(c){hb.superClass.onStyleChanged.apply(this,arguments),Vc[c]&&qg(this._41I,this._40I)},getSerializableProperties:function(){var f=hb.superClass.getSerializableProperties.call(this);return dc(f,{source:1,target:1}),f}});var qh=k.Group=function(){Hh(qh,this)};Ni("Group",Gk,{_image:"group_image",_icon:"group_icon",_57O:!1,getUIClass:function(){return gf},onChildAdded:function(){qh.superClass.onChildAdded.apply(this,arguments),this._81I()},onChildRemoved:function(){qh.superClass.onChildRemoved.apply(this,arguments),this._81I()},_81I:function(){var e=this;if(!e._54I&&!Mb){var L=e.getChildrenRect();L&&(e._53I=1,e.p(Lp(e.s("group.position"),L,e.getSize())),delete e._53I)}},getChildrenRect:function(){var Z,B=this;return B.eachChild(function(b){rd(b)&&(Z=ps(Z,B.getChildRect(b)))}),Z},getChildRect:function(R){var l;return rd(R)&&R.s(Ym)&&(bm(R)&&R.isExpanded()&&R.eachChild(function(C){l=ps(l,R.getChildRect(C))}),!l&&R.getRect&&(l=R.getRect())),l},setPosition:function(G,o){var H=this;if(!H._54I){var t;t=2===arguments.length?{x:G,y:o}:G,Mb||H._53I||(H._54I=1,nq(H._children,t.x-H._position.x,t.y-H._position.y),delete H._54I),qh.superClass.setPosition.call(this,t)}},toggle:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._57O},setExpanded:function(F){var A=this;if(A._57O!==F){var p=A._57O;A._57O=F,A.fp("expanded",p,A._57O),A._fireInvalidateDeep(),A._8I()}},_fireInvalidateDeep:function(){this.eachChild(function(r){bm(r)?r._fireInvalidateDeep():r.iv()})},_8I:function(){qh.superClass._8I.call(this),this.eachChild(function(V){rd(V)&&V._8I()})},onStyleChanged:function(d){qh.superClass.onStyleChanged.apply(this,arguments),"group.position"===d&&this._81I()},getSerializableProperties:function(){var y=qh.superClass.getSerializableProperties.call(this);return y.expanded=1,y}});var Cn=k.Block=function(){Hh(Cn,this)};Ni("Block",Gk,{_icon:"block_icon",_clickThroughEnabled:!1,_syncSize:!0,ms_ac:["clickThroughEnabled","syncSize"],getUIClass:function(){return ul},onChildAdded:function(){Cn.superClass.onChildAdded.apply(this,arguments),this.updateFromChildren()},onChildRemoved:function(){Cn.superClass.onChildRemoved.apply(this,arguments),this.updateFromChildren()},updateFromChildren:function(){var y=this;if(!Mb&&!y._updatingToChildren&&y._syncSize&&!y._freezeSyncFromChildren){var b,i,p,k,R,Z=[],t=y.getRotation();if(y.eachChild(function($){rd($)&&Z.push.apply(Z,$.getCorners())}),Z.length){y._updatingFromChildren=1;var E=e(-t),g=U(-t),r=1/0,N=-1/0,Y=1/0,G=-1/0;for(k=0,R=Z.length;R>k;k++)p=Z[k],b=p.x,i=p.y,p.x=E*b-g*i,p.y=g*b+E*i,r=f(r,p.x),N=D(N,p.x),Y=f(Y,p.y),G=D(G,p.y);var J=y.getScale();y.setSize(M((N-r)/J.x),M((G-Y)/J.y));var K;J.x<0&&(K=r,r=N,N=K),J.y<0&&(K=Y,Y=G,G=K),E=e(t),g=U(t);var T=y.getAnchor();b=r+(N-r)*T.x,i=Y+(G-Y)*T.y,y.setPosition(E*b-g*i,g*b+E*i),delete y._updatingFromChildren}}},setPosition:function(o,g){var u=this;if(!u._updatingToChildren){var b;b=2===arguments.length?{x:o,y:g}:o,Mb||u._updatingFromChildren||(u._updatingToChildren=1,nq(u._children,b.x-u._position.x,b.y-u._position.y),delete u._updatingToChildren),Cn.superClass.setPosition.call(this,b)}},setWidth:function(z){return this.setSize(z,this.getHeight())},setHeight:function(C){return this.setSize(this.getWidth(),C)},setSize:function(a,V){1>a&&(a=1),1>V&&(V=1);var C=this;if(!C._updatingToChildren){2!==arguments.length&&(V=a.height,a=a.width);var c=C.getWidth(),r=C.getHeight();if(a!==c&&Cn.superClass.setWidth.call(C,a),V!==r&&Cn.superClass.setHeight.call(C,V),!Mb&&!C._updatingFromChildren){C._updatingToChildren=1;var G=a/c,E=V/r;C._adjustChildScaleOrSize(G,E,"size"),delete C._updatingToChildren,C.updateFromChildren()}}},_adjustChildScaleOrSize:function(S,q,I){var E=this;if(E._syncSize){var l=E.getPosition(),Z=E.getRotation();E.getScale(),E.eachChild(function(u){if(rd(u)){var Q=u.getPosition(),p=u.getRotation(),O=u.getWidth(),B=u.getHeight(),c=u.getScale(),R=c.x*O,d=c.y*B,r=new Ae(p,Q.x,Q.y,R,d);r.translate(-l.x,-l.y),r.rotate(-Z),p=s(r.b*Math.sign(R),r.a*Math.sign(R)),r.scale(S,q);var n,m,M,F=e(p);if(Math.abs(F)<.001?(n=U(p),m=r.b/n,M=-r.c/n):(m=r.a/F,M=r.d/F),"scale"===I)u.setScale(m/O,M/B);else if("size"===I){var t=m/c.x,N=M/c.y;u.setScale(gb(m)*Math.abs(c.x),gb(M)*Math.abs(c.y)),u instanceof k.Shape?(u.setWidthForce(Math.max(Math.abs(t),1e-5)),u.setHeightForce(Math.max(Math.abs(N),1e-5))):u.setSize(Math.max(.01,Math.abs(t)),Math.max(.01,Math.abs(N)))}r.rotate(Z),r.translate(l.x,l.y),u.setPosition(r.tx,r.ty)}})}},_calcChangeFactor:function(r,S,E,e){var T,$,i,P;return T=M(r),$=M(E),i=T>$?T/$:$/T,T=M(S),$=M(e),P=T>$?T/$:$/T,D(i,P)},setAnchor:function(){var N=this;if(!N._updatingToChildren){var B=N.getAnchor();if(Cn.superClass.setAnchor.apply(N,arguments),!Mb&&!N._updatingFromChildren&&N._syncSize){N._updatingToChildren=1;var q=N.getAnchor();N.getPosition();var F=N.getSize(),j=N.getScale(),W=N.getRotation(),D=-F.width*j.x*(B.x-q.x),g=-F.height*j.y*(B.y-q.y),i=U(W),l=e(W),t=l*D-i*g,E=i*D+l*g;N.eachChild(function(K){if(rd(K)){var R=K.getPosition();K.setPosition(R.x-t,R.y-E)}}),delete N._updatingToChildren}}},setRotation:function(f){var b=this;if(!b._updatingToChildren){var D=b.getRotation();if(Cn.superClass.setRotation.apply(b,arguments),!Mb&&!b._updatingFromChildren){b._updatingToChildren=1;var e=b.getPosition(),h=f-D;b.eachChild(function(Q){if(rd(Q)){var z=Q.getMatrix();z.translate(-e.x,-e.y),z.rotate(h),z.translate(e.x,e.y);var X=Math.sign(Q.getScale().x);Q.setRotation(s(z.b*X,z.a*X)),Q.setPosition(z.tx,z.ty)}}),delete b._updatingToChildren}}},setScale:function(i,E){var o=this;if(!o._updatingToChildren){null==E&&(E=i.y,i=i.x);var P=o.getScale();if(M(i)<.01&&(i=.01*(gb(i)||gb(P.x))),M(E)<.01&&(E=.01*(gb(E)||gb(P.y))),Cn.superClass.setScale.call(o,i,E),!Mb&&!o._updatingFromChildren){o._updatingToChildren=1;var N=i/P.x,G=E/P.y;o._adjustChildScaleOrSize(N,G,"size"),delete o._updatingToChildren,o.updateFromChildren()}}},getSerializableProperties:function(){var R=Cn.superClass.getSerializableProperties.call(this);return R.clickThroughEnabled=1,R.syncSize=1,R}});var jp=k.Grid=function(){Hh(k.Grid,this)};Ni("Grid",Gk,{IRotatable:!1,_icon:"grid_icon",_image:V,getUIClass:function(){return Uk},setRotation:function(){},getCellRect:function(o,c){var a=this,l=a.s("grid.row.count"),j=a.s("grid.column.count");if(0>=l||0>=j||0>o||o>=l||0>c||c>=j)return V;var Q,n,h,v=a.getRect(),C=a.s("grid.row.percents"),w=a.s("grid.column.percents");if(hj(v,a,"grid.border",-1),C&&C._as&&(C=C._as),w&&w._as&&(w=w._as),C&&C.length===l){for(h=0,Q=0;o>Q;Q++)h+=v.height*C[Q];v.y+=h,v.height=v.height*C[o]}else v.height=v.height/l,v.y+=v.height*o;if(w&&w.length===j){for(n=0,Q=0;c>Q;Q++)n+=v.width*w[Q];v.x+=n,v.width=v.width*w[c]}else v.width=v.width/j,v.x+=v.width*c;return ol(v,-a.s("grid.gap")),v}});var iq=k.Text=function(){Hh(iq,this),this.setSize(100,50),this.s("text","TEXT")};Ni("Text",Gk,{_icon:"text_icon",_image:"__text__",getUIClass:function(){return ri},setWidth:function(J){J||(J=.001),iq.superClass.setWidth.call(this,J)},setHeight:function(z){z||(z=.001),iq.superClass.setHeight.call(this,z)},toLabel:function(){return this._displayName||this._name||this.s("text")}}),mk("__text__",{width:{value:100,isSafeFunc:!0,func:function(G){return G._width}},height:{value:50,isSafeFunc:!0,func:function(V){return V._height}},comps:[{type:"text",relative:!0,rect:[0,0,1,1],text:{func:"style@text"},align:{func:"style@text.align"},vAlign:{func:"style@text.vAlign"},color:{func:"style@text.color"},font:{func:"style@text.font"},shadow:{func:"style@text.shadow"},shadowColor:{func:"style@text.shadow.color"},shadowBlur:{func:"style@text.shadow.blur"},shadowOffsetX:{func:"style@text.shadow.offset.x"},shadowOffsetY:{func:"style@text.shadow.offset.y"},scaleX:{func:"style@text.scale.x"},scaleY:{func:"style@text.scale.y"}}]});var Wd=k.Shape=function(){Hh(Wd,this),this._59O=new Vd};Wd.__de__=zn,Ni("Shape",Gk,{ms_ac:["thickness","closePath"],_icon:"shape_icon",_thickness:10,_closePath:!1,getUIClass:function(){return dr},_22Q:function(){return tc},getLength:function(m){return Od(so(this._59O,this._58O,m,this._closePath))},getSegments:function(){return this._58O},toSegments:function(){var T=this._58O;return T?new Vd(T._as.slice(0)):T},setSegments:function(s){var x=this._58O;s=s?lk(s)?new Vd(s.slice(0)):new Vd(s._as.slice(0)):null,(x&&s&&x._as.join(",")!==s._as.join(",")||x!==s)&&(this._58O=s,this.fp("segments",x,s))},getPoints:function(){return this._59O},toPoints:function(){var Z=this._59O;return new Vd(Z._as.slice(0))},setPoints:function(V,g){var o=this,f=o._59O;V=V?lk(V)?new Vd(V.slice(0)):new Vd(V._as.slice(0)):new Vd;var J,H,n,P,X,S;g&&(J=o.getPosition(),S=new Ae(o.getRotation(),0,0,o.getScale().x,o.getScale().y)),(f&&V&&f._as.join(",")!==V._as.join(",")||f!==V)&&(o._59O=V,o.fs(),o.fp("points",f,V)),g&&(H=o.getPosition(),n=H.x-J.x,P=H.y-J.y,X=S.tf(n,P),o.setPosition(H.x-n+X.x,H.y-P+X.y))},addPoint:function(p,d,z){var B=this.toPoints();B.add(p,d),this.setPoints(B,z)},setPoint:function(V,f,Q){var o=this.toPoints();o.set(V,f),this.setPoints(o,Q)},removePointAt:function(A){var D=this.toPoints();D.removeAt(A),this.setPoints(D)},setWidthForce:function(L){var k=this;if(!k._55I&&!Mb&&k.getWidth()){k._55I=1;var q=k._position.x,w=L/k.getWidth(),H=k.toPoints(),J=new Vd;H.each(function(m){J.add({x:(m.x-q)*w+q,y:m.y,e:m.e})}),k.setPoints(J),uj(k,[w,0,0,1,q*(1-w),0]),k.fs(),delete k._55I}Wd.superClass.setWidth.call(k,L)},setWidth:function(A){return this.setWidthForce(1>A?1:A)},setHeightForce:function(R){var n=this;if(!n._55I&&!Mb&&n.getHeight()){n._55I=1;var c=n._position.y,x=R/n.getHeight(),r=n.toPoints(),I=new Vd;r.each(function(E){I.add({x:E.x,y:(E.y-c)*x+c,e:E.e})}),n.setPoints(I),uj(n,[1,0,0,x,0,c*(1-x)]),n.fs(),delete n._55I}Wd.superClass.setHeight.call(n,R)},setHeight:function(C){return this.setHeightForce(1>C?1:C)},setAnchorElevation:function(l){var D=this;D._55I=!0;var u=D._updatingAnchor3d,Y=!Mb&&!u;if(Y){var p,K=l,E=D.getAnchorElevation(),d=D.getTall();p=d*(E-K),D.shiftPointsElevation(p)}var W=Wd.superClass.setAnchorElevation.apply(D,arguments);return u||delete D._55I,W},getShapeElevation:function(){var S=this,u=S._54O;return u-(S.getTall()||0)*(S._anchorElevation-.5)},setAnchor3d:function(s,v,h,K){var C,f=this;"number"==typeof s?C={x:s,y:v,z:h}:(C=s.length?{x:s[0],y:s[1],z:s[2]}:s,K=v),f._55I=!0,f._updatingAnchor3d=!0;var p=f.getDataModel();if(p&&p.beginTransaction(),!Mb){var H=f.getAnchor3d(),m=f.getSize(),$=f.getTall(),k=m.width*(H.x-C.x),n=m.height*(H.z-C.z),X=$*(H.y-C.y);K||f.shiftPoints(k,n,X);var L=f.p3()}var T=Wd.superClass.setAnchor3d.apply(f,arguments);if(!Mb&&K){var F=f.p3();f.shiftPoints(F[0]-L[0]+k,F[2]-L[2]+n,F[1]-L[1]+X)}return p&&p.endTransaction(),delete f._updatingAnchor3d,delete f._55I,T},setAnchor:function(i,T,s){var G=this;G._55I=!0;var n=G._updatingAnchor3d,X=!Mb&&!n;if(X){var f,c,u;"number"==typeof i?u={x:i,y:T}:(u=i.length?{x:i[0],y:i[1]}:i,s=T);var H=G.getAnchor(),V=G.getSize();f=V.width*(H.x-u.x),c=V.height*(H.y-u.y),s||G.shiftPoints(f,c);var o=G.getPosition()}var y=Wd.superClass.setAnchor.apply(G,arguments);if(X){var d=G.getPosition();s&&G.shiftPoints(d.x-o.x+f,d.y-o.y+c)}return n||delete G._55I,y},shiftPoints:function(G,u,$){var E=this,W=E.getElevation()||0,n=E.toPoints(),c=new Vd;n.each(function(e){var T=e.e;$&&(T=(T==V?W:T)+$),c.add({x:e.x+G,y:e.y+u,e:T})}),E.setPoints(c),E.fs()},shiftPointsElevation:function(V){return this.shiftPoints(0,0,V)},setPosition:function(h,D){var q,m=this;if(!m._28Q){if(m._28Q=1,!m._55I&&!Mb){q=2===arguments.length?{x:h,y:D}:h;var p=q.x-m._position.x,g=q.y-m._position.y;if(0===p&&0===g)return delete m._28Q,void 0;m._55I=1,m.shiftPoints(p,g),uj(m,[1,0,0,1,p,g]),delete m._55I}Wd.superClass.setPosition.apply(m,arguments),delete m._28Q}},fs:function(){this.fireShapeChange()},_70I:function(){var R=this;if(2!==R._59O.size())return!1;var J=R._58O;return J?2===J.size()&&1===J.get(0)&&2===J.get(1)?!0:!1:!0},fireShapeChange:function(){var X=this;if(!X._55I&&!Mb){var k=fr(X._59O);k&&(X._55I=1,X.setRect(k),delete X._55I)}X.fp(Hd,!1,!0)},getSerializableProperties:function(){var c=Wd.superClass.getSerializableProperties.call(this);return c.segments=1,c.points=1,c.thickness=1,c.closePath=1,c}});var Wi=k.Polyline=function(){Hh(Wi,this),this.s({"shape.background":null,"shape.border.width":2})};Ni("Polyline",Wd,{_icon:"polyline_icon",_22Q:function(){return go},getUIClass:function(){return nc},setClosePath:function(){},setTall:function(Q){var $=this;if(!$._55I&&!$._24Q&&!Mb&&$.getTall()){$._24Q=1;var f=$._54O,i=Q/$.getTall();$._59O.each(function(R){R.e=R.e==V?f:(R.e-f)*i+f}),$.fs(),delete $._24Q}Wi.superClass.setTall.call($,Q)},setElevation:function(H){var G=this;if(!G._55I&&!G._24Q&&!Mb){G._24Q=1;var Z=H-G._54O;G._59O.each(function(w){w.e==V?w.e=H:w.e+=Z}),G.fs(),delete G._24Q}Wi.superClass.setElevation.apply(G,arguments)},fireShapeChange:function(){var q=this,p=q._59O;if(!q._55I&&!q._24Q&&!Mb){var i=p.size();if(i){var G=1,B=p.get(0),H=q._54O;B.e==V&&(B.e=H);for(var C=B.e,U=0;i>G;G++){B=p.get(G),B.e==V&&(B.e=H);var o=f(C,B.e),Q=D(C+U,B.e);C=o,U=Q-o}q._24Q=1,q.setTall(U),q.setElevation(C+U*q._anchorElevation),delete q._24Q}}Wi.superClass.fireShapeChange.apply(q,arguments)}});var Fo=k.SubGraph=function(){Hh(Fo,this)};Ni("SubGraph",Gk,{ISubGraph:1,_image:"subGraph_image",_icon:"subGraph_icon",_8I:function(){Fo.superClass._8I.call(this),this.eachChild(function(t){rd(t)&&t._8I()})}}),m.loadingRefGraph=0;var fd=k.RefGraph=function(){Hh(fd,this)};Ni("RefGraph",Cn,{_icon:"refGraph_icon",getRef:function(){return this._ref},setRef:function(Z){var m=this._ref;this._ref=Z,this.fp("ref",m,Z),this.updateRef()},_21I:function(){fd.superClass._21I.apply(this,arguments),this.updateRef()},updateRef:function(){var N=this;if(m.loadingRefGraph++,N.clearChildrenFromDataModel(),m.loadingRefGraph--,N._ref&&N._dataModel){N._xhrLoadHandler&&(N._xhrLoadHandler.cancel=!0);var F=Mb,K=N._xhrLoadHandler=function(Y){if(Y&&N._dataModel){m.loadingRefGraph++;var I=N._pendingUpdateInfo={needToRestore:F};F&&(I.position=N.p(),I.width=N.getWidth(),I.height=N.getHeight(),I.rotation=N.getRotation(),I.anchor=N.getAnchor(),I.scale=N.getScale()),N.p(0,0),N.setAnchor(.5,.5),N.setRotation(0),N.setScale(1,1);var D=m.parse(Y),U=N._dataModel.deserialize(D,N,{justDatas:!0});U.each(function(q){q._refGraph=N}),N.checkPendingUpdateInfo(),m.loadingRefGraph--,m.handleRefGraphLoaded(N,U,D)}};K.xhrLoadCalled=!1,m.load(N._ref,function(l){K.cancel||(K.xhrLoadCalled?K(l):Md(function(){K(l)}))}),K.xhrLoadCalled=!0}},checkPendingUpdateInfo:function(){var E=this,d=E._pendingUpdateInfo;
if(!d)return E.onPendingUpdated&&(m.loadingRefGraph++,E.onPendingUpdated(),m.loadingRefGraph--),void 0;var J=!0;this.eachChild(function(C){(C._pendingCheckImageJSON||C._pendingUpdateInfo)&&(J=!1)}),J&&(m.loadingRefGraph++,E._pendingUpdateInfo=null,E.updateFromChildren(),d.needToRestore&&(E.setSize(d.width,d.height),E.setAnchor(d.anchor),E.setRotation(d.rotation),E.setScale(d.scale),E.p(d.position)),this.getParent()instanceof fd&&this.getParent().checkPendingUpdateInfo(),E.onPendingUpdated&&E.onPendingUpdated(),m.loadingRefGraph--)},getSerializableProperties:function(){var C=fd.superClass.getSerializableProperties.call(this);return C.ref=1,C}}),k.EdgeGroup=function(w,X){this._70O=w,this._siblings=X;for(var C,G,l=0,q=w.size(),H=g[oq];q>l;l++)if(C=w.get(l).getStyle(oq,!1),C!=V){H=C;break}H==V&&(H=!0);var u=m.edgeGroupAgentFunc;for(u&&(G=u(w),G&&G!==w.get(0)&&(w.remove(G),w.add(G,0))),l=0;q>l;l++)w.get(l).s(oq,H)},Ni("EdgeGroup",H,{getEdges:function(){return this._70O},size:function(){return this._70O.size()},get:function(p){return this._70O.get(p)},indexOf:function(s){return this._70O.indexOf(s)},each:function(Z,u){this._70O.each(Z,u)},getSiblings:function(){return this._siblings},eachSiblingEdge:function(U,c){this._siblings.each(function(n){n._70O.each(U,c)})}});var ac=function(R,u,O){var b=yk[R]={type:R,action:u};if(O)for(var H in O)b[H]=O[H]};dc(m,{setConnectAction:ac,getConnectAction:function(d,q){if(!q){if(!d)return null;q=d.getCurrentConnectActionType()}return yk[q]},doConnectAction:function(B,X,p,e){e=e||B.getCurrentConnectActionType();var r=yk[e];if(!r)return!1;var D=r.action;return D?(X instanceof _p.Group?B.sm().getSelection().each(function(m){D.call(null,B,m,p)}):D.call(null,B,X,p),!0):!1},doDeleteConnectionAction:function(z,$,U){U=U||z.getCurrentConnectActionType();var v=yk[U];if(!v||!v.delete)return!1;var b=v.delete.action;return b?($ instanceof _p.Group?z.sm().getSelection().each(function(L){b.call(null,z,L)}):b.call(null,z,$),!0):!1}});var Si=k.JSONSerializer=function(Q,S){this.dm=this._dataModel=Q,this._hierarchical=m.forceHierarchicalSerialization?!0:S==V?Q.isHierarchicalRendering():S};Ni("JSONSerializer",H,{ms_ac:["hierarchical"],serialize:function(k){return m.stringify(this.toJSON(),k)},toJSON:function(){var V=this,i=V.dm,h=i.getRoots(),s=V.json={v:m.getVersion(),p:{},a:{},d:[]},M=i.getSerializableAttrs();i.getInit()&&(s.init=i.getInit()),i.getName()&&(s.p.name=i.getName()),i.getBackground()&&(s.p.background=i.getBackground()),i.getLayers()&&(s.p.layers=i.getLayers()),i.getEnvmap()&&(s.p.envmap=i.getEnvmap()),s.p.autoAdjustIndex=i.isAutoAdjustIndex(),s.p.hierarchicalRendering=i.isHierarchicalRendering();for(var d in M){var g=i.a(d);g!==C&&V[bb](d,g,s.a)}return Bk(s.a)&&delete s.a,V._hierarchical?h.each(V.serializeData,this):i.each(function(s){V.serializeData(s)}),i.fireSerializeEvent({type:"serialize",json:s}),i.getPostProcessingData()&&(s.p.postProcessingData=i.getPostProcessingData()),s},isSerializable:function(){return!0},getProperties:function(P){return P.getSerializableProperties()},getStyles:function(M){return M.getSerializableStyles()},getAttrs:function(x){return x.getSerializableAttrs()},serializeData:function(u){var L=this;if(L.isSerializable(u)&&!u._refGraph){var o,V,Q,p,M=Bf(u.getClassName())||u.getClass(),e=new M,A={c:u.getClassName(),i:u.getId(),p:{},s:{},a:{}};L.json.d.push(A),o=L.getProperties(u);for(V in o)if(/^_/.test(V)){if(Q=u[V],("_width"===V||"_height"===V)&&Q===C){var J;((u.s("layout.h")||u.s("layout.v"))&&u.getHost()||u instanceof k.Node&&(J=u.getParent())&&J instanceof k.Block||u.s("fullscreen"))&&(Q=u[V]="_width"===V?u.getWidth():u.getHeight())}Q!==e[V]&&L[bb](V.substr(1),Q,A.p)}else p=sc(V),u[p]&&(Q=u[p](),Q!==e[p]()&&L[bb](V,Q,A.p));o=L.getStyles(u);for(V in o)Q=u.s(V),Q!==e.s(V)&&L[bb](V,Q,A.s);o=L.getAttrs(u);for(V in o)Q=u.a(V),Q!==e.a(V)&&L[bb](V,Q,A.a);Bk(A.p)&&delete A.p,Bk(A.s)&&delete A.s,Bk(A.a)&&delete A.a}L._hierarchical&&u.getChildren().each(L.serializeData,L)},serializeValue:function(Q,g,y){br(g)?g={__a:g._as}:g instanceof oj&&(g={__i:g.getId()}),y[Q]=g},deserialize:function(M,i,q){var I=this;return Jh(M)&&/.json$/.test(M)?(m.xhrLoad(M,function(E){I.deserializeImpl(E,i,q)}),void 0):I.deserializeImpl(M,i,q)},deserializeImpl:function(W,g,Z){var T=this,P=T.dm;Z=Hm(Z)?{setId:Z}:fg(Z)?{finishFunc:Z}:Z||{},W=T.json=Jh(W)?m.parse(W):W,W.a&&W.a.onPreDeserialize&&!Z.disableOnPreDeserialize&&W.a.onPreDeserialize(W,P,Z.view),P.beginTransaction(),Mb++,T._82I={};var O=new Vd,x=new Vd,h=0,i=W.d.length;if(Z.justDatas||(fg(W.init)&&W.init(P),P.setInit(W.init)),!Z.justDatas){for(var y in W.a)P.a(y,T[Gf](W.a[y]));for(var K in W.p)P[wc(K)](W.p[K])}for(;i>h;h++){var A=W.d[h],M=Bf(A.c),L=new M,c=A.i;Z.setId&&c!=V&&(L._id=c),T._82I[c]=L,O.add(L),x.add(A)}for(h=0;i>h;h++)T.deserializeData(O.get(h),x.get(h));return O.each(function(I){g&&!I.getParent()&&I.setParent(g),P.add(I)}),P.fireSerializeEvent({type:"deserialize",json:W}),Mb--,P.endTransaction(),W.a&&W.a.onPostDeserialize&&!Z.disableOnPostDeserialize&&W.a.onPostDeserialize(W,P,Z.view,O),Z.finishFunc&&Z.finishFunc(W,P,Z.view,O),O},deserializeData:function(M,Y){for(var l in Y.p)M[wc(l)](this[Gf](Y.p[l]));for(l in Y.s)M.s(l,this[Gf](Y.s[l]));for(l in Y.a)M.a(l,this[Gf](Y.a[l]))},deserializeValue:function(F){if(Ib(F)){var $=F.__i;if($!=V)return this._82I[$];if($=F.__a,lk($))return new Vd($)}return F}}),dc(bi,{serialize:function(o,N){return new Si(this,N).serialize(o)},toJSON:function(X){return new Si(this,X).toJSON()},deserialize:function(C,k,R){return new Si(this).deserialize(C,k,R)}});var Il=k.OverlappingBox=function(b){this.gv=b,this.boxes={}};Ni("OverlappingBox",H,{clear:function(){var l,d,z=this.boxes;for(l in z)d=z[l],d.length=0},isOverlapping:function(S,d){var N,B,n=this,Y=n.boxes,f=Y[S];f?(N=f.rects,B=f.length):f=Y[S]={rects:N=[],length:B=0};var x,v,d;for(x=0;B>x;x++)if(v=N[x],v.x<d.x+d.w&&v.x+v.w>d.x&&v.y<d.y+d.h&&v.h+v.y>d.y)return!0;return N.length<=B?(N.push(d),f.length++):N[f.length++]=d,!1}}),dc(m,{fetch:function(K,Q){var f="GET",k=!1,N=null,o="";Q&&(f=Q.method||"GET",k=Q.sync,o=Q.url,N=Q.data||null),K.open(f,o,!k),Q.responseType?K.responseType=Q.responseType:Q.overrideMimeType&&K.overrideMimeType&&K.overrideMimeType(Q.overrideMimeType),K.send(N)},convertImageSrc:function(M,h){h&&"function"==typeof h||(h=function(){}),h(M)}});var lh=k.Request=function(){this._xhr=new XMLHttpRequest,this._onloadFunc=function(){},this._errorFunc=function(){}};Ni("Request",H,{_responseType:null,_overrideMimeType:"text/plain",send:function(E){var N=this._xhr,d=this.onload,Q=this.onerror;this.getResponseType()?E.responseType=this.getResponseType():this.getOverrideMimeType()&&(E.overrideMimeType=this.getOverrideMimeType()),N.onload=d,N.onerror=Q,m.fetch(N,E)},onload:function(){},onerror:function(){},getResponseType:function(){return this._responseType},setResponseType:function(t){this._responseType=t},getOverrideMimeType:function(){return this._overrideMimeType},setOverrideMimeType:function(A){this._overrideMimeType=A},getResponseText:function(){var e=this._xhr;return e.response||e.responseText}}),Wm.GraphView=function(C){var d=this;d._24I={},d._34I=new Vd,d._25I={},d._56I={},d._view=np(1,d),d._canvas=sk(d._view),d.dm(C?C:new bi),this._coreInteractor=new sm(this),d.setEditable(!1),d.setScrollBarVisible(m.graphViewScrollBarVisible)},en("GraphView",H,{ms_v:1,ms_gv:1,ms_bnb:1,ms_tip:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,_52o:1,_51o:1,ms_ac:[Qc,Qj,Cf,ts,"resettable","editInteractor",_r,"zoomable","pannable","rectSelectable","autoScrollZone",_d,"movableFunc","editableFunc","pointEditableFunc","rectEditableFunc","rotationEditableFunc","anchorEditableFunc","rectSelectBackground","rectSelectBorderColor","editPointSize","editPointBorderColor","editPointBackground","hoverDelay"],_zoomable:m.graphViewZoomable,_resettable:m.graphViewResettable,_pannable:m.graphViewPannable,_rectSelectable:m.graphViewRectSelectable,_autoScrollZone:m.graphViewAutoScrollZone,_rectSelectBackground:m.graphViewRectSelectBackground,_rectSelectBorderColor:m.graphViewRectSelectBorderColor,_editPointSize:m.graphViewEditPointSize,_editPointBorderColor:m.graphViewEditPointBorderColor,_editPointBackground:m.graphViewEditPointBackground,_scrollBarColor:Dd,_scrollBarSize:Lb,_autoHideScrollBar:Uq,_autoMakeVisible:Ai,_currentActionType:null,getCoreInteractor:function(){return this._coreInteractor},getLayers:function(){return this._dataModel.getLayers()},setLayers:function(X){this._dataModel.setLayers(X)},setEditable:function(U){var X=this,_=X.__interactorMap__;if(!_){var Q=Wm.XEditInteractor;_=X.__interactorMap__={scrollBar:new nf(X),select:new pi(X),edit:Q?new Q(X):new jo(X),text:new Nm(X),move:new kq(X),"default":new gm(X),touch:new _f(X,{editable:!1})}}U?(X._uieditable=!0,X.setInteractors([_.scrollBar,_.select,_.edit,_.text,_.move,_.default,_.touch])):(X._uieditable=!1,X.setInteractors([_.scrollBar,_.select,_.move,_.default,_.touch]))},getCanvas:function(){return this._canvas},_33I:function(N){var H=N.getUIClass();return H?new H(this,N):V},getDataUI:function(i){var _=this,I=_._25I[i._id];return I===C&&(I=_._33I(i),_._25I[i._id]=I),I},getNodeRect:function(j){return m.getNodeRect(this,j)},getFullscreenDatas:function(){return this._dataModel.getFullscreenDatas()},getEdgeInfo:function(h){var H=this.getDataUI(h);return H?(H._79o(),H._78o):null},getEdgeSourcePosition:function(u){var b=this,C=b.getDataUI(u),T=C.s,l=C._data._40I;return zh(b,l,T("edge.source.position"),T("edge.source.offset.x"),T("edge.source.offset.y"),T("edge.source.anchor.x"),T("edge.source.anchor.y"))},getEdgeTargetPosition:function(V){var M=this,v=M.getDataUI(V),$=v.s,b=v._data._41I;return zh(M,b,$("edge.target.position"),$("edge.target.offset.x"),$("edge.target.offset.y"),$("edge.target.anchor.x"),$("edge.target.anchor.y"))},invalidateAll:function(D){var B=this;if(D){for(var o in B._25I){var $=B._25I[o];$&&$.dispose()}B._25I={},B._56I={},B._24I={},B._34I.clear(),B.redraw()}else B.dm().each(function(T){B.invalidateData(T)})},invalidateSelection:function(){var Z=this;Z.sm().each(function(V){Z.invalidateData(V)})},invalidateData:function(g){var b=this;b._24I[g._id]=g,b._21Q(g),b.iv()},_21Q:function(O){var q=this,l=q._24I;if(ee(O)&&Io[O.s(Bb)]){var V=O.getSourceAgent();V&&V.getAgentEdges().each(function($){l[$._id]=$}),V=O.getTargetAgent(),V&&V.getAgentEdges().each(function(j){l[j._id]=j}),q.iv()}},redraw:function(b){var R=this;R._32I||(b?R._34I.add(b):(R._32I=1,R._34I.clear()),R.iv())},each:function(s,p){var Y,g,E,q=0,M=this.getLayers(),C=this._dataModel,F=C._datas._as,t=F.length;if(M){for(var r=M.length;r>q;q++)if(E=M[q],Ib(E)&&(E=E.name),C.isHierarchicalRendering()){var l=function(N){return N._layer===E?p?s.call(p,N):s(N):void 0};if(this._dataModel.eachByHierarchical(l)===!1)return}else for(var U=0;t>U;U++)if(Y=F[U],Y._layer===E&&(g=p?s.call(p,Y):s(Y),g===!1))return}else if(C.isHierarchicalRendering())this._dataModel.eachByHierarchical(s,null,p);else for(;t>q;q++)if(Y=F[q],g=p?s.call(p,Y):s(Y),g===!1)return},reverseEach:function(B,i){var s,r,I,L,f=this._dataModel,v=f._layers,A=f._datas._as,S=A.length;if(v){for(s=v.length-1;s>=0;s--)if(L=v[s],Ib(L)&&(L=L.name),f.isHierarchicalRendering()){var R=function(U){return U._layer===L?i?B.call(i,U):B(U):void 0};if(f.reverseEachByHierarchical(R)===!1)return}else for(var o=S-1;o>=0;o--)if(r=A[o],r._layer===L&&(I=i?B.call(i,r):B(r),I===!1))return}else if(f.isHierarchicalRendering())f.reverseEachByHierarchical(B,null,i);else for(s=S-1;s>=0;s--)if(r=A[s],I=i?B.call(i,r):B(r),I===!1)return},getViewRect:function(){return this._29I},getContentRect:function(){var f=this,A=f._84I;if(!A){var Z=this.dm().a("width"),h=this.dm().a("height");Z>0&&h>0?f._84I={x:0,y:0,width:Z,height:h}:(f.each(function(V){f.isVisible(V)&&(A=ps(A,f.getDataUIBounds(V)))}),f._84I=A?A:fe)}return f._84I},getScrollRect:function(){return ps(this.getContentRect(),this._29I)},makeCenter:function(v,F,B){var D=this;if(!D.getWidth()||!D.getHeight())return B||Md(D.centerData,D,[v,F,!0],500),void 0;D.makeVisible(v),D.validate();var U=D.getDataUIBounds(v);if(U){var C=D.getWidth(),O=D.getHeight(),e=U.x+U.width/2,u=U.y+U.height/2,G=-e*D._zoom+C/2,o=-u*D._zoom+O/2;D.setTranslate(G,o,F)}},fitData:function(o,n,G,j,y){var h=this;if(!h.getWidth()||!h.getHeight())return y||Md(h.fitData,h,[o,n,G,j,!0],500),void 0;var Z=function(){h.makeVisible(o),h.validate();var I=h.getDataUIBounds(o);I&&(I=Zq(I),ol(I,G==V?20:G),h.fitRect(I,n,j))};n?m.callWhenLoaded(Z):Z()},fitContent:function(G,F,y,$){var q=this;if(!q.getWidth()||!q.getHeight())return $||Md(q.fitContent,q,[G,F,y,!0],500),void 0;var A=function(){q.validate();var Q=Zq(q.getContentRect());ol(Q,F==V?20:F),q.fitRect(Q,G,y)};G?m.callWhenLoaded(A):A()},fitRect:function(l,y,b){var r=this,A=r.getWidth(),d=r.getHeight(),k=l.x+l.width/2,x=l.y+l.height/2,G=f(A/l.width,d/l.height),N=r._zoom,J=-k*N+A/2,Q=-x*N+d/2;0===G||isNaN(G)||(b&&(G=f(1,G)),y?(r._65I&&(delete r._65I.finishFunc,r._65I.stop(!0)),r._14o&&r._14o.stop(!0),r.setTranslate(J,Q,{finishFunc:function(){r.setZoom(G,y)}})):(r.setTranslate(J,Q),r.setZoom(G)))},toCanvas:function(K,o){o=o||this._zoom,this.validateImpl();var m=this,A=m.getContentRect();A.width||(A.width=10),A.height||(A.height=10);var d=sk(),Q=A.x*o,s=A.y*o,h=A.width*o,S=A.height*o;ye(d,h,S,1);var W=Qq(d);return K=K||this._dataModel.getBackground(),K&&Qm(W,0,0,h,S,K),Zo(W,-Q,-s),W.scale(o,o),m._42(W),W.restore(),d},toDataURL:function(D,q,g){return this.toCanvas(D,g).toDataURL(q||"image/png",1)},getClipBounds:function(){return this._74O},_42:function(u,O){var V=this,m=V.dm().getBackground();if(m){var N=V.dm().a("width"),p=V.dm().a("height");N>0&&p>0&&Qm(u,0,0,N,p,m)}var C=V.__htmlOrderList,e=[];if(V._93db(u,O),V.each(function(E){var S=V.getDataUI(E);if(S){var P=V._56I[E._id],U=S._htmlView;if(P){var z=S._79o();if(U=S._htmlView,k.HtmlNode&&E instanceof k.HtmlNode)S._42(u);else{var $=V.getViewRect(),C=U&&U.layoutHTML;!O||zj(O,z)?(C&&(U.layoutHTML(),S.__outerLayout&&delete S.__outerLayout),S._42(u)):zj($,z)||!C||S.__outerLayout||(U.layoutHTML(),S.__outerLayout=!0)}}U&&(e.push(U),U.getView&&(U=U.getView()),U.style.display=P?"block":Fi)}}),C&&e.length>0){var K=!1;if(C.length!==e.length)K=!0;else for(var j=0;j<e.length;j++)if(e[j]!==C[j]){K=!0;break}K&&(e.forEach(function(Y){V.appendHTML(Y,!0)}),this.__htmlOrderList=e)}else this.__htmlOrderList=e;V._92db(u,O)},validateImpl:function(){this.tryUpdateRootData();var C,l,O,F,f,V=this,M=V.tx(),N=V.ty(),Q=V._zoom,Z=V._canvas,S=this.getWidth(),b=this.getHeight(),L=V._29I,z={x:-M/Q,y:-N/Q,width:S/Q,height:b/Q},_={},q=V._34I,E=V._24I,I=V._32I,P=V._23I;V._24I={},(S!==Z.clientWidth||b!==Z.clientHeight)&&(ye(Z,S,b),I=1),I||sd(z,L)||(I=1),V._29I=z,V.each(function(M){l=M._id;var v=_[l]=V.isVisible(M);v!==V._56I[l]&&(E[l]=M,O=V.getDataUI(E[l]),O&&O._84o(v),V._84o(M,v))},V);for(l in E)O=V.getDataUI(E[l]),O&&(!I&&V._56I[l]&&(f=O._79o(),f&&q.add(f)),O.invalidate()),V._83I=1;if(V._56I=_,!I)for(l in E)_[l]&&(O=V.getDataUI(E[l]),O&&(f=O._79o(),f&&q.add(f)));if(I?F=z:(q.each(function(C){zj(z,C)&&(F=ps(F,C))}),F&&(ol(F,D(1,1/Q)),F.x=$(F.x*Q)/Q,F.y=$(F.y*Q)/Q,F.width=j(F.width*Q)/Q,F.height=j(F.height*Q)/Q,F=xj(z,F))),V._74O=F,F){C=Qq(Z);var H=F.x,X=F.y,A=F.width,m=F.height;H=Math.floor((H*Q+M)*lo),X=Math.floor((X*Q+N)*lo),A=Math.ceil(A*Q*lo)+1,m=Math.ceil(m*Q*lo)+1,C.beginPath(),C.rect(H,X,A,m),C.clip(),C.clearRect(H,X,A,m),dl(C,M,N,Q),V._42(C,F),C.restore(),delete V._74O}if(q.clear(),delete V._32I,P&&S>0&&b>0){var O=V.getDataUI(P);if(O){var f=O._79o(),R=V._29I,v=R.x,h=R.y,i=R.width,o=R.height,Q=V._zoom;f&&!zj(f,R)&&(f.x+f.width<v&&V.tx(-f.x*Q),f.x>v+i&&V.tx(-(f.x+f.width-i)*Q),f.y+f.height<h&&V.ty(-f.y*Q),f.y>h+o&&V.ty(-(f.y+f.height-o)*Q))}delete V._23I}V._83I&&(delete V._83I,delete V._84I),V._98O(),V.countFrame(),Bk(V._24I)||Md(V.iv,V)},isValidGuideLineSource:function(){return!0},tryUpdateRootData:function(){if(!this._rootDataUpdating){this._rootDataUpdating=!0;var X,g=this.getFullscreenDatas();for(var W in g)X=g[W],this.scaleRootData(X);this._rootDataUpdating=!1}},scaleRootData:function(Y){var C=Y.s("fullscreen");if("uniform"===C||"fill"===C){Y.getRotation()&&Y.setRotation(0);var b=Y.s("fullscreen.gap")||0,j=this.getWidth(),O=this.getHeight();if(j&&O){var E,c,v,r=j-2*b,G=O-2*b,u=Y.getAnchor(),z=Y.getScaledSize(),h=z.width,V=z.height,L=Y.s("fullscreen.lock");if(L)return"uniform"===C?r/G>h/V?(E=G/V,h=V*r/G):(E=r/h,V=h*G/r):"v"===L?(E=G/V,h=r/E,Y.getWidth()!==h&&Y.setWidth(h)):(E=r/h,V=G/E,Y.getHeight()!==V&&Y.setHeight(V)),this.setZoom(E),c=b-(Y.getX()-u.x*h)*E,v=b-(Y.getY()-u.y*V)*E,c!==this.tx()&&this.tx(c),v!==this.ty()&&this.ty(v),void 0;c=this.tx(),v=this.ty(),E=this._zoom;var P={x:(-c+b)/E,y:(-v+b)/E,width:r/E,height:G/E};if("uniform"===C){var s=h/V,Z=Math.min(P.width,P.height*s),g=Z/s;P.x+=.5*(P.width-Z),P.y+=.5*(P.height-g),P.width=Z,P.height=g}r=P.width/Y.getScaleX(),G=P.height/Y.getScaleY(),(Y.getWidth()!=r||Y.getHeight()!==G)&&Y.setSize(r,G);var y=P.x+u.x*P.width,o=P.y+u.y*P.height,J=Y.getPosition();(y!==J.x||o!==J.y)&&Y.setPosition(y,o)}}},isScrollBarVisible:function(){return!!this._79O},setScrollBarVisible:function(z){var t=this;z!==t.isScrollBarVisible()&&(z?(Kl(t._view,t._79O=Ij()),Kl(t._79O,t._27I=Ij()),Kl(t._79O,t._28I=Ij())):(Nr(t._79O),delete t._79O,delete t._27I,delete t._28I),t.fp("scrollBarVisible",!z,z))},getDebugTip:function(){return""},showScrollBar:function(){var g=this;g._79O&&(g._85I||(G(function(){g._86I()},Nd),g.iv()),g._85I=new Date)},_86I:function(){var q=this;if(q._85I){var b=new Date,Z=b.getTime();Z-q._85I.getTime()>=Nd?(delete q._85I,q.iv()):G(function(){q._86I()},Nd)}},getVScrollBar:function(){return this._27I},getHScrollBar:function(){return this._28I},_98O:function(){var m=this,v=this._27I,b=this._28I;if(m._79O){if(m._autoHideScrollBar&&!m._85I)return v.style.visibility=ki,b.style.visibility=ki,void 0;var x=m.getScrollBarColor(),U=m._zoom,p=m.getScrollBarSize(),c=m.getViewRect(),G=m.getScrollRect(),f=c.height*U,D=G.height*U,Z=c.width*U-p-2,o=f*((c.y-G.y)*U/D),k=f*(f/D),j=v.style;D-.5>f?(Pm>k&&(o=o+k/2-Pm/2,0>o&&(o=0),o+Pm>f&&(o=f-Pm),k=Pm),xg(v,Z,o,p,k),j.visibility=gk,j.background=x,j.borderRadius=p/2+Sd):j.visibility=ki;var r=c.width*U,S=G.width*U,o=c.height*U-p-2,Z=r*((c.x-G.x)*U/S),e=r*(r/S),j=b.style;S-.5>r?(Pm>e&&(Z=Z+e/2-Pm/2,0>Z&&(Z=0),Z+Pm>r&&(Z=r-Pm),e=Pm),xg(b,Z,o,e,p),j.visibility=gk,j.background=x,j.borderRadius=p/2+Sd):j.visibility=ki}},setDataModel:function(O){var f=this,W=f._dataModel,S=f._selectionModel;W!==O&&(W&&(W.ump(f.handleDataModelPropertyChange,f),W.umm(f.handleDataModelChange,f),W.umd(f.handleDataPropertyChange,f),W.removeIndexChangeListener(f._75O,f),W.removeHierarchyChangeListener(f.handleHierarchyChange,f),S||W.sm().ums(f.handleSelectionChange,f)),f._dataModel=O,O.mp(f.handleDataModelPropertyChange,f),O.mm(f.handleDataModelChange,f),O.md(f.handleDataPropertyChange,f),O.addIndexChangeListener(f._75O,f),O.addHierarchyChangeListener(f.handleHierarchyChange,f),S?S._21I(O):O.sm().ms(f.handleSelectionChange,f),f.invalidateAll(!0),f.fp(al,W,O),f.updateBackground())},getLayersInfo:function(){if(this._layersInfo===C){var c=this.getLayers();c?(this._layersInfo={},c.forEach(function(V){var B=Ib(V)?V.name:V;this._layersInfo[B]=V},this)):this._layersInfo=null}return this._layersInfo},calculateEdgePosition:function(l,G,f){var k,Z,r=this,O=r.getDataUI(l),y=Gq(O),t=ls(G,function(H){return sp(y,100*H)},100,.001),C=sp(y,100*t);if(!f){var X=vh(O),i=new nj(C.x,C.y),e=49/(r._zoom*r._zoom);for(k=0,Z=X.length;Z>k;k++)if(i.distanceToSquared(X[k])<e)return{index:k,point:X[k],distance:Math.sqrt((X[k].x-G.x)*(X[k].x-G.x)+(X[k].y-G.y)*(X[k].y-G.y))}}return{percent:t,point:C,distance:Math.sqrt((C.x-G.x)*(C.x-G.x)+(C.y-G.y)*(C.y-G.y))}},calculateAttachPoint:function(){var A=new nj,E=new nj,r=new nj;return function(z,N){var x=this.getAttachPoints(z);if(!x||!x.length)return null;r.set(N.x,N.y);for(var l,P,i,y,c=1/0,f=0,$=x.length;$>f;f++)i=x[f],E.x=i.x,E.y=i.y,A.x=i.offsetX||0,A.y=i.offsetY||0,y=zh(this,z,0,A.x,A.y,E.x,E.y),P=r.distanceToSquared(y),c>P&&(l=f,c=P);c=Math.sqrt(c);var F=this.getAttachStyle(z);if("close"===F){var T=z.s("attach.close.threshold")/this._zoom;if(c>T)return null}return{index:l,distance:c,info:x[l]}}}(),getAttachPoints:function(f){var E=f.s("attach.points");if(E)return E;var o=hs(f._image);return o?$d(o.attachPoints,f,this)||null:void 0},getAttachStyle:function(n){var Q=n.s("attach.style");if(Q)return Q;var T=hs(n._image);return T?$d(T.attachStyle,n,this)||"close":void 0},updateLayers:function(){this._layersInfo=C,this.invalidateSelection(),this.redraw()},updateBackground:function(){var Y=this.dm().a("width"),O=this.dm().a("height");this._canvas.style.background=Y>0&&O>0?"":this.dm().getBackground()||""},handleDataModelPropertyChange:function(p){if("background"===p.property){var E=this._canvas.style.background,u=p.newValue||"";this.updateBackground(),this.fp("canvasBackground",E,u),this.redraw()}else"a:width"===p.property||"a:height"===p.property?(this._83I=1,this.updateBackground(),this.redraw()):"layers"===p.property?this.updateLayers():"hierarchicalRendering"===p.property&&this.redraw()},handleDataPropertyChange:function(g){this.dm().isHierarchicalRendering()&&"parent"===g.property&&g.data.hasChildren()&&this.redraw(),this.invalidateData(g.data)},onPropertyChanged:function(w){var U=this,g=w.property;if(U.redraw(),"zoom"===g){var P=U.sm().getSelection();P.size()&&P.each(function(p){p.invalidate()})}Do[g]?U.showScrollBar():g===_r&&U.onCurrentSubGraphChanged(w)},onCurrentSubGraphChanged:function(){this.sm().cs(),this.reset()},handleDataModelChange:function(Y){var G=this,y=Y.kind,e=Y.data;if(G._83I=1,"add"===y)G.invalidateData(e),ee(e)&&e.getEdgeGroup()&&e.getEdgeGroup().eachSiblingEdge(G.invalidateData,G);else if(y===ih){G._21Q(e);var h=e._id,j=G._25I[h];if(j){if(G._56I[h]){var X=j._79o();X&&G.redraw(X)}j.dispose(),delete G._25I[h],delete G._24I[h],delete G._56I[h]}e===G._currentSubGraph&&G.setCurrentSubGraph(V)}else y===cn&&(G.invalidateAll(!0),G.setCurrentSubGraph(V))},_75O:function(o){this.invalidateData(o.data)},handleHierarchyChange:function(l){this.dm().isHierarchicalRendering()&&l.data.hasChildren()&&this.redraw(),this.invalidateData(l.data)},adjustIndex:function(f){var z=this;if(z.isVisible(f)){z.dm().beginTransaction();for(var k=f;k._parent&&z.isVisible(k._parent);)k=k._parent;k&&k!==f&&z._dataModel.adjustIndex(k),z._dataModel.adjustIndex(f),z.dm().endTransaction()}},getImage:function(Q){return Q.getImage?Q.getImage():C},getSelectWidth:function(v){var Z=hs(this.getImage(v));return Z&&$d(Z.disableSelectedBorder,v,this)?0:v.s("select.width")},getSelectColor:function(k){return k.s("select.color")},isSelectable:function(V,z){if(this.isSelected(V))return!0;if(!z&&V.getParent()instanceof Cn&&this.isSelectable(V.getParent(),!0)&&V.getParent().isSyncSize())return!1;var Z=this.getLayersInfo();if(Z){var O=Z[V._layer];if(O&&O.selectable===!1)return!1}return V.s("2d.selectable")&&this.sm().isSelectable(V)},isMovable:function(v){var U=this;if(ee(v)&&v.getStyle(Bb)!==Lg)return!1;var M=this.getLayersInfo();if(M){var X=M[v._layer];if(X&&X.movable===!1)return!1}return v.s("2d.movable")?U._movableFunc?U._movableFunc(v):!0:!1},isEditable:function(g){var q=this;if(k._uiSerializing)return q._uieditable;if(!q._editInteractor||!q.isSelected(g))return!1;if(bm(g)){var p=q.getDataUI(g);if(!p||p._88I)return!1}if(ee(g)&&g.getStyle(Bb)!==Lg)return!1;var D=this.getLayersInfo();if(D){var I=D[g._layer];if(I&&I.editable===!1)return!1}return g.s("2d.editable")?q._editableFunc?q._editableFunc(g):!0:!1},handleDelete:function(){this._editInteractor&&(this._editInteractor.handleDelete?this._editInteractor.handleDelete():this.removeSelection())},isPointEditable:function(o){return rd(o)&&0!==o.getRotation()?!1:this._pointEditableFunc?this._pointEditableFunc(o):!0},isRectEditable:function(K){return this._rectEditableFunc?this._rectEditableFunc(K):!0},isAnchorEditable:function(X){return this._anchorEditableFunc?this._anchorEditableFunc(X):!0},isRotationEditable:function(q){return q.setRotation&&q.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(q):!0:!1},getRotationPoint:function(G){var v=G.getAnchor(),Q=G.getScale(),g=this._zoom,a=qe(G.getRotation(),0,-G.getHeight()*Q.y*v.y-(Q.y<0?-1:1)*(fn?32:16)/g),y=G.p();return a.x+=y.x,a.y+=y.y,a},getLogicalPoint:function(V){var v=this;return Gh(V,v._canvas,v.tx(),v.ty(),v._zoom,v._zoom)},getScreenPoint:function(I,y){var F,J=this;return"object"==typeof I?I.x!==C?(F=I.x,y=I.y):(F=I[0],y=I[1]):F=I,Tg(F,y,J._canvas,J.tx(),J.ty(),J._zoom,J._zoom)},getSelectedDataAt:function(t){var K=this;return this.getDataAt(t,function(s){return K.isSelected(s)})},getDataInfoAt:function(W,u,x){var j,M=this.lp(W),m=this.getDataAt(M,u,x);if(m){var i=this.getDataUI(m);j={data:m,ui:i,point:M};var G=i._38o;if(G){var C=G.icons;for(var l in C){var s=C[l],w=G.rects[l];if(w)for(var E=$d(s.names,m,this),P=E?E.length:0,d=w.rotation,S=P-1;S>=0;S--){var _=E[S],J=w[S];if(zc(J,M,d))return j.part="icons",j.name=l,j.icon=_,j.rect=J,j.index=S,j.rotation=d,j}}}if(this.isNoteVisible(m)){if(i.note2Info&&zc(i.note2Info.clickRect,M,V,i.note2Info.scale))return j.part="note2",j;if(i.noteInfo&&zc(i.noteInfo.clickRect,M,V,i.noteInfo.scale))return j.part="note",j}if(this.isLabelVisible(m)){if(i.label2Info&&zc(i.label2Info.rect,M,i.label2Info.rotation,i.label2Info.scale))return j.part="label2",j;if(i.labelInfo&&zc(i.labelInfo.rect,M,i.labelInfo.rotation,i.labelInfo.scale))return j.part="label",j}if(m.isInRect&&m.isInRect(M))return j.part="body",j}return j},getDataAt:function(G,g,u){G.target&&(G=this.lp(G));var r,b=this._zoom;return this.reverseEach(function(p){return(g?g(p):this.isSelectable(p))&&this.rectIntersects(p,Gr(G.x,G.y,u,b))?(r=p,!1):void 0},this),r},getIconInfoAt:function(O,P){var j=this;if(O.target&&(O=j.lp(O)),P||(P=j.getDataAt(O)),P){var s=j.getDataUI(P);if(s&&s._38o){var n,C=s._38o,z=new Vd;for(n in C.icons)z.add(n);for(var b=z.size()-1;b>=0;b--){n=z.get(b);for(var I=C.rects[n],o=I.rotation,i=I.length-1;i>=0;i--){var c=I[i],y=c.width,S=c.height,Y={x:O.x-c.x-y/2,y:O.y-c.y-S/2};o!=V&&(Y=qe(-o,Y.x,Y.y));var c={x:-y/2,y:-S/2,width:y,height:S};if(zc(c,Y))return{key:n,index:i,name:C.icons[n].names[i],rect:I[i],point:O,rotation:o,relativeRect:c,relativePoint:Y,data:P}}}}}return V},getDatasInRect:function(a,h,c){c===C&&(c=1);var d=this,z=new Vd;return d.reverseEach(function(i){c&&!d.isSelectable(i)||(h?d.rectIntersects(i,a):d.rectContains(i,a))&&z.add(i)}),z},moveSelection:function(b,A){var n=this;n.dm().beginTransaction(),nq(n.sm().toSelection(n.isMovable,n),b,A),n.dm().endTransaction()},moveDatas:function(E,N,A){var Y=this;Y.dm().beginTransaction(),E instanceof Vd||(E=new Vd(E)),nq(E,N,A),Y.dm().endTransaction()},getDataUIBounds:function(h){var e=this.getDataUI(h);return e?e._79o():V},drawData:function(O,X,f){var Q=this.getDataUI(X);if(Q){var J=Q._79o();(!f||zj(f,J))&&(Q._42(O),X instanceof k.Block&&X.eachChild(function(D){this.drawData(O,D,f)},this))}},getBoundsForGroup:function(K){return K.s(Ym)?this.getDataUIBounds(K):V},isPixelPerfect:function(r){return r.s("pixelPerfect")},rectIntersects:function(M,Z){this.validate();var N=V;if(this._56I[M._id]){var P=this._25I[M._id];if(P){var S=P._79o();if(Ch(Z,S))N=!0;else if((Z=xj(Z,S))&&(P.rectIntersects&&(N=P.rectIntersects(Z)),N==V)){if(!this.isPixelPerfect(M))return!0;var j=Z.x,u=Z.y,y=Z.width,F=Z.height,h=this._zoom,U=m.hitMaxArea,H=y*F*h*h;if(H>U){var Y=Math.sqrt(U/H);h*=Y}y*=h,F*=h,2>y&&(y=2),2>F&&(F=2),j*=h,u*=h;var O=Uf(y,F);Zo(O,-j,-u),O.scale(h,h),this._drawForChecking=!0,this.drawData(O,M,Z),this._drawForChecking=!1;try{for(var C=0,o=O.getImageData(0,0,y,F).data;C<o.length;C+=4)if(0!==o[C+3]){N=!0;break}O.restore()}catch(q){ub=V,N=!1}}}}return N?!0:!1},rectContains:function(v,o){if(this._56I[v._id]){var W=this._25I[v._id];if(W)return Ch(o,W._79o())}return!1},reset:function(){this.setZoom(1),this.setTranslate(0,0)},handleKeyDown:function(Y){if(!m.isInput(Y.target)){var U=this,Z=U._focusData,p=Z&&U._25I[Z._id],B=0,y=U._dataModel._datas;if(!(Z&&Z._enabled&&Z._editable&&p&&p.onKeyDown&&p.onKeyDown(Y)===!0))if(9===Y.keyCode&&(Z&&(B=y.indexOf(Z),gh(Y)?-1===--B&&(B=0):++B===y.size()&&(B=0)),U._focusData=Z=y.get(B),U.sm().setSelection(Z)),_n(Y)?U.selectAll():on(Y)&&U.isResettable()&&U.reset(),U.sm().isEmpty()){if(U._editing)return;var V=U.tx(),T=U.ty(),M=!1,u=gh()?100:10;hr(Y)&&(V-=u,M=!0),Zp(Y)&&(T-=u,M=!0),rc(Y)&&(V+=u,M=!0),Bh(Y)&&(T+=u,M=!0),M&&U.setTranslate(V,T)}else{Ol(Y)&&U.handleDelete(Y);var _=gh()?10:1;hr(Y)&&(U.moveSelection(-_,0),U.fi({kind:"moveLeft"})),Zp(Y)&&(U.moveSelection(0,-_),U.fi({kind:"moveUp"})),rc(Y)&&(U.moveSelection(_,0),U.fi({kind:"moveRight"})),Bh(Y)&&(U.moveSelection(0,_),U.fi({kind:"moveDown"}))}}},handleScroll:function(i,q){if(Mf(i),this.isZoomable()){if(!this.getEditInteractor()){var n=this.getDataAt(i);if(n){var X=hs(this.getImage(n));if(X&&$d(X.scrollable,n,this))return}}var e=this.lp(i);q>0?this.scrollZoomIn(e):0>q&&this.scrollZoomOut(e)}},handlePinch:function(B,a,o){this.isZoomable()&&(a>o?this.pinchZoomIn(B):this.pinchZoomOut(B))},checkDoubleClickOnNote:function(d,l){var u=this,f=u.lp(d),v=u.getDataUI(l),O=v.note2Info;return O&&l.s("note2.toggleable")&&zc(O.clickRect,f)?(l.s(fs,!l.s(fs)),u.fi({kind:"toggleNote2",event:d,data:l}),!0):(O=v.noteInfo,O&&l.s("note.toggleable")&&zc(O.clickRect,f)?(l.s(Di,!l.s(Di)),u.fi({kind:"toggleNote",event:d,data:l}),!0):!1)},_84o:function(){},isNoteVisible:function(){return this._zoom>.15},isLabelVisible:function(){return this._zoom>.15},isEditVisible:function(){return this._zoom>.15},autoScroll:function(F,K){var b=this,D=b.getAutoScrollZone(),t=D/b.getZoom(),q=D/4,C=b._29I,J=b.lp(F),S={x:b.tx(),y:b.ty()};return J&&D>0&&C&&(J.x-C.x<t?b.translate(q,0):C.x+C.width-J.x<t&&b.translate(-q,0),J.y-C.y<t?b.translate(0,q):C.y+C.height-J.y<t&&b.translate(0,-q)),S.x=b.tx()-S.x,S.y=b.ty()-S.y,K&&(K.x+=S.x,K.y+=S.y),S},getMoveMode:function(K,M){var T=M.s("2d.move.mode");return T?T:Gd["88"]?"x":Gd["89"]?"y":"xy"},getSerializableProperties:function(){return{scrollBarColor:1,scrollBarSize:1,autoMakeVisible:1,autoHideScrollBar:1,editable:1,resettable:1,pannable:1,rectSelectable:1,autoScrollZone:1,visibleFunc:1,movableFunc:1,editableFunc:1,pointEditableFunc:1,rectEditableFunc:1,anchorEditableFunc:1,rotationEditableFunc:1,rectSelectBackground:1,rectSelectBorderColor:1,editPointSize:1,editPointBorderColor:1,editPointBackground:1,hoverDelay:1,dataModel:1,selectionModel:1,currentSubGraph:1,zoom:1,translateX:1,translateY:1}},serializeProperty:function(c,M,u){var p=this;return"currentSubGraph"===M?{__i:c.getId()}:u.serializeProperty(c,M,p)},deserializeProperty:function(U,a,Y){var Q=this;if("currentSubGraph"===a){var K=Q.dm(),V=K.__idMap;return V[U.__i]}return Y.deserializeProperty(U,a,Q)},setDefaultCursor:function(d,I){this._defaultCursor=d,I!==!1&&this.setCursor(d)},setCursor:function(O){"default"===O&&(O=this._defaultCursor||O);var W=this.getView().style;W.cursor=O,W.cursor="-webkit-"+O,W.cursor="-moz-"+O},getCurrentConnectActionType:function(){return this._currentActionType},setCurrentConnectActionType:function(N){return N===V||m.getConnectAction(null,N)?(this._currentActionType=N,this.redraw(),!0):!1},getEditStyle:function(G){var o=this.getEditInteractor();return o?o.getStyle(G):C},setEditStyle:function(x,A,v){var M=this.getEditInteractor();return M?(M.setStyle(x,A,v),!0):!1},isConnectActionVisible:function(W){var B=m.getConnectAction(this);if(!B)return!1;var d=B.visible;return fg(d)&&(d=d(this,W)),d},isInteractive:function(I){var Q=hs(this.getImage(I));return Q&&$d(Q.interactive,I,this)?!0:I.s("interactive")},appendHTML:function(B,X){var Z=this.getView();if(!(X||B&&B.parentNode!==Z))return!1;var v=B.getView&&B.getView();if(!X&&v&&v.parentNode===Z)return!1;(B.getView||B.isSelfViewEvent)&&(B=B.getView());var G=this.getEditInteractor();return G&&G._canvas?Z.insertBefore(B,G._canvas):this.isScrollBarVisible()?Z.insertBefore(B,this.getView().lastChild):Kl(Z,B),!0},_layoutHTMLImpl:function(S,a,n){if(arguments.length>1){var $,A=this,M=A._zoom;
if(a.getView&&($=a,a=a.getView()),a.style.position="absolute",n){var O=S.getRect();xg($||a,A.tx()+O.x*M,A.ty()+O.y*M,O.width*M,O.height*M)}else{var r=new Eh,O=S.getAnchorRect(),D=S.getPosition(),q=S.getScale(),Z=a.style;xg($||a,O),r.appendTranslate(A.tx(),A.ty()),r.appendScale(M,M),r.append(new Eh(S.getRotation(),D.x,D.y,q.x,q.y)),te(Z,"transform","matrix("+r.a.toFixed(5)+", "+r.b.toFixed(5)+", "+r.c.toFixed(5)+",\n    "+r.d.toFixed(5)+", "+r.tx.toFixed(5)+", "+r.ty.toFixed(5)+")"),te(Z,"transformOrigin",(-O.x).toFixed(5)+"px "+(-O.y).toFixed(5)+"px"),a._matrixAppend=r.invert().translate(-O.x,-O.y)}}else this._layoutHTML&&this._layoutHTML()},getTextEditInfo:function(_){return _ instanceof iq?{name:"text",accessType:"s",isMultiline:!1}:void 0},getState:function(y){var B="state",O=y.s(B);if(O)return O;var J=hs(y._image);return J?$d(J[B],y,this)||null:void 0}}),H.defineProperties(Wm.GraphView.prototype,{layoutHTML:{get:function(){return this._layoutHTMLImplBind||(this._layoutHTMLImplBind=this._layoutHTMLImpl.bind(this)),this._layoutHTMLImplBind},set:function(h){this._layoutHTML=h}}});var jc=function(H,o){var Z=this;Z.gv=H,Z.s=function(Z){return o.getStyle(Z)},Z._data=o,Z._87I=new Vd};Ir(jc,H,{_6I:V,ms_icons:1,_84o:function(){},dispose:function(){},isShadowed:function(){return this.s("shadow")||this.gv.isSelected(this._data)&&"shadow"===this.s("select.type")},getSelectWidth:function(){var U=this,m=U.gv.isSelected(U._data);return!m||U.isShadowed()?0:U.gv.getSelectWidth(U._data)},getSelectColor:function(){return this.gv.getSelectColor(this._data)},getBodyColor:function($){var j=this._data,d=this.gv.getBodyColor(j);return d?d:$?j.getStyle($):V},_2Q:function(B){return this.s(B)},_1Q:function(f,Q,r,M){var K=this.s,u=K("2d.gray"),o=K(Q+".dash.color");if(u&&(o=m.toGrayColor(o)),f.strokeStyle=o,f.lineWidth=r,f.stroke(),K(Q+".dash.3d")){var k=K(Q+".dash.3d.color");Hb(f,o,u?m.toGrayColor(k):k,r,this.gv._zoom,K(Q+".dash.3d.accuracy"))}$f(f,M)},invalidate:function(){this._6I=V},_79o:function(){var a=this;if(!a._6I){var i=a._data,Q=a.gv;a.labelInfo=a.label2Info=a.noteInfo=a.note2Info=a._38o=V,a._87I.clear(),a.interactiveInfo=Q.isInteractive(i)?{}:V,a._3O(),a._55O=Q.isEditable(i)?{_42O:Q.isRectEditable(i),_43O:Q.isPointEditable(i),_56O:Q.isRotationEditable(i)}:V,a._6I=a._81o()}return a._6I},_3O:function(){},getPosition:function(){return fe},_68o:function(H,i){H&&this._87I.add(Nl(H,i))},_81o:function(){var r=this,W=r.s;r._24O(Lr,"getLabel"),r._24O(nb,"getLabel2"),r._26O(_c,"getNote"),r._26O(Vg,"getNote2"),r._15O(),r._55O&&r._48O();var E;if(r._87I.each(function(m){E=ps(E,m)}),E&&r.isShadowed()){var o=Zq(E);o.x+=W("shadow.offset.x"),o.y+=W("shadow.offset.y"),ol(o,W("shadow.blur")),E=ps(E,o)}return r._87I.clear(),E},_42:function(C){var j=this,E=j._data,r=j.gv,d=j.s,f=d("opacity"),o=this.isShadowed();if(o){var i=C.shadowOffsetX,h=C.shadowOffsetY,K=C.shadowBlur,n=C.shadowColor,Y=r.getZoom();C.shadowOffsetX=d("shadow.offset.x")*Y,C.shadowOffsetY=d("shadow.offset.y")*Y,C.shadowBlur=d("shadow.blur")*Y,C.shadowColor=j.getSelectColor()}if(f!=V){var e=C.globalAlpha;C.globalAlpha=f}j._80o(C),r.isLabelVisible(E)&&((!r._drawForChecking||d("label.selectable"))&&Cc(C,j.labelInfo),(!r._drawForChecking||d("label2.selectable"))&&Cc(C,j.label2Info)),r.isNoteVisible(E)&&(pd(C,j.noteInfo),pd(C,j.note2Info)),j._99O(C),f!=V&&(C.globalAlpha=e),o&&(C.shadowOffsetX=i,C.shadowOffsetY=h,C.shadowBlur=K,C.shadowColor=n)},_80o:function(){},_47O:function(){},_24O:function(w,g){var F=this,o=F._data,s=F.gv,d=F.s,R=s[g](o);if(R!=V){var b=d(w+".scale"),_=d(w+".max"),r=d(w+".position"),K=F[w+"Info"]={label:R,scale:b,color:s[g+"Color"](o),font:d(w+".font"),opacity:d(w+".opacity"),align:d(w+".align"),rotation:F.getRotation(d(w+".rotation"),!1,r),background:s[g+"Background"](o)},n=tb(K,R);_>0&&_<n.width&&(K.labelWidth=n.width,n.width=_),1!==b&&(n.width*=b,n.height*=b);var i=F.getPosition(r,d(w+".offset.x"),d(w+".offset.y"),n,d(w+".position.fixed"));if(n.x=i.x-n.width/2,n.y=i.y-n.height/2,F._68o(K.rect=n,K.rotation),1!==b){var y=n.width/b,x=n.height/b;K.rect={x:i.x-y/2,y:i.y-x/2,width:y,height:x}}}},_26O:function(w,$){var R=this,D=R.gv,n=R._data,Q=R.s,O=D[$](n);if(O!=V){var Z,T,o=Q(w+".scale"),d=R[w+"Info"]={note:O,scale:o,data:n,view:D,expanded:Q(w+".expanded"),font:Q(w+".font"),color:Q(w+".color"),opacity:Q(w+".opacity"),align:Q(w+".align"),icon:Q(w+".icon"),backgroundImage:Q(w+".backgroundImage"),borderWidth:Q(w+".border.width"),borderColor:Q(w+".border.color"),background:D[$+"Background"](n)},f=R.getPosition(Q(w+".position"),Q(w+".offset.x"),Q(w+".offset.y")),L=f.x,I=f.y;if(d.expanded){var l,N=Q(w+".max"),q=Q(w+".backgroundImage");q?(q=hs(q),l={width:si(q,n),height:of(q,n)}):l=tb(d,O),l.width+=6,l.height+=2,N>0&&N<l.width&&(d.labelWidth=l.width,l.width=N),Z=l.width,T=l.height+8,d.clickRect={x:L-Z*o/2,y:I-T*o,width:Z*o,height:T*o*l.height/T}}else{var g=Q(w+".icon");g?(g=hs(g),Z=si(g,n),T=of(g,n)):(Z=12,T=18),d.clickRect={x:L-Z*o/2,y:I-T*o,width:Z*o,height:T*o}}d.rect={x:L-Z/2,y:I-T*o/2-T/2,width:Z,height:T};var W=j(d.borderWidth/2)*o;R._68o({x:L-Z*o/2-W,y:I-T*o-W,width:Z*o+2*W,height:T*o+2*W})}},_48O:function(){},_99O:function(E){var G=this,b=G._38o;if(b){var o=G.gv,Q=G._data,l=b.icons,d=G.interactiveInfo;d&&(d._38o={});for(var r in l){var e=l[r],h=b.rects[r];if(h){d&&(d._38o[r]=[]);var R=$d(e.opacity,Q,o),i=$d(e.names,Q,o),Y=i?i.length:0,N=h.rotation;if(R!=V){var y=E.globalAlpha;E.globalAlpha*=R}for(var C=0;Y>C;C++){var K=i[C],X=hs(K),J=h[C];if(N){var q=J.x+J.width/2,P=J.y+J.height/2;E.save(),Zo(E,q,P),zi(E,N),Zo(E,-q,-P)}d&&d._38o[r].push(E.interactiveInfo={compInfos:[],matrix:N?new Eh(N,q,P).appendTranslate(-q,-P):new Eh}),re(E,X,$d(e.stretch,Q,o),J.x,J.y,J.width,J.height,G._data,G.gv),E.interactiveInfo=V,N&&E.restore()}R!=V&&(E.globalAlpha=y)}}}}});var Oh=function(d,e){Hh(Oh,this,[d,e])};Ir(Oh,jc,{_checkEmptyRect:!0,_40O:function(y,r){var G=this,v=G.s,J=y.rect;(y.borderColor=G.gv.getBorderColor(G._data))&&(y.borderType=v("border.type"),y.borderWidth=v("border.width"),y.borderPadding=v("border.padding"),r=D(r,y.borderPadding+y.borderWidth/2));var g=G._data.getScale(),l=D(1,D(M(g.x),M(g.y)));if(y.selectWidth=G.getSelectWidth()){var e=G.gv._zoom;y.selectType=v("select.type"),y._97o=G.getSelectColor(),y.selectPadding=v("select.padding"),r=D(r,(y.selectPadding+y.selectWidth/2/e)/l)}r>0&&(r*=l,J=Zq(J),ol(J,r)),G._68o(J)},_39O:function(C,D){var I,F=this,A=D.rect;if(D.borderWidth>0&&(I=D.borderPadding,C.strokeStyle=D.borderColor,C.lineWidth=D.borderWidth,En(C,D.borderType,{x:A.x-I,y:A.y-I,width:A.width+2*I,height:A.height+2*I}),C.stroke()),D.selectWidth>0){var U=F.gv._zoom;if(I=D.selectPadding,C.strokeStyle=D._97o,C.lineWidth=D.selectWidth/U,D.rotation!=V){C.save(),C.translate(D.position.x,D.position.y),C.rotate(D.rotation);var g=F._data,y=g.getWidth(),K=g.getHeight(),o=D.scale,j=D.anchor;A={x:o.x*-y*j.x,y:o.y*-K*j.y,width:o.x*y,height:o.y*K}}En(C,D.selectType,{x:A.x-I,y:A.y-I,width:A.width+2*I,height:A.height+2*I}),D.rotation!=V&&C.restore(),C.stroke()}},dispose:function(){var A=this,o=A._htmlView;Oh.superClass._3O.call(A),o&&(o.onHTMLRemoved&&o.onHTMLRemoved(),Nr(o))},_3O:function(){var p=this,a=p.s,A=p._data,z=p.gv,e=A.getStyle(Hd),J=p.getBodyColor(),Z=p._83o=e?{shape:e,_53o:p.getBodyColor("shape.background"),_27Q:hs(a("shape.repeat.image"),J),shapeGradientPack:a("shape.gradient.pack"),_54o:a("shape.border.width"),_55o:a("shape.border.color"),_56o:a("shape.border.3d"),_57o:a("shape.border.3d.color"),_58o:a("shape.border.3d.accuracy"),shapeGradient:a("shape.gradient"),_59o:a("shape.gradient.color"),_60o:a("shape.border.pattern"),_61o:a("shape.border.cap"),_62o:a("shape.border.join"),shapeForeground:a("shape.foreground"),bodyColor:J,gray:a("2d.gray")}:{img:hs(z.getImage(A),J),bodyColor:J,gray:a("2d.gray"),stretch:a("image.stretch")};if(l&&!d);else{var W,C=Z.img;C&&C.renderHTML?(p._htmlInfo&&p._htmlInfo.img!==C&&(p._htmlInfo=V),p._htmlInfo||(p._htmlInfo={img:C,cache:{}}),W=C.renderHTML(A,z,p._htmlInfo.cache)):p._htmlInfo=V,p._htmlView&&p._htmlView!==W&&(p._htmlView.onHTMLRemoved&&p._htmlView.onHTMLRemoved(),Nr(p._htmlView.getView?p._htmlView.getView():p._htmlView)),(p._htmlView=W)&&z.appendHTML(W)&&(W.onHTMLAddedSync&&W.onHTMLAddedSync(),W.onHTMLAdded&&Md(W.onHTMLAdded)),Z.rect=A.getRect(),Z.position=A.p(),Z.scale=A.getScale(),Z.anchor=A.getAnchor(),Z.rotation=A.getRotation(),e===mc&&(Z._63o=a("shape.depth"));var L=0;if(e)L=Nq(V,Z._54o/2,Z._62o),p.s("shape.dash")&&(L=D(L,(p.s("shape.dash.width")||Z._54o)/2));else if(C&&C.boundExtend)if(L=$d(C.boundExtend,A,z),C.boundExtendAbsolute){var Q=A.getScale();L/=z._zoom*D(1,D(M(Q.x),M(Q.y)))}else if(!$d(C.fitSize,A,z)){var P=$d(C.width,A,z),v=$d(C.height,A,z);L*=D(A.getWidth()/P,A.getHeight()/v)}p._40O(Z,L);var s=a("clip.percentage");if(1>s&&(0>s&&(s=0),Z.clipRect=fp(A.getAnchorRect(),a("clip.direction"),s)),e){var h=a("shape.fill.clip.percentage");1>h&&(0>h&&(h=0),Z.shapeClipRect=fp(A.getAnchorRect(),a("shape.fill.clip.direction"),h));var E=a("shape.foreground.clip.percentage");1>E&&(0>E&&(E=0),Z.shapeForegroundClipRect=fp(A.getAnchorRect(),a("shape.foreground.clip.direction"),E))}}},getPosition:function(a,H,Y,P){var X=Lp(a,this._83o.rect,P);return X.x+=H,X.y+=Y,X},_80o:function(u){var o=this,c=o.s,r=o.gv,p=o._data,j=o._83o,A=j.rect,N=j.position,X=j.rotation,w=j.anchor,I=j.scale,Y=j.shape,y=j.clipRect;if(!o._checkEmptyRect||A.width>0&&A.height>0){var d=p.getSize();if(d.x=-d.width*w.x,d.y=-d.height*w.y,u.save(),Zo(u,N.x,N.y),zi(u,X),cl(u,I.x,I.y),y&&(u.beginPath(),u.rect(y.x,y.y,y.width,y.height),u.clip()),r._drawForChecking&&j.img&&$d(j.img.pixelPerfect,p,r)===!1)Qm(u,d.x,d.y,d.width,d.height,"#888888");else if(o.freeDraw)o.freeDraw(u,d,j);else if(Y){var H,h,K,R,O=j._60o,S=$p(u,O),f=j._27Q,l=j._54o,$=j.shapeGradientPack,C=j.gray,Q=u.lineJoin,v=u.lineCap,U=function($){return C?m.toGrayColor($):$};"roundRect"===Y?H=c("shape.corner.radius"):"polygon"===Y?H=c("shape.polygon.side"):"arc"===Y&&(H=c("shape.arc.from"),h=c("shape.arc.to"),K=c("shape.arc.close"),R=c("shape.arc.oval")),u.lineJoin=j._62o,u.lineCap=j._61o;var e=U(j._53o);if(e||f||$){var i=j.shapeClipRect;i&&(u.save(),u.beginPath(),u.rect(i.x,i.y,i.width,i.height),u.clip()),En(u,Y,d,H,h,K,R),$?vm(u,$):f?lb(u,f,U(j.bodyColor),null,p,r):ym(u,e,j.shapeGradient,U(j._59o),d),u.fill(),i&&u.restore(),$&&u.restore(),u!==S&&En(S,Y,d,H,h,K,R)}else En(S,Y,d,H,h,K,R);var k=j.shapeForeground;if(k){u.save();var F=j.shapeForegroundClipRect;F&&(u.beginPath(),u.rect(F.x,F.y,F.width,F.height),u.clip()),En(u,Y,d,H,h,K,R),ym(u,k,c("shape.foreground.gradient"),U(c("shape.foreground.gradient.color")),d),u.fill(),u.restore()}if(l>0){var G=c("shape.border.width.absolute");G&&(u.save(),u.setTransform(1,0,0,1,0,0)),u.lineWidth=l;var Z=U(j._55o);u.strokeStyle=Z,u.stroke(),G&&u.restore(),j._56o&&Hb(u,Z,U(j._57o),l,r._zoom,j._58o)}if($f(u,O),c("shape.dash")){var q=c("shape.dash.width")||l;if(q>0){O=c("shape.dash.pattern");var S=$p(u,O,o._2Q("shape.dash.offset"));S!==u&&En(S,Y,d,H,h,K,R),o._1Q(u,"shape",q,O)}}$q(u,e,j._63o,d),u.lineJoin=Q,u.lineCap=v}else{var T=o.interactiveInfo;T&&(u.interactiveInfo=T.bodyInfo={compInfos:[],matrix:new Eh(X,N.x,N.y,I.x,I.y)}),j.gray&&(u.compGray=!0);var n=j.img;n&&n.cacheRule!=V&&(n=Wq(u,n,j.stretch,d.width,d.height,p,r,j.bodyColor)),re(u,n,j.stretch,d.x,d.y,d.width,d.height,p,r,j.bodyColor),u.compGray=!1,u.interactiveInfo=V}u.restore()}o._39O(u,j)},_48O:function(){},_47O:function(){}});var Sq=function(c,V){Hh(Sq,this,[c,V])},Dm=function(i,g,Y,x){var s=_e(i,g);return Y=x?f(Y,s):yf(Y,s),s?Y/=s:Y=0,{x:i.x+(g.x-i.x)*Y,y:i.y+(g.y-i.y)*Y}};Ir(Sq,jc,{_3O:function(){var T,i=this,$=i._data,M=i.gv,L=i.s,d=L(Bb),p=$.isLooped(),N=L("edge.width"),Q=L("edge.center"),B=L("edge.offset"),I=M.getBorderColor($),o=I?L("border.width"):0,Y=i.getSelectWidth(),S=$._40I,a=$._41I,E=i._78o=S&&a?{looped:p,type:d,width:N,center:Q,color:i.getBodyColor("edge.color"),borderColor:I,borderWidth:o,_97o:Y?i.getSelectColor():V,selectWidth:Y,pattern:L("edge.pattern"),cap:L("edge.cap"),join:L("edge.join"),is3d:L("edge.3d"),_67o:L("edge.3d.color"),_66o:L("edge.3d.accuracy"),gray:L("2d.gray")}:V;if(E){var f=m.getEdgeType(d);if(f){var e=f($,uh(i,M,$,p,d),M,i._19Q);e.points&&e.points.size()>1?(E.edgeTypeInfo=e,T=fr(E.edgeTypeInfo.points)):e[cf]&&e.rect&&(E.edgeTypeInfo=e,T=e.rect)}else{var G=L("edge.source.anchor.x"),n=L("edge.source.anchor.y"),v=L("edge.target.anchor.x"),P=L("edge.target.anchor.y"),u=kb(M,$,"source"),X=kb(M,$,"target");if(d===Lg){var W=E.points=L(sb)||Lj,J=W.size();E.segments=L("edge.segments");var w=G!==C||n!==C||ee(S),y=v!==C||P!==C||ee(a);if(!Q)if(B)w||(u=Dm(u,J?W.get(0):X,B,J)),y||(X=Dm(X,J?W.get(J-1):u,B,J));else{var c;w||(c=vc(u,J?W.get(0):X,ed(M,S)),c&&(u={x:c[0],y:c[1]})),y||(c=vc(J?W.get(J-1):u,X,ed(M,a)),c&&(X={x:c[0],y:c[1]}))}T=ps(fr(E.points),fr(u,X))}else{var O=uh(i,M,$,p,d);if(i._19Q||(O=-O),p)u=Zq(u),u.x=M.getNodeRect(S).x,E.radius=O,T={x:u.x-O,y:u.y-O,width:2*O,height:2*O};else{var R=_e(u,X),_=yf(B,R),K={x:_,y:O},x={x:R-_,y:O},l=s(X.y-u.y,X.x-u.x),H=E.mat=new Ae(l);if(E.orienAngle=l,E.angle=X.x<u.x?l+F:l,E.rect={x:K.x,y:K.y,width:x.x-K.x,height:0},E.origin=u,K=H.tf(K),K.x+=u.x,K.y+=u.y,x=H.tf(x),x.x+=u.x,x.y+=u.y,Q){var h={x:R,y:0};h=H.tf(h),h.x+=u.x,h.y+=u.y,T=fr([u,K,x,h]),E.c1=u,E.c2=h}else T=fr(K,x);u=K,X=x}}E.sourcePoint=u,E.targetPoint=X,$._lastSourcePoint=u,$._lastTargetPoint=X}var A=0;L("edge.dash")&&(A=L("edge.dash.width")||N);var U="square"===E.cap?.71:.5;Nq(T,D(A*U,N*U+o+Y),E.join),i._68o(T)}},getRotation:function(B,A,Z){B=B||0;var F=this._78o;if(F){var s,E=F.angle,y=F.points,f=F.edgeTypeInfo;if(E!=V)return A?F.orienAngle+B:E+B;if(f&&f[cf])return f.getRotation?f.getRotation(this,B,A,Z):0;if(f&&f.points){var g=f.points;return s=g.size(),Eo[Z]?s&&0===s%2?Me(g.get(s/2-1),g.get(s/2),A,B):B:dk[Z]?Me(g.get(0),g.get(1),A,B):Me(g.get(s-2),g.get(s-1),A,B)}if(y)return s=y.size(),Eo[Z]?s&&0===s%2?Me(y.get(s/2-1),y.get(s/2),A,B):B:dk[Z]?Me(F.sourcePoint,s?y.get(0):F.targetPoint,A,B):Me(s?y.get(s-1):F.sourcePoint,F.targetPoint,A,B)}return B},getPosition:function(t,u,X,q,O){var C=this._78o;if(C){var x,I=C.type,b=C.points,s=C.edgeTypeInfo,F=C.sourcePoint,G=C.targetPoint;if(!I)return C.looped?{x:F.x-C.radius+u,y:F.y+X}:(O&&F&&G&&(F.x>G.x||F.x===G.x&&F.y>G.y)&&(t=Ki[t],X=-X),x=Lp(t,C.rect,q),x.x+=u,x.y+=X,x=C.mat.tf(x),x.x+=C.origin.x,x.y+=C.origin.y,x);if(s&&s[cf])return s.getPosition?s.getPosition(this,t,u,X,q,O):{x:(F.x+G.x)/2,y:(F.y+G.y)/2};if(b){var x,e=b.size();if(Eo[t]){if(e){var Q=e%2;if(0===Q)return Jq(b.get(e/2-1),b.get(e/2),t,u,X,q,O);x=b.get((e-Q)/2)}else x={x:(F.x+G.x)/2,y:(F.y+G.y)/2};return x=Lp(t,{x:x.x,y:x.y,width:0,height:0},q),x.x+=u,x.y+=X,x}return dk[t]?Jq(F,e?b.get(0):G,t,u,X,q,O):Jq(e?b.get(e-1):F,G,t,u,X,q,O)}if(s){var l=s.points,e=l.size();if(Eo[t]){var Q=e%2;return 0===Q?Jq(l.get(e/2-1),l.get(e/2),t,u,X,q,O):(x=l.get((e-Q)/2),x=Lp(t,{x:x.x,y:x.y,width:0,height:0},q),x.x+=u,x.y+=X,x)}return dk[t]?Jq(l.get(0),l.get(1),t,u,X,q,O):Jq(l.get(e-2),l.get(e-1),t,u,X,q,O)}}return fe},_42:function(h){this._78o&&Sq.superClass._42.call(this,h)},drawPath:function(v,H){v.beginPath();var M=H.type,f=H.points,J=H.segments,n=H.edgeTypeInfo;if(!M||f){var B=H.sourcePoint,F=B.x,s=B.y,A=H.targetPoint,Z=A.x,z=A.y;if(M)if(J){var V=new Vd({x:F,y:s});V.addAll(f),V.add({x:Z,y:z}),_l(v,V,J)}else v.moveTo(F,s),f.each(function(m){v.lineTo(m.x,m.y)}),v.lineTo(Z,z);else H.looped?v.arc(F,s,H.radius,0,w,!0):H.center?(v.moveTo(H.c1.x,H.c1.y),v.lineTo(F,s),v.lineTo(Z,z),v.lineTo(H.c2.x,H.c2.y)):(v.moveTo(F,s),v.lineTo(Z,z))}else n&&(n.points?_l(v,n.points,n.segments):n[cf]&&n[cf](v,n))},_80o:function(r){var c=this,F=c.s,S=c._78o,G=S.width,Y=S.selectWidth,f=S.borderWidth,t=r.lineJoin,T=r.lineCap,V=S.gray,C=S.pattern;r.lineJoin=S.join,r.lineCap=S.cap,c.drawPath($p(r,C),S);var A=F("edge.width.absolute");A&&(r.save(),r.setTransform(1,0,0,1,0,0)),Y&&(r.strokeStyle=S._97o,r.lineWidth=G+2*(f+Y),r.stroke()),f&&(r.strokeStyle=V?m.toGrayColor(S.borderColor):S.borderColor,r.lineWidth=G+2*f,r.stroke());var U=V?m.toGrayColor(S.color):S.color,p=V?m.toGrayColor(S._67o):S._67o;if(r.strokeStyle=U,r.lineWidth=G,r.stroke(),S.is3d&&Hb(r,U,p,G,c.gv._zoom,S._66o),A&&r.restore(),$f(r,C),F("edge.dash")){C=F("edge.dash.pattern");var J=$p(r,C,c._2Q("edge.dash.offset"));J!==r&&c.drawPath(J,S),c._1Q(r,"edge",F("edge.dash.width")||G,C)}r.lineJoin=t,r.lineCap=T},_48O:function(){},_47O:function(){}});var gf=function(J,Q){Hh(gf,this,[J,Q])};Ir(gf,Oh,{_3O:function(){var J,k,d=this,H=d.s,L=d._data,g=d.gv;if(d._88I=V,L.isExpanded()&&L.eachChild(function(I){if(rd(I)){var n=g.getBoundsForGroup(I);n&&(k||(k=[]),k.push(n),J=ps(J,n))}}),J){var I=g.getLabel(L),o=H("group.type");J=Xk(o,k,J),hj(J,L,"group.padding",1);var l=d._88I={type:o,rect:J,_64o:J};if(!o&&I!=V){var W,F=d.labelInfo={label:I,color:H("group.title.color"),font:H("group.title.font"),align:H("group.title.align")},U=tb(F,I),Z=U.width,p=U.height,O=H("group.title.align"),C=H("group.title.orientation");if((C===qs||C===rq)&&Z>J.width?J.width=Z:(C===ws||C===Hn)&&Z>J.height&&(J.height=Z),F.rect={y:J.y-p,width:U.width,height:p},W=O===ws?J.x:O===Hn?J.x+J.width-Z:J.x+J.width/2-Z/2,F.rect.x=W,C===rq)l.titleRect={x:J.x,y:J.y+J.height,width:J.width,height:p},l.rect={x:J.x,y:J.y,width:J.width,height:J.height+p},F.rect={x:W,y:J.y+J.height,width:Z,height:p};else if(C===ws){var c=l.titleRect={x:J.x-p,y:J.y,width:p,height:J.height};l.rect={x:J.x-p,y:J.y,width:J.width+p,height:J.height},F.rect={x:c.x+p/2-J.height/2,y:c.y+J.height/2-p/2,width:J.height,height:p},F.rotation=-Math.PI/2}else if(C===Hn){var c=l.titleRect={x:J.x+J.width,y:J.y,width:p,height:J.height};l.rect={x:J.x,y:J.y,width:J.width+p,height:J.height},F.rect={x:c.x+p/2-J.height/2,y:c.y+J.height/2-p/2,width:J.height,height:p},F.rotation=Math.PI/2}else l.titleRect={x:J.x,y:J.y-p,width:J.width,height:p+1},l.rect={x:J.x,y:J.y-p,width:J.width,height:J.height+p}}d._40O(l,H("group.border.width")/2)}else gf.superClass._3O.call(d)},getPosition:function($,X,E,g){var A=this._88I;if(A){var k=Lp($,A.rect,g);return k.x+=X,k.y+=E,k}return gf.superClass.getPosition.apply(this,arguments)},_24O:function(b,M){var T=this._88I;(!T||T.type||"label2"===b)&&gf.superClass._24O.call(this,b,M)},_80o:function(P){var E=this,$=E._88I;if($){var D=E._data,s=E.s,N=E.gv,m=$.type,A=$.rect,v=$._64o,c=$.titleRect,b=E.getBodyColor(),V=hs(s("group.image"),b),y=s("group.image.stretch"),x=E.getBodyColor("group.background"),L=hs(s("group.repeat.image"),b),S=s("group.gradient.pack"),R=s("group.gradient"),j=s("group.gradient.color"),g=s("group.border.width"),C=s("group.border.color"),u=s("group.border.pattern"),n=s("group.title.orientation"),Z=s("group.depth");if(m){var p=P.lineJoin,J=P.lineCap;if(P.lineJoin=s("group.border.join"),P.lineCap=s("group.border.cap"),V){if(P.save(),En(P,m,A),P.clip(),re(P,V,y,A.x,A.y,A.width,A.height,D,N,b),P.restore(),g>0){var Q=$p(P,u);En(Q,m,A),P.lineWidth=g,P.strokeStyle=C,P.stroke(),$f(P,u)}}else{var Q=$p(P,u);x||L||S?(En(P,m,A),S?vm(P,S):L?lb(P,L,b,null,D,N):ym(P,x,R,j,A),P.fill(),S&&P.restore(),P!==Q&&En(Q,m,A)):En(Q,m,A),g>0&&(P.lineWidth=g,P.strokeStyle=s("group.border.color"),P.stroke()),$f(P,u),m===mc&&$q(P,x,Z,A)}P.lineJoin=p,P.lineCap=J}else{var e=s("group.title.background"),X=s("group.border.radius");if(V)re(P,V,y,v.x,v.y,v.width,v.height,D,N,E.getBodyColor());else if(x||L)if(L?lb(P,L,b,null,D,N):ym(P,x,R,j,v),0===g)En(P,mc,v),P.fill(),$q(P,x,Z,v);else{switch(P.beginPath(),n){case rq:cb(P,v.x,v.y,v.width,v.height,X,X,0,0);break;case ws:cb(P,v.x,v.y,v.width,v.height,0,X,0,X);break;case Hn:cb(P,v.x,v.y,v.width,v.height,X,0,X,0);break;case qs:cb(P,v.x,v.y,v.width,v.height,0,0,X,X)}P.fill()}if(c&&e)if(0===g)Qm(P,c.x,c.y,c.width,c.height,e),$q(P,e,Z,c);else{switch(P.beginPath(),P.fillStyle=e,n){case rq:cb(P,c.x,c.y,c.width,c.height,0,0,X,X);break;case ws:cb(P,c.x,c.y,c.width,c.height,X,0,X,0);break;case Hn:cb(P,c.x,c.y,c.width,c.height,0,X,0,X);break;case qs:cb(P,c.x,c.y,c.width,c.height,X,X,0,0)}P.fill()}if(g>0){var Q=$p(P,u);if(En(Q,"roundRect",A,X),P.lineWidth=g,P.strokeStyle=C,c&&s("group.splitLine")){var l=c.x,I=c.y,K=c.width,o=c.height;n===rq?(P.moveTo(l,I),P.lineTo(l+K,I)):n===ws?(P.moveTo(l+K,I),P.lineTo(l+K,I+o)):n===Hn?(P.moveTo(l,I),P.lineTo(l,I+o)):(P.moveTo(l,I+o),P.lineTo(l+K,I+o))}P.stroke(),$f(P,u)}}E._39O(P,$)}else gf.superClass._80o.call(E,P)}});var ul=function(U,P){Hh(ul,this,[U,P])};Ir(ul,Oh,{_80o:function(s){this._39O(s,this._83o)}});var dr=function(e,Z){Hh(dr,this,[e,Z])};Ir(dr,Oh,{_3O:function(){var o=this,N=o._data,d=o.s,J=o.gv,$=N.getPoints(),K=J.getBorderColor(N),p=K?d("border.width"):0,X=o.getSelectWidth(),_=d("shape.border.width"),Q=N.getRect(),b=N.getAnchorRect(),G=J.getBodyColor(N),O=o._99o=$.isEmpty()?V:{rect:Q,rotation:N.getRotation(),fillRule:d("shape.fill.rule"),scale:N.getScale(),position:N.p(),points:$,segments:N.getSegments(),bodyColor:G,borderColor:K,borderWidth:p,_94o:d("shape.border.3d"),_95o:d("shape.border.3d.color"),_96o:d("shape.border.3d.accuracy"),_97o:X?o.getSelectColor():V,selectWidth:X,_53o:d("shape.background"),_27Q:hs(d("shape.repeat.image"),G),shapeGradientPack:d("shape.gradient.pack"),_54o:_,_55o:d("shape.border.color"),shapeGradient:d("shape.gradient"),_59o:d("shape.gradient.color"),_60o:d("shape.border.pattern"),_61o:d("shape.border.cap"),_62o:d("shape.border.join"),shapeForeground:d("shape.foreground"),gray:d("2d.gray")};if(O){b.x+=O.position.x,b.y+=O.position.y,O.gradientRect=b;var v=N.getScale(),h=D(1,D(M(v.x),M(v.y)));d("shape.dash")&&d("shape.dash.width")>_&&(_=d("shape.dash.width"));var t=_*("square"===O._61o?.71:.5)+p+X/o.gv._zoom/h;t&&(t*=h,Q=Zq(Q),Nq(Q,t,O._62o)),o._68o(Q);var H=d("clip.percentage");1>H&&(0>H&&(H=0),O.clipRect=fp(N.getAnchorRect(),d("clip.direction"),H));var w=d("shape.fill.clip.percentage");1>w&&(0>w&&(w=0),O.shapeClipRect=fp(N.getAnchorRect(),d("shape.fill.clip.direction"),w));var j=d("shape.foreground.clip.percentage");1>j&&(0>j&&(j=0),O.shapeForegroundClipRect=fp(N.getAnchorRect(),d("shape.foreground.clip.direction"),j))}},getPosition:function(h,X,V,d){var O=this._99o;if(O){var Y=Lp(h,O.rect,d);return Y.x+=X,Y.y+=V,Y}return fe},_42:function(S){this._99o&&dr.superClass._42.call(this,S)},_80o:function(Q){var G,P=this,N=P.s,V=P._99o,U=V.position,s=V.scale,C=V.rotation,x=V.borderWidth,k=V.selectWidth/P.gv._zoom,I=V._27Q,$=V.shapeGradientPack,H=V._54o,R=V.clipRect,L=V.shapeClipRect,l=V.points,K=V.segments,S=P._data.isClosePath(),O=V.fillRule,_=V.gray,n=function(q){return _?m.toGrayColor(q):q},z=n(V._53o),b=z||I||$;Q.save(),Zo(Q,U.x,U.y),zi(Q,C),cl(Q,s.x,s.y),R&&(Q.beginPath(),Q.rect(R.x,R.y,R.width,R.height),Q.clip()),b&&L&&(Q.save(),Q.beginPath(),Q.rect(L.x,L.y,L.width,L.height),Q.clip()),Zo(Q,-U.x,-U.y);var e=V._60o,X=$p(Q,e),F=Q.lineJoin,Y=Q.lineCap;Q.lineJoin=V._62o,Q.lineCap=V._61o;var f=n(V.bodyColor);b?(_l(Q,l,K,S),$?vm(Q,$):I?lb(Q,I,f,null,P._data,P.gv):(G=f?f:z,ym(Q,G,V.shapeGradient,n(V._59o),V.gradientRect)),Q.fill(O),L&&(Q.restore(),Zo(Q,-U.x,-U.y)),$&&Q.restore(),X!==Q&&_l(X,l,K,S)):_l(X,l,K,S);var t=V.shapeForeground;if(t){Q.save();var g=V.shapeForegroundClipRect;g&&(Zo(Q,U.x,U.y),Q.beginPath(),Q.rect(g.x,g.y,g.width,g.height),Q.clip(),Zo(Q,-U.x,-U.y)),_l(Q,l,K,S),ym(Q,t,N("shape.foreground.gradient"),n(N("shape.foreground.gradient.color")),V.gradientRect),Q.fill(O),Q.restore()}var w=N("shape.border.width.absolute");if(w&&(Q.save(),Q.setTransform(1,0,0,1,0,0)),k&&(Q.strokeStyle=V._97o,Q.lineWidth=H+2*(x+k),Q.stroke()),x&&(Q.strokeStyle=n(V.borderColor),Q.lineWidth=H+2*x,Q.stroke()),H&&(G=n(V._55o),!z&&f&&(G=f),Q.strokeStyle=G,Q.lineWidth=H,Q.stroke(),V._94o&&Hb(Q,G,n(V._95o),H,P.gv._zoom,V._96o)),w&&Q.restore(),$f(Q,e),N("shape.dash")){var y=N("shape.dash.width")||H;if(y>0){e=N("shape.dash.pattern");var X=$p(Q,e,P._2Q("shape.dash.offset"));X!==Q&&_l(X,l,K,S),P._1Q(Q,"shape",y,e)}}Q.lineJoin=F,Q.lineCap=Y,Q.restore()},_48O:function(){},_47O:function(){}});var nc=function(T,K){Hh(nc,this,[T,K])};Ir(nc,dr,{getRotation:function(H,O,q){H=H||0;var W=this._data.getPoints(),E=W.size();return E>1?Eo[q]?E&&0===E%2?Me(W.get(E/2-1),W.get(E/2),O,H):H:dk[q]?Me(W.get(0),W.get(1),O,H):Me(W.get(E-2),W.get(E-1),O,H):H},getPosition:function(I,H,l,i,B){var Z=this._data.getPoints(),C=Z.size();if(C>1){if(Eo[I]){var L=C%2;if(0===L)return Jq(Z.get(C/2-1),Z.get(C/2),I,H,l,i,B);var s=Z.get((C-L)/2),U={x:s.x,y:s.y,width:0,height:0};return s=Lp(I,U,i),s.x+=H,s.y+=l,s}return dk[I]?Jq(Z.get(0),Z.get(1),I,H,l,i,B):Jq(Z.get(C-2),Z.get(C-1),I,H,l,i,B)}return fe}});var Uk=function(R,w){Hh(Uk,this,[R,w])};Ir(Uk,Oh,{_3O:function(){var Z=this;Uk.superClass._3O.call(Z);var A=Z.s,m=Z._83o;Z._82o=m.img||m.shape?V:{background:Z.getBodyColor("grid.background"),depth:A("grid.depth"),rect:m.rect,_88o:A("grid.cell.depth"),cellBorderColor:A("grid.cell.border.color"),_89o:A("grid.row.count"),_90o:A("grid.column.count"),block:A("grid.block"),_91o:A("grid.block.color"),_92o:A("grid.block.padding"),_93o:A("grid.block.width")}},_80o:function(s){var z=this,r=z._82o;if(!r)return Uk.superClass._80o.call(z,s),void 0;var F,C,L=z._data,W=r.background,p=r.rect,e=r.block,o=r._91o,v=r._92o,M=r._93o,H=r._88o,K=r.cellBorderColor,h=r._89o,j=r._90o;if(W)if(Qm(s,p.x,p.y,p.width,p.height,W),$q(s,W,r.depth,p),H)for(F=0;h>F;F++)for(C=0;j>C;C++)p=L.getCellRect(F,C),p&&$q(s,W,H,p);else if(K){for(s.beginPath(),F=0;h>F;F++)for(C=0;j>C;C++)p=L.getCellRect(F,C),p&&s.rect(p.x,p.y,p.width,p.height);s.strokeStyle=K,s.lineWidth=1,s.stroke()}if("h"===e)for(F=0;h>F;F++)p=ps(L.getCellRect(F,0),L.getCellRect(F,j-1)),ol(p,v),Mh(s,o,p.x,p.y,p.width,p.height,M);else if("v"===e)for(C=0;j>C;C++)p=ps(L.getCellRect(0,C),L.getCellRect(h-1,C)),ol(p,v),Mh(s,o,p.x,p.y,p.width,p.height,M);z._39O(s,z._83o)}});var ri=function(_,R){Hh(ri,this,[_,R])};Ir(ri,Oh,{_checkEmptyRect:!1,_81o:function(){var l=this._data,Z=ri.superClass._81o.call(this),O=l.s("text");if(O!=V){var H,m,N=l.s("text.font"),J=l.s("text.align"),r=l.s("text.vAlign"),p=hd(N,O),D=p.width,t=p.height,T=l.getAnchor(),u=l.getWidth(),h=l.getHeight();"left"===J?H=-u*T.x:"center"===J?H=-u*T.x+(u-D)/2:"right"===J&&(H=u*(1-T.x)-p.width),"top"===r?m=-h*T.y:"middle"===r?m=-h*T.y+(h-t)/2:"bottom"===r&&(m=h*(1-T.y)-p.height);var C,M=l.getMatrix();if(C=fr([M.tf(H,m),M.tf(H+D,m),M.tf(H+D,m+t),M.tf(H,m+t)]),Z=ps(Z,C),Z&&l.s("text.shadow")){var z=Zq(Z);z.x+=l.s("text.shadow.offset.x"),z.y+=l.s("text.shadow.offset.y"),ol(z,l.s("text.shadow.blur")),Z=ps(Z,z)}}return Z}});var hl=Wm.Interactor=function(N){this.gv=this._graphView=N};en("Interactor",H,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners(),this.clear()},clear:function(){},fi:function(C){this.gv.fi(C)},setCursor:function(d){fn||this.gv.setCursor(d)},startDragging:function(Z){var C=this;C._lastClientPoint=_h(Z),C._lastLogicalPoint=C.gv.lp(Z),cp(C,Z)},clearDragging:function(){var r=this;r._lastClientPoint=r._lastLogicalPoint=r._logicalPoint=V},autoScroll:function(a){return this.gv.autoScroll(a,this._lastClientPoint)}});var Sm=V,fl=function(T){Sm.handleWindowTouchMove(T)},qd=function(X){Sm.handleWindowTouchEnd(X),K.removeEventListener(lf,fl,B),K.removeEventListener(Aj,qd,B),Sm=V},Ro=function(s){Sm.handleWindowMouseMove(s)},ie=function(U){Sm.handleWindowMouseUp(U),K.removeEventListener(Hf,Ro,B),K.removeEventListener(mm,ie,B),Sm=V},ue=function(y,$){y!==Sm&&(Sm?fn?Sm.handleWindowTouchEnd($):Sm.handleWindowMouseUp($):fn?(K.addEventListener(lf,fl,B),K.addEventListener(Aj,qd,B)):(K.addEventListener(Hf,Ro,B),K.addEventListener(mm,ie,B)),Sm=y)},sm=function(W){var t=this;t.gv=W,t._is2d=W instanceof Wm.GraphView,t._is2d&&(t.filter=function(Y){return W.isSelectable(Y)&&W.isInteractive(Y)}),W.getView(),["mousedown","mousemove","mouseleave","touchstart","touchmove",Zg].forEach(function(L){t.addListener(L)}),t.initImageResource()};Ir(sm,hl,{enableVR:function(l){var U=this;if(!!U._vrEnable!==l)if(U._vrEnable=l,l)U.gv.vr.mp(U.onVRControllerChange,U);else if(U.gv.vr.ump(U.onVRControllerChange,U),U._vrRayPolyline){var T=U.gv.dm();T.remove(U._vrRayPolyline),T.remove(U._vrRayHitPoint),U._vrRayPolyline=C,U._vrRayHitPoint=C}},onVRControllerChange:function(h){var Y=this,V=h.property,o=h.newValue,k=Y.gv.vr.getController(o.id),X=k.getRay();X&&("gamepad.button.trigger"===V?"down"===o._62O?Y.handle_mousedown(X):Y.handleWindowMouseUp(X):"gamepad.pose"===V&&(Y.handle_mousemove(X),Y.handleWindowMouseMove(X)))},drawVRRay:function(n,m,h){var f,q=this,H=q.gv,o=q._vrRayPolyline,M=!1;if(o)f=q._vrRayHitPoint;else{var B=H.dm();q._vrRayPolyline=o=new k.Polyline,q._vrRayHitPoint=f=new k.Node,f.s({shape3d:"billboard","shape3d.transparent":!0,"shape3d.texture.scale":10,"shape3d.image":"coreInteractorRayHitImage"}),f.setAnchor3d(.5,.5,.499);var i=.2/H.vr.measureOflength;f.s3(i,i,i),o.s("intersect",!1),f.s("intersect",!1),B.add(o),B.add(f),M=!0}if(m){var e=h.world,v=h.worldNormal,Z=e.x,D=e.y,W=e.z;o.s("shape.border.color","red"),o.setPoints([{x:n.origin.x,y:n.origin.z,e:n.origin.y},{x:Z,y:W,e:D}]),f.s("3d.visible",!0),f.p3(Z,D,W),f.lookAtDirection([v.x,v.y,v.z],"front")}else{o.s("shape.border.color","blue");var x=new k.Math.Vector3;x.copy(n.direction).setLength(1e3/q.gv.vr.measureOflength).add(n.origin),o.setPoints([{x:n.origin.x,y:n.origin.z,e:n.origin.y},{x:x.x,y:x.z,e:x.y}]),f.s("3d.visible",!1)}H.fi({kind:"vrRayIntersect",ray:n,data:m,intersect:h,polyline:o,hitNode:f,begin:M})},addListener:function(R){var P=this;P.gv.getView().addEventListener(R,function(A){m.preventDefault(A),P.disabled||P["handle_"+R](A)},B)},handleWindowTouchMove:function(j){this.handleWindowMouseMove(j)},handleWindowMouseMove:function(V){this.downInfo&&(this.isDragging?this.handleDownInfo("onDrag",V):(this.handleDownInfo("onBeginDrag",V),this.isDragging=!0))},handleWindowTouchEnd:function(u){this.handleWindowMouseUp(u)},handleWindowMouseUp:function(P){if(this.isDragging&&(this.handleDownInfo("onEndDrag",P),this.isDragging=!1),this.downInfo){var n=this.handle("onUp",P);if(n&&n.data===this.downInfo.data){this.handleMissingUp(P);var e=this,o=2===P.button?"onContextMenu":"onClick";if(!e._dbclickTimer)return e._dbclickTimer=G(function(){delete e._dbclickTimer,e.handleClick(P,o,n),this.downInfo=V},m.clickDelay),void 0;W(e._dbclickTimer),delete e._dbclickTimer,o="onDoubleClick",e.handleClick(P,o,n)}else this.handleDownInfo("onUp",P);this.downInfo=V}},handle_mouseleave:function(L){var A=this,S=A.gv,n=A.currentInfo?A.currentInfo.data:V;if(n){n.s("onLeave")&&n.s("onLeave")(L,n,S),A.fire("data","onLeave",L,n);var y=A.currentInfo?A.currentInfo.hits:V;if(y)for(var i in y)A.handleLeave(L,i);A.currentInfo=V}},handle_mousewheel:function(c){c.scrollDelta=c.wheelDelta/40,this.handle("onScroll",c)},handle_DOMMouseScroll:function(P){P.scrollDelta=2===P.axis?-P.detail:0,this.handle("onScroll",P)},handle_touchstart:function(q){this.handle_mousedown(q)},handle_touchmove:function(g){this.handle("onMove",g)},handle_mousedown:function(N){this.isDragging&&(this.handleDownInfo("onEndDrag",N),this.isDragging=!1),this.downInfo=this.handle("onDown",N),this.downInfo&&ue(this,N)},handle_mousemove:function(O){var X=this,w=X.gv;X._hoverTimer&&(W(X._hoverTimer),delete X._hoverTimer);var Q,J,i,U=X.handle("onMove",O),E=this.currentInfo?this.currentInfo.data:V,D=this.currentInfo?this.currentInfo.hits:V;if(U&&(J=U.data,i=U.hits,X._hoverTimer=G(function(){W(X._hoverTimer),delete X._hoverTimer,X.handle("onHover",O,U)},w.getHoverDelay()||m.hoverDelay)),J!==E){if(E&&(E.s("onLeave")&&E.s("onLeave")(O,E,w),this.fire("data","onLeave",O,E)),J&&(J.s("onEnter")&&J.s("onEnter")(O,J,w),this.fire("data","onEnter",O,J)),D)for(Q in D)this.handleLeave(O,Q);if(i)for(Q in i){var o=i[Q];o.target.onEnter&&o.target.onEnter(O,J,w,o.point,o.width,o.height),this.fire(o.type,"onEnter",o.event,o.data,o.image,o.comp,o.point,o)}}else{if(D)for(Q in D)i&&i[Q]||this.handleLeave(O,Q);if(i)for(Q in i)if(!D||!D[Q]){var o=i[Q];o.target.onEnter&&o.target.onEnter(O,J,w,o.point,o.width,o.height),this.fire(o.type,"onEnter",o.event,o.data,o.image,o.comp,o.point,o)}}this.currentInfo=U
},handle:function(z,y,e){var f,W=this,I=W.gv;if(W._is2d){if(e=e||I.getDataInfoAt(y,this.filter),!e)return;if(f=e.ui.interactiveInfo){var F,H=e.data;if(H.s(z)&&H.s(z)(y,H,I),this.fire("data",z,y,H),"body"===e.part&&f.bodyInfo)F="body",e.hits=this.handleImage(F,I.getImage(H),z,y,H,e.point,f.bodyInfo);else if("icons"===e.part&&f._38o){var K=f._38o[e.name];K&&K[e.index]&&(F="icons|"+e.name+"|"+e.index,e.hits=this.handleImage(F,e.icon,z,y,H,e.point,K[e.index]))}}return e}var H,R;if(!e)if(y&&y instanceof k.Math.Ray){var S=I.vr.intersectWorld(y);if(H=S.data,R=S.intersect,W.drawVRRay(y,H,R),!H)return;var m=I.getData3dUI(H);if(f=m.interactiveInfo,!f)return;e={data:H,part:R.part,ui:m}}else{if(e=I.getDataInfoAt(y),!e)return;e&&(e={data:e.data,part:e.part})}if(!R){H=e.data;var m=I.getData3dUI(H);if(e.ui=m,f=m.interactiveInfo,!f)return e;if(R=I.intersectObject(y,H),!R)return}H.s(z)&&H.s(z)(y,H,I),this.fire("data",z,y,H);var s,D=R.part;return"body"!==D&&(s=H.s(D+".image")||H.s("shape3d."+D+".image")),s||(s=H.s("all.image")||H.s("shape3d.image")),f="object"==typeof s?f[s.uuid]:f[s],f&&f.bodyInfo?(e.part="body",e.interactiveInfo=f,e.point=R.uv.multiply({x:f.bodyInfo.rect.width,y:f.bodyInfo.rect.height}),e.image=s,e.hits=this.handleImage("body",s,z,y,H,e.point,f.bodyInfo),e):e},_handleLeaveOrMissing:function($,z,g){var P="leave"===$?this.currentInfo:this.downInfo;if(P){var C=P.interactiveInfo||P.ui.interactiveInfo;if(C){var T,I,U=P.data;if(this._is2d){if(I=this.gv.lp(z),"body"===P.part&&C.bodyInfo)T="body","leave"===$?this.handleLeaveImage(g,T,this.gv.getImage(U),z,U,I,C.bodyInfo):this.handleMissingUpImage(T,this.gv.getImage(U),z,U,I,C.bodyInfo);else if("icons"===P.part&&C._38o){var K=C._38o[P.name];K&&K[P.index]&&(T="icons|"+P.name+"|"+P.index,"leave"===$?this.handleLeaveImage(g,T,P.icon,z,U,I,K[P.index]):this.handleMissingUpImage(T,P.icon,z,U,I,K[P.index]))}}else{if(!C.bodyInfo)return;var J=this.gv.intersectObject(z,U);I=J?J.uv.multiply({x:C.bodyInfo.rect.width,y:C.bodyInfo.rect.height}):{x:1/0,y:1/0},"leave"===$?this.handleLeaveImage(g,"body",P.image,z,U,I,C.bodyInfo):this.handleMissingUpImage("body",P.image,z,U,I,C.bodyInfo)}}}},handleClick:function(D,F,s){var i=this,B=this.downInfo;if(B&&s){var l,v=s.interactiveInfo||s.ui.interactiveInfo,Z=s.data,U=this.gv;if(Z.s(F)&&Z.s(F)(D,Z,U),i.fire("data",F,D,Z),v)if(this._is2d){if(B.part===s.part){var _=U.lp(D);"body"===s.part&&v.bodyInfo&&(l="body",this.handleClickImage(l,U.getImage(Z),F,D,Z,_,v.bodyInfo,s))}}else{if(!v.bodyInfo)return;var C=U.intersectObject(D,Z);if(!C)return;_=C.uv.multiply({x:v.bodyInfo.rect.width,y:v.bodyInfo.rect.height}),this.handleClickImage("body",B.image,F,D,Z,_,v.bodyInfo,s)}}},handleDownInfo:function(J,e){if(this.downInfo){var f=this.downInfo,T=this.gv,G=f.interactiveInfo||f.ui.interactiveInfo;if(G){var w,E=f.data;if(E.s(J)&&E.s(J)(e,E,T),this.fire("data",J,e,E),this._is2d){var Z=T.lp(e);if("body"===f.part&&G.bodyInfo)w="body",this.handleDownInfoImage(w,T.getImage(E),J,e,E,Z,G.bodyInfo);else if("icons"===f.part&&G._38o){var m=G._38o[f.name];m&&m[f.index]&&(w="icons|"+f.name+"|"+f.index,this.handleDownInfoImage(w,f.icon,J,e,E,Z,m[f.index]))}}else{if(!G.bodyInfo)return;var p=T.intersectObject(e,E);if(!p)return;Z=p.uv.multiply({x:G.bodyInfo.rect.width,y:G.bodyInfo.rect.height}),this.handleDownInfoImage("body",f.image,J,e,E,Z,G.bodyInfo)}}}},fire:function(z,f,w,Z,T,W,$,x){this.gv.fi({kind:f,type:z,event:w,data:Z,image:T,comp:W,view:this.gv,point:$,width:x?x.width:C,height:x?x.height:C})},handleImage:function(m,G,B,s,V,U,M){var t={};if(G&&(G=hs(G))){var J=this.gv,b=M.rect,k=this.convertPoint(U,M);k.inRect&&(G[B]&&G[B](s,V,J,k,b.width,b.height),this.fire("image",B,s,V,G,C,k,b),t[m+"|image"]={target:G,type:"image",image:G,data:V,event:s,point:k,width:b.width,height:b.height});for(var o=M.compInfos,Y=G,i=o.length-1;i>=0;i--){var Q=o[i],c=Q.comp;k=this.convertPoint(U,Q,Y,c,J,V),k.inRect&&(b=Q.rect,V._interactPrefix=Q.prefix,c[B]&&c[B](s,V,J,k,b.width,b.height),this.fire("comp",B,s,V,G,c,k,b),(G=b.image)&&(G[B]&&G[B](s,V,J,k,b.width,b.height),this.fire("image",B,s,V,G,C,k,b)),V._interactPrefix=null,t[m+"|"+i]={target:c,type:"comp",comp:c,image:G,data:V,event:s,point:k,width:b.width,height:b.height},G&&(t[m+"|"+i+"|image"]={target:G,type:"image",image:G,data:V,event:s,point:k,width:b.width,height:b.height}))}}return t},handleLeave:function(F,U){return this._handleLeaveOrMissing("leave",F,U)},handleMissingUp:function(g){return this._handleLeaveOrMissing("missing",g)},handleLeaveImage:function(X,y,r,j,q,O,J){if(r&&(r=hs(r))){var n=this.gv,I=J.rect,R=this.convertPoint(O,J);X===y+"|image"&&(r.onLeave&&r.onLeave(j,q,n,R,I.width,I.height),this.fire("image","onLeave",j,q,r,C,R,I));for(var M=J.compInfos,f=r,G=M.length-1;G>=0;G--){var B=M[G],i=B.comp;R=this.convertPoint(O,B,f,i,n,q),I=B.rect,q._interactPrefix=B.prefix,X===y+"|"+G&&(i.onLeave&&i.onLeave(j,q,n,R,I.width,I.height),this.fire("comp","onLeave",j,q,r,i,R,I)),(r=I.image)&&X===y+"|"+G+"|image"&&(r.onLeave&&r.onLeave(j,q,n,R,I.width,I.height),this.fire("image","onLeave",j,q,r,C,R,I)),q._interactPrefix=null}}},handleMissingUpImage:function(p,h,$,d,z,r){var F="onUp",U=this.downInfo.hits;if(U&&h&&(h=hs(h))){var q=this.gv,G=r.rect,Z=this.convertPoint(z,r);!Z.inRect&&U[p+"|image"]&&(h[F]&&h[F]($,d,q,Z,G.width,G.height),this.fire("image",F,$,d,h,C,Z,G));for(var Y=r.compInfos,V=h,e=Y.length-1;e>=0;e--){var E=Y[e],I=E.comp;Z=this.convertPoint(z,E,V,I,q,d),Z.inRect||(G=E.rect,d._interactPrefix=E.prefix,U[p+"|"+e]&&(I[F]&&I[F]($,d,q,Z,G.width,G.height),this.fire("comp",F,$,d,h,I,Z,G)),(h=G.image)&&U[p+"|"+e+"|image"]&&(h[F]&&h[F]($,d,q,Z,G.width,G.height),this.fire("image",F,$,d,h,C,Z,G)),d._interactPrefix=null)}}},handleDownInfoImage:function(n,S,i,L,X,o,k){var d=this.downInfo.hits;if(d&&S&&(S=hs(S))){var K=this.gv,p=k.rect,O=this.convertPoint(o,k);d[n+"|image"]&&(S[i]&&S[i](L,X,K,O,p.width,p.height),this.fire("image",i,L,X,S,C,O,p));for(var T=k.compInfos,H=S,D=T.length-1;D>=0;D--){var V=T[D],y=V.comp;O=this.convertPoint(o,V,H,y,K,X),p=V.rect,X._interactPrefix=V.prefix,d[n+"|"+D]&&(y[i]&&y[i](L,X,K,O,p.width,p.height),this.fire("comp",i,L,X,S,y,O,p)),(S=p.image)&&d[n+"|"+D+"|image"]&&(S[i]&&S[i](L,X,K,O,p.width,p.height),this.fire("image",i,L,X,S,C,O,p)),X._interactPrefix=null}}},handleClickImage:function(d,r,a,f,H,O,g,l){var Q=this.downInfo.hits,T=l.hits;if(Q&&r&&(r=hs(r))){var D=this.gv,K=g.rect,h=this.convertPoint(O,g);Q[d+"|image"]&&(r[a]&&r[a](f,H,D,h,K.width,K.height),this.fire("image",a,f,H,r,C,h,K));for(var M=g.compInfos,W=r,E=M.length-1;E>=0;E--){var J=M[E],I=J.comp;h=this.convertPoint(O,J,W,I,D,H),K=J.rect,H._interactPrefix=J.prefix,Q[d+"|"+E]&&T[d+"|"+E]&&(I[a]&&I[a](f,H,D,h,K.width,K.height),this.fire("comp",a,f,H,r,I,h,K)),(r=K.image)&&Q[d+"|"+E+"|image"]&&(r[a]&&r[a](f,H,D,h,K.width,K.height),this.fire("image",a,f,H,r,C,h,K)),H._interactPrefix=null}}},initImageResource:function(){m.setImage("coreInteractorRayHitImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",opacity:.3,rotation:-1.593,rect:[.73315,.6933,14.5337,14.61341]},{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",rotation:-1.593,rect:[3.56695,3.75073,8.8661,8.49856]}]})},convertPoint:function(k,e,O,c,n,I){var l=e.rect,A=e.matrix.applyInverse(k).sub(l),$=A.x>=0&&A.y>=0&&A.x<=l.width&&A.y<=l.height;if(!$)return A;if(c&&$d(c.pixelPerfect,I,n)){var l,u=1;this._is2d?(u=n.getZoom(),l=Gr(k.x,k.y,C,u)):l=Gr(k.x,k.y);var B=!1,X=l.x,N=l.y,w=l.width,f=l.height,h=m.hitMaxArea,t=w*f*u*u;if(t>h){var d=Math.sqrt(h/t);u*=d}w*=u,f*=u,2>w&&(w=2),2>f&&(f=2),X*=u,N*=u;var H=Uf(w,f),W=new Eh(0,-X,-N,u,u);W.append(e.matrix),n._drawForChecking=!0,c.transform=W;var K=O.comps;O.comps=[c],Af(H,O,0,0,w,f,I,self),O.comps=K,delete c.transform,n._drawForChecking=!1;try{for(var g=0,_=H.getImageData(0,0,w,f).data;g<_.length;g+=4)if(0!==_[g+3]){B=!0;break}H.restore()}catch(z){ub=V,B=!1}A.inRect=B}else A.inRect=!0;return A}});var gm=Wm.DefaultInteractor=function(z){Hh(gm,this,[z])};en("DefaultInteractor",hl,{handle_mousedown:function(Y){Mf(Y);var D=this,X=D.gv,K=X.getDataAt(Y);if(X.setFocus(Y)&&!X._editing&&!X._scrolling){$e(Y)?X.handleDoubleClick(Y,K):X.handleClick(Y,K);var r=ef(Y);!on()&&!r&&K&&(X.isMovable(K)||X.isInteractive(K))||!X.isPannable()||!Te(Y)&&!r||Kg(Y)||(D._tx=X.tx(),D._ty=X.ty(),D.startDragging(Y))}},handleWindowMouseUp:function(Y){var P=this,N=P.gv;N._panning&&(delete N._panning,N.onPanEnded(),P.fi({kind:"endPan",event:Y})),delete P._tx,delete P._ty,P.clearDragging()},handle_mousemove:function(z){var T=this,g=T.gv;T._hoverTimer&&(W(T._hoverTimer),delete T._hoverTimer),T._hoverTimer=G(function(){T.fi({kind:"hover",event:z}),W(T._hoverTimer),delete T._hoverTimer},g.getHoverDelay()||m.hoverDelay)},handle_touchmove:function(X){this.handle_mousemove(X)},handleWindowMouseMove:function(y){var S=this,K=S.gv;S.fi({kind:K._panning?"betweenPan":"beginPan",event:y}),K._panning=1;var P=Ub(K,y,S._lastClientPoint);K.setTranslate(S._tx+P.x,S._ty+P.y)},handle_mousewheel:function(R){this.gv.handleScroll(R,R.wheelDelta)},handle_DOMMouseScroll:function(O){2===O.axis&&this.gv.handleScroll(O,-O.detail)},handle_keydown:function(u){this.gv.handleKeyDown(u)}});var pi=Wm.SelectInteractor=function(B){Hh(pi,this,[B])};en("SelectInteractor",hl,{_42:function(){var h=this,$=h.gv,y=$.getZoom(),u=h.mark,k=h.div;k||(k=h.div=Ij(),Kl(h.getView(),k));var l={};l.x=u.x*y+$.tx(),l.y=u.y*y+$.ty(),l.width=u.width*y,l.height=u.height*y,xg(k,l),this.intersects()?(k.style.border="",k.style.background=$.getRectSelectBackground()):(k.style.background="",k.style.border="1px solid "+$.getRectSelectBorderColor())},handle_mousedown:function(H){var y=this,l=y.gv;if(y._57I=V,y.pendingClickThrough=V,!(l._editing||l._scrolling||on()||ef(H))){var J=l.getDataAt(H),G=l.sm();J?Kg(H)?G.co(J)?G.rs(J):G.as(J):G.co(J)?J instanceof Cn&&J.isClickThroughEnabled()&&Te(H)&&(y.pendingClickThrough=_h(H)):G.ss(J):Kg(H)||!l.isPannable()?Te(H)&&(Kg(H)||G.cs(),l.isRectSelectable()&&(y.startDragging(H),l._77O=1)):Te(H)&&(y._57I=_h(H))}},handle_mouseup:function(E){var g=this,x=g.gv,w=g._57I;if(w&&(_e(w,_h(E))<=1&&x.sm().cs(),g._57I=V),g.pendingClickThrough){if(_e(g.pendingClickThrough,_h(E))<=1){var c=x.getDataAt(E);if(c instanceof Cn&&c.isClickThroughEnabled()){var d=x.getDataAt(E,function(i){var Q=i.getParent()===c&&x.isSelectable(i,!0);return Q});d&&(E.clickThrough=!0,x.sm().ss(d))}}g.pendingClickThrough=V}},handleWindowMouseUp:function(J){this.clear(J)},handleWindowMouseMove:function(P){var m=this,O=m.gv;m._logicalPoint=O.lp(P),m.mark?(m.fi({kind:"betweenRectSelect",event:P}),O.isPannable()&&m.autoScroll(P),m.redraw()):m.fi({kind:"beginRectSelect",event:P}),m.mark=fr(m._lastLogicalPoint,m._logicalPoint),m.redraw()},intersects:function(){var H=this,Y=H._lastLogicalPoint,h=H._logicalPoint;return Y.x>h.x||Y.y>h.y},clear:function(q){var H=this,Q=H.gv,S=H.mark;if(H._57I=V,H.pendingClickThrough=V,H._lastLogicalPoint){if(S){if(0!==S.width&&0!==S.height){var r=Q.getDatasInRect(S,H.intersects());if(!r.isEmpty()){var D=Q.sm(),z=D.toSelection();r.each(function($){D.co($)?z.remove($):z.add($)}),D.ss(z)}}Nr(H.div),delete H.div,delete H.mark,H.redraw(),H.fi({kind:"endRectSelect",event:q}),Q.onRectSelectEnded()}H.clearDragging(),delete Q._77O}},redraw:function(){var s=this;s._draw||(s._draw=1,G(function(){s.mark&&s._42(),delete s._draw},16))}});var kq=Wm.MoveInteractor=function(R){Hh(kq,this,[R])};en("MoveInteractor",hl,{handle_mousedown:function(d){var S=this,g=S.gv;if(Te(d)&&!g._editing&&!g._scrolling&&!on()){var Y=g.getSelectedDataAt(d);!Y||g.isInteractive(Y)&&!g.isMovable(Y)?g._focusData=V:(S._data=Y,g.handleMouseDown&&g.handleMouseDown(d,Y),S.startDragging(d),g.isMovable(Y)&&(g._moving=1))}},handleWindowMouseUp:function(L){var q=this,F=q.gv;F.handleMouseUp&&F.handleMouseUp(L,q._data),q.clear(L)},handleWindowMouseMove:function(J){var N=this,j=N._data,Q=N.gv;if((!Q._93O||!Q._93O(J,j))&&Q._moving){N._logicalPoint||N.fi({kind:"prepareMove",event:J});var q=N._logicalPoint?"betweenMove":"beginMove",F={kind:q,event:J},H=N._logicalPoint=Q.lp(J);"beginMove"!==q||N._alreadyBeginTransaction||(N._alreadyBeginTransaction=!0,Q.getDataModel().beginTransaction());var h=N._calcShift(q,J),Z=h.x,u=h.y,I=N.gv.getMoveMode(J,j);I&&("x"===I?u=0:"y"===I?Z=0:"xy"!==I&&(Z=u=0)),Q.moveSelection(Z,u),N._lastLogicalPoint=H,N.autoScroll(J),N.fi(F)}},_calcShift:function(){var $=this,G=$._logicalPoint,C=$._lastLogicalPoint,A=G.x-C.x,k=G.y-C.y;return{x:A,y:k}},clear:function(h){var x=this,u=x.gv;x._lastLogicalPoint&&(x._lastLogicalPoint=x._data=u._moving=V,x._logicalPoint&&(x.fi({kind:"endMove",event:h}),u.onMoveEnded()),x.clearDragging()),x._alreadyBeginTransaction&&(x._alreadyBeginTransaction=!1,u.getDataModel().endTransaction())}});var Nm=Wm.TextEditInteractor=function(J){Hh(Nm,this,[J]),this.init()};en("TextEditInteractor",hl,{init:function(){var v=this,S=this.input=T.createElement("input"),U=S.style;S.text="text",U.border="1px solid #d8d8d8",U.position="absolute",U.padding="2px 3px",U.outline="none",U.marginLeft="-90px",U.marginTop="-16px",U.backgroundColor="rgba(255,255,255, 0.9)",U.fontSize="14px",U.width="180px",U.height="32px",U.boxShadow="0 0 13px rgba(16,142,233, 0.5)",U.textAlign="center",U.boxSizing="border-box",S.addEventListener("keyup",function(G){Yd(G)&&v.endTextEdit()}),S.addEventListener("focus",function(){S.select()});var A=this.textarea=T.createElement("textarea"),J=this.wrap=T.createElement("div");J.appendChild(A),U=A.style,U.margin=0,U.padding="4px",U.overflow="hidden",U.boxSizing="border-box",U.position="absolute",U.outline="none",U.backgroundColor="transparent",U.resize="none",U.textAlign="center",U.fontSize="14px",U.border="none",U.borderWidth=0,U.width="100%",U.top="50%",U=J.style,U.boxSizing="border-box",U.margin=0,U.padding=0,U.position="absolute",U.boxShadow="0 0 13px rgba(16,142,233, 0.5)",U.border="1px solid #d8d8d8",U.backgroundColor="rgba(255,255,255, 0.9)",U.width="180px",U.marginLeft="-90px",A.addEventListener("keydown",function(g){return(gh()||Kg())&&Yd(g)?(v.endTextEdit(),void 0):(v.calculateTextareaHeight(String.fromCharCode(g.keyCode)),void 0)}),A.addEventListener("focus",function(){A.select()});var C=function(l){l.stopPropagation()};S.addEventListener("mousedown",C),S.addEventListener("touchstart",C),A.addEventListener("mousedown",C),A.addEventListener("touchstart",C),v.SIZING_STYLE=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"],v.HIDDEN_TEXTAREA_STYLE="visibility:hidden; min-height:0 !important;max-height:none !important;height:0 !important;visibility:hidden !important;overflow:hidden !important;position:absolute !important;z-index:-1000 !important;top:0 !important;right:0 !important",v.handleWindowClick=function(J){var Z=v._editingDOM,Y=Z.getBoundingClientRect(),X=_h(J);zc(Y,X)||v.endTextEdit()}},handle_mousedown:function(B){var T=this,v=T.gv;if($e(B)&&!v._editing){var j=v.getDataAt(B);if(j){var P=v.getTextEditInfo(j);P&&(this._editInfo=P,this._editTarget=j,v._editing=!0,P.isMultiline?this.handleMultilineEdit():this.handleTextEdit())}}},handleMultilineEdit:function(){var P=this,$=P.gv,Z=P._editTarget,c=P.getTargetValue(),z=P.textarea,D=P.wrap;this.hiddenTextarea||this.createHiddenTextarea(),(null===c||c===C)&&(c=""),z.value=c,P._editingDOM=z,$.getView().appendChild(D),this.layoutHTML(D,Z),this.calculateTextareaHeight(),G(function(){z.focus(),K.addEventListener("mousedown",P.handleWindowClick),K.addEventListener("touchstart",P.handleWindowClick)},10)},handleTextEdit:function(){var x=this,W=x.gv,$=x._editTarget,e=x.getTargetValue(),p=x.input;(null===e||e===C)&&(e=""),p.value=e,x._editingDOM=p,W.getView().appendChild(p),this.layoutHTML(p,$),G(function(){p.focus(),K.addEventListener("mousedown",x.handleWindowClick),K.addEventListener("touchstart",x.handleWindowClick)},10)},layoutHTML:function(L,Z){var c=this.gv,w=c.getZoom();if(Z instanceof k.Node){var K=Z.getRect();L.style.left=(K.x+K.width/2)*w+c.tx()+"px",L.style.top=(K.y+K.height/2)*w+c.ty()+"px"}else if(Z instanceof k.Edge){var j=c.getDataUI(Z),K=j._6I;L.style.left=(K.x+K.width/2)*w+c.tx()+"px",L.style.top=(K.y+K.height/2)*w+c.ty()+"px"}},endTextEdit:function(){var T=this,k=T._editInfo.isMultiline?T.wrap:T.input,R=T._editInfo.isMultiline?T.textarea:T.input;T.setTargetValue(R.value),T.gv.getView().removeChild(k),T.gv._editing=!1,delete T._editingDOM,K.removeEventListener("mousedown",T.handleWindowClick),K.removeEventListener("touchstart",T.handleWindowClick)},setTargetValue:function(p){var N=this,e=N._editTarget,a=N._editInfo,f=a.accessType,g=a.name;if(g&&f||(f="p",g="name"),"p"===f){var t=k.Default.setter(g);e[t](p)}else"a"===f?e.a(g,p):e.s(g,p)},getTargetValue:function(){var G=this,P=G._editTarget,t=G._editInfo,W=t.accessType,U=t.name;if(U&&W||(W="p",U="name"),"p"===W){var E=k.Default.getter(U);return P[E]()}return"a"===W?P.a(U):P.s(U)},createHiddenTextarea:function(){this.hiddenTextarea=T.createElement("textarea"),this.hiddenTextarea.setAttribute("style","margin:0; padding:0; position:absolute; overflowY:scroll; resize:none; box-sizing:border-box;"),this.hiddenTextarea.setAttribute("rows","1"),this.gv.getView().appendChild(this.hiddenTextarea)},calculateHTMLStyle:function(X,V){if(V&&this.computedStyleCache)return this.computedStyleCache;var r=this,M=K.getComputedStyle(X),D=M.getPropertyValue("box-sizing")||M.getPropertyValue("-moz-box-sizing")||M.getPropertyValue("-webkit-box-sizing"),s=parseFloat(M.getPropertyValue("padding-bottom"))+parseFloat(M.getPropertyValue("padding-top")),o=parseFloat(M.getPropertyValue("border-bottom-width"))+parseFloat(M.getPropertyValue("border-top-width")),f=r.SIZING_STYLE.map(function(X){return X+":"+M.getPropertyValue(X)}).join(";"),k={sizingStyle:f,paddingSize:s,borderSize:o,boxSizing:D};return V&&(this.computedStyleCache=k),k},calculateTextareaHeight:function(e){e=e||"";var C=this,I=C.textarea,M=C.hiddenTextarea,d=C.wrap,X=32,V=C.calculateHTMLStyle(I,!1),A=V.paddingSize,O=V.borderSize,b=V.boxSizing,v=V.sizingStyle;M.setAttribute("style",v+";"+C.HIDDEN_TEXTAREA_STYLE),M.value=I.value+e;var E=M.scrollHeight;"border-box"===b?E+=O:"content-box"===b&&(E-=A),I.style.height=E+"px",I.style.marginTop=0-.5*E+"px",d.style.height=Math.max(E,X)+"px",d.style.marginTop=E*-.5+"px"}});var nf=Wm.ScrollBarInteractor=function(K){Hh(nf,this,[K])};en("ScrollBarInteractor",hl,{_41o:function(){return this.gv.getViewRect().height<this.gv.getScrollRect().height},_40o:function(){return this.gv.getViewRect().width<this.gv.getScrollRect().width},isV:function(O){var i=this.gv.getViewRect();return this._41o()&&(i.x+i.width-this.gv.lp(O).x)*this.gv.getZoom()<je},isH:function(U){var J=this.gv.getViewRect();return this._40o()&&(J.y+J.height-this.gv.lp(U).y)*this.gv.getZoom()<je},handle_mousemove:function(P){this.handle_touchmove(P)},handle_touchmove:function(i){if(!bl&&Te(i)&&this.gv.isScrollBarVisible()){var C=this,n=C.isV(i),p=C.isH(i);(n||p)&&C.gv.showScrollBar(),C.gv._scrolling=n||p}},handleWindowMouseUp:function(Z){this.handleWindowTouchEnd(Z)},handleWindowTouchEnd:function(x){this._state=this._cp=this._tx=this._ty=this.gv._scrolling=V,this.fi({kind:"endScroll",event:x})},handle_mousedown:function(b){this.handle_touchstart(b)},handle_touchstart:function(X){var F=this;if(F.gv.setFocus(X),Mf(X),F.handle_touchmove(X),!(Sg(X)>1)&&F.gv._scrolling&&F.gv.isScrollBarVisible()){F._cp=_h(X),F._tx=F.gv.tx(),F._ty=F.gv.ty();var $=F.isV(X);F._state=$?"vScroll":"hScroll",cp(F,X),F.fi({kind:"beginScroll",event:X})}},handleWindowMouseMove:function(k){this.handleWindowTouchMove(k)},handleWindowTouchMove:function(u){var x=_h(u),R=this.gv.getViewRect(),X=this.gv.getScrollRect();"vScroll"===this._state?this.gv.ty(this._ty+(this._cp.y-x.y)*X.height/R.height):"hScroll"===this._state&&this.gv.tx(this._tx+(this._cp.x-x.x)*X.width/R.width),this.fi({kind:"betweenScroll",event:u})}});var _f=Wm.TouchInteractor=function(S,P){P=P||{},P.selectable===C&&(P.selectable=!0),P.movable===C&&(P.movable=!0),P.pannable===C&&(P.pannable=!0),P.pinchable===C&&(P.pinchable=!0),P.editable===C&&(P.editable=!0),this.params=P,Hh(_f,this,[S])};en("TouchInteractor",hl,{ms_edit:1,setUp:function(){var M=this;_f.superClass.setUp.call(M),fn&&M.params.editable&&M.gv.setEditInteractor(M)},tearDown:function(){var z=this;_f.superClass.tearDown.call(z),fn&&z.params.editable&&z.gv.setEditInteractor(V)},clear:function(U){var C=this,X=C.gv;X._moving&&(C.fi({kind:"endMove",event:U}),delete X._moving,X.onMoveEnded(),X.dm().endTransaction()),X._panning&&(C.fi({kind:"endPan",event:U}),delete X._panning,X.onPanEnded()),X._pinching&&(C.fi({kind:"endPinch",event:U}),delete X._pinching,X.onPinchEnded()),X._editing&&(C._46O(U),C._77I=C._node=C._edge=C._shape=C._rect=C._89I=C._index=X._editing=V),C._moving=C._panning=C._pinching=C._editing=C._57I=C._data=C._beginHistory=V,C.clearDragging()},handle_touchstart:function(c){var s=this;if(!s.gv._editing){Mf(c),s._57I=V;var S=s.params,J=s.gv,$=J.sm(),Z=J.getDataAt(c),T=Sg(c);if(1===T){if($e(c))return J.handleDoubleClick(c,Z),void 0;J.handleClick(c,Z),Z&&(J.handleMouseDown&&J.handleMouseDown(c,Z),s._data=Z),S.selectable||(Z=V),Z&&($.co(Z)||$.ss(Z),S.editable&&J.isEditable(Z)&&s._79I(c,Z,!0)?(s._editing=1,s.startDragging(c)):S.movable&&J.isMovable(Z)&&(s._moving=1,s.startDragging(c))),Z&&J.isMovable(Z)||(s._57I=_h(c),S.pannable&&J.isPannable()&&(s._panning=1,s.startDragging(c),s._translate={x:J.tx(),y:J.ty()}))}else if(S.pinchable&&2===T){if(Z&&J.isInteractive(Z))return;s._pinching=1,s.startDragging(c);var G=J.getView(),A=J.getZoom(),H=G.getBoundingClientRect(),z=c.touches[0],l=c.touches[1],B={x:(z.clientX+l.clientX)/2-H.left,y:(z.clientY+l.clientY)/2-H.top};B.x-=J.tx(),B.y-=J.ty(),B.x/=A,B.y/=A,s._p=B,s._d=xi(c)}}},handle_touchend:function(y){var Z=this,Q=Z.gv,T=Z._57I,m=Z._data;T&&(_e(T,_h(y))<=1&&!graphView.getDataAt(y)&&Q.sm().cs(),Z._57I=V),m&&Q.handleMouseUp&&Q.handleMouseUp(y,m)},handleWindowTouchEnd:function(t){this.clear(t)},handleWindowTouchMove:function(E){var $=this,Q=$.gv,j=Sg(E);if(1===j){if($._editing&&($._beginHistory||($._beginHistory=1,Q.dm().beginTransaction()),Q._editing=1,$._78I(E)),$._moving)$._beginHistory||($._beginHistory=1,Q.dm().beginTransaction()),$.handleMove(E);else if($._panning){var c=_h(E),I=Ub(Q,c,$._lastClientPoint);Q.setTranslate($._translate.x+I.x,$._translate.y+I.y),$.fi({kind:Q._panning?"betweenPan":"beginPan",event:E}),Q._panning=1}}else if(2===j&&$._pinching){var G=xi(E);Q.handlePinch($._p,G,$._d),$._d=G,$.fi({kind:Q._pinching?"betweenPinch":"beginPinch",event:E}),Q._pinching=1}},handleMove:function(E){var d=this,W=d.gv,O=W.lp(E);W._93O&&W._93O(E,d._data)||(W.moveSelection(O.x-d._lastLogicalPoint.x,O.y-d._lastLogicalPoint.y),d._lastLogicalPoint=O,d.autoScroll(E),d.fi({kind:W._moving?"betweenMove":"beginMove",event:E}),W._moving=1)}});var k=K.ht,_p=k.graph._editor={Math:k.Math,Guide:{}};_p.getStyle=function(g){var E,U=_p.StyleMap;return U&&(E=U[g],E!==C)?E:_p.DefaultStyleMap[g]},_p.setStyle=function(W,T){var l=_p.StyleMap;l||(l=_p.StyleMap={}),l[W]=T},_p.inEdit=function(J){return J._inXEdit===!0},_p.startEdit=function(O){O._inXEdit=!0,_p.Inject.doInject(O)},_p._46O=function(P){P._inXEdit=!1,_p.Inject.undoInject(P)},_p.toScreenPosition=function(y,t){var m=y.tx(),F=y.ty(),w=y._zoom;return new _p.Math.Vector2(t.x*w+m,t.y*w+F)},_p.checkHit=function(d,j,B){return d.distanceTo(j)<B?!0:!1},_p.toWorldPosition=function(t,v){var d=t.tx(),R=t.ty(),$=t._zoom;return{x:(v.x-d)/$,y:(v.y-R)/$}},_p.setAntialias=function(C,T){for(var L,Q=["imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","msImageSmoothingEnabled"],D=0,G=Q.length;G>D&&(L=Q[D],!(L in C));D++);C[L],C[L]=T},_p.getTargetCornersOnScreen=function(u,N){if(!N)return null;var P,c=[];if(Rl(N,u)){var J=ed(u,N);P=[{x:J.x,y:J.y},{x:J.x+J.width,y:J.y},{x:J.x+J.width,y:J.y+J.height},{x:J.x,y:J.y+J.height}]}else{if(!N.getCorners)return null;P=N.getCorners()}return P.forEach(function(x){var F=_p.toScreenPosition(u,x);c.push(F.x,F.y)}),c},_p.log=function(){};var Po=_p.Inject={_modules:[]};Po.registAsModule=function(h,J){var o={},W={};for(var s in h){var K=J.prototype[s];o[s]=K}h.getBackup=function(s){return o[s]},h.getBackups=function(){return o},W.doInject=function(){for(var e in h)"getBackup"!==e&&(J.prototype[e]=h[e])},W.undoInject=function(){for(var K in h)"getBackup"!==K&&(J.prototype[K]=o[K])},Po._modules.push(W)},Po.doInject=function(U){for(var i,Y=Po._modules,$=0,S=Y.length;S>$;$++)i=Y[$],i.doInject(U)},Po.undoInject=function(b){for(var H,A=Po._modules,s=0,G=A.length;G>s;s++)H=A[s],H.undoInject(b)};var hl=k.graph.EditInteractor=function(O){var H=this,E=T.createElement("canvas");E.className="editCanvas",E.style.position="absolute",H._styleMap={},H._canvas=E,H._context=E.getContext("2d"),hl.superClass.constructor.call(H,O),_p.setAntialias(H._context,!1),H._subModules=[new _p.Anchor(H),new _p.RotateX(H),new _p.MoveDummy(H),new _p.Rect(H),new _p.Curve(H),new _p.MoveHelper(H)],H._gridGuide=new _p.Guide.Grid(H),H._rectGuide=new _p.Guide.Rect(H),H._hoverGuide=new _p.Guide.Hover(H)},jo=hl;k.Default.def(hl,k.graph.Interactor,{ms_edit:1,ms_fire:1}),H.defineProperties(hl.prototype,{editDetail:{get:function(){var X=!!this._editDetail;return X},set:function(X){var c=this,J=c._editDetail;J!==X&&(c._editDetail=X,c.gv._editing=X,c.fp("editDetail",J,X),c.fp("pointsEditingMode",J,X),c.fi({kind:X?"beginEditPoints":"endEditPoints"}))}},gvEditing:{get:function(){return this.gv._editing},set:function(W){(!this._editDetail||W)&&(this.gv._editing=W,W||(this.editDetail=!1))}},editing:{get:function(){return this._editing},set:function(O){this._editing=O,this.gvEditing=O}},pointsEditingMode:{get:function(){return this.editDetail},set:function(f){var _=this;_.editDetail!==f&&(f?_._tryEnterEditDetailMode():_._tryQuitEditDetailMode())}},gridEnabled:{get:function(){var F=this._gridEnabled;if(!F)return!1;var w=this.gv;return w?!0:!0},set:function(N){N!==this._gridEnabled&&(this._gridEnabled=N,this._42())}},alignmentGuideEnabled:{get:function(){return this._agEnabled},set:function($){$!==this._agEnabled&&(this._agEnabled=$,this._42())}},gridGuide:{get:function(){return this._gridGuide}},rectGuide:{get:function(){return this._rectGuide}},hoverGuide:{get:function(){return this._hoverGuide}}}),hl.prototype.getSubModule=function(W){var q,V,J,U=this._subModules;for(V=0,J=U.length;J>V;V++)if(q=U[V],q.catalog===W)return q},hl.prototype.invokeSubModule=function(m,M){var n=this,x=n._subModules;if(x)for(var I,h,Q,r=Array.prototype.slice.call(arguments,2),D=0,k=x.length;k>D;D++)if(I=x[D],h=I[m],h&&(Q=h.apply(I,r),Q!=C&&M))return I},hl.prototype.invokeSubModuleInverse=function(Q,Z){var V=this,F=V._subModules;if(F)for(var e,z,X,l=Array.prototype.slice.call(arguments,2),R=F.length-1;R>=0;R--)if(e=F[R],z=e[Q],z&&(X=z.apply(e,l),X!=C&&Z))return e},hl.prototype.setUp=function(){_p.log("setUp");var g=this,M=g.gv,t=M.getView(),i=g._canvas;hl.superClass.setUp.call(g),M.setEditInteractor(g),M._79O?t.insertBefore(i,M._79O):t.appendChild(i),_p.startEdit(M),g.invokeSubModule("setUp"),M.dm().mm(g._onDataModelChanged,g),M.dm().md(g._onDataPropertyChanged,g)},hl.prototype.tearDown=function(){_p.log("tearDown");var y=this,b=y.gv,r=b.getView();y._resetCustomCursorStyle(),hl.superClass.tearDown.call(y),b.dm().umm(y._onDataModelChanged,y),b.dm().umd(y._onDataPropertyChanged,y),b.setEditInteractor(null),r.removeChild(y._canvas),y._drawTimer&&(W(y._drawTimer),y._drawTimer=null),_p._46O(b),y.invokeSubModule("tearDown")},hl.prototype._onDataModelChanged=function(C){var I=this;("clear"===C.kind||"remove"===C.kind&&I.editDetail&&C.data===I.getSubModule("Curve").target)&&(I.editDetail=!1,I._42())},hl.prototype._onDataPropertyChanged=function(J){var q=this;if(q.editDetail){var x=q.getSubModule("Curve"),C=J.data;C===x.target&&(C._writing||x._handleDataChanged(J))}},hl.prototype.clear=function(){_p.log("clear")},hl.prototype.redraw=function(){this._42()},hl.prototype._42=function(){var K=this;K._drawTimer||(K._drawTimer=G(function(){K._drawTimer=null,K.drawImpl()},0))},hl.prototype.drawImpl=function(){var h;for(h in{_42:!0})break;return function(){var e=this,p=e._canvas,s=e.gv,x=s.getWidth(),z=s.getHeight(),n=e._context,y=k.Default.getInternal(),b=K.devicePixelRatio;(p.width!==x||p.height!==z)&&y.setCanvas(p,x,z,b),n.clearRect(0,0,p.width,p.height);var X=e._getValidSelection();n.save(),n.scale(b,b),e._gridGuide._42(),e.invokeSubModuleInverse(h,!1,n,s,X),e._rectGuide._42(),e._hoverGuide._42(),n.restore()}}(),hl.prototype._getValidSelection=function(){var J=this,Q=J.gv,t=Q.sm().getSelection(),Y=[];return t.each(function(L){Q.isVisible(L)&&Q.isEditable(L)&&Y.push(L)}),Y},hl.prototype.handle_touchmove=function(y){return this.handle_mousemove(y)},hl.prototype.handle_mousemove=function(o){if(!k.Default.isDragging()){var N=this;if(N.editDetail||!on()&&!ef(o))if(N.gvEditing=!1,N._checkEdit(o))N.gvEditing=!0;else{if(!N.getStyle("hoverGuideEnabled"))return;N.hoverData=N.gv.getDataAt(o),N._42()}}},hl.prototype.handle_touchstart=function(Y){return this.handle_mousedown(Y)},hl.prototype.handle_mousedown=function(A){Mf(A);var c=this;if(c.editDetail||!on()&&!ef(A)){if($e(A)&&!A.clickThrough){if(c.editDetail){if(c._tryQuitEditDetailMode(A))return}else if(c._tryEnterEditDetailMode())return;c.gv.dm().beginTransaction();var t=c.invokeSubModule("handleDoubleClick",!0,A);if(c.gv.dm().endTransaction(),t)return}var R=c._checkEdit(A);R&&(c._downPosition=c._getLogicalPoint(A),c.gv.dm().beginTransaction(),R.startEdit(c,A),c.editing=!0)}},hl.prototype._checkEdit=function(D){var s=this,o=s.gv,E=s._getLogicalPoint(D),Q=s.invokeSubModule("check",!0,o,D,E)||null;return s._editMod=Q,Q},hl.prototype.handleWindowTouchMove=function(z){return this.handleWindowMouseMove(z)},hl.prototype.handleWindowMouseMove=function(l){var E=this,f=E._downPosition;if(f){var m=E._getLogicalPoint(l);if(m.distanceTo(f)<E.getStyle("moveSensitivity"))return;delete E._downPosition}var $=E._editMod;$&&$.handleEdit(E.gv,l)},hl.prototype._getLogicalPoint=function(D){var T=this,Z=k.Default.getLogicalPoint(D,T._canvas);return new _p.Math.Vector2(Z)},hl.prototype.handleWindowTouchEnd=function(s){return this.handleWindowMouseUp(s)},hl.prototype.handleWindowMouseUp=function(){var s;for(s in{_46O:!0})break;return function(g){var L=this;L.editing=!1,L.setCursor("default"),L.invokeSubModule(s,!1,g),L._42(),L.gv.dm().endTransaction()}}(),hl.prototype.handle_mousewheel=function(a){var r=this;Mf(a),r.invokeSubModule("preHandleScroll",!0)||r.gv.handleScroll(a,a.wheelDelta)},hl.prototype.handleDelete=function(){var x=this;if(!x.editDetail){x.gv.dm().beginTransaction();var w=x.invokeSubModule("handleNormalStateDelete",!0);return x.gv.dm().endTransaction(),w||x.gv.removeSelection(),void 0}x.gv.dm().beginTransaction(),x.invokeSubModule("handleDelete",!0),x.gv.dm().endTransaction(),x._42()},hl.prototype.handle_keydown=function(I){var X=this;if((I.metaKey||I.ctrlKey)&&X._42(),on(I)&&!X.editing)return X.gvEditing=!1,X.setCursor("default"),X._42(),void 0;var K=Yd(I);return X.editDetail?((K||zq(I))&&(X.editDetail=!1,X._42()),X.gv.dm().beginTransaction(),X.invokeSubModule("handle_keydown",!0,I),X.gv.dm().endTransaction(),void 0):(X.gv.dm().beginTransaction(),X.invokeSubModule("handleNormalStateKeyDown",!0,I),X.gv.dm().endTransaction(),K&&X._tryEnterEditDetailMode(),void 0)},hl.prototype.handle_keyup=function(N){this.gv.dm().beginTransaction(),this.invokeSubModule("handle_keyup",!0,N),this.gv.dm().endTransaction()},hl.prototype._tryEnterEditDetailMode=function(){var C=this;return!C.editDetail&&C.invokeSubModule("canEnterEditDetailMode",!0)&&1===C._getValidSelection().length?(C.editDetail=!0,C._42(),!0):void 0},hl.prototype._tryQuitEditDetailMode=function(T){var s=this;return s.editDetail?!T||s.invokeSubModule("canQuitEditDetailMode",!0,T)?(s.editDetail=!1,s._42(),!0):!1:!1
},hl.prototype.setStyle=function(c,p,h){var z=this;h?_p.setStyle(c,p):z._styleMap[c]=p,"baseColor"===c&&(Kf=p),z.fp("styleChanged",null,{key:c,value:p,base:h}),z._42()},hl.prototype.getStyle=function(R){var D=this,Z=D._styleMap[R];return Z!==C?Z:_p.getStyle(R)},hl.prototype.setCursor=function(U){this._resetCustomCursorStyle(),k.graph.EditInteractor.superClass.setCursor.call(this,U)},hl.prototype._resetCustomCursorStyle=function(){var S=this;if(S._customStyle){var g=this.gv.getView();g.classList&&g.classList.remove&&g.classList.remove(S._customStyle),S._customStyle=null}},hl.prototype._setRotateCursor=function(q){var B=this,L=B._cursorFactory;L||(L=B._cursorFactory=new _p.CursorFactory(B));var g=L.getRotateCursor(q),c=B.gv.getView();B._resetCustomCursorStyle(),B._customStyle=g,c.classList&&c.classList.add&&c.classList.add(g)};var co=_p.Group=function(r){var W=this;W._entities=r,W._64O=0,W._position={x:0,y:0},W._scale={x:1,y:1},W._anchor={x:.5,y:.5},W._anchor2={x:.5,y:.5}};co.prototype={},co.prototype.constructor=co;var ti=null;co.findOrCreateGroup=function(L){if(ti&&ti.checkIsMe(L))return ti;var M=new _p.Group(L);return M.getKeyOb()?(ti=M,M):void 0},co.prototype.checkIsMe=function(W){var Q=this._entities;if(Q.length!==W.length)return!1;var o,F={},H=W.length;for(o=0;H>o;o++)F[W[o]._id]=!0;for(o=0;H>o;o++)if(!F[Q[o]._id])return!1;return!0},co.prototype.getRotation=function(){return this._64O},co.prototype.getPosition=function(){return this._position},co.prototype.getAnchor=function(){return this._anchor},co.prototype.getWidth=function(){return this._width},co.prototype.getScale=function(){return this._scale},co.prototype.getSize=function(){return{width:this._width,height:this._height}},co.prototype.getHeight=function(){return this._height},co.prototype.getKeyOb=function(){for(var H=this._entities,c=H.length-1;c>=0;c--){var Z=H[c];if(this.isNode(Z))return Z}},co.prototype.getAnchor2=function(){var s=this,b=s.rotateCenter;if(b)return b;var E=s.getKeyOb();if(!E)return s._anchor;var i=s._anchor2,u=E.getMatrix();return u.tf({x:E.getWidth()*(i.x-E.getAnchor().x),y:E.getHeight()*(i.y-E.getAnchor().y)})},co.prototype.setAnchor2=function(Q,I){var e=this,X=e.getKeyOb();if(X){var G,o=X.getMatrix();G="number"==typeof Q?{x:Q,y:I}:Q;var D=o.tfi(G);e._anchor2={x:X.getAnchor().x+D.x/X.getWidth(),y:X.getAnchor().y+D.y/X.getHeight()}}},co.prototype.setRotation=function(){},co.prototype.beginRotate=function(u){this.rotateCenter=u.pos,this.rotateMode=u.groupRotateMode},co.prototype.endRotate=function(){delete this.rotateCenter,delete this.rotateMode},co.prototype.addRotation=function(E,O){return"batch"===O?this._addRotationInBatchMode(E):"block"===O?this._addRotationInBlockMode(E):void 0},co.prototype._addRotationInBlockMode=function(R){var v=this,I=v.rotateCenter||v.getPosition();v._entities.forEach(function(U){if(v.isNode(U)){var j=U.getMatrix();j.translate(-I.x,-I.y),j.rotate(R),j.translate(I.x,I.y);var T=Math.sign(U.getScale().x);U.setRotation(s(j.b*T,j.a*T)),U.setPosition(j.tx,j.ty)}})},co.prototype._addRotationInBatchMode=function(t){var F=this,h=F._anchor2;F._entities.forEach(function(P){if(F.isNode(P)){var k=P.getAnchor(),L=P.getMatrix(),p=L.tf({x:P.getWidth()*(h.x-k.x),y:P.getHeight()*(h.y-k.y)}),C=new _p.Math.Matrix2d;C.set(L.a,L.b,L.c,L.d,L.tx,L.ty),C.translate(-p.x,-p.y),C.rotate(t),C.translate(p.x,p.y);var B=Math.sign(P.getScale().x);P.setRotation(s(C.b*B,C.a*B)),P.setPosition(C.tx,C.ty)}})},co.prototype.setPosition=function(B){var k,O,w,I,u=this,S=u._position,n=B.x-S.x,L=B.y-S.y,M=u._entities;for(O=0,w=M.length;w>O;O++)k=M[O],rd(k)&&(I=k.getPosition(),k.setPosition(I.x+n,I.y+L));u._position=B},co.prototype.setScale=function(E,$){var l=this,X=E/l._scale.x,K=$/l._scale.y;l._adjustChildScaleOrSize(X,K,"size"),l._scale={x:E,y:$}},co.prototype.getRect=function(){var g=this,F=g._position,a=g._width,$=g._height;return{x:F.x-a/2,y:F.y-$/2,width:a,height:$}},co.prototype.setSize=function(b,Z){var p=this,b=Math.max(1,b),Z=Math.max(1,Z),u=b/p._width,s=Z/p._height;p._adjustChildScaleOrSize(u,s,"size"),p._width=b,p._height=Z},co.prototype._adjustChildScaleOrSize=function(k,Z,B){var b,H,Y,f,A,S,J,j,w,d,N,T,h,V,X=this,l=X._position,t=X._entities,K=new _p.Math.Matrix2d;for(H=0,Y=t.length;Y>H;H++)if(b=t[H],X.isNode(b)){if(f=b.getPosition(),A=b.getRotation(),S=b.getWidth(),J=b.getHeight(),j=b.getScale(),N=j.x*S,T=j.y*J,K.identity().scale(N,T).rotate(A).translate(f.x,f.y).translate(-l.x,-l.y).rotate(-X._64O),A=s(K.b*Math.sign(N),K.a*Math.sign(N)),K.scale(k,Z),w=Math.cos(A),d=Math.sin(A),Math.abs(w)<.001?(h=K.b/d,V=-K.c/d):(h=K.a/w,V=K.d/w),"scale"===B)b.setScale(h/S,V/J);else if("size"===B){var u=h/j.x,g=V/j.y;b.setScale(gb(h)*Math.abs(j.x),gb(V)*Math.abs(j.y)),b.setSize(Math.max(.1,Math.abs(u)),Math.max(.1,Math.abs(g)))}K.rotate(X._64O).translate(l.x,l.y),b.setPosition(K.tx,K.ty)}},co.prototype.getMatrix=function(){var Y=this,G=Y._position,X=k.Default.getInternal(),u=Y._scale;return new X.Mat(Y._64O,G.x,G.y,u.x,u.y)},co.prototype.toGlobal=function(D){return this.getMatrix().tf(D)},co.prototype.getCorners=function(){var V=this,h=V._width,i=V._height,j=V._anchor,k=-h*j.x,N=-i*j.y,X=V.getMatrix();return[X.tf(k,N),X.tf(k,N+i),X.tf(k+h,N+i),X.tf(k+h,N)]},co.prototype.calcInfo=function(){var A,D,L,C,F,g,V=this,q=[],e=V._entities,S=V._64O;for(C=0,F=e.length;F>C;C++)g=e[C],V.isNode(g)&&g.getCorners&&q.push.apply(q,g.getCorners());if(q.length){var N=Math.cos(-S),k=Math.sin(-S),y=1/0,n=-1/0,I=1/0,v=-1/0;for(C=0,F=q.length;F>C;C++)L=q[C],A=L.x,D=L.y,L.x=N*A-k*D,L.y=k*A+N*D,y=Math.min(y,L.x),n=Math.max(n,L.x),I=Math.min(I,L.y),v=Math.max(v,L.y);V._width=(n-y)/V._scale.x,V._height=(v-I)/V._scale.y,N=Math.cos(S),k=Math.sin(S);var W=V._anchor;A=y+(n-y)*W.x,D=I+(v-I)*W.y,V._position={x:N*A-k*D,y:k*A+N*D}}},co.prototype.isNode=function(L){return rd(L)?Rl(L)?!1:!0:!1},co.prototype._42=function(a,v,H){var l,I,M,y,r,T,n,x,Q=this,c=Q._entities,u=Q.rotateMode;for("batch"===u&&(x=Q.getKeyOb()),l=0,I=c.length;I>l;l++)M=c[l],Q.isNode(M)&&(T=M.getRect(),y=_p.toScreenPosition(H,{x:T.x,y:T.y}),r=_p.toScreenPosition(H,{x:T.x+T.width,y:T.y+T.height}),n={min:y,max:r},M===x&&(n.isKeyOb=!0),_p.Icons.DrawIcon(a,v,_p.Icons.GroupSubEntityRect,n))};var Bq=_p.CurveActiving=function(o,R){this._curve=o,this._interactor=o._interactor;for(var G in R)this[G]=R[G]};Bq.prototype={},Bq.prototype.constructor=Bq,H.defineProperties(Bq.prototype,{point:{get:function(){return this._point},set:function(E){var k=this;k._point=E,k.editingCtrl||k._firePointChange()}},pairs:{get:function(){return this._pairs},set:function(L){var o=this;o._pairs=L,o.editingCtrl&&o._firePointChange()}}}),Bq.prototype._firePointChange=function(){var u=this,S=u.getCurrentEditingPoint(),H=u._interactor;if(!S)return H.fi({kind:"selectPoint"}),void 0;var W=this._curve.target;if(W){var R=_p.getDataMatrix(W).invert(),$=S.e;S=R.apply(_p.toWorldPosition(H.gv,S)),S.e=$;var Y=u._lastFirePoint;Y&&Math.abs(S.x-Y.x)<1e-5&&Math.abs(S.y-Y.y)<1e-5&&(S.e==C&&Y.e==C||Math.abs(S.e-Y.e)<1e-5)||(u._lastFirePoint=S,H.fi({kind:"selectPoint",x:S.x,y:S.y,e:S.e}))}},Bq.prototype.dispose=function(){this._interactor.fi({kind:"selectPoint"})},Bq.prototype.getCurrentEditingPoint=function(){var b=this,u=b.editingCtrl;if(u){var F=b.pairs;if(F){var n=F[u.pairId],v=n[u.type];if(v)return v}}return b._point};var Bo=_p.CursorFactory=function(v){var X=this;X._interactor=v,X._rotateCursorStyles={}};Bo.prototype={},Bo.prototype.constructor=Bo,Bo.prototype.getRotateCursor=function(W){var q=this;0>W&&(W+=2*Math.PI);var g=q._interactor,V=g.getStyle("rotateCursorSize"),t=g.getStyle("rotateCursorRound"),G=Math.round(180*(W/Math.PI)/t);G*t>=360&&(G=0);var T=q._rotateCursorStyles,e="htCustomRotateStyle_"+V+"_"+t+"_"+G;return T[e]||(q._produceRotateCursor(e,V,t,G),T[e]=!0),e},Bo.prototype._produceRotateCursor=function(k,t,R,H){var s=this;s._interactor;var U=s._canvas;U||(U=s._canvas=T.createElement("canvas")),U.width=U.height=t*devicePixelRatio,U.style.width=U.style.height=t+" px";var g=U.getContext("2d");_p.setAntialias(g,!1),g.scale(devicePixelRatio,devicePixelRatio);var b,F,j,G,X,W=Math.round(t/2),K=""+W+" "+W+",auto !important;";b=Math.PI/180*H*R,g.clearRect(0,0,t,t),g.save(),g.scale(t/32,t/32),g.translate(16,16),g.rotate(b+Math.PI/2),g.beginPath(),g.moveTo(-8,0),g.lineTo(-8,3),g.lineTo(-5,3),g.moveTo(8,0),g.lineTo(8,3),g.lineTo(5,3),g.moveTo(-8,3),g.quadraticCurveTo(0,-6,8,3),g.restore(),g.strokeStyle="white",g.lineWidth=4,g.stroke(),g.strokeStyle="black",g.lineWidth=2,g.stroke(),F=JSON.stringify(U.toDataURL()),G="cursor:url("+F+")"+K,1!==devicePixelRatio&&(j='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+t+'px" height="'+t+'px"><image xlink:href='+F+' width="'+t+'" height="'+t+'"/></svg>',G+="cursor:url(data:image/svg+xml;base64,"+btoa(j)+")"+K,G+="cursor:-webkit-image-set(url("+F+")"+devicePixelRatio+"x,url("+F+")1x)"+K),X=T.createElement("style"),X.textContent="body."+k+" *, ."+k+"{"+G+"}",T.head.appendChild(X)};var jp=_p.Guide.Grid=function(R){var m=this;m._interactor=R,m._alignmentGuideId=0,m._xAlignmentGuide=[],m._yAlignmentGuide=[]};jp.prototype={},jp.prototype.constructor=jp,H.defineProperties(jp.prototype,{gridBlockSize:{get:function(){var h=this;return h._gridBlockSize||h._interactor.getStyle("gridBlockSize")},set:function(o){this._gridBlockSize=o,this._interactor._42()}},gridThickLinesEvery:{get:function(){var H=this;return H._gridThickLinesEvery||H._interactor.getStyle("gridThickLinesEvery")},set:function(F){this._gridThickLinesEvery=F,this._interactor._42()}},gridEnabled:{get:function(){var p=this,X=p._interactor;return X.gridEnabled&&p.isValidGrid()}}}),jp.prototype._42=function(){var C=this,x=C._interactor;C.gridEnabled&&C.drawGrid(),x.alignmentGuideEnabled&&C.drawAlignmentGuide()},jp.prototype.makeMatrix=function(){var i=this,E=i._interactor.getStyle("gridAngle"),k=i._interactor.getStyle("gridRotation"),l=new _p.Math.Matrix2d,$=Math.sin(E),c=Math.cos(E);return l.set(1,0,c,$,0,0),l.rotate(k),l},jp.prototype.isValidGrid=function(){var x=this,s=Math.PI,l=x._interactor,S=l.gv;if(S._zoom<l.getStyle("gridZoomThreshold"))return!1;var k=l.getStyle("gridAngle"),g=Math.abs(180*(k%s/s)),N=1-1e-8;return N>g||g>180-N?!1:!0},jp.prototype.drawAlignmentGuide=function(){var I=this,K=I._interactor,n=K.gv,e=K._canvas,q=K._context,V=e.width,k=e.height,L=n.tx(),v=n.ty(),l=n._zoom;q.beginPath(),q.strokeStyle=K.getStyle("gridAlignmentGuideColor"),q.lineWidth=1,I._xAlignmentGuide.forEach(function(w){var N=w.p*l+L;q.moveTo(N,0),q.lineTo(N,k)}),I._yAlignmentGuide.forEach(function(x){var D=x.p*l+v;q.moveTo(0,D),q.lineTo(V,D)}),q.stroke()},jp.prototype.drawGrid=function(){function w(h,j,m,V){var e=_p.toScreenPosition(p,K.apply({x:h,y:j})),n=_p.toScreenPosition(p,K.apply({x:m,y:V}));x.moveTo(e.x,e.y),x.lineTo(n.x,n.y)}var M=this,B=M._interactor,t=M.gridBlockSize,J=M.gridThickLinesEvery,n=B.getStyle("gridThickColor"),Z=B.getStyle("gridLightColor"),p=B.gv,D=B._canvas,x=B._context,k=D.width,G=D.height,K=M.makeMatrix(),I=K.applyInverse(_p.toWorldPosition(p,{x:0,y:0})),V=K.applyInverse(_p.toWorldPosition(p,{x:k,y:0})),W=K.applyInverse(_p.toWorldPosition(p,{x:0,y:G})),g=K.applyInverse(_p.toWorldPosition(p,{x:k,y:G})),b=Math.min(I.x,V.x,W.x,g.x),q=Math.max(I.x,V.x,W.x,g.x),C=Math.min(I.y,V.y,W.y,g.y),o=Math.max(I.y,V.y,W.y,g.y);k=q-b,G=o-C;var v=Math.ceil(b/t),c=Math.floor(q/t),A=Math.ceil(C/t),_=Math.floor(o/t);p.tx(),p.ty(),p._zoom;var z,S,y;for(x.save(),x.lineWidth=1,x.beginPath(),x.strokeStyle=n,y=Math.ceil(v/J)*J;c>=y;y+=J)z=y*t,w(z,C,z,o);for(y=Math.ceil(A/J)*J;_>=y;y+=J)S=y*t,w(b,S,q,S);for(x.stroke(),x.beginPath(),x.strokeStyle=Z,y=v;c>=y;y++)0!==y%J&&(z=y*t,w(z,C,z,o));for(y=A;_>=y;y++)0!==y%J&&(S=y*t,w(b,S,q,S));x.stroke(),x.restore()},jp.prototype.getAlignmentGuides=function(){var P=this;return{x:P._xAlignmentGuide,y:P._yAlignmentGuide}},jp.prototype.addAlignmentGuide=function(a,c,L){var B=this,j="x"===a?B._xAlignmentGuide:B._yAlignmentGuide,L=L?L:++B._alignmentGuideId,q={p:c,id:L};if(j.length){var Z=B._findClosestAlignmentGuide(q.p,j);Z.dis<0?j.splice(Z.index+1,0,q):j.splice(Z.index,0,q)}else j.push(q);return B._interactor._42(),L},jp.prototype.findClosest=function(q,A,j){var T=this,K=T._interactor,P=K.gv;j&&(q=_p.toWorldPosition(P,q));var S,s,O,$=1/0,L=1/0,e=q.x,w=q.y;if(T.gridEnabled){var o=T.gridBlockSize,V=T.makeMatrix(),Z=V.applyInverse(q);Z=V.apply({x:Math.round(Z.x/o)*o,y:Math.round(Z.y/o)*o}),$=Z.x-e,L=Z.y-w,O=!0}if(K.alignmentGuideEnabled&&(S=T._findClosestAlignmentGuide(e,T._xAlignmentGuide).dis,s=T._findClosestAlignmentGuide(w,T._yAlignmentGuide).dis,Math.abs(S)<Math.abs($)&&($=S,O=!0),Math.abs(s)<Math.abs(L)&&(L=s,O=!0)),O){O=!1;var B=P._zoom,v=K.getStyle("smartGuideSensitivity")/B,Q={};if(Math.abs($)<v&&"y"!==A&&(Q.x=j?$*B:$,O=!0),Math.abs(L)<v&&"x"!==A&&(Q.y=j?L*B:L,O=!0),O)return Q}},jp.prototype._findClosestAlignmentGuide=function(n,r){if(!r.length)return{dis:1/0};for(var K,S=0,y=r.length-1;y-S>1;)K=Math.floor((S+y)/2),r[K].p<n?S=K:y=K;var b=r[S].p-n,X=r[y].p-n;return Math.abs(b)<=Math.abs(X)?{line:r[S],dis:b,index:S}:{line:r[y],dis:X,index:y}},jp.prototype.removeAllAlignmentGuide=function(z){var Y=this;"y"!==z&&(Y._xAlignmentGuide=[]),"x"!==z&&(Y._yAlignmentGuide=[]),Y._interactor._42()},jp.prototype.removeAlignmentGuide=function(G){for(var V,g,D,m=this,c=m._xAlignmentGuide,Y=0;2>Y;Y++)for(c=0===Y?m._xAlignmentGuide:m._yAlignmentGuide,V=0,g=c.length;g>V;V++)if(D=c[V],D.id===G)return c.splice(V,1),m._interactor._42(),{axis:0===Y?"x":"y",position:D.p};return!1},jp.prototype.adjustAlignmentGuide=function(B,H){var Z=this,X=Z.removeAlignmentGuide(B);return X?(Z.addAlignmentGuide(X.axis,H,B),!0):!1};var Tk=_p.Guide.Rect=function(t){var B=this;B._interactor=t};Tk.prototype={},Tk.prototype.constructor=Tk,Tk.prototype.gatherRects=function(){var L,W,q,X,h=this,C=h._interactor.gv,u=[],w=[],Q={x:u,y:w},J={},K=C.getDataModel(),A=K.a("width"),o=K.a("height");A&&o&&(L=0,W=0,q=A,X=o,u.push({node:K,type:0,p:L},{node:K,type:1,p:L+q/2},{node:K,type:2,p:L+q}),w.push({node:K,type:0,p:W},{node:K,type:1,p:W+X/2},{node:K,type:2,p:W+X}),J[K._id||0]={x:L,y:W,width:q,height:X}),K.each(function(A){if(rd(A)&&!C.isSelected(A)&&C.isVisible(A)&&C.isValidGuideLineSource(A)){var V=!1;if(C.sm().getSelection().each(function(l){V||(A.isHostOn(l)?V=!0:A.isDescendantOf(l)&&(V=!0))}),!V){var f=A.getRect();L=f.x,W=f.y,q=f.width,X=f.height,u.push({node:A,type:0,p:L},{node:A,type:1,p:L+q/2},{node:A,type:2,p:L+q}),w.push({node:A,type:0,p:W},{node:A,type:1,p:W+X/2},{node:A,type:2,p:W+X}),J[A._id]=f}}}),u.sort(function(N,R){return N.p-R.p}),w.sort(function(D,M){return D.p-M.p}),h._grid=Q,h._87I=J},Tk.prototype.gatherLines=function(B,J,N){var b,c,n,k,Q,s,V,X,K,D,L,o,S=this,H=[S.findClosest({x:B.x,y:B.y},J),S.findClosest({x:B.x+B.w/2,y:B.y+B.h/2},J),S.findClosest({x:B.x+B.w,y:B.y+B.h},J)],x={},g=S._87I;N=N||255;var u,d;for(S._guideLine=[],b=0;2>b;b++)for(x={},0===b?(k="y",X=B.x,K=X+B.w):(k="x",X=B.y,K=X+B.h),c=0;3>c;c++)Q=H[c],Q&&isFinite(Q[k])&&(u=1<<3*b+c,N&u&&(s=Q[k+"Line"],V=s.node,d=V._id||0,x[d]||(x[d]=!0,o=g[d],"y"===k?(D=o.x,L=o.x+o.width):(D=o.y,L=o.y+o.height),n=s.p,S._guideLine.push({type:k,a:X,b:K,c:D,d:L,p:n,center:1===s.type}))))},Tk.prototype._binarySearchClosest=function(p,x){if(!x.length)return{dis:1/0};for(var H,O=0,W=x.length-1;W-O>1;)H=Math.floor((O+W)/2),x[H].p<p?O=H:W=H;var v=x[O].p-p,R=x[W].p-p;return Math.abs(v)<=Math.abs(R)?{line:x[O],dis:v}:{line:x[W],dis:R}},Tk.prototype.findClosest=function(N,w,j){var U=this,c=U._interactor,m=c.gv,B=U._grid;j&&(N=_p.toWorldPosition(m,N));var z,M=U._binarySearchClosest(N.x,B.x),b=U._binarySearchClosest(N.y,B.y),Y=M.dis,q=b.dis,W=m._zoom,C=c.getStyle("smartGuideSensitivity")/W,X={};return Math.abs(Y)<C&&"y"!==w&&(X.x=j?Y*W:Y,X.xLine=M.line,z=!0),Math.abs(q)<C&&"x"!==w&&(X.y=j?q*W:q,X.yLine=b.line,z=!0),z?X:void 0},Tk.prototype._42=function(){var u=this,G=u._guideLine;if(G&&!k.Default.isCtrlDown()){var M,q,y,B,W,U,v,p,Y,S,l,K,i,X,f,H,F,g=u._interactor,E=g.gv,_=g._context,c=E.tx(),e=E.ty(),j=E._zoom,N=g.getStyle("guideLineTextSpacing");for(M=0,q=G.length;q>M;M++)y=G[M],p=y.type,Y=y.p,S=y.a,l=y.b,K=y.c,i=y.d,X=Math.min(S,K),f=Math.max(l,i),"x"===p?(B=Y*j+c,W=X*j+e,U=B,v=f*j+e):(B=X*j+c,W=Y*j+e,U=f*j+c,v=W),_p.Icons.DrawIcon(g,_,_p.Icons.MoveLineGuide,{rect:[B,W,U,v],center:y.center}),i>=S&&l>=K||(X=S>i?i:l,f=S>i?S:K,F=f-X,"x"===p?(y.center2center||(B-=N,U=B),W=X*j+e,v=f*j+e,H=_p.Icons.MoveLineGuideDistanceV):"y"===p&&(y.center2center||(W-=N,v=W),B=X*j+c,U=f*j+c,H=_p.Icons.MoveLineGuideDistanceH),_p.Icons.DrawIcon(g,_,H,{x0:B,y0:W,x1:U,y1:v,dis:F}))}},Tk.prototype.clear=function(){this._guideLine=null};var ic=_p.Guide.Hover=function(F){var M=this;M._interactor=F};ic.prototype={},ic.prototype.constructor=ic,H.defineProperties(ic.prototype,{}),ic.prototype._42=function(){var c=this._interactor;if(c.getStyle("hoverGuideEnabled")&&!c.gvEditing){var B=c.hoverData,x=c.gv;if(!rd(B)||x.isSelected(B))return c.hoverData=null,void 0;var u=ed(x,B),n=_p.toScreenPosition(x,{x:u.x,y:u.y}),v=_p.toScreenPosition(x,{x:u.x+u.width,y:u.y+u.height});_p.Icons.DrawIcon(c,c._context,_p.Icons.HoverDataRect,{min:n,max:v,color:c.getStyle("hoverGuideColor")||c.getStyle("baseColor")})}},_p.DefaultStyleMap={baseColor:"rgb(51,153,255)",pointSize:[24,9],checkSize:7,rotateCheckSize:10,moveSensitivity:10,moveDummyVisible:32,moveDummyPosition:[0,0,-16,-16],moveDummyLineExtraShift:[-32,0],moveDummySensitivity:16,keepAspectRatio:!1,rotateRound:Math.PI/2,shiftRotateRound:Math.PI/12,rotateSensitivity:Math.PI/60,rotateAsClock:!1,shiftLineRotateRound:Math.PI/4,anchorMovable:!0,anchorVisible:!0,anchorHideThreshold:25,anchorOutsideVisibleThreshold:.25,anchorRound:.25,anchorSensitivity:.02,smartGuideSensitivity:8,curveIntersectSize:5,curvePointIntersectSize:8,edgeHostDetectPerFrame:!0,edgeHostEdgeMaxDistance:12,edgeHostEdgeHighlighColor:"#5d5d5d",edgeHostPointHighlighColor:"red",edgeHostHighlighPeriod:1500,guideLineTextSpacing:0,hoverGuideEnabled:!1,hoverGuideColor:null,gridBlockSize:40,gridThickLinesEvery:10,gridThickColor:"#5d5d5d",gridLightColor:"#d0d0d0",gridZoomThreshold:.25,gridAlignmentGuideColor:"#ff0000",gridAngle:Math.PI/2,gridRotation:0,groupRotateModeDefault:"block",groupRotateModeKey:["ctrlKey","metaKey"],rotateCursorSize:32,rotateCursorRound:45,tipTextColor:"#ffffff",tipBackground:"#333333",curveHighlightColor:"#30599e",rectPointBackground:"white",rectPointBorderColor:"#666666",rectPointShadowColor:"rgba(0,0,0,0.35)",shapeCtrlPointBackground:"white",shapeCtrlPointBorderColor:null,shapeCtrlPointHighlightBorder:null,shapeHighlighPointBackground:"#30599e",curveElevationVisible:!0,curveElevationIntersectSize:8,curveElevationGuideShift:[20,0],connectGuideVisible:!0,connectGuideShift:[1,.25,8,0],connectGuideIntersectSize:8,connectGuideGarbageIntersectsize:25,connectGuideGarbageShift:[1,1,-48,-48]};var pn=_p.Icons={},Zm=1e4,Vb=null,Kf=_p.DefaultStyleMap.baseColor,fo="rgb(183,232,135)",Ie="rgb(255,204,153)",Ko=6;k.Default.setImage("Icons.RectPoint",{width:Ko,height:Ko,comps:[{type:"rect",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return Kf}},rect:[0,0,Ko,Ko]}]}),pn.GroupSubEntityRect={comps:[{type:"shape",points:{func:function(){var Y=pn.GroupSubEntityRect.data;if(!Y)return[];var u=Y.min,p=Y.max;return[u.x,u.y,u.x,p.y,p.x,p.y,p.x,u.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return pn.GroupSubEntityRect.data.isKeyOb?Kf:Kf}}}]};var Nc=4;pn.HoverDataRect={comps:[{type:"shape",points:{func:function(){var T=pn.HoverDataRect.data;if(!T)return[];var O=T.min,x=T.max,P=Nc;return O.x-=P,O.y-=P,x.x+=P,x.y+=P,[O.x,O.y,O.x,x.y,x.x,x.y,x.x,O.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return pn.HoverDataRect.data.color}},borderCap:"round",borderPattern:[1,4]}]},pn.Line={comps:[{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[pn.Line.data.P1.x,pn.Line.data.P1.y],Ko,Ko]}}},{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[pn.Line.data.P2.x,pn.Line.data.P2.y],Ko,Ko]}}}]},pn.NodeHoverGuide={comps:[{type:"shape",points:{func:function(){return pn.NodeHoverGuide.data}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:"#3399FF"}]},pn.Rect={comps:[{type:"shape",points:{func:function(){var g=pn.Rect.data;if(!g)return[];var k=g.LT,F=g.LB,_=g.RB,z=g.RT;return[k.x,k.y,F.x,F.y,_.x,_.y,z.x,z.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Kf}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return pn.Rect.data.rotation}},rect:{func:function(){return[[pn.Rect.data.LT.x,pn.Rect.data.LT.y],Ko,Ko]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return pn.Rect.data.rotation}},rect:{func:function(){return[[pn.Rect.data.LB.x,pn.Rect.data.LB.y],Ko,Ko]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return pn.Rect.data.rotation}},rect:{func:function(){return[[pn.Rect.data.RB.x,pn.Rect.data.RB.y],Ko,Ko]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return pn.Rect.data.rotation}},rect:{func:function(){return[[pn.Rect.data.RT.x,pn.Rect.data.RT.y],Ko,Ko]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return pn.Rect.data.rotation}},visible:{func:function(){return pn.Rect.data.L?!0:!1}},rect:{func:function(){return[[pn.Rect.data.L.x,pn.Rect.data.L.y],Ko,Ko]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return pn.Rect.data.rotation}},visible:{func:function(){return pn.Rect.data.R?!0:!1}},rect:{func:function(){return[[pn.Rect.data.R.x,pn.Rect.data.R.y],Ko,Ko]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return pn.Rect.data.rotation}},visible:{func:function(){return pn.Rect.data.T?!0:!1}},rect:{func:function(){return[[pn.Rect.data.T.x,pn.Rect.data.T.y],Ko,Ko]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return pn.Rect.data.rotation}},visible:{func:function(){return pn.Rect.data.B?!0:!1}},rect:{func:function(){return[[pn.Rect.data.B.x,pn.Rect.data.B.y],Ko,Ko]}}}]};var Rh=16;k.Default.setImage("Icons.Anchor",{width:12,height:12,comps:[{type:"shape",borderWidth:1,borderColor:{func:function(){return Kf}},borderCap:"round",shadowColor:"#1ABC9C",points:[.50928,6,11.49072,6,6,6,6,.50928,6,11.49072]},{type:"circle",borderWidth:1,borderColor:{func:function(){return Kf}},shadowColor:"#1ABC9C",rect:[2.84391,2.84391,6.53697,6.53697]}]}),pn.Anchor={comps:[{type:"image",name:"Icons.Anchor",rect:{func:function(){return[[pn.Anchor.data.POS.x,pn.Anchor.data.POS.y],Rh,Rh]}}}]},pn.TipShiftX=12,pn.TipShiftY=12;var _o=[8,28];pn.TipHelper={comps:[{type:"roundRect",rect:{func:function(){return[pn.TipHelper.data.helperPos.x,pn.TipHelper.data.helperPos.y,_o[0]*pn.TipHelper.data.size,_o[1]]}},background:{func:function(){return Vb.getStyle("tipBackground")}},opacity:.6},{type:"text",text:{func:function(){return pn.TipHelper.data.text}},rect:{func:function(){return[pn.TipHelper.data.helperPos.x,pn.TipHelper.data.helperPos.y,_o[0]*pn.TipHelper.data.size,_o[1]]}},color:{func:function(){return Vb.getStyle("tipTextColor")}},font:"bold 12px Arial",align:"center"}]};var Ug=7;pn.ShapePoint={comps:[{type:"circle",visible:{func:function(){return!!pn.ShapePoint.data.dynamicVisible}},rect:{func:function(){var u=pn.ShapePoint.data.point,W=pn.ShapePoint.data.size||Ug;return[u,W+10,W+10]}},background:{func:function(){var P=Date.now(),O=pn.ShapePoint.data.dynamicPeriod||1500,y=Math.sin(P%O/O*Math.PI);return"rgba(27,124,22,"+.5*y+")"}},borderWidth:0},{type:"circle",rect:{func:function(){var e=pn.ShapePoint.data.point,N=pn.ShapePoint.data.size||Ug;return[e,N,N]}},background:{func:function(){var t=pn.ShapePoint.data.isEnd;return t?"rgba(27,124,222,0.7)":"#ffffff"}},borderWidth:1,borderColor:{func:function(){return pn.ShapePoint.data.color||Kf}}},{type:"rect",visible:{func:function(){return!!pn.ShapePoint.data.dynamicVisible}},background:"red",borderWidth:0,rotation:Math.PI/4,borderColor:{func:function(){return Kf}},rect:{func:function(){var O=5;return[pn.ShapePoint.data.point,O,O]}}}]},pn.ShapeBgCurve={comps:[{type:"shape",visible:{func:function(){return!!pn.ShapeBgCurve.data.dynamicVisible}},points:{func:function(){return pn.ShapeBgCurve.data.P}},segments:{func:function(){return pn.ShapeBgCurve.data.S}},background:null,borderWidth:6,borderColor:{func:function(){var L=Date.now(),q=pn.ShapeBgCurve.data.dynamicPeriod||1500,K=Math.sin(L%q/q*Math.PI);return"rgba(27,124,22,"+.3*K+")"}}},{type:"shape",points:{func:function(){return pn.ShapeBgCurve.data.P}},segments:{func:function(){return pn.ShapeBgCurve.data.S}},background:null,borderWidth:1,borderColor:{func:function(){return pn.ShapeBgCurve.data.color||Kf}}}]};var Ud=8;pn.ShapeHighlighPoint={comps:[{type:"circle",rect:{func:function(){var M=pn.ShapeHighlighPoint.data;return[[M.x,M.y],Ud,Ud]}},background:{func:function(){return Vb.getStyle("shapeHighlighPointBackground")}},borderWidth:0}]};var Rf=10;pn.ShapeHighlighRealPoint={comps:[{type:"circle",rect:{func:function(){var k=pn.ShapeHighlighRealPoint.data;return[[k.x,k.y],Rf,Rf]}},background:"#ffffff",borderWidth:2,borderColor:{func:function(){return Kf}}}]};var Am=8;pn.ShapeHighlighCtrlPoint={comps:[{type:"shape",points:{func:function(){var p=pn.ShapeHighlighCtrlPoint.data,s=p.x,y=p.y,B=Am/2;return[s-B,y-B,s-B,y+B,s+B,y+B,s+B,y-B]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Vb.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return Vb.getStyle("shapeCtrlPointBorderColor")||Kf}}}]};var Ac=3;pn.ShapeHighlightCurve={comps:[{type:"shape",points:{func:function(){return pn.ShapeHighlightCurve.data}},segments:[1,4],background:null,borderWidth:Ac,borderColor:{func:function(){return Vb.getStyle("curveHighlightColor")}}}]},pn.ShapeGuideLine={comps:[{type:"shape",points:{func:function(){return pn.ShapeGuideLine.data}},background:null,borderWidth:1,borderColor:"rgb(255,204,153)"}]},pn.MoveLineGuide={comps:[{type:"shape",points:{func:function(){return pn.MoveLineGuide.data.rect}},background:null,borderWidth:1,borderColor:{func:function(){return pn.MoveLineGuide.data.center?fo:Ie}}}]};var Rg=5;pn.MoveLineGuideDistanceH={comps:[{type:"shape",points:{func:function(){var Y=pn.MoveLineGuideDistanceH.data,n=Y.x0,i=Y.y0;return[n,i-Rg,n,i+Rg]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Ie},{type:"shape",points:{func:function(){var J=pn.MoveLineGuideDistanceH.data,q=J.x1,G=J.y1;return[q,G-Rg,q,G+Rg]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Ie},{type:"text",text:{func:function(){return Math.round(pn.MoveLineGuideDistanceH.data.dis)}},rect:{func:function(){var f=pn.MoveLineGuideDistanceH.data;return[[(f.x0+f.x1)/2,f.y0-10],20,20]}},color:Ie,font:"12px Arial",align:"center"}]},pn.MoveLineGuideDistanceV={comps:[{type:"shape",points:{func:function(){var w=pn.MoveLineGuideDistanceV.data,G=w.x0,s=w.y0;return[G-Rg,s,G+Rg,s]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Ie},{type:"shape",points:{func:function(){var a=pn.MoveLineGuideDistanceV.data,C=a.x1,f=a.y1;return[C-Rg,f,C+Rg,f]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Ie},{type:"text",text:{func:function(){return Math.round(pn.MoveLineGuideDistanceV.data.dis)}},rect:{func:function(){var r=pn.MoveLineGuideDistanceV.data;return[[r.x0-10,(r.y0+r.y1)/2],20,20]}},color:Ie,font:"12px Arial",align:"center"}]},k.Default.setImage("Icons.EdgeElevationGuideImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,255,255)",borderWidth:1,borderColor:"rgb(138,138,138)",rect:[.5,.5,15,15]},{type:"shape",borderWidth:2,borderColor:"rgb(44,44,44)",borderCap:"round",points:[4,8,8,4,12,8,8,4,8,13],segments:[1,2,2,1,2]}]}),pn.EdgeElevationGuide={comps:[{type:"image",name:"Icons.EdgeElevationGuideImage",rect:{func:function(){var $=pn.EdgeElevationGuide.data,l=$.x,_=$.y,T=Vb.getStyle("curveElevationIntersectSize"),R=Vb.getStyle("curveElevationGuideShift");return l+=R[0],_+=R[1],[l-T,_-T,2*T,2*T]}}}]},k.Default.setImage("Icons.ConnectGuideBgImage",{width:12,height:12,comps:[{type:"shape",background:"#3399ff",fillRule:"evenodd",shadowColor:"#1ABC9C",rotation:3.14159,points:[6.00001,11.99999,6.00001,11.99999,2.6863,11.99999,1e-5,9.30695,1e-5,5.99999,1e-5,5.99999,1e-5,2.68628,2.69305,-1e-5,6.00001,-1e-5,12.00001,-1e-5,11.99998,12.00001,6.00001,11.99999],segments:[1,2,4,2,4,2,2,2]}]}),k.Default.setImage("Icons.ConnectGuideHeaderImage",{width:12,height:12,comps:[{type:"oval",background:"#3399FF",borderColor:"#3399FF",shadowColor:"#1ABC9C",rect:[0,0,12,12]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[4.76,2.56,8.2,5.98,4.76,9.44]}]}),pn.ConnectGuide={comps:[{type:"image",name:"Icons.ConnectGuideBgImage",rotation:{func:function(){return pn.ConnectGuide.data.rotation}},rect:{func:function(){var n=pn.ConnectGuide.data.connect;n.x,n.y;var v=Vb.getStyle("connectGuideIntersectSize");return[[n.x,n.y],2*v,2*v]}}},{type:"image",name:"Icons.ConnectGuideHeaderImage",rect:{func:function(){var m=pn.ConnectGuide.data.cursorPos||pn.ConnectGuide.data.connect,T=Vb.getStyle("connectGuideIntersectSize");return[[m.x,m.y],2*T-2,2*T-2]}}},{type:"shape",background:null,borderColor:"#3399ff",borderWidth:2,segments:[1,4],points:{func:function(){var k=pn.ConnectGuide.data.connect,Q=pn.ConnectGuide.data.cursorPos||k;return[k.x,k.y,k.x+.5*(Q.x-k.x),k.y,Q.x+.5*(k.x-Q.x),Q.y,Q.x,Q.y]}}}]},k.Default.setImage("Icons.ConnectGuideGarbageImage",{width:48,height:48,comps:[{type:"oval",background:"rgba(0,0,0,0.1)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,48,48]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[19.84721,19.69091,19.84721,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[24.10371,19.69091,24.10371,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[28.15279,19.69091,28.15279,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[11.23055,15.22377,36.76945,15.189,19.12302,15.17121,20.94722,11.5228,26.41985,11.5228,28.24406,15.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[15.48702,15.22377,17.02595,21.25344]}]}),k.Default.setImage("Icons.ConnectGuideDeletingImage",{width:56,height:56,comps:[{type:"oval",background:"rgba(232,0,0,0.75)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,56,56]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[22.67939,27.69091,22.67939,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[26.93588,27.69091,26.93588,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[30.98497,27.69091,30.98497,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",anchorX:0,anchorY:1,rotation:5.65062,points:[14.06272,23.22377,39.60163,23.189,21.9552,23.17121,23.7794,19.5228,29.25203,19.5228,31.07623,23.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[18.3192,23.22377,17.02595,21.25344]}]}),pn.ConnectGuideGarbage={comps:[{type:"image",name:{func:function(){var s=pn.ConnectGuideGarbage.data.hover;return s?"Icons.ConnectGuideDeletingImage":"Icons.ConnectGuideGarbageImage"}},rect:{func:function(){var B=pn.ConnectGuideGarbage.data,z=Vb.getStyle("connectGuideGarbageIntersectsize");return B.hover&&(z+=5),[[B.x,B.y],2*z,2*z]}}}]};var Wf=6;pn.ShapeActivingCtrl={comps:[{type:"shape",visible:{func:function(){return pn.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var r=pn.ShapeActivingCtrl.data;return[r.point.x,r.point.y,r.c1.x,r.c1.y]
}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return Kf}}},{type:"shape",visible:{func:function(){return pn.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var L=pn.ShapeActivingCtrl.data;return[L.point.x,L.point.y,L.c2.x,L.c2.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return Kf}}},{type:"shape",visible:{func:function(){return pn.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var R=pn.ShapeActivingCtrl.data.c1,t=R.x,A=R.y,B=Wf/2;return"c1"===pn.ShapeActivingCtrl.data.hl&&(B+=.5),[t-B,A-B,t-B,A+B,t+B,A+B,t+B,A-B]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Vb.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c1"===pn.ShapeActivingCtrl.data.hl?Vb.getStyle("shapeCtrlPointHighlightBorder")||Kf:Vb.getStyle("shapeCtrlPointBorderColor")||Kf}}},{type:"shape",visible:{func:function(){return pn.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var G=pn.ShapeActivingCtrl.data.c2,C=G.x,e=G.y,P=Wf/2;return"c2"===pn.ShapeActivingCtrl.data.hl&&(P+=.5),[C-P,e-P,C-P,e+P,C+P,e+P,C+P,e-P]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Vb.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c2"===pn.ShapeActivingCtrl.data.hl?Vb.getStyle("shapeCtrlPointHighlightBorder")||Kf:Vb.getStyle("shapeCtrlPointBorderColor")||Kf}}}]},pn.RoundPoint={comps:[{type:"circle",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return Kf}},rect:{func:function(){return[[pn.RoundPoint.data.x,pn.RoundPoint.data.y],Ko,Ko]}}}]},pn.AttachPoint={comps:[{type:"rect",background:{func:function(){return pn.AttachPoint.data.isAttach?"rgb(51,153,255)":"rgb(247,247,247)"}},borderWidth:1,rotation:Math.PI/4,borderColor:{func:function(){return Kf}},rect:{func:function(){var b=pn.AttachPoint.data.isAttach?Ko+4:Ko;return[[pn.AttachPoint.data.x,pn.AttachPoint.data.y],b,b]}}}]},pn.SimpleRect={comps:[{type:"rect",background:null,borderWidth:{func:function(){return pn.SimpleRect.data.borderWidth||1}},borderColor:{func:function(){return pn.SimpleRect.data.color||Kf}},rect:{func:function(){var h=pn.SimpleRect.data;return[h.x,h.y,h.width,h.height]}}}]},k.Default.setImage("Icons.MoveDummyImage",{width:32,height:32,boundExtend:12,attachStyle:"close",comps:[{type:"oval",background:"rgb(255,255,255)",borderColor:"#979797",shadow:!0,shadowColor:"rgba(0,0,0,0.25)",shadowOffsetX:0,rect:[0,0,32,32]},{type:"shape",background:"rgb(51,153,255)",pixelPerfect:!0,points:[8.65079,11.90713,9.05502,11.46921,9.70629,11.46921,10.11052,11.90713,10.51476,12.28891,10.51476,12.92895,10.11052,13.34441,8.49359,14.97258,12.2889,14.97258,12.85034,14.97258,13.29949,15.42172,13.29949,15.99439,13.29949,16.57828,12.85034,17.0162,12.2889,17.0162,8.49359,17.0162,10.11052,18.6556,10.51476,19.0486,10.51476,19.7111,10.11052,20.09288,9.70629,20.50834,9.05502,20.50834,8.65079,20.09288,5.32709,16.76917,5.28217,16.71303,4.87794,16.32002,4.87794,15.67998,5.28217,15.26452,8.65079,11.90713,8.65079,11.90713,8.65079,11.90713,13.3444,10.09931,13.3444,10.09931,12.94017,10.50354,12.2889,10.50354,11.88467,10.09931,11.48043,9.69507,11.48043,9.0438,11.88467,8.63957,15.27574,5.25973,15.66874,4.86672,16.32001,4.86672,16.73547,5.25973,16.76917,5.31586,20.10409,8.63957,20.50832,9.0438,20.50832,9.68385,20.10409,10.09931,19.69986,10.49231,19.07105,10.50354,18.64436,10.09931,17.02742,8.45991,17.02742,12.26646,17.02742,12.83912,16.55581,13.31072,15.99438,13.31072,15.43295,13.31072,14.98379,12.83912,14.98379,12.26646,14.96134,8.45991,13.3444,10.09931,13.3444,10.09931,13.3444,10.09931,21.90069,13.33318,21.90069,13.33318,21.49646,12.91771,21.49646,12.27768,21.90069,11.89591,22.31615,11.45798,22.94497,11.45798,23.36043,11.89591,26.72904,15.2533,27.12205,15.66876,27.12205,16.3088,26.72904,16.7018,26.6729,16.75794,23.36043,20.08165,22.94497,20.49711,22.31615,20.49711,21.90069,20.08165,21.49646,19.69987,21.49646,19.03737,21.90069,18.64437,23.51763,17.00498,19.72231,17.00498,19.14965,17.00498,18.71173,16.56705,18.71173,15.98316,18.71173,15.41049,19.14965,14.96135,19.72231,14.96135,23.51763,14.96135,21.90069,13.33318,21.90069,13.33318,21.90069,13.33318,11.88467,23.32675,11.88467,23.32675,11.48043,22.94498,11.48043,22.27125,11.88467,21.88948,12.2889,21.48523,12.94017,21.48523,13.3444,21.88948,14.96134,23.52887,14.98379,19.7111,14.98379,19.14966,15.43295,18.67805,15.99438,18.67805,16.55581,18.67805,17.02742,19.14966,17.02742,19.7111,17.02742,23.52887,18.64436,21.88948,19.07105,21.48523,19.69986,21.48523,20.10409,21.88948,20.50832,22.27125,20.50832,22.94498,20.10409,23.32675,16.76917,26.65045,16.73547,26.72905,16.32001,27.13329,15.66874,27.13329,15.27574,26.72905,11.88467,23.32675,11.88467,23.32675,11.88467,23.32675],segments:[1,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2]}]}),pn.MoveDummy={comps:[{type:"image",name:"Icons.MoveDummyImage",rect:{func:function(){var I=pn.MoveDummy.data;return[[I.pos.x,I.pos.y],2*I.size,2*I.size]}}}]},_p.Icons.DrawIcon=function(o,g,G,x){G.width=G.height=Zm,G.data=x,Vb=o,k.Default.drawImage(g,G,0,0,Zm,Zm)},_p.Icons.MapPoints=function(Q,H){for(var k=0,O=Q.length;O>k;k++)Q[k]/=H},_p.roundTo=function(L,g,_){var F=Math.abs(L%g);return _>F||_>g-F?g*Math.round(L/g):L},_p.toFixed=function(I){return Math.round(100*I)/100},_p.getDataMatrix=function(T){if(T instanceof k.Shape){var q=new k.Math.Matrix2d,t=T.getPosition();return q.translate(-t.x,-t.y).scale(T.getScale().x,T.getScale().y).rotate(T.getRotation()).translate(t.x,t.y),q}return T.getMatrix?T.getMatrix():new k.Math.Matrix2d};var qf=_p.Math.Curve=function(){this._curves=[]};qf.prototype={},qf.prototype.constructor=qf,qf.prototype.createFromHtShape=function($,e,T){e instanceof k.List&&(e=e.toArray());var s,B,K,a,H,j,D,n=this,d=null,v=null,y=0,R=_p.Math.Vector2,W=_p.Math.CubicBezier,Z=function(L){return new R($[L],$[L+1],T?T[L/2]:C)};for(B=0,K=e.length;K>B;B++){switch(a=e[B],H=null,a){case 1:v=Z(y),d=v,y+=2;break;case 2:s=Z(y),y+=2,H=new W(v,v.clone(),s.clone(),s),v=s;break;case 3:j=Z(y),s=Z(y+2),y+=4,H=new W(v,j.clone().sub(v).multiplyScalar(2/3).add(v),j.clone().sub(s).multiplyScalar(2/3).add(s),s),v=s;break;case 4:j=Z(y),D=Z(y+2),s=Z(y+4),y+=6,H=new W(v,j,D,s),v=s;break;case 5:if(!d)break;H=new W(v,v.clone(),d.clone(),d),v=null,d=null}H&&(H._index=n._curves.length,n._curves.push(H))}},qf.prototype.checkPoint=function(X,K){var x,h,L,Z,p,J=this,v=J._curves;for(x=0,h=v.length;h>x;x++)if(Z=v[x],p=Z.intersectRect(X,K,K),p.length)return L=0,p.forEach(function(o){L+=o.t}),L/=p.length,X=Z.getPointAt(L),X.t=L,{bezier:Z,intersection:X}},qf.prototype.insertKnot=function(l,k){var C=l.insertKnot(k),q=this,r=q._curves;r.splice(l._index,1,C[0],C[1])},qf.prototype._isCloseEnough=function(S,r){return Math.abs(S.x-r.x)<1e-6&&Math.abs(S.y-r.y)<1e-6},qf.prototype._isSamePoint=function(L,B){return L===B},qf.prototype.moveRealPoint=function(G,z){var O=this,d=O._curves,c=z.clone().sub(G);d.forEach(function(T){var H=T._p1;T._p2,T._p3;var A=T._p4;O._isSamePoint(H,G)&&(T._p2.add(c),T._p1=z),O._isSamePoint(A,G)&&(T._p3.add(c),T._p4=z)})},qf.prototype.moveCtrlDueToRealPointMovement=function(x,F){var e=this,R=e._curves,T=function(_){_.add(F),_.e&&F.e&&(_.e+=F.e)};R.forEach(function(D){var g=D._p1;D._p2,D._p3;var S=D._p4;e._isSamePoint(g,x)&&T(D._p2),e._isSamePoint(S,x)&&T(D._p3)})},qf.prototype.moveCtrlPoint=function(z,R,f){var N=z[f];if(N){N.e!==C&&(R.e=N.e);var V=this,I=V._curves;R.clone().sub(N),I.forEach(function($){var D;"c2"===f?D="_p2":"c1"===f&&(D="_p3"),V._isSamePoint($[D],N)&&($[D]=R)}),z[f]=R}},qf.prototype.deleteRealPoint=function(z,e){var h,I,m,d,x,_,J,Y=this,v=Y._curves,i={},$=[],X=_p.Math.CubicBezier;for(I=0,m=v.length;m>I;I++)h=v[I],d=h._p1,x=h._p2,_=h._p3,J=h._p4,(i[I]||!Y._isSamePoint(d,z))&&(Y._isSamePoint(J,z)?m>I+1&&Y._isSamePoint(v[I+1]._p1,z)&&(e||$.push(new X(d,x,v[I+1]._p3,v[I+1]._p4))):$.push(h));Y._curves=$},qf.prototype.findPairs=function(a,k){var j,M,i,f,D,c,n,t,E=this,T=E._curves,U={},p=[];for(M=0,i=T.length;i>M;M++)j=T[M],f=j._p1,D=j._p2,c=j._p3,n=j._p4,!U[M]&&E._isSamePoint(f,a)&&(k?p.push({point:f,r2:n}):p.push({point:f,c2:D})),E._isSamePoint(n,a)&&(t=k?{point:n,r1:f}:{point:n,c1:c},i>M+1&&E._isSamePoint(T[M+1]._p1,a)&&(k?t.r2=T[M+1]._p4:t.c2=T[M+1]._p2,U[M+1]=!0),p.push(t));return p},qf.prototype.toHtShape=function(){var Y=this,l=Y._curves,O=[],W=[],F={x:1/0,y:1/0};return l.forEach(function(y){var B=y._p1,t=y._p2,l=y._p3,_=y._p4;return Y._isCloseEnough(B,F)||(O.push(1),W.push(B.clone())),F=_,Y._isCloseEnough(B,t)&&Y._isCloseEnough(l,_)?(O.push(2),W.push(_.clone()),void 0):(O.push(4),W.push(t.clone(),l.clone(),_.clone()),void 0)}),{segments:O,points:W}};var qj=_p.Math.CubicBezier=function(b,s,n,v){var T=this;T._id=_p.Math.CubicBezier._globalId++,T._p1=b,T._p2=s,T._p3=n,T._p4=v};qj._globalId=1,qj.prototype={},qj.prototype.constructor=qj,qj.prototype.toString=function(){return this._id},qj.prototype.intersectRect=function(g,k,h){var B=k/2,R=h/2,C=g.x,w=g.y,S=_p.Math.Vector2,v=new S(-B+C,-R+w),s=new S(B+C,R+w),W=new S(s.x,v.y),H=new S(v.x,s.y),o=this,i=o.intersectLine(v,W),t=o.intersectLine(W,s),a=o.intersectLine(s,H),F=o.intersectLine(H,v),U=i.concat(t).concat(a).concat(F);return U},qj.prototype.intersectLine=function(z,b){var t,V,G,W,g,l,s,h,Q,T,u,E,q,c=this,N=z.clone().min(b),$=z.clone().max(b);W=c._p1,g=c._p2,l=c._p3,s=c._p4,t=W.clone().multiplyScalar(-1),V=g.clone().multiplyScalar(3),G=l.clone().multiplyScalar(-3),u=t.add(V).add(G).add(s),t=W.clone().multiplyScalar(3),V=g.clone().multiplyScalar(-6),G=l.clone().multiplyScalar(3),T=t.add(V).add(G),t=W.clone().multiplyScalar(-3),V=g.clone().multiplyScalar(3),Q=t.add(V),h=W.clone(),q=new _p.Math.Vector2(z.y-b.y,b.x-z.x),E=z.x*b.y-b.x*z.y;for(var o=c.getRoots(q.dot(u),q.dot(T),q.dot(Q),q.dot(h)+E),y=new Array,x=0,r=o.length;r>x;x++){var v=o[x];if(!(0>v||v>1)){var S=W.clone().lerp(g,v),j=g.clone().lerp(l,v),Y=l.clone().lerp(s,v),d=S.lerp(j,v),B=j.lerp(Y,v),n=d.lerp(B,v);n.t=v,z.x==b.x?N.y<=n.y&&n.y<=$.y&&y.push(n):z.y==b.y?N.x<=n.x&&n.x<=$.x&&y.push(n):n.x>=N.x&&n.y>=N.y&&n.x<=$.x&&n.y<=$.y&&y.push(n)}}return y},qj.prototype.solveTForPoint=function(H){var q,A,G,d,v=this;q=v._p1.x-H.x,A=v._p2.x-H.x,G=v._p3.x-H.x,d=v._p4.x-H.x;for(var s=v.getRoots(d-3*G+3*A-q,3*G-6*A+3*q,3*A-3*q,q),Q=C,r=1/0,Z=0,$=s.length;$>Z;Z++){var D=s[Z];if(!(0>D||D>1)){var w=v._p1.clone().lerp(v._p2,D),z=v._p2.clone().lerp(v._p3,D),u=v._p3.clone().lerp(v._p4,D),c=w.lerp(z,D),W=z.lerp(u,D),p=c.lerp(W,D);p.t=D;var m=Math.abs(p.y-H.y);r>m&&(r=m,Q=p)}}return Q},qj.prototype.getPointAt=function(j){var x=this,z=x._p1,U=x._p2,l=x._p3,h=x._p4,V=z.clone().lerp(U,j),w=U.clone().lerp(l,j),$=l.clone().lerp(h,j),E=V.lerp(w,j),v=w.lerp($,j);return E.lerp(v,j)},qj.prototype.getRoots=function(U,C,Z,O){var l,h,m,s,$,R=new Array;if(Math.abs(U)<1e-6){var l=C,h=Z/l,m=O/l,s=h*h-4*m;if(s>0){var $=Math.sqrt(s);R.push(.5*(-h+$)),R.push(.5*(-h-$))}else 0==s&&R.push(.5*-h)}C/=U,Z/=U,O/=U,l=(3*Z-C*C)/3,h=(2*C*C*C-9*Z*C+27*O)/27;var J=C/3,S=h*h/4+l*l*l/27,u=h/2;if(Math.abs(S)<=1e-6&&(S=0),S>0){var d,Y,$=Math.sqrt(S);d=-u+$,Y=d>=0?Math.pow(d,1/3):-Math.pow(-d,1/3),d=-u-$,d>=0?Y+=Math.pow(d,1/3):Y-=Math.pow(-d,1/3),R.push(Y-J)}else if(0>S){var T=Math.sqrt(-l/3),_=Math.atan2(Math.sqrt(-S),-u)/3,x=Math.cos(_),k=Math.sin(_),X=Math.sqrt(3);R.push(2*T*x-J),R.push(-T*(x+X*k)-J),R.push(-T*(x-X*k)-J)}else{var d;d=u>=0?-Math.pow(u,1/3):Math.pow(-u,1/3),R.push(2*d-J),R.push(-d-J)}return R},qj.prototype._70I=function(){var G=this;return G._p1.distanceToSquared(G._p2)<1e-10&&G._p3.distanceToSquared(G._p4)<1e-10},qj.prototype.insertKnot=function(g){var W=this,G=W._p1,I=W._p2,P=W._p3,F=W._p4,p=G.clone().lerp(I,g),H=I.clone().lerp(P,g),D=P.clone().lerp(F,g),U=p.clone().lerp(H,g),T=H.clone().lerp(D,g),X=U.clone().lerp(T,g);return W._70I()?(G.clone().lerp(F,g),[new _p.Math.CubicBezier(G,G.clone(),X.clone(),X),new _p.Math.CubicBezier(X,X.clone(),F.clone(),F)]):[new _p.Math.CubicBezier(G,p,U,X),new _p.Math.CubicBezier(X,T,D,F)]};var Sq=k.Default.getInternal().ui().EdgeUI,vr={_47O:function(c){var V=this,G=vr.getBackups()._47O;_p.inEdit(V.gv)||G.call(V,c)}};_p.Inject.registAsModule(vr,Sq);var Oh=k.Default.getInternal().ui().NodeUI,ml={_47O:function(i){var j=this,p=ml.getBackups()._47O;_p.inEdit(j.gv)||p.call(j,i)},getSelectWidth:function(){var P=this,B=P.gv,u=P._data;if(B.isEditable(u)&&_p.inEdit(B))return 0;var c=ml.getBackup("getSelectWidth");return c.call(P)}};_p.Inject.registAsModule(ml,Oh);var ng=k.graph.GraphView,eb={_editPointSize:function(){var h=k.Default.isTouchable,b=_p.getStyle("pointSize");return b[h?0:1]}(),isPointEditable:function(e){var l=this;if(_p.inEdit(l))return l._pointEditableFunc?l._pointEditableFunc(e):!0;var _=eb.getBackup("isPointEditable");_.call(l,e)},isEditable:function(j){var Z,R=this,O=eb.getBackup("isEditable");if(Z=j instanceof _p.Group?!0:O.call(R,j),!_p.inEdit(R))return Z;if(!(j instanceof k.Edge))return Z;if(!j.s("2d.editable"))return!1;var m=R.getEditableFunc();return m?m(j):!0},_42:function($,B){var C=this,n=eb.getBackups()._42;if(n.call(C,$,B),_p.inEdit(C)){var e=C.getEditInteractor();e.drawImpl()}}};_p.Inject.registAsModule(eb,ng);var dr=k.Default.getInternal().ui().ShapeUI,Ce={_47O:function(T){var n=this,O=Ce.getBackups()._47O;_p.inEdit(n.gv)||O.call(n,T)}};_p.Inject.registAsModule(Ce,dr);var gm=k.graph.DefaultInteractor,_j={handle_mousewheel:function(O){var i=this,K=_j.getBackup("handle_mousewheel");_p.inEdit(i.gv)||K.call(i,O)}};_p.Inject.registAsModule(_j,gm);var kq=k.graph.MoveInteractor,rp={_calcShift:function(O,X){var g=this,k=rp.getBackup("_calcShift"),e=g.gv;if(!_p.inEdit(e))return k.call(g,O,X);var l=e.getEditInteractor(),D=l.getSubModule("Move").calcShift(O,X,g);return D||k.call(g,O,X)},clear:function(a){var t=this,J=rp.getBackup("clear");J.call(t,a);var e=t.gv;if(_p.inEdit(e)){var m=e.getEditInteractor();m.getSubModule("Move").clear(a)}}};_p.Inject.registAsModule(rp,kq);var Tk=_p.Rect=function($){this.catalog="Rect",this._interactor=$};Tk.prototype={},Tk.prototype.constructor=Tk,Tk.prototype.gatherInfo=function(u,z){var M=this;if(1===z.length){var d=z[0];return d instanceof k.Shape&&d._70I()?M.gatherLine(u,d):Rl(d,u)?!1:M.gatherSingleTarget(u,d)}return z.length>1?M.gatherMultiTargets(u,z):!1},Tk.prototype.gatherSingleTarget=function(w,S){if(S.getCorners){var t,T=this,K=T.info;T.target=S,t=T.screenInfo={};var Y=S.getCorners();K.LT=new _p.Math.Vector2(Y[0]),K.LB=new _p.Math.Vector2(Y[1]),K.RB=new _p.Math.Vector2(Y[2]),K.RT=new _p.Math.Vector2(Y[3]),K.T=K.LT.clone().add(K.RT).divideScalar(2),K.B=K.LB.clone().add(K.RB).divideScalar(2),K.L=K.LT.clone().add(K.LB).divideScalar(2),K.R=K.RT.clone().add(K.RB).divideScalar(2);for(var y in K)t[y]=_p.toScreenPosition(w,K[y]);var G=T._interactor,L=G.getStyle("checkSize"),M=function(h,x,w){var p=x.clone().sub(h).setLength(-L),c=w.clone().sub(h).setLength(-L),G=p.add(c).add(h);return G};return t.rotLT=M(t.LT,t.RT,t.LB),t.rotLB=M(t.LB,t.LT,t.RB),t.rotRB=M(t.RB,t.LB,t.RT),t.rotRT=M(t.RT,t.LT,t.RB),t.rotT=t.rotLT.clone().add(t.rotRT).divideScalar(2),t.rotB=t.rotLB.clone().add(t.rotRB).divideScalar(2),t.rotL=t.rotLT.clone().add(t.rotLB).divideScalar(2),t.rotR=t.rotRT.clone().add(t.rotRB).divideScalar(2),t.rotation=S.getRotation(),T.gatherConnectInfo(),!0}},Tk.prototype.gatherConnectInfo=function(){var X=this,c=X.target,R=X._interactor,d=X.screenInfo,q=R.gv;if(q.isConnectActionVisible(c)&&R.getStyle("connectGuideVisible")){var M;c.s&&(M=c.s("connectGuideShift")),M||(M=R.getStyle("connectGuideShift"));var t=c.getAnchor(),y=c.getSize(),F=c.toGlobal({x:y.width*(M[0]-t.x),y:y.height*(M[1]-t.y)});F=_p.toScreenPosition(q,F),d.P1?F.add(d.P2.clone().sub(d.P1).setLength(M[2])):(F.add(d.RT.clone().sub(d.LT).setLength(M[2])),F.add(d.LB.clone().sub(d.LT).setLength(M[3]))),d.connect=F}},Tk.prototype.gatherMultiTargets=function(Y,P){var T=_p.Group.findOrCreateGroup(P);if(!T)return!1;var h=this;return h.editing&&"rotate"!==h.editing.mode||T.calcInfo(),h.gatherSingleTarget(Y,T)},Tk.prototype.gatherLine=function(k,G){this.target=G;var T=this.screenInfo={},O=G.getPoints(),A=_p.getDataMatrix(G);return T.P1=_p.toScreenPosition(k,A.apply(O.get(0))),T.P2=_p.toScreenPosition(k,A.apply(O.get(1))),this.gatherConnectInfo(),!0},Tk.ResizeKeys=["LT","RB","LB","RT","L","R","B","T"],Tk.ResizeDirection=[{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}],Tk.RotateKeys=["rotLT","rotRB","rotLB","rotRT","rotL","rotR","rotB","rotT"],Tk.prototype.check=function(p,m,O){if(k.Default.isLeftButton(m)){var u=this;if(u.editing=null,u.tipInfo=null,u.screenInfo){var y=u.target,P=p.isEditable(y),C=u.screenInfo;if(P&&C.connect){var G=u._checkConnect(O);if(G)return G}if(C.P1)return u._checkLine(O);var v,A,r,V=null,e=u._interactor,B=e.getStyle("checkSize");if(P&&p.isRectEditable(y))for(A=0;A<_p.Rect.ResizeKeys.length;A++)if(r=_p.Rect.ResizeKeys[A],_p.checkHit(O,C[r],B)){V=r,v="resize";break}if(!V&&P&&p.isRotationEditable(y)&&!e.getStyle("rotateAsClock")){var T=e.getStyle("rotateCheckSize");for(A=0;A<_p.Rect.RotateKeys.length;A++)if(r=_p.Rect.RotateKeys[A],_p.checkHit(O,C[r],T)){V=r,v="rotate";break}}if(!V)return e.setCursor("default"),void 0;if("rotate"===v){var E,j=p.lp(m);if(y instanceof _p.Group){var i=e.getStyle("groupRotateModeKey");"string"==typeof i&&(i=[i]);for(var s=!1,I=0,J=i.length;J>I;I++)if(m[i[I]]){s=!0;break}var K=e.getStyle("groupRotateModeDefault");E=s?"batch"===K?"block":"batch":K}var z="batch"===E?y.getAnchor2():y.getPosition(),w=Math.atan2(j.y-z.y,j.x-z.x);e._setRotateCursor(w),u.editing={mode:v,key:V,pos:z,flipY:y.getScale().y<0,rotation:y.getRotation(),hitRot:w},E&&(u.editing.groupRotateMode=E)}else{var t=_p.Rect.ResizeKeys.indexOf(V),f=_p.Rect.ResizeDirection[t],H=Math.cos(y.getRotation()),X=Math.sin(y.getRotation()),$=f.x*Math.sign(y.getScale().x),x=f.y*Math.sign(y.getScale().y),F=Math.atan2(-X*$-H*x,H*$-X*x),b=(Math.round(F/(Math.PI/4))+8)%8,N=["ew-resize","nesw-resize","ns-resize","nwse-resize","ew-resize","nesw-resize","ns-resize","nwse-resize"][b];this._interactor.setCursor(N);var d=y.getWidth(),g=y.getHeight(),l=y.getAnchor();u.editing={mode:v,key:V,rect:{x:-d*l.x,y:-g*l.y,width:d,height:g},anchor:l,matrix:y.getMatrix()}}return V}}},Tk.prototype._checkLine=function(o){var z=this;z.screenInfo;var R,H=z._interactor.getStyle("checkSize");if(_p.checkHit(o,z.screenInfo.P1,H))R="P1";else{if(!_p.checkHit(o,z.screenInfo.P2,H))return this._interactor.setCursor("default"),void 0;R="P2"}return z.editing={mode:"line",key:R},R},Tk.prototype._checkConnect=function(p){var h=this,w=h.screenInfo,B=h._interactor,j=B.getStyle("connectGuideIntersectSize"),q=w.connect,x=p.x,i=q.x;if(i>x&&j>i-x&&Math.abs(q.y-p.y)<j||x>=i&&_p.checkHit(p,q,j)){var C="connect",F=m.getConnectAction(B.gv);if(h.editing={mode:C},F&&F.delete)if(h.target instanceof _p.Group){var o=!0;B.gv.sm().getSelection().each(function(s){F.delete.visible.call(null,B.gv,s)||(o=!1)}),h.editing.hasDeleteAction=o}else F.delete.visible.call(null,B.gv,h.target)&&(h.editing.hasDeleteAction=!0);return B.setCursor("default"),C}},Tk.prototype._fireEditEvent=function(q,F){var Z=this._interactor,L=this.editing;if(L){var I=L.mode;I="rotate"===I?"Rotation":"connect"===I?"Connection":I[0].toUpperCase()+I.slice(1),Z.fi({kind:q+"Edit"+I,event:F})}},Tk.prototype.startEdit=function(f,D){f.startDragging(D);var R=this;R._interactor.fi({kind:"prepareEdit",event:D});var I=R.editing,_=R.target;if(I){if(R._fireEditEvent("begin",D),"rotate"===I.mode)return I.groupRotateMode&&_.beginRotate(I),void 0;if("connect"!==I.mode)("line"===I.mode||_&&0===_.getRotation())&&(R._inSmartGuide=!0,R._interactor.rectGuide.gatherRects());else if(I.hasDeleteAction){var w=f.gv,i=R._interactor.getStyle("connectGuideGarbageShift");I.garbageInfo={x:w.getWidth()*i[0]+i[2],y:w.getHeight()*i[1]+i[3],size:R._interactor.getStyle("connectGuideGarbageIntersectsize")},f._42()}}},Tk.prototype._46O=function(d){var z,H,K=this,X=K.editing,w=K.target;if(X){if("connect"===X.mode&&!X.canceled&&!X.deleted)try{X.garbageInfo&&X.garbageInfo.hover?m.doDeleteConnectionAction(K._interactor.gv,w):m.doConnectAction(K._interactor.gv,w,X.target)}catch(F){console.error(F)}H=X.freezeFlag,z=K.editing.groupRotateMode,K._fireEditEvent("end",d),K.editing=null}K.tipInfo=null,K._inSmartGuide&&(K._interactor.rectGuide.clear(),K._inSmartGuide=!1),z&&w&&w.endRotate(),w instanceof k.Block&&(H===C?delete w._freezeSyncFromChildren:w._freezeSyncFromChildren=H,w.updateFromChildren())},Tk.prototype.handleNormalStateDelete=function(){var L=this,h=L.editing;if(h&&"connect"===h.mode&&!h.canceled&&!h.deleted){if(h.garbageInfo){try{m.doDeleteConnectionAction(L._interactor.gv,L.target)}catch(e){console.error(e)}h.garbageInfo=null}return h.cursorPos=null,h.targetCorners=null,h.deleted=!0,L._interactor._42(),!0}},Tk.prototype.handleNormalStateKeyDown=function(j){var w=this,l=w.editing;return!l||"connect"!==l.mode||l.canceled||l.deleted?void 0:k.Default.isEsc(j)?(l.cursorPos=null,l.targetCorners=null,l.canceled=!0,w._interactor._42(),!0):void 0},Tk.prototype.handleEdit=function(l,r){var h=this,d=h.editing;if(d){var j,p,T,n,S,v=h.target,z=d.key,X=d.mode,$=l.lp(r),N=h._interactor;if("connect"===X){if(d.canceled)return;if(d.deleted)return;d.cursorPos=N._getLogicalPoint(r);var C=d.garbageInfo;return C&&_p.checkHit(d.cursorPos,C,C.size)?(C.hover=!0,d.target=null,d.targetCorners=null):(C&&(C.hover=!1),d.target=l.getDataAt($,function(U){return l.isSelectable(U)?rd(U)?!0:!1:!1})||null,d.targetCorners=_p.getTargetCornersOnScreen(l,d.target)),N._42(),void 0}if("rotate"===X){var B,J,G=d.pos,x=Math.atan2($.y-G.y,$.x-G.x);if(d.groupRotateMode?J=x-d.hitRot:(B=x-d.hitRot,J=d.rotation+B),J%=2*Math.PI,0>J&&(J+=2*Math.PI),!k.Default.isCtrlDown(r)){var b,_;gh(r)?(b=N.getStyle("shiftRotateRound"),_=b/2):(b=N.getStyle("rotateRound"),_=N.getStyle("rotateSensitivity")),J=_p.roundTo(J,b,_)}d.groupRotateMode?(B=J-(d.lastRotation||0),0!==B&&(v.addRotation(B,d.groupRotateMode),d.lastRotation=J)):v.setRotation(J),N._setRotateCursor(x),J>Math.PI&&(J-=2*Math.PI);var s=180*(J/Math.PI);s=s.toFixed(2),j=""+s+"°"}else if("resize"===X){var o=d.rect;T=o.x,n=o.y;var D,f=o.width,u=o.height,Q=d.anchor,I=d.matrix,K=v.s&&v.s("keepAspectRatio")||N.getStyle("keepAspectRatio");gh(r)&&(K=!K);var O=h._unionPointMode1,q=h._unionPointMode2;if(h._inSmartGuide&&!k.Default.isCtrlDown(r)&&!K){var W;"L"===z||"R"===z?W="x":("T"===z||"B"===z)&&(W="y"),h._adsorbedToClosest($,W),S=!0}D=I.tfi($);var R;"LT"===z?(o=O(D,{x:T+f,y:n+u},f,u,K),R=9):"T"===z?(o=q({x:T,y:D.y},{x:T+f,y:n+u},f,u,K,"v"),R=1):"RT"===z?(o=O(D,{x:T,y:n+u},f,u,K),R=33):"L"===z?(o=q({x:D.x,y:n},{x:T+f,y:n+u},f,u,K,"h"),R=8):"R"===z?(o=q({x:T,y:n},{x:D.x,y:n+u},f,u,K,"h"),R=32):"LB"===z?(o=O(D,{x:T+f,y:n},f,u,K),R=12):"B"===z?(o=q({x:T,y:n},{x:T+f,y:D.y},f,u,K,"v"),R=4):"RB"===z&&(o=O(D,{x:T,y:n},f,u,K),R=36);var t=I.tf(o.x+o.width*Q.x,o.y+o.height*Q.y);v instanceof k.Block&&(d.hasOwnProperty("freezeFlag")||(d.freezeFlag=v._freezeSyncFromChildren,v._freezeSyncFromChildren=!0)),v.setPosition(t),v.setSize(o.width,o.height),S&&(p=v.getRect(),N.rectGuide.gatherLines({node:v,x:p.x,y:p.y,w:p.width,h:p.height},W,R)),j=""+Math.round(o.width)+" * "+Math.round(o.height)}else if("line"===X){if(gh(r)){var i=v.getPoints(),V="P1"===z?i.get(1):i.get(0),Y={x:$.x-V.x,y:$.y-V.y},y=N.getStyle("shiftLineRotateRound"),M=h._shiftDirList;if(!M||h._shiftRotateRound!==y){h._shiftRotateRound=y,h._shiftDirList=M=[];for(var m=0;m<Math.PI;m+=y)M.push({x:U(m),y:e(m)})}for(var L,g=0,Z=0,E=M.length;E>Z;Z++){var w=M[Z],F=w.x*Y.x+w.y*Y.y;Math.abs(F)>Math.abs(g)&&(g=F,L=w)}$={x:V.x+L.x*g,y:V.y+L.y*g},N.rectGuide.clear()}else h._inSmartGuide&&!k.Default.isCtrlDown(r)&&(h._adsorbedToClosest($),S=!0);var A=_p.getDataMatrix(v).applyInverse($);v.setPoint("P1"===z?0:1,A,!0);var a=v.getPoints(),P=a.get(0),c=a.get(1);T=P.x-c.x,n=P.y-c.y,j=" "+Math.round(Math.sqrt(T*T+n*n))+" ",S&&(p=v.getRect(),N.rectGuide.gatherLines({node:v,x:p.x,y:p.y,w:p.width,h:p.height}))}if(j){var H=k.Default.getLogicalPoint(r,N._canvas);H.x+=_p.Icons.TipShiftX,H.y+=_p.Icons.TipShiftY,h.tipInfo={helperPos:H,text:j,size:j.length}}h._fireEditEvent("between",r)}},Tk.prototype._unionPointMode1=function(A,Y,L,l,n){if(n&&L&&l){var g=A.x-Y.x,i=A.y-Y.y;Math.abs(g*l)<Math.abs(i*L)?(i=Math.sign(i)*Math.abs(g*l/L),A.y=Y.y+i):(g=Math.sign(g)*Math.abs(i*L/l),A.x=Y.x+g)}return k.Default.unionPoint(A,Y)},Tk.prototype._unionPointMode2=function(F,v,l,h,X,p){var H=k.Default.unionPoint(F,v);if(X&&l&&h){var j;"v"===p?(j=H.x+H.width/2,H.width=l*H.height/h,H.x=j-H.width/2):(j=H.y+H.height/2,H.height=h*H.width/l,H.y=j-H.height/2)}return H},Tk.prototype._adsorbedToClosest=function(N,Q){var p=this,T=p._interactor,c=T.rectGuide.findClosest(N,Q),Z=T.gridGuide.findClosest(N,Q),a=1/0,t=1/0;c&&(isFinite(c.x)&&(a=c.x),isFinite(c.y)&&(t=c.y)),Z&&(isFinite(Z.x)&&Math.abs(Z.x)<Math.abs(a)&&(a=Z.x),isFinite(Z.y)&&Math.abs(Z.y)<Math.abs(t)&&(t=Z.y)),isFinite(a)&&(N.x+=a),isFinite(t)&&(N.y+=t)},Tk.prototype._42=function(M,O,u){var X=this;X.info={},X.screenInfo=null;var L=X._interactor;if(!L.editDetail&&X.gatherInfo(O,u)){var c=X.editing,m=c?c.groupRotateMode:null,l=X.screenInfo;if("block"!==m){if(l.P1?_p.Icons.DrawIcon(L,M,_p.Icons.Line,l):_p.Icons.DrawIcon(L,M,_p.Icons.Rect,l),l.connect&&(_p.Icons.DrawIcon(L,M,_p.Icons.ConnectGuide,{rotation:l.rotation,connect:l.connect,cursorPos:c?c.cursorPos:null}),c)){if(c.targetCorners){for(var D={x:1/0,y:1/0},R={x:-1/0,y:-1/0},d=0,i=c.targetCorners.length;i>d;d+=2)D.x=Math.min(D.x,c.targetCorners[d]),R.x=Math.max(R.x,c.targetCorners[d]),D.y=Math.min(D.y,c.targetCorners[d+1]),R.y=Math.max(R.y,c.targetCorners[d+1]);_p.Icons.DrawIcon(L,M,_p.Icons.HoverDataRect,{min:D,max:R,color:L.getStyle("hoverGuideColor")||L.getStyle("baseColor")})}c.garbageInfo&&_p.Icons.DrawIcon(L,M,_p.Icons.ConnectGuideGarbage,c.garbageInfo)}X.tipInfo&&_p.Icons.DrawIcon(L,M,_p.Icons.TipHelper,X.tipInfo)}X.target instanceof _p.Group&&X.target._42(L,M,O)}};var $h=_p.Anchor=function(n){this.catalog="Anchor",this._interactor=n};$h.prototype={},$h.prototype.constructor=$h,$h.prototype.gatherInfo=function(B,q){var D=this;if(1===q.length){var c=q[0];if(!c.getAnchor)return;if(c instanceof k.Shape&&c._70I())return;if(Rl(c,B))return;return D.gatherSingleTarget(B,q[0])}return q.length>1?D.gatherMultiTargets(B,q):!1},$h.prototype.gatherSingleTarget=function(j,y){var O=this;return O.info.POS=y.getPosition(),O.screenInfo.POS=_p.toScreenPosition(j,O.info.POS),O.target=y,!0},$h.prototype.gatherMultiTargets=function(J,B){var j=this,o=_p.Group.findOrCreateGroup(B);return o?(j.screenInfo.POS=_p.toScreenPosition(J,o.getAnchor2()),j.target=o,!0):!1},$h.prototype.isVisible=function(){var N=this,v=N._interactor;if(v.getStyle("anchorVisible")===!1)return!1;var $=N.target;if($){if(this.editing)return!0;var V=$.getAnchor(),D=v.getStyle("anchorOutsideVisibleThreshold");if(V.x<-D||V.x>1+D||V.y<-D||V.y>1+D)return!0;var r=$.getSize(),m=$.getScale(),X=Math.min(Math.abs(r.width*m.x),Math.abs(r.height*m.y));if(X*v.gv._zoom<v.getStyle("anchorHideThreshold"))return!1}return!0},$h.prototype.check=function(G,x,v){if(k.Default.isLeftButton(x)){var m=this,d=m._interactor;if(m.isVisible()&&d.getStyle("anchorMovable")!==!1){m.editing=null,m.tipInfo=null;var t=m.target;if(t&&G.isAnchorEditable(t)&&G.isEditable(t)){var q;if(m.screenInfo&&(q=m.screenInfo.POS)&&_p.checkHit(v,new _p.Math.Vector2(q),d.getStyle("checkSize"))){if(t instanceof _p.Group)return m.editing={},!0;var g=t.getWidth(),c=t.getHeight(),s=t.getAnchor();return m.editing={rect:{x:-g*s.x,y:-c*s.y,width:g,height:c},anchor:s,matrix:t.getMatrix()},!0}}}}},$h.prototype.startEdit=function(_,z){_.startDragging(z),_.fi({kind:"beginEditAnchor",event:z})},$h.prototype._46O=function(p){var h=this;h.editing&&(h.editing=null,h._interactor.fi({kind:"endEditAnchor",event:p})),h.tipInfo=null},$h.prototype.handleEdit=function(X,Z){var l=this,a=l.target;if(a){var A=l.editing;if(A){var W=X.lp(Z),z=l._interactor;if(a instanceof _p.Group)return a.setAnchor2(W),z._42(),void 0;var f=A.matrix,e=f.tfi(W),T=A.rect,u=(e.x-T.x)/T.width,o=(e.y-T.y)/T.height;if(!k.Default.isCtrlDown(Z)){var L=z.getStyle("anchorRound"),S=z.getStyle("anchorSensitivity");u=_p.roundTo(u,L,S),o=_p.roundTo(o,L,S)}a.setAnchor(u,o,!0);var i=k.Default.getLogicalPoint(Z,z._canvas);i.x+=_p.Icons.TipShiftX,i.y+=_p.Icons.TipShiftY;var c=""+u.toFixed(2)+", "+o.toFixed(2);l.tipInfo={helperPos:i,text:c,size:c.length},z.fi({kind:"betweenEditAnchor",event:Z})}}},$h.prototype._42=function(d,e,O){var b=this;b.info={},b.screenInfo={};var k=b._interactor;k.editDetail||b.gatherInfo(e,O)&&b.isVisible()&&(_p.Icons.DrawIcon(k,d,_p.Icons.Anchor,b.screenInfo),b.tipInfo&&_p.Icons.DrawIcon(k,d,_p.Icons.TipHelper,b.tipInfo))};var Ed=_p.MoveDummy=function(p){this.catalog="MoveDummy",this._interactor=p};Ed.prototype={},Ed.prototype.constructor=Ed,Ed.prototype.gatherInfo=function(){var e=this,M=this._interactor.getSubModule("Rect");if(M){var p=M.screenInfo;if(p){var k=e._interactor,x=e.getMovableTarget(M.target);if(x){var K=k.getStyle("moveDummyVisible"),c=p.LT||p.P1,V=p.RT||p.P2,Z=p.LB||c;if(c){var h=p.P1,X=Math.min(c.distanceTo(Z),c.distanceTo(V));if(!(X>K)){var P=k.getStyle("moveDummyPosition"),A=V.clone().sub(c),J=Z.clone().sub(c),y=P[2],a=P[3];if(h){var q=k.getStyle("moveDummyLineExtraShift");q&&(y+=q[0],a+=q[1])}var u=c.clone().add(A.clone().multiplyScalar(P[0])).add(A.setLength(y)).add(J.clone().multiplyScalar(P[1])).add(J.setLength(a));return e.screenInfo.pos=u,e.screenInfo.size=k.getStyle("moveDummySensitivity"),!0}}}}}},Ed.prototype.getMovableTarget=function(p){var m=this._interactor.gv;if(rd(p)){if(m.isMovable(p))return p}else if(p instanceof _p.Group)for(var F=p._entities,M=F.length-1;M>=0;M--){var L=F[M];if(rd(L)&&m.isMovable(L))return L}return null},Ed.prototype.getMoveInteractor=function(){for(var U,w,O,I=this._interactor.gv,X=I.getInteractors(),U=0,w=X.length;w>U;U++)if(O=X.get(U),O instanceof kq)return O},Ed.prototype.startEdit=function(G,I){G.startDragging(I);var n=this.getMoveInteractor();if(n){var A=this.selectedTarget,t=G.gv;t._moving=1,n._data=A,t.handleMouseDown&&t.handleMouseDown(I,A)}},Ed.prototype._46O=function(I){var n=this,F=n.getMoveInteractor();F&&(F.handleWindowMouseUp(I),n.selectedTarget=null)},Ed.prototype.handleEdit=function(b,t){var k=this.getMoveInteractor();k&&k.handleWindowMouseMove(t)},Ed.prototype.check=function(F,J,a){if(this.selectedTarget=null,k.Default.isLeftButton(J)&&!F._scrolling&&!on()){var g=this;if(g.screenInfo){var q=g.screenInfo.pos;if(q&&!(a.distanceTo(q)>g.screenInfo.size)){var _=g._interactor;return g.selectedTarget=g.getMovableTarget(_.getSubModule("Rect").target),_.setCursor("default"),!0}}}},Ed.prototype._42=function(l,x,c){var g=this;g.screenInfo={};var P=g._interactor;P.editDetail||g.gatherInfo(x,c)&&(!P.editing||g.selectedTarget)&&_p.Icons.DrawIcon(P,l,_p.Icons.MoveDummy,g.screenInfo)};var Xb=_p.RotateX=function(b){this.catalog="RotateX",this._interactor=b};Xb.prototype={},Xb.prototype.constructor=Xb,Xb.prototype.gatherInfo=function(v,J){var Y=this;if(1===J.length){var t=J[0];return t instanceof k.Shape&&t._70I()||Rl(t,v)?!1:Y.gatherSingleTarget(v,t)}return J.length>1?Y.gatherMultiTargets(v,J):!1},Xb.prototype.gatherSingleTarget=function(){var z=new k.Math.Vector2,Q=new k.Math.Vector2,s=new k.Math.Vector2,y=new k.Math.Vector2,Z=function(l,T){var E=l.x-T.x,U=l.y-T.y;return E*E+U*U};return function(T,G){if(G.getCorners){var Y=this,q=G.getCorners(),a=15,o=G.getPosition();z.copy(q[0]),s.copy(q[1]),y.copy(q[3]),Q.copy(z).add(y).divideScalar(2).add(z.sub(s).setLength(a/T.getZoom()));var n=Math.max(Z(o,q[0]),Z(o,q[1]),Z(o,q[2]),Z(o,q[3]));return Y.info.POS=Q.clone(),Y.screenInfo.POS=_p.toScreenPosition(T,Y.info.POS),Y.screenInfo.LEN=Math.sqrt(n)*T.getZoom()+a,Y.screenInfo.CENTER=_p.toScreenPosition(T,o),Y.target=G,!0}}}(),Xb.prototype.gatherMultiTargets=function(b,t){var L=this,J=_p.Group.findOrCreateGroup(t);if(!J)return!1;
var L=this;return L.gatherSingleTarget(b,J)},Xb.prototype.isVisible=function(){var a=this._interactor;if(!a.getStyle("rotateAsClock"))return!1;var E=this.target;if(!E)return!0;var R=a.gv;return R.isEditable(E)&&R.isRotationEditable(E)?!0:!1},Xb.prototype.check=function(D,a,V){var J=this,r=J._checkImpl(D,a,V);return(r||J._clockPainted)&&J._interactor._42(),r},Xb.prototype._checkImpl=function(N,Z,d){if(k.Default.isLeftButton(Z)){var q=this;q.editing=null,q.tipInfo=null;var G;if(q.screenInfo&&(G=q.screenInfo.POS)&&q.isVisible()){var K=q._interactor;if(_p.checkHit(d,G,K.getStyle("checkSize"))){var a=q.target,U=N.lp(Z),i=a.getPosition(),p=Math.atan2(U.y-i.y,U.x-i.x);return K._setRotateCursor(p),q.editing={pos:i,rotation:a.getRotation(),hitRot:p,groupRotateMode:"block",screenInfo:{CENTER:q.screenInfo.CENTER,LEN:q.screenInfo.LEN}},!0}}}},Xb.prototype.startEdit=function(D,H){D.startDragging(H),D.fi({kind:"beginEditRotation",event:H}),this.target instanceof _p.Group&&this.target.beginRotate(this.editing)},Xb.prototype._46O=function(G){var t=this;t.editing&&(t.editing=null,t._interactor.fi({kind:"endEditRotation",event:G})),t.target instanceof _p.Group&&t.target.endRotate(),t.tipInfo=null},Xb.prototype.handleEdit=function(Z,p){var j=this,b=j.editing;if(b){var u,y,B=j.target,Q=Z.lp(p),a=j._interactor,T=b.pos,n=Math.atan2(Q.y-T.y,Q.x-T.x),D=B instanceof _p.Group;if(D?y=n-b.hitRot:(u=n-b.hitRot,y=b.rotation+u),y%=2*Math.PI,0>y&&(y+=2*Math.PI),!k.Default.isCtrlDown(p)){var I,m;gh(p)?(I=a.getStyle("shiftRotateRound"),m=I/2):(I=a.getStyle("rotateRound"),m=a.getStyle("rotateSensitivity")),y=_p.roundTo(y,I,m)}D?(u=y-(b.lastRotation||0),0!==u&&(B.addRotation(u,b.groupRotateMode),b.lastRotation=y)):B.setRotation(y),a._setRotateCursor(n),y>Math.PI&&(y-=2*Math.PI);var z=180*(y/Math.PI),h=""+z.toFixed(2)+"°",L=k.Default.getLogicalPoint(p,a._canvas);L.x+=_p.Icons.TipShiftX,L.y+=_p.Icons.TipShiftY,j.tipInfo={helperPos:L,text:h,size:h.length},a.fi({kind:"betweenEditRotation",event:p})}},Xb.prototype._42=function(B,I,q){var d=this;d._clockPainted=!1,d.info={},d.screenInfo={};var U=d._interactor;U.editDetail||d.gatherInfo(I,q)&&d.isVisible()&&(_p.Icons.DrawIcon(U,B,_p.Icons.RoundPoint,d.screenInfo.POS),d.tipInfo&&_p.Icons.DrawIcon(U,B,_p.Icons.TipHelper,d.tipInfo),d.editing&&d.drawClock(B))},Xb.prototype.drawClock=function($){$.save();var p=this;p._clockPainted=!0;var A=p.editing||{},N=A.screenInfo||p.screenInfo,H=N.LEN,P=H+8,l=H+18;$.save(),$.translate(N.CENTER.x,N.CENTER.y),$.beginPath(),$.strokeStyle="rgb(150, 150, 150)";for(var s,m,Z,L,g,c=0;360>c;c++)s=c*Math.PI/180,0===c%5&&(m=e(s)*H,Z=U(s)*H,L=e(s)*P,g=U(s)*P,$.moveTo(m,Z),$.lineTo(L,g)),0===c%45&&(m=e(s)*H,Z=U(s)*H,L=e(s)*l,g=U(s)*l,$.moveTo(m,Z),$.lineTo(L,g));$.stroke(),$.rotate(-X);var I=A.lastRotation||p.target.getRotation();$.beginPath(),$.fillStyle="rgba(255, 0, 0, 0.1)",$.strokeStyle="rgb(157, 157, 157)",$.moveTo(0,0),$.arc(0,0,l,0,I,!1),$.fill(),$.beginPath(),$.moveTo(0+l,0),$.arc(0,0,l,0,I,!1),$.stroke(),$.restore()};var qf=_p.Curve=function(S){this.catalog="Curve",this._interactor=S};qf.prototype={},qf.prototype.constructor=qf,H.defineProperties(qf.prototype,{activing:{get:function(){return this._activing},set:function(l){var X=this;if(l)X._activing=new _p.CurveActiving(this,l);else{var d=X._activing;d&&d.dispose(),X._activing=null}}}}),qf.PointType={Mirrored:0,Straight:1,Disconnected:2,Asymmetric:3},qf.prototype.setUp=function(){var w=this,u=w._interactor;u&&u.gv.mp(w._onGraphviewPropertyChanged,w)},qf.prototype._onGraphviewPropertyChanged=function(p){("zoom"===p.property||"translateX"===p.property||"translateY"===p.property)&&this._handleDataChanged()},qf.prototype.tearDown=function(){var F=this,E=F._interactor;E&&E.gv.ump(F._onGraphviewPropertyChanged,F)},qf.prototype.canEnterEditDetailMode=function(){var L=this,f=L._interactor,Y=f._getValidSelection();if(1===Y.length){var p=Y[0],v=p instanceof k.Edge;if(p instanceof k.Shape||v){if(v){var _=p.s("edge.type");if(_&&"points"!==_)return}var c=f.gv;if(c.isPointEditable(p)&&c.isEditable(p))return L.target=p,!0}}},qf.prototype.canQuitEditDetailMode=function(T){var R=this,p=R._interactor._getLogicalPoint(T);return R._checkEditRealPoint(p)?void 0:R._interactor.gv.getDataAt(T)!==R.target?!0:void 0},qf.prototype.preHandleScroll=function(){var P=this.editing;return P&&P.inEdit?!0:void 0},qf.prototype.getCurrentSelectintStatus=function(){var Z=this;if(Z.activing&&!Z.activing.selections){if(Z.activing.status!=C)return Z.activing.status;var f=function(q){var S=Z.activing.status;Z.activing.status=q,Z._interactor.fp("shapePointStatus",S,q)},j=_p.Curve.PointType,e=Z.activing.point,k=Z.activing.pairs;if(!k||1!==k.length)return f(j.Mirrored);var w=k[0],y=w.c1&&w.c1.isNearEnough(e),Q=w.c2&&w.c2.isNearEnough(e);if(!w.c1||!w.c2)return y||Q?f(j.Straight):f(j.Disconnected);if(y&&Q)return f(j.Straight);if(y||Q)return f(j.Asymmetric);var q=w.c1.clone().sub(e),t=w.c2.clone().sub(e);return Math.abs(q.x*t.y-q.y*t.x)>1e-5||q.x*t.x>0?f(j.Disconnected):Math.abs(q.length()-t.length())>1e-5?f(j.Asymmetric):f(j.Mirrored)}},qf.prototype.handle_keydown=function(h){var F=this;if(F._interactor.editDetail){var A=_p.Curve.PointType;"1"===h.key?F._setCurrentSelectionStatus(A.Straight):"2"===h.key?F._setCurrentSelectionStatus(A.Mirrored):"3"===h.key?F._setCurrentSelectionStatus(A.Disconnected):"4"===h.key&&F._setCurrentSelectionStatus(A.Asymmetric)}},qf.prototype.setCurrentSelectionStatus=function(h){var w=this,g=w._interactor;if(g){var N=g.gv;N.dm().beginTransaction(),this._setCurrentSelectionStatus(h),N.dm().endTransaction()}},qf.prototype._setCurrentSelectionStatus=function(A){var c=this,W=c.activing;if(W){var o=c.getCurrentSelectintStatus();if(null!==o&&o!==A){W.status=A;var v=c.activing.point,r=c.activing.pairs;if(r&&1===r.length){var b=r[0],Y=c.screenInfo.curve,E=_p.Curve.PointType,R=function(){c._writeToHt(),c._interactor.fp("shapePointStatus",o,A)};if(A===E.Straight)return Y.moveCtrlPoint(b,v,"c1"),Y.moveCtrlPoint(b,v,"c2"),R(),void 0;if(o===E.Straight){var T=Y.findPairs(v,!0),H=T[0],F=H.r1||v,N=H.r2||v,X=N.clone().sub(F).multiplyScalar(.25);return Y.moveCtrlPoint(b,v.clone().sub(X),"c1"),Y.moveCtrlPoint(b,v.clone().add(X),"c2"),R(),void 0}var s=b.c1,Z=b.c2;if(s&&Z){if(A===E.Mirrored)return Y.moveCtrlPoint(b,v.clone().multiplyScalar(2).sub(Z),"c1"),R(),void 0;if(A===E.Asymmetric&&o===E.Disconnected){var p=s.clone().sub(v).length(),X=v.clone().sub(Z).setLength(p).add(v);return Y.moveCtrlPoint(b,X,"c1"),R(),void 0}}W._firePointChange(),c._interactor.fp("shapePointStatus",o,A)}}}},qf.prototype._handleDataChanged=function(){var y="points,segments,shape,position,rotation,scale".split(",");return function(R){var e=this;if(e.screenInfo&&e.target){if(R&&y.indexOf(R.property)<0)return;var j=e._interactor;e.gatherSingleTarget(j.gv,e.target,!0),e.check(j.gv,null,new _p.Math.Vector2(j._lastClientPoint)),j._42()}}}(),qf.prototype.gatherSingleTarget=function(J,P,n){var $,T,O=this;O.screenInfo&&O.screenInfo.curve&&(T=O.screenInfo.curve._curves);var I=O.editing;$=I?O.screenInfo:O.screenInfo={};var e,y,Z=P instanceof k.Edge;Z?(e=P.s("edge.segments"),y=P.s("edge.points")||new k.List):(e=P._58O,y=P._59O),$.S=e;var M,E=$.P=[],h=_p.getDataMatrix(P);if(P instanceof k.Polyline&&(M=P.getElevation()||0,$.E=[]),y.each(function(g){$.E&&$.E.push(g.e||M),g=h.apply(g);var N=_p.toScreenPosition(J,g);E.push(N.x,N.y)}),Z){var N=_p.toScreenPosition(J,P._lastSourcePoint),g=_p.toScreenPosition(J,P._lastTargetPoint);E.splice(0,0,N.x,N.y),E.push(g.x,g.y)}if(!$.S||!$.S.size()){$.S=new k.List,$.S.add(1);for(var D=0;D<E.length/2-1;D++)$.S.add(2)}if((!I||n)&&O.convertToCubicBezier(T),O.activing&&(n||!O.editing||"realPoint"===O.editing.type)){var U=$.curve.findPairs(O.activing.point);O.activing.pairs=U}Z&&"points"!==P.s("edge.type")&&O._writeToHt()},qf.prototype._convertToNewPoint=function(v,H,d,R){var t,U,Z;for(t=0,U=H.length;U>t;t++){if(Z=H[t],Z._p1.isNearEnough(v)&&(!R||R.indexOf(Z._p1)<0))return Z._p1;if(Z._p4.isNearEnough(v)&&(!R||R.indexOf(Z._p4)<0))return Z._p4}if(d)for(t=0,U=Math.min(d.length,U);U>t;t++){if(Z=d[t],Z._p1===v&&(!R||R.indexOf(H[t]._p1)<0))return H[t]._p1;if(Z._p4===v&&(!R||R.indexOf(H[t]._p4)<0))return H[t]._p4}},qf.prototype.convertToCubicBezier=function(k){var C,w,a=this,X=new _p.Math.Curve,u=a.screenInfo;if(X.createFromHtShape(u.P,u.S,u.E),u.curve=X,a.activing){var U=X._curves;C=a.activing.point,w=a._convertToNewPoint(C,U,k);var H=[];if(w&&(a.activing.point=w,H.push(w)),a.activing.selections){var D=-1,G=a.activing.selections;G.forEach(function(b){D++,w=a._convertToNewPoint(b,U,k,H),w&&(G[D]=w,H.push(w))})}}},qf.prototype.check=function(c,g,M){if(!g||Te(g)||ef(g)){var Q=this;if(Q._interactor.setCursor("default"),Q.editing=null,Q.highlight=null,Q.tipInfo=null,Q.edgeEditResult=null,Q.screenInfo){if(on()||ef(g))return Q._interactor._42(),!0;if(Q._checkEditCtrlPoint(M))return Q._interactor._42(),!0;if(Q._checkEditRealPoint(M))return Q._interactor._42(),!0;if(Q._checkEditElevation(M))return Q._interactor._42(),!0;var I=Q.screenInfo.curve,w=I.checkPoint(M,Q._interactor.getStyle("curveIntersectSize"));if(w){var x=Q.highlight={};x.type="insertKnot",x.bezier=w.bezier,x.point=w.intersection}return Q._interactor._42(),!0}}},qf.prototype._checkEditRealPoint=function(X){var M,G,J,v,c,U,A=this,I=A.screenInfo.curve._curves,z=A._interactor.getStyle("curvePointIntersectSize"),a=1/0;for(z*=z,J=0,v=I.length;v>J;J++)M=I[J],c=M._p1,U=X.distanceToSquared(c),a>U&&(a=U,G=c),c=M._p4,U=X.distanceToSquared(c),a>U&&(a=U,G=c);if(a>z)return!1;var y=A.highlight={};return y.type="changeRealPoint",y.point=G,A.editing={type:"realPoint",point:G,shiftGuide:{point:G.clone(),dir:"x",limit:0}},A._interactor.setCursor("crosshair"),!0},qf.prototype._checkEditElevation=function(I){var O=this;if(!O._interactor.getStyle("curveElevationVisible"))return!1;var D=O.activing;if(!D)return!1;var g=D.getCurrentEditingPoint();if(!g)return!1;var i=O._interactor,q=i.getStyle("curveElevationGuideShift"),E=i.getStyle("curveElevationIntersectSize"),z=I.distanceToSquared({x:g.x+q[0],y:g.y+q[1]});if(!(z>E*E)){var k=O.highlight={};k.type="elevation";var G=new _p.Math.Vector2(I.x,I.y,g.e);return O.editing={type:"elevation",startPoint:G},O._interactor.setCursor("crosshair"),!0}},qf.prototype._checkEditCtrlPoint=function(d){var h=this;if(h.activing&&!h.activing.selections){var o=h.getCurrentSelectintStatus();if(o!==_p.Curve.PointType.Straight){var C=h.activing.pairs;if(C){var f=h._interactor.getStyle("curvePointIntersectSize");f*=f;var p,l,e,m,Y,T,b,P,X,t=1/0;for(b=0,X=C.length;X>b;b++)for(m=C[b],P=0;2>P;P++)Y=0===P?"c1":"c2",m[Y]&&(T=d.distanceToSquared(m[Y]),t>T&&(t=T,p=m,l=b,e=Y));if(t>f)return!1;h.activing.hlpair=p,h.activing.hltype=e;var w=h.highlight={};return w.type="changeCtrlPoint",w.point=p[e],h.editing={type:"ctrlPoint",pair:p,pairId:l,ctrlType:e,direction:p[e].clone().sub(h.activing.point).normalize()},h._interactor.setCursor("crosshair"),!0}}}},qf.prototype.startEdit=function(j,y){j.startDragging(y);var v=this;v.highlight&&"insertKnot"===v.highlight.type&&(v.insertKnot(),v.gatherSingleTarget(v._interactor.gv,v.target),v.activing=null,v._checkEditRealPoint(v._interactor._getLogicalPoint(y)));var O=v._activing;if(O){var B=v.editing?v.editing.type:null;"ctrlPoint"===B?O.editingCtrl={pairId:v.editing.pairId,type:O.hltype}:"realPoint"===B&&(O.editingCtrl=!1)}var s=v.highlight,_=k.Default.isCtrlDown(y);if(!s||on()||ef(y)){var Y=v._interactor.gv;if(!Y.setFocus(y)||Y._scrolling)return;return _?v._multiSelect={startPoint:Y.lp(y)}:Y.isPannable()&&(Te(y)||ef(y))&&(v._pan={tx:Y.tx(),ty:Y.ty()},j.fi({kind:"beginPan",event:y})),void 0}if("changeRealPoint"===s.type){var J,C=v.activing?v.activing.point:null,b=v.activing?v.activing.selections:null;if(_&&v.activing)C===s.point?(b?(v.activing={point:b[0]},b.length>1&&(b.splice(0,1),v.activing.selections=b)):v.activing=null,v.editing=null):b&&(J=b.indexOf(s.point))>=0?(b.length>1?b.splice(J,1):delete v.activing.selections,v.editing=null):b?(b.push(C),v.activing={point:s.point,selections:b}):v.activing={point:s.point,selections:[C]};else if(b)C===s.point||((J=b.indexOf(s.point))>=0?(b.splice(J,1,C),v.activing={point:s.point,selections:b}):v.activing={point:s.point});else{var z;C===s.point&&(z=v.activing.status),v.activing={point:s.point},z&&(v.activing.status=z)}j.fi({kind:"beginEditPoint",event:y})}},qf.prototype.insertKnot=function(){var X=this,S=X.highlight,v=X.screenInfo.curve;v.insertKnot(S.bezier,S.point.t),X._writeToHt()},qf.prototype._writeToHt=function(){var Z,V,X,O,w=this,Y=w.screenInfo.curve,U=Y.toHtShape(),m=U.points,D=[],A=U.segments,i=w._interactor.gv,P=w.target,b=P instanceof k.Edge,u=_p.getDataMatrix(P).invert();O=P instanceof k.Polyline,O&&(X=P.getElevation());for(var r=0,f=m.length;f>r;r++)Z=m[r],V=_p.toWorldPosition(i,Z),V=u.apply(V),Z.e!=C&&Z.e!==X&&(V.e=Z.e),D.push(V);if(P._writing=!0,b){P.s("edge.type","points"),P.setStyle("edge.segments",A),P.setStyle("edge.points",D.slice(1,D.length-1)),P.setStyle("edge.source.offset.x",0),P.setStyle("edge.source.offset.y",0),P.setStyle("edge.target.offset.x",0),P.setStyle("edge.target.offset.y",0);var K=w._nextChangeEdgeHost;delete w._nextChangeEdgeHost,K&&("source"===K.type?P.setSource(K.host):P.setTarget(K.host)),w._writeEdgeHostAnchor("source",D[0]),w._writeEdgeHostAnchor("target",D[D.length-1])}else D.length?(P.setSegments(A),P.setPoints(D,!0)):P.removeFromDataModel();delete P._writing},qf.prototype._writeEdgeHostAnchor=function(t,O){var g=this,p=g.target,Q=g._calcHostAnchor(p,t,O);Q.index!==C?(p.setStyle("edge."+t+".index",Q.index),p.setStyle("edge."+t+".percent",C),p.setStyle("edge."+t+".anchor.x",C),p.setStyle("edge."+t+".anchor.y",C)):Q.percent!==C?(p.setStyle("edge."+t+".percent",Q.percent),p.setStyle("edge."+t+".index",C),p.setStyle("edge."+t+".anchor.x",C),p.setStyle("edge."+t+".anchor.y",C)):(p.s("edge."+t+".anchor.x",Q.x),p.s("edge."+t+".anchor.y",Q.y),Q.offsetX||Q.offsetY?(p.s("edge."+t+".offset.x",Q.offsetX),p.s("edge."+t+".offset.y",Q.offsetY)):(p.s("edge."+t+".offset.x",0),p.s("edge."+t+".offset.y",0)))},qf.prototype._calcHostAnchor=function(t,y,O,i){i||(i="source"===y?t.getSource():t.getTarget());var a=this._interactor.gv,o=a.calculateAttachPoint(i,O);if(o)return o.info;if(ee(i)){var B=a.calculateEdgePosition(i,O);return B}var g=i.getRotation(),z=i.getAnchor();if(Rl(i,a)&&(g=0),g){var U=i.getMatrix(),n=U.tfi(O),Q=i.getSize();return{x:n.x/Q.width+z.x,y:n.y/Q.height+z.y}}var u=ed(a,i),X={x:(O.x-u.x)/u.width,y:(O.y-u.y)/u.height};return X},qf.prototype._handlePanning=function(t){var H=this,_=H._pan;if(_){_.started=!0;var s=H._interactor,g=s.gv,A=s._lastClientPoint,p=_h(t),x=Ub(g,p,A);g.setTranslate(_.tx+x.x,_.ty+x.y),H.gatherSingleTarget(s.gv,H.target),s._42(),s.fi({kind:"betweenPan",event:t})}},qf.prototype.handleEdit=function(n,v){var W=this,w=W.editing;if(W._pan)return W._handlePanning(v),void 0;if(W._multiSelect)return W._multiSelect.endPoint=n.lp(v),W._interactor.redraw(),void 0;if(w){w.inEdit=!0;var H,t,f,z=W._interactor._getLogicalPoint(v),M=k.Default.isCtrlDown(v),u=k.Default.isShiftDown(v),T=w.type,c=W.activing;if(W._guideInfo=null,"ctrlPoint"===T&&u){var K=W.editing.direction.clone();H=c.point;var s=K.dot(z.clone().sub(H));z=K.setLength(s).add(H)}else if("ctrlPoint"===T||"realPoint"===T){var K;if("realPoint"===T&&u){var U=W.editing.shiftGuide;t=U.point;var r=Math.abs(z.x-t.x),j=Math.abs(z.y-t.y);r>j&&r>U.limit&&"y"===U.dir&&(U.dir="x"),j>r&&j>U.limit&&"x"===U.dir&&(U.dir="y"),K=U.dir,"x"===K?(z.y=t.y,U.limit=Math.max(U.limit,r)):"y"===K&&(z.x=t.x,U.limit=Math.max(U.limit,j))}var A=W._isEditEdgeSourceTarget();if(A){var B=W._editEdgeSourceTarget(A,z,M);B&&(W.edgeEditResult=B,f=B.tipText)}else if(!M){var h=W._guidingToEdit(z,K),$="realPoint"===T?W._interactor.gridGuide.findClosest(z,K,!0):null,S=1/0,Q=1/0;$&&($.x&&(S=$.x),$.y&&(Q=$.y));var P=!1;h&&(h.xList&&(Math.abs(h.x)<=Math.abs(S)?(P=!0,S=h.x):delete h.xList),h.yList&&(Math.abs(h.y)<=Math.abs(Q)?(P=!0,Q=h.y):delete h.yList),P&&(W._guideInfo=h)),isFinite(S)&&(z.x+=S),isFinite(Q)&&(z.y+=Q),P&&(h.v=z)}}var L=W.screenInfo.curve;if("realPoint"===w.type){H=w.point,H.e!==C&&(z.e=H.e),L.moveRealPoint(H,z),w.point=z,W.highlight.point=z;var x=c.status,O=c.selections;if(W.activing={point:z,status:x},O){var y=z.clone().sub(H),V=0;O.forEach(function(P){var U=P.clone().add(y);L.moveRealPoint(P,U),O[V++]=U}),W.activing.selections=O}}else if("ctrlPoint"===w.type){var D=c.pairs,X=D[w.pairId];L.moveCtrlPoint(X,z,w.ctrlType);var o=c.status,d=_p.Curve.PointType;if((o===d.Mirrored||o===d.Asymmetric)&&X.c1&&X.c2){var H=new _p.Math.Vector2(c.point),N="c1"===w.ctrlType?"c2":"c1";if(o===_p.Curve.PointType.Mirrored)L.moveCtrlPoint(X,H.clone().multiplyScalar(2).sub(z),N);else if(o===d.Asymmetric){var s=X[N].clone().sub(H).length(),i=H.clone().sub(X[w.ctrlType]).setLength(s).add(H);isNaN(i.x)||L.moveCtrlPoint(X,i,N)}}c._firePointChange()}else if("elevation"===w.type){t=w.startPoint;var l=t.e+(t.y-z.y)/n._zoom;W._setCurrentPointImpl("e",l),c._firePointChange(),f="E: "+_p.toFixed(l)}var F=k.Default.getLogicalPoint(v,W._interactor._canvas);if(F.x+=_p.Icons.TipShiftX,F.y+=_p.Icons.TipShiftY,!f){var e=_p.toWorldPosition(n,z);f=""+_p.toFixed(e.x)+", "+_p.toFixed(e.y)}W.tipInfo={helperPos:F,text:f,size:f.length},W._writeToHt(),W._interactor.fi({kind:"betweenEditPoint",event:v})}},qf.prototype._setCurrentPointImpl=function(V,a){var U=this,Z=U._activing;if(!Z)return!1;var k=U.target;if(!k)return!1;var Y=Z.getCurrentEditingPoint();if(!Y)return!1;var K=Z.editingCtrl;if(!K)var y=Y.clone();if("e"===V)Y.e=a;else{var X;if("x"===V||"y"===V){var n=Z._lastFirePoint;X="x"===V?{x:a,y:n?n.y:0}:{x:n?n.x:0,y:a}}else"object"==typeof V?(X=V,V.e!==C&&(Y.e=V.e)):(X={x:arguments[0],y:arguments[1]},arguments[2]!==C&&(Y.e=arguments[2]));var j=_p.getDataMatrix(k);X=_p.toScreenPosition(U._interactor.gv,j.apply(X)),Y.x=X.x,Y.y=X.y}if(!K){var s=y.multiplyScalar(-1).add(Y);Y.e&&y.e&&(s.e=Y.e-y.e),U.screenInfo.curve.moveCtrlDueToRealPointMovement(Y,s)}return!0},qf.prototype.setCurrentPoint=function(B,Y){return this._setCurrentPointImpl(B,Y)?(this._writeToHt(),!0):!1},qf.prototype._isEditEdgeSourceTarget=function(){var S=this,z=S.target;if(!(z instanceof k.Edge))return!1;var e=S.editing.point,w=S.screenInfo.curve._curves;return e===w[0]._p1?"source":e===w[w.length-1]._p4?"target":!1},qf.prototype._editEdgeSourceTarget=function(b,A,F){var D,v=this,l=v.target;if(D="source"===b?l.getSource():l.getTarget()){var p,t=v._interactor.gv,W=_p.toWorldPosition(t,A),I=v._calcHostAnchor(l,b,W,D);if(p=I.index!==C||I.percent!==C?I.distance*t.getZoom()>v._interactor.getStyle("edgeHostEdgeMaxDistance"):v._interactor.getStyle("edgeHostDetectPerFrame")?!0:I.x<0||I.x>1||I.y<0||I.y>1?!0:!1){var Q=t.getDataAt(W,function(c){return t.isSelectable(c)?c===D?!1:l.canSetSourceTarget(c,b)?!0:!1:!1});if(Q){var u=v._calcHostAnchor(l,b,W,Q);D=Q,v._nextChangeEdgeHost={type:b,host:Q},I=u}}var f,q,i;if(F||I.x===C)(I.percent!==C||I.index!==C)&&(q=I.point);else{var $=v._interactor.getStyle("anchorRound"),n=v._interactor.getStyle("anchorSensitivity");f=t.calculateAttachPoint(D,W),f?I=f.info:(I.x=_p.roundTo(I.x,$,n),I.y=_p.roundTo(I.y,$,n)),q=D.getAttachPosition(I.x,I.y,I.offsetX,I.offsetY)}q&&(i=_p.toScreenPosition(t,q),A.x=i.x,A.y=i.y),v._edgeHostGuideInfo={corners:_p.getTargetCornersOnScreen(t,D),attach:f?f.index:-1,host:D};var z;return I.percent!==C?z="percent: "+I.percent.toFixed(2):I.index!==C?z="index: "+I.index:(z=""+I.x.toFixed(2)+", "+I.y.toFixed(2),(I.offsetX||I.offsetY)&&(z+=" offset: "+I.offsetX.toFixed(2)+", "+I.offsetY.toFixed(2))),{host:D,anchor:I,tipText:z}}},qf.prototype._guidingToEdit=function(r,P){var C,o,J=this;if(C=J.screenInfo.curve){o=C._curves;var u,X,v,B,z,R,N,V,U=1/0,n=1/0,s=[];for(J.editing&&"realPoint"===J.editing.type&&(V=J.editing.point),z=0,R=2*o.length;R>z;z++)N=o[Math.floor(z/2)][z%2?"_p4":"_p1"],s.indexOf(N)>=0||(s.push(N),V&&V===N||(v=N.x-r.x,B=N.y-r.y,Math.abs(v)<Math.abs(U)?(U=v,u=[N]):v===U&&u.push(N),Math.abs(B)<Math.abs(n)?(n=B,X=[N]):B===n&&X.push(N)));var L=J._interactor.getStyle("smartGuideSensitivity");if((Math.abs(U)>L||"y"===P)&&(u=null),(Math.abs(n)>L||"x"===P)&&(X=null),u||X){var g=!1,q={};if(u&&(g=!0,q.xList=u,q.x=U),X&&(g=!0,q.yList=X,q.y=n),g)return q}}},qf.prototype._46O=function(w){var s=this;s.editing&&(s.editing=null,s._interactor.fi({kind:"endEditPoint",event:w})),s._guideInfo=null,s._edgeHostGuideInfo=null,s._pan&&(s._pan=null,s._interactor.fi({kind:"endPan",event:w})),s._multiSelect&&(s._handleMultiSelect(s._multiSelect),s._multiSelect=null),s.tipInfo=null,s.edgeEditResult=null},qf.prototype._handleMultiSelect=function(c){if(c.startPoint&&c.endPoint){var X,R,m,A,v,H=this,x=H._interactor,T=x.gv,N=_p.toScreenPosition(T,c.startPoint),u=_p.toScreenPosition(T,c.endPoint),V=k.Default.unionPoint(N,u),P=H.screenInfo.curve._curves,$=[],z=function(a){a.x>=V.x&&a.y>=V.y&&a.x<=V.x+V.width&&a.y<=V.y+V.height&&$.indexOf(a)<0&&$.push(a)};for(X=0,R=P.length;R>X;X++)v=P[X],z(v._p1),z(v._p4);if($.length){var Z=H.activing||{},n=Z.selections||[];for(Z.point&&n.push(Z.point),X=0,R=n.length;R>X;X++)m=n[X],A=$.indexOf(m),A>=0?$[A]=C:$.push(m);var w=$;for($=[],X=0,R=w.length;R>X;X++)w[X]&&$.push(w[X]);R=$.length,0===R?H.activing=null:1===R?H.activing={point:$[0]}:(m=$[R-1],H.activing={point:m,selections:$.splice(0,R-1)}),x.redraw()}}},qf.prototype._canDeletePoint=function(d,i){var F=this.target;if(!(F instanceof k.Edge))return!0;var b=d._curves[0],Q=d._curves[d._curves.length-1];return b._p1===i||Q._p4===i?!1:!0},qf.prototype.handleDelete=function(){var a=this;if(a.activing&&a.screenInfo){var i=k.Default.isShiftDown(),C=a.screenInfo.curve;a._canDeletePoint(C,a.activing.point)&&C.deleteRealPoint(a.activing.point,i),a.activing.selections&&a.activing.selections.forEach(function(Z){a._canDeletePoint(C,Z)&&C.deleteRealPoint(Z,i)}),a.activing=null,delete a.editing,delete a.tipInfo,delete a.edgeEditResult,delete a._pan,delete a._multiSelect,a._writeToHt(),a._interactor.fp("deleteShapePoint",!1,!0)}},qf.prototype.handleDoubleClick=function(k){var z=this,c=z._interactor._getLogicalPoint(k);if(z.screenInfo&&z._checkEditRealPoint(c)){var w=z.getCurrentSelectintStatus(),S=_p.Curve.PointType;return w=w===S.Mirrored?S.Straight:S.Mirrored,z._setCurrentSelectionStatus(w),z._interactor._42(),!0}},qf.prototype._drawHighlight=function(R){var D=this,g=D.highlight;if(g){var l=g.bezier,i=D._interactor;l&&_p.Icons.DrawIcon(i,R,_p.Icons.ShapeHighlightCurve,[l._p1.x,l._p1.y,l._p2.x,l._p2.y,l._p3.x,l._p3.y,l._p4.x,l._p4.y]);var W=g.point;W&&"insertKnot"===g.type&&_p.Icons.DrawIcon(i,R,_p.Icons.ShapeHighlighPoint,W)}},qf.prototype._drawGuide=function(w){var S=this,R=S._guideInfo;if(R){var o,c,L,n,G=R.v;for(o=0;2>o;o++)if(n=0===o?R.xList:R.yList)for(c=0,L=n.length;L>c;c++)_p.Icons.DrawIcon(S._interactor,w,_p.Icons.ShapeGuideLine,[G.x,G.y,n[c].x,n[c].y])}},qf.prototype._drawCurrentPoint=function(j){var u=this;if(u.activing){var k=u.activing,f=u.getCurrentSelectintStatus(),w=u._interactor;if(f!==_p.Curve.PointType.Straight){var o=k.pairs;k.hlpair,k.hltype;var J=k.selections,g=k.editingCtrl;if(o&&!J){var G,t,r;for(t=0,r=o.length;r>t;t++)G=o[t],g&&t===g.pairId&&G[g.type]?_p.Icons.DrawIcon(w,j,_p.Icons.ShapeActivingCtrl,{point:G.point,c1:G.c1,c2:G.c2,hl:g.type}):_p.Icons.DrawIcon(w,j,_p.Icons.ShapeActivingCtrl,G)}}_p.Icons.DrawIcon(w,j,_p.Icons.ShapeHighlighRealPoint,u.activing.point),J&&J.forEach(function(N){_p.Icons.DrawIcon(w,j,_p.Icons.ShapeHighlighRealPoint,N)})}},qf.prototype.clear=function(){var e=this;e.editing=null,e._guideInfo=null,e.activing=null,e.highlight=null},qf.prototype._42=function(j){var W=this;W.info={},W.editing||(W.screenInfo=null);var x=W._interactor;if(!x.editDetail)return W.clear(),void 0;var N=x.gv;if(!W.target||!N.isSelected(W.target)||!N.isVisible(W.target))return x.editDetail=!1,W.clear(),void 0;if(W.gatherSingleTarget(N,W.target),_p.Icons.DrawIcon(x,j,_p.Icons.ShapeBgCurve,W.screenInfo),W._drawHighlight(j),W._drawCurrentPoint(j),W._getRealPoint().forEach(function(k){_p.Icons.DrawIcon(x,j,_p.Icons.ShapePoint,k)}),W._drawGuide(j),W.tipInfo&&_p.Icons.DrawIcon(x,j,_p.Icons.TipHelper,W.tipInfo),W._edgeHostGuideInfo){_p.Icons.DrawIcon(x,j,_p.Icons.NodeHoverGuide,W._edgeHostGuideInfo.corners);var e=W._edgeHostGuideInfo.host;if(e){var c=N.getAttachPoints(e);if(c&&c.length)for(var L=0,R=c.length;R>L;L++){var E=c[L],Q=e.getAttachPosition(E.x,E.y,E.offsetX,E.offsetY);Q=_p.toScreenPosition(N,Q),Q.isAttach=W._edgeHostGuideInfo.attach===L,_p.Icons.DrawIcon(x,j,_p.Icons.AttachPoint,Q)}}}if(W._interactor.getStyle("curveElevationVisible")&&W.target instanceof k.Polyline&&W.activing){var o=W.activing.getCurrentEditingPoint();o&&_p.Icons.DrawIcon(x,j,_p.Icons.EdgeElevationGuide,o)}if(W.edgeEditResult&&W._drawEdgeHostHighlight(j,W.edgeEditResult.host,W.edgeEditResult.anchor),W._multiSelect&&W._multiSelect.endPoint){var Y=k.Default.unionPoint(_p.toScreenPosition(N,W._multiSelect.startPoint),_p.toScreenPosition(N,W._multiSelect.endPoint));Y.color=N.getRectSelectBorderColor(),j.save(),j.setTransform(1,0,0,1,0,0);var m=K.devicePixelRatio,f=Y.borderWidth=Math.round(m);f/=2,Y.x=Math.round(Y.x*m)+f,Y.y=Math.round(Y.y*m)+f,Y.width=Math.round(Y.width*m),Y.height=Math.round(Y.height*m),_p.Icons.DrawIcon(x,j,_p.Icons.SimpleRect,Y),j.restore()}},qf.prototype._drawEdgeHostHighlight=function(u,o,j){this.drawEdgeHostHighlight(u,o,j),this._interactor.redraw()},qf.prototype.drawEdgeHostHighlight=function(K,J,r){if(ee(J)){var k,E,g,P,e=this,u=e._interactor,R=u.gv,A=R.getDataUI(J),B=Go(A),W=[];for(g=0,P=B.points.length;P>g;g++)E=_p.toScreenPosition(R,B.points.get(g)),W.push(E.x,E.y);B.segments&&(k=B.segments.toArray());var L=u.getStyle("edgeHostHighlighPeriod"),F=u.getStyle("edgeHostEdgeHighlighColor");_p.Icons.DrawIcon(u,K,_p.Icons.ShapeBgCurve,{P:W,S:k,color:F,dynamicVisible:r.index===C,dynamicPeriod:L}),F=u.getStyle("edgeHostPointHighlighColor");var s=vh(A);for(g=0,P=s.length;P>g;g++){var d=s[g],q=_p.toScreenPosition(R,d);_p.Icons.DrawIcon(u,K,_p.Icons.ShapePoint,{point:{x:q.x,y:q.y},color:F,size:12,dynamicVisible:g===r.index,dynamicPeriod:L})}}},qf.prototype._getRealPoint=function(){var R,M=this.screenInfo,V=M.P,s=M.S,Q=-1,y=[],L=-1,a=s.length;return s.each(function(z){L++;var B=1;if(3===z)B=2;else if(4===z)B=3;else if(5===z)return;Q+=B,R=L+1>=a?!0:1===s.get(L+1)?!0:!1,y.push({point:{x:V[2*Q],y:V[2*Q+1]},segmentIndex:L,pointIndex:Q,isEnd:R})}),y},qf.prototype.getEditingPointsInfo=function(c){var y=this,J=y.activing;if(!J)return!1;var b=J.point;if(!b)return!1;var U=this._getRealPoint(),C=[{screen:b}];J.selections&&J.selections.forEach(function(F){C.push({screen:F})});var g,w,z=U.length;return C.forEach(function(v){for(g=0;z>g;g++)if(w=U[g],v.screen.isNearEnough(w.point)){v.segmentIndex=w.segmentIndex,v.pointIndex=w.pointIndex,v.point=y.target.getPoints().get(w.pointIndex);break}}),c&&C.sort(function($,g){return $.segmentIndex-g.segmentIndex}),C};var Or=_p.MoveHelper=function(M){var l=this;l.catalog="Move",l._interactor=M};Or.prototype={},Or.prototype.constructor=Or,Or.prototype.calcShift=function(q,c,N){var g,p,M=this,P=M._interactor.gv,f=P.lp(c);if("beginMove"===q&&M._gatherGridInfo(N._lastLogicalPoint||f),g=M._target){var D=g.downPosition;if(D){var d=M._interactor.getStyle("moveSensitivity")/P._zoom;if(D.distanceTo(f)<d)return{x:0,y:0};delete g.downPosition}var R;p=k.Default.isShiftDown(c),p&&(f=M._dealShiftDown(f),R=g.shiftGuide.dir);var Z,K=g.rawPos={x:g.pos.x+f.x-g.lp.x,y:g.pos.y+f.y-g.lp.y};if(k.Default.isCtrlDown(c)){if(Z=M._calcShiftByAddon(),M._target.node instanceof _p.Group){var r=M._target.node;r._position.x+=Z.x,r._position.y+=Z.y}return Z}for(var s,W=g.x+K.x,h=g.y+K.y,C={x:W,y:h},m={x:W+g.w/2,y:h+g.h/2},i={x:W+g.w,y:h+g.h},a=M._interactor.rectGuide,B=M._interactor.gridGuide,F=[a.findClosest(C,R),a.findClosest(m,R),a.findClosest(i,R),B.findClosest(C,R),B.findClosest(m,R),B.findClosest(i,R)],T=1/0,U=1/0,O=0,j=F.length;j>O;O++)s=F[O],s&&(W=s.x,h=s.y,isFinite(W)&&Math.abs(W)<Math.abs(T)&&(T=W),isFinite(h)&&Math.abs(h)<Math.abs(U)&&(U=h));if(isFinite(T)||(T=0),isFinite(U)||(U=0),Z=M._calcShiftByAddon(T,U),M._target.node instanceof _p.Group){var r=M._target.node;r._position.x+=Z.x,r._position.y+=Z.y}var b=g.node;if(!Rl(b,P)){var n=K.x+T,w=K.y+U;M._interactor.rectGuide.gatherLines({node:b,x:g.x+n,y:g.y+w,w:g.w,h:g.h},R)}return Z}},Or.prototype._calcShiftByAddon=function(b,n){var x=this._target,N=x.rawPos,z=x.node.getPosition();return b=b||0,n=n||0,{x:N.x-z.x+b,y:N.y-z.y+n}},Or.prototype._dealShiftDown=function(k){var J=this,E=J._target.shiftGuide,C=J._target.lp,D=Math.abs(k.x-C.x),z=Math.abs(k.y-C.y);D>z&&D>E.limit&&"y"===E.dir&&(E.dir="x"),z>D&&z>E.limit&&"x"===E.dir&&(E.dir="y");var g=E.dir;return"x"===g?(k.y=C.y,E.limit=Math.max(E.limit,D)):"y"===g&&(k.x=C.x,E.limit=Math.max(E.limit,z)),k},Or.prototype._gatherGridInfo=function(B){var E,A=this,l=A._interactor,v=l._getValidSelection();if(v.length){if(1===v.length){if(E=v[0],!E.getRect)return A._target=null,void 0}else if(E=_p.Group.findOrCreateGroup(v),!E)return A._target=null,void 0}else{var v=l.gv.sm().getSelection();if(v.length&&(E=v.get(0),!E.getRect))return A._target=null,void 0}var s=E.getPosition(),D=E.getRect();A._target={node:E,x:D.x-s.x,y:D.y-s.y,w:D.width,h:D.height,lp:{x:B.x,y:B.y},pos:{x:s.x,y:s.y},shiftGuide:{dir:"x",limit:0},downPosition:new _p.Math.Vector2(B)},l.rectGuide.gatherRects()},Or.prototype.clear=function(){var z=this;z._interactor.rectGuide.clear(),z._interactor._42()};var El="directional",sh="point",Wr="spot",kl="light.color",$g={},mj=function(T,N){Jh(N)&&We.test(N)?eq(T,N):Ib(N)&&N.modelType?Gn(T,N):be[T]=N},no=function(n){if(Ib(n))return n.modelType?n.uuid?be[n.uuid]:(n.uuid=k.Math.generateUUID(),Gn(n.uuid,n),C):n;var S=be[n];return n&&S===C&&We.test(n)&&(Jf&&Jf[n]||eq(n,n)),S},Hq=function(Q,j){Q.frameStack?Q.frameStack.push(j):Q.frameStack=[j],Q.bindFramebuffer(Q.FRAMEBUFFER,j)},oo=function(q){var V=q.frameStack;if(V){if(V.pop(),V.length)return q.bindFramebuffer(q.FRAMEBUFFER,V[V.length-1]),void 0;q.frameStack=null}q.bindFramebuffer(q.FRAMEBUFFER,null)};dc(m,{graph3dViewAttributes:V,graph3dViewFirstPersonMode:!1,graph3dViewMouseRoamable:!0,graph3dViewMoveStep:15,graph3dViewRotateStep:F/60,graph3dViewEditHelperDisabled:!1,graph3dViewPannable:!0,graph3dViewRotatable:!0,graph3dViewWalkable:!0,graph3dViewResettable:!0,graph3dViewZoomable:!0,graph3dViewRectSelectable:!0,graph3dViewRectSelectBackground:Yo,graph3dViewGridVisible:!1,graph3dViewGridSize:50,graph3dViewGridGap:50,graph3dViewGridColor:[.4,.75,.85,1],graph3dViewOriginAxisVisible:!1,graph3dViewCenterAxisVisible:!1,graph3dViewAxisXColor:[1,0,0,1],graph3dViewAxisYColor:[0,1,0,1],graph3dViewAxisZColor:[0,0,1,1],graph3dViewEditSizeColor:[1,1,0,1],graph3dViewOrtho:!1,graph3dViewOrthoWidth:2e3,graph3dViewFovy:F/4,graph3dViewNear:10,graph3dViewFar:1e4,graph3dViewEye:[0,300,1e3],graph3dViewCenter:[0,0,0],graph3dViewUp:[0,1,-1e-7],graph3dViewHeadlightRange:0,graph3dViewHeadlightColor:[1,1,1,1],graph3dViewHeadlightIntensity:1,graph3dViewHeadlightDisabled:!1,graph3dViewFogDisabled:!0,graph3dViewFogColor:"white",graph3dViewFogNear:1,graph3dViewFogFar:2e3,graph3dViewDashDisabled:!0,graph3dViewBatchBlendDisabled:!0,graph3dViewBatchBrightnessDisabled:!0,graph3dViewBatchColorDisabled:!1,graph3dMaxVectorCacheTime:50,setShape3dModel:mj,getShape3dModel:no,createMatrix:function(d,v){lk(d)||(d=[d]);for(var x=d.length-1;x>=0;x--){var u=d[x];v=Fp(u.mat,u.s3,u.r3,u.rotationMode,u.t3,v)}return v},transformVec:function(S,r){return Qf(S,r)},glBindFrame:Hq,glUnbindFrame:oo,createBoxModel:function(){return{vs:bh,ns:So,uv:wr,is:Ef}},createRoundRectModel:function(D,C){return Dh.roundRect(D,C)},createStarModel:function(F,O){return Dh.star(F,O)},createRectModel:function(R,s){return Dh.rect(R,s)},createTriangleModel:function(Y,s){return Dh.triangle(Y,s)},createRightTriangleModel:function(B,g){return Dh.rightTriangle(B,g)},createParallelogramModel:function(V,i){return Dh.parallelogram(V,i)},createTrapezoidModel:function(V,v){return Dh.trapezoid(V,v)
},createSmoothSphereModel:function(z,q,n,F,Z,x,R){return zp(new Oo(z,q,n,F,Z,x,R))},createSphereModel:function(J,Z,E,$,g,M){return J?Kn(J,Z,E,$,g,M):m.createSmoothSphereModel()},createSmoothConeModel:function(D,u,R,N,M){return bf(D,u,R,N,M)},createConeModel:function(W,c,n,Z,x,C){return W?To(W,c,n,Z,x,C):bf(C)},createSmoothCylinderModel:function(D,$,V,s,E,f,p,F){return zp(new ep(D,$,V,s,E,f,p,F))},createCylinderModel:function(F,J,x,E,N,l,b){return F?Dj(F,J,x,E,N,l,b):lg(l,b)},createSmoothTorusModel:function(r,u,E,D,W,X){return zp(new wh(r,u,E,D,W,X))},createTorusModel:function(j,V,f,N,E,B,w){return j?Kh(j,V,f,N,E,B,w):Cs(B,w)},createExtrusionModel:function(J,v,I,a,q,$,d,e){return Ao(J,v,I,a,q,$,d,e)},createSmoothRingModel:function(A,F,C,O,i,b){for(var G=[],u=0;u<A.length-1;u+=2)G.push({x:A[u],y:A[u+1]});for(A=so(G,F,C)[0],G=[],u=0;u<A.length;u++){var n=A[u];G.push(new qk(n.x,0,n.y))}return zp(new Tp(G,b,O,i))},createTextGeometry:function(R,w){return zp(new $m(R,w))},loadFontFace:function(e,l){m.xhrLoad(e,function(t){if(!t)return l();var k;try{k=JSON.parse(t)}catch(j){k=JSON.parse(t.substring(65,t.length-2))}yc.loadFace(k),l&&l(k.familyName.toLowerCase())},l?null:{sync:!0})},createRingModel:function(g,M,w,D,v,i,B,t,J,d){for(var H=[],X=0;X<g.length-1;X+=2)H.push({x:g[X],y:g[X+1]});i=i||m.shapeSide,B=B||0,t=t||i;var z,F,c,p,T,j,P,K,k,f,X,I,a,o,G,C,Y,l,N=[],x=[],q=J?[]:V,L=J?[]:V,W=d?[]:V,r=d?[]:V,Q=D?[]:V,y=D?[]:V,Z=v?[]:V,R=v?[]:V,g=so(H,M,w),E=Od(g),S=0,h=2*Math.PI/i;return g.forEach(function(u){if(c=u.length,c>1){if(p=u[0],D)for(j=p.x,K=p.y,X=B;t>X;X++)I=X+1,a=X*h,o=I*h,G=e(a),C=U(a),Y=e(o),l=U(o),Q.push(G*j,K,-C*j,Y*j,K,-l*j,0,K,0),y.push(.5-.5*G,.5-.5*C,.5-.5*Y,.5-.5*l,.5,.5);for(f=0;c>f;f++){for(T=u[f],j=p.x,P=T.x,K=p.y,k=T.y,z=S/E,S+=_e(p,T),F=S/E,X=B;t>X;X++)I=X+1,a=X*h,o=I*h,G=e(a),C=U(a),Y=e(o),l=U(o),N.push(G*P,k,-C*P,Y*P,k,-l*P,G*j,K,-C*j,Y*P,k,-l*P,Y*j,K,-l*j,G*j,K,-C*j),x.push(X/i,F,I/i,F,X/i,z,I/i,F,I/i,z,X/i,z),J&&X===B&&(q.push(0,K,0,0,k,0,G*P,k,-C*P,G*P,k,-C*P,G*j,K,-C*j,0,K,0),L.push(0,.5-K,0,.5-k,2*P,.5-k,2*P,.5-k,2*j,.5-K,0,.5-K)),d&&I===t&&(W.push(0,K,0,Y*P,k,-l*P,0,k,0,Y*P,k,-l*P,0,K,0,Y*j,K,-l*j),r.push(1,.5-K,1-2*P,.5-k,1,.5-k,1-2*P,.5-k,1,.5-K,1-2*j,.5-K));p=T}if(v)for(j=p.x,K=p.y,X=B;t>X;X++)I=X+1,a=X*h,o=I*h,G=e(a),C=U(a),Y=e(o),l=U(o),Z.push(Y*j,K,-l*j,G*j,K,-C*j,0,K,0),R.push(.5-.5*Y,.5+.5*l,.5-.5*G,.5+.5*C,.5,.5)}}),{vs:N,uv:x,bottom_vs:Z,bottom_uv:R,top_vs:Q,top_uv:y,from_vs:q,from_uv:L,to_vs:W,to_uv:r}}},!0),dc(g,{"3d.move.mode":C,"3d.selectable":!0,"3d.visible":!0,"3d.movable":!0,"3d.editable":!0,"shape.border.gradient.color":C,"edge.gradient.color":C,"edge.source.t3":C,"edge.target.t3":C,"light.type":sh,"light.center":[0,0,0],"light.color":[1,1,1,1],"light.disabled":!1,"light.angle":F/4,"light.range":0,"light.exponent":1,"light.intensity":1,"wf.visible":!1,"wf.width":1,"wf.color":uq,"wf.short":!1,"wf.mat":C,"wf.geometry":!1,"wf.loadQuadWireframe":!1,"wf.combineTriangle":!0,batch:C,"transparent.mask":!1,brightness:C,"select.brightness":.7,"repeat.uv.length":C,alphaTest:.4,renderTextureSamples:4,"highlight.visible":!0,"highlight.width":.8,"highlight.color":"rgba(190, 210, 250, 1)","color.empty":[0,0,0,0],"shape3d.vector.dynamic.maxsize":2048,"label.face":Bn,"label.t3":C,"label.r3":C,"label.texture.scale":2,"label.rotationMode":Zc,"label.light":!1,"label.blend":C,"label.reverse.flip":!1,"label.reverse.color":Mg,"label.reverse.cull":!1,"label.transparent":!1,"label.autorotate":!1,"label2.face":Bn,"label2.t3":C,"label2.r3":C,"label2.texture.scale":2,"label2.rotationMode":Zc,"label2.light":!1,"label2.blend":C,"label2.reverse.flip":!1,"label2.reverse.color":Mg,"label2.reverse.cull":!1,"label2.transparent":!1,"label2.autorotate":!1,"note.face":Bn,"note.t3":C,"note.r3":C,"note.texture.scale":2,"note.rotationMode":Zc,"note.light":!1,"note.blend":C,"note.reverse.flip":!1,"note.reverse.color":Mg,"note.reverse.cull":!1,"note.transparent":!1,"note.autorotate":!1,"note2.face":Bn,"note2.t3":C,"note2.r3":C,"note2.texture.scale":2,"note2.rotationMode":Zc,"note2.light":!1,"note2.blend":C,"note2.reverse.flip":!1,"note2.reverse.color":Mg,"note2.reverse.cull":!1,"note2.transparent":!1,"note2.autorotate":!1,shape3d:C,"shape3d.color":Qb,"shape3d.top.color":C,"shape3d.bottom.color":C,"shape3d.from.color":C,"shape3d.to.color":C,"shape3d.image":C,"shape3d.top.image":C,"shape3d.bottom.image":C,"shape3d.from.image":C,"shape3d.to.image":C,"shape3d.light":!0,"shape3d.side":0,"shape3d.side.from":C,"shape3d.side.to":C,"shape3d.visible":!0,"shape3d.from.visible":!0,"shape3d.to.visible":!0,"shape3d.top.visible":!0,"shape3d.bottom.visible":!0,"shape3d.torus.radius":.17,"shape3d.resolution":0,"shape3d.blend":C,"shape3d.opacity":C,"shape3d.reverse.flip":!1,"shape3d.reverse.color":Mg,"shape3d.reverse.cull":!1,"shape3d.transparent":!1,"shape3d.uv.offset":C,"shape3d.uv.scale":C,"shape3d.top.uv.offset":C,"shape3d.top.uv.scale":C,"shape3d.bottom.uv.offset":C,"shape3d.bottom.uv.scale":C,"shape3d.from.uv.offset":C,"shape3d.from.uv.scale":C,"shape3d.to.uv.offset":C,"shape3d.to.uv.scale":C,"shape3d.top.cap":C,"shape3d.bottom.cap":C,"shape3d.start.angle":0,"shape3d.sweep.angle":w,"shape3d.point.epsilon":1e-6,"shape3d.discard.selectable":!0,"shape3d.top.discard.selectable":!0,"shape3d.bottom.discard.selectable":!0,"shape3d.from.discard.selectable":!0,"shape3d.to.discard.selectable":!0,"shape3d.scaleable":!0,"shape3d.autorotate":!1,"shape3d.fixSizeOnScreen":C,"shape3d.image.cache":!1,"shape3d.alwaysOnTop":!1,"all.light":!0,"all.visible":!0,"all.color":Qb,"all.image":C,"all.blend":C,"all.opacity":C,"all.reverse.flip":!1,"all.reverse.color":Mg,"all.reverse.cull":!1,"all.transparent":!1,"all.uv":C,"all.uv.offset":C,"all.uv.scale":C,"all.discard.selectable":!0,mat:C,"left.mat":C,"right.mat":C,"top.mat":C,"bottom.mat":C,"front.mat":C,"back.mat":C},!0);var Kb,Zh=!1,vn=[0,0,0,0],el={left:[1/255,0,0,1],right:[2/255,0,0,1],top:[3/255,0,0,1],bottom:[4/255,0,0,1],front:[5/255,0,0,1],back:[6/255,0,0,1],m:{1:ws,2:Hn,3:qs,4:rq,5:Bn,6:rg}},jd=function(G,d,j,E){if(d.getFaceVisible(G,j)){we(d,pc(G,d.getFaceMat(G,j)||d.getMat(G)));var f=d._26I;d.getFaceReverseCull(G,j)?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),rk(f,d._prg.uFixPickReverseColor,el[j]),Sj(f),hc(f,E,6),tk(f),Vm(d)}},Sk=function(e){return e instanceof Cd},$i=function(V){return[V.x,V.e||0,V.y]},$c=function(Y,g,p){for(var g=Fe(g),P=g[0],f=g[1],b=g[2];p--;)Y.push(P,f,b)},uf=function(l,n,x){for(var n=Fe(n),F=n[0],J=n[1],W=n[2],a=n[3];x--;)l.push(F,J,W,a)},Ze=function(C,p,c){if(p)for(var U,j,y,A=p[0],f=p[1],S=p[2],X=p[4],t=p[5],l=p[6],H=p[8],E=p[9],w=p[10],e=p[12],r=p[13],k=p[14],Q=c.length,o=0,o=0;Q>o;o+=3)U=c[o],j=c[o+1],y=c[o+2],C.push(A*U+X*j+H*y+e,f*U+t*j+E*y+r,S*U+l*j+w*y+k);else Rd(C,c)},xc=function(X,F){var Y=F.s("light.intensity"),V=Fe(F.s(kl)),L=V[0],g=V[1],A=V[2];1!==Y&&(L*=Y,g*=Y,A*=Y),X.push(L,g,A,F.s("light.disabled")?1:0)},vq=function(m,Q,U){rk(Q,U.uHeadlightRange,m._headlightRange);var x=m._headlightIntensity,F=Fe(m._headlightColor);1!==x&&(F=[F[0]*x,F[1]*x,F[2]*x]),rk(Q,U.uHeadlightColor,[F[0],F[1],F[2],m._headlightDisabled?1:0]);var k=m._59O,i=m._spots,b=m._dirs;if(k.length){var v=[],N=[],O=[];k.forEach(function(U){xc(v,U),Rd(N,m._transformPointToViewSpace(U.p3())),O.push(U.s("light.range"))}),Q.uniform4fv(U.uPointColor,v),Q.uniform1fv(U.uPointRange,O),Q.uniform3fv(U.uPointPosition,N)}if(i.length){var C=[],g=[],w=[],I=[],Z=[],M=[];i.forEach(function(n){xc(C,n),Rd(g,m._transformPointToViewSpace(n.p3())),Rd(Z,m._transformDirectionToViewSpace(n.p3(),n.s("light.center"))),w.push(n.s("light.range")),I.push(e(n.s("light.angle")/2)),M.push(n.s("light.exponent"))}),Q.uniform4fv(U.uSpotColor,C),Q.uniform1fv(U.uSpotRange,w),Q.uniform1fv(U.uSpotAngle,I),Q.uniform1fv(U.uSpotExponent,M),Q.uniform3fv(U.uSpotPosition,g),Q.uniform3fv(U.uSpotDirection,Z)}if(b.length){var G=[],t=[];b.forEach(function(o){xc(G,o),Rd(t,m._transformDirectionToViewSpace(o.p3()))}),Q.uniform4fv(U.uDirColor,G),Q.uniform3fv(U.uDirDirection,t)}},Ck=function(F){return F>0&&0===(F-1&F)},Xh=function(x){return x=D(0,f(F,x)),x=D(mr,f(F-mr,x))},qr=function(){return.05+v()/2},zb=function(B,w,Z,J){var H,o=B.getEye();return B.isOrtho()?(H=Nn(B.getCenter(),o),H[0]+=J[0],H[1]+=J[1],H[2]+=J[2]):H=o,nm(w,Z,J,H)},nm=function(j,H,r,$){var E=Ld(j,H),b=Nn($,r,!0),Y=Ld(b,H);if(M(Y)<mr)return V;var G=(E-Ld(r,H))/Y;return[r[0]+b[0]*G,r[1]+b[1]*G,r[2]+b[2]*G]},_i=function(t,h){return{x:2*t.x-h.x,y:2*t.y-h.y}},wo=function(y,o,v,w){var u,k;if(!y)return u=s(o.y-v.y,v.x-o.x),{x:o.x+w*U(u),y:o.y+w*e(u)};if(!v)return u=s(y.y-o.y,o.x-y.x),{x:o.x+w*U(u),y:o.y+w*e(u)};var t=Nn([y.x,y.y,0],[o.x,o.y,0],!0),I=Nn([v.x,v.y,0],[o.x,o.y,0],!0),O=-(t[0]+I[0])/2,K=-(t[1]+I[1])/2,c=Y(O*O+K*K);if(mr>c)return u=s(y.y-o.y,o.x-y.x),{x:o.x+w*U(u),y:o.y+w*e(u)};var P=y.x-o.x,G=y.y-o.y,J=v.x-o.x,S=v.y-o.y,f=Y(P*P+G*G),z=Y(J*J+S*S);u=q(Ld(t,I))/2,k=t[1]*I[0]-t[0]*I[1]>0?-1:1,O/=c,K/=c;var E=w/U(u),R=D(f,z)/e(u);c=Math.min(E,R);var X={x:o.x+k*c*O,y:o.y+k*c*K};return v.b&&E>z/e(u)&&(X.adjust=!0),X},md=function(i){var Z=i[1],T=i[2],P=i[3],z=i[6],t=i[7],h=i[11];i[1]=i[4],i[2]=i[8],i[3]=i[12],i[4]=Z,i[6]=i[9],i[7]=i[13],i[8]=T,i[9]=z,i[11]=i[14],i[12]=P,i[13]=t,i[14]=h},un=function(Z){var h=Z[0],J=Z[1],Y=Z[2],x=Z[3],b=Z[4],y=Z[5],W=Z[6],u=Z[7],m=Z[8],K=Z[9],G=Z[10],Q=Z[11],T=Z[12],j=Z[13],P=Z[14],F=Z[15],o=h*y-J*b,z=h*W-Y*b,R=h*u-x*b,I=J*W-Y*y,U=J*u-x*y,S=Y*u-x*W,O=m*j-K*T,C=m*P-G*T,f=m*F-Q*T,q=K*P-G*j,c=K*F-Q*j,H=G*F-Q*P,r=o*H-z*c+R*q+I*f-U*C+S*O;return r?(r=1/r,Z[0]=(y*H-W*c+u*q)*r,Z[1]=(Y*c-J*H-x*q)*r,Z[2]=(j*S-P*U+F*I)*r,Z[3]=(G*U-K*S-Q*I)*r,Z[4]=(W*f-b*H-u*C)*r,Z[5]=(h*H-Y*f+x*C)*r,Z[6]=(P*R-T*S-F*z)*r,Z[7]=(m*S-G*R+Q*z)*r,Z[8]=(b*c-y*f+u*O)*r,Z[9]=(J*f-h*c-x*O)*r,Z[10]=(T*U-j*R+F*o)*r,Z[11]=(K*R-m*U-Q*o)*r,Z[12]=(y*C-b*q-W*O)*r,Z[13]=(h*q-J*C+Y*O)*r,Z[14]=(j*z-T*I-P*o)*r,Z[15]=(m*I-K*z+G*o)*r,void 0):V},Xl=function(N,k){if(k){var y=k[0],f=k[1],U=k[2];N[12]=N[0]*y+N[4]*f+N[8]*U+N[12],N[13]=N[1]*y+N[5]*f+N[9]*U+N[13],N[14]=N[2]*y+N[6]*f+N[10]*U+N[14],N[15]=N[3]*y+N[7]*f+N[11]*U+N[15]}},Dr=function(Q,A){if(A){var v=A[0],I=A[1],N=A[2];Q[0]=Q[0]*v,Q[1]=Q[1]*v,Q[2]=Q[2]*v,Q[3]=Q[3]*v,Q[4]=Q[4]*I,Q[5]=Q[5]*I,Q[6]=Q[6]*I,Q[7]=Q[7]*I,Q[8]=Q[8]*N,Q[9]=Q[9]*N,Q[10]=Q[10]*N,Q[11]=Q[11]*N}},pb=function(h,q,P){var w=q[0],x=q[1],G=q[2],B=q[3],v=q[4],K=q[5],H=q[6],l=q[7],Z=q[8],m=q[9],W=q[10],V=q[11],c=q[12],N=q[13],p=q[14],O=q[15],E=P[0],r=P[1],a=P[2],R=P[3];return h[0]=E*w+r*v+a*Z+R*c,h[1]=E*x+r*K+a*m+R*N,h[2]=E*G+r*H+a*W+R*p,h[3]=E*B+r*l+a*V+R*O,E=P[4],r=P[5],a=P[6],R=P[7],h[4]=E*w+r*v+a*Z+R*c,h[5]=E*x+r*K+a*m+R*N,h[6]=E*G+r*H+a*W+R*p,h[7]=E*B+r*l+a*V+R*O,E=P[8],r=P[9],a=P[10],R=P[11],h[8]=E*w+r*v+a*Z+R*c,h[9]=E*x+r*K+a*m+R*N,h[10]=E*G+r*H+a*W+R*p,h[11]=E*B+r*l+a*V+R*O,E=P[12],r=P[13],a=P[14],R=P[15],h[12]=E*w+r*v+a*Z+R*c,h[13]=E*x+r*K+a*m+R*N,h[14]=E*G+r*H+a*W+R*p,h[15]=E*B+r*l+a*V+R*O,h},zs=function(f,y,u,C){var J,c,N,R,O,X,g,B,r,w,z=y[0],s=y[1],t=y[2],k=C[0],_=C[1],D=C[2],v=u[0],d=u[1],i=u[2];return M(z-v)<mr&&M(s-d)<mr&&M(t-i)<mr?Qo(f):(g=z-v,B=s-d,r=t-i,w=1/Y(g*g+B*B+r*r),g*=w,B*=w,r*=w,J=_*r-D*B,c=D*g-k*r,N=k*B-_*g,w=Y(J*J+c*c+N*N),w?(w=1/w,J*=w,c*=w,N*=w):(J=0,c=0,N=0),R=B*N-r*c,O=r*J-g*N,X=g*c-B*J,w=Y(R*R+O*O+X*X),w?(w=1/w,R*=w,O*=w,X*=w):(R=0,O=0,X=0),f[0]=J,f[1]=R,f[2]=g,f[3]=0,f[4]=c,f[5]=O,f[6]=B,f[7]=0,f[8]=N,f[9]=X,f[10]=r,f[11]=0,f[12]=-(J*z+c*s+N*t),f[13]=-(R*z+O*s+X*t),f[14]=-(g*z+B*s+r*t),f[15]=1,f)},ud=function(A,w,v,P,R){var s=1/I(w/2),L=1/(P-R);return A[0]=s/v,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=s,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=(R+P)*L,A[11]=-1,A[12]=0,A[13]=0,A[14]=2*R*P*L,A[15]=0,A},wp=function(X,q,v,F,I,x,R){var f=1/(q-v),p=1/(F-I),J=1/(x-R);return X[0]=-2*f,X[1]=0,X[2]=0,X[3]=0,X[4]=0,X[5]=-2*p,X[6]=0,X[7]=0,X[8]=0,X[9]=0,X[10]=2*J,X[11]=0,X[12]=(q+v)*f,X[13]=(I+F)*p,X[14]=(R+x)*J,X[15]=1,X},Eq=function(i,N){var x=N[0],t=N[1],g=N[2],z=N[3],S=x*x+t*t+g*g+z*z,q=S?1/S:0;return i[0]=-x*q,i[1]=-t*q,i[2]=-g*q,i[3]=z*q,i},yp=function(F,w){var j=w[0]+w[5]+w[10],i=0;return j>0?(i=2*Math.sqrt(j+1),F[3]=.25*i,F[0]=(w[6]-w[9])/i,F[1]=(w[8]-w[2])/i,F[2]=(w[1]-w[4])/i):w[0]>w[5]&w[0]>w[10]?(i=2*Math.sqrt(1+w[0]-w[5]-w[10]),F[3]=(w[6]-w[9])/i,F[0]=.25*i,F[1]=(w[1]+w[4])/i,F[2]=(w[8]+w[2])/i):w[5]>w[10]?(i=2*Math.sqrt(1+w[5]-w[0]-w[10]),F[3]=(w[8]-w[2])/i,F[0]=(w[1]+w[4])/i,F[1]=.25*i,F[2]=(w[6]+w[9])/i):(i=2*Math.sqrt(1+w[10]-w[0]-w[5]),F[3]=(w[1]-w[4])/i,F[0]=(w[8]+w[2])/i,F[1]=(w[6]+w[9])/i,F[2]=.25*i),F},Wn=function(T,r,S){var A=r[0],q=r[1],m=r[2],x=r[3],C=A+A,H=q+q,d=m+m,i=A*C,U=A*H,N=A*d,j=q*H,G=q*d,_=m*d,$=x*C,e=x*H,v=x*d;return T[0]=1-(j+_),T[1]=U+v,T[2]=N-e,T[3]=0,T[4]=U-v,T[5]=1-(i+_),T[6]=G+$,T[7]=0,T[8]=N+e,T[9]=G-$,T[10]=1-(i+j),T[11]=0,T[12]=S[0],T[13]=S[1],T[14]=S[2],T[15]=1,T},Bl=function(p,K){if(p.vr.enable){var Q=p.vr.getViewMatrix(K);if(Q)return Q}return zs(K?K:Yq(),p._eye,p._center,p._up)},sj=function(y,z){if(y.vr.enable){var p=y.vr.getProjectMatrix();if(p)return p}if(!z&&y._computedProjectMatrix)return ko(y._computedProjectMatrix);var Q=y.getAspect(),H=y._near,j=y._far,u=Yq();if(y._ortho){var x=y._orthoWidth/2,b=x/Q;wp(u,-x,x,-b,b,H,j)}else ud(u,y._fovy,Q,H,j);return u},Hp=function(S,s){if(!S)return V;var v=0,N=1,C=2,b=[],h=0,M=S.length,G=M/3;if(s){for(;M>h;h++)b[h]=0;for(h=0;h<s.length;h+=3){var c=[],t=[],$=[];c[v]=S[3*s[h+1]+v]-S[3*s[h]+v],c[N]=S[3*s[h+1]+N]-S[3*s[h]+N],c[C]=S[3*s[h+1]+C]-S[3*s[h]+C],t[v]=S[3*s[h+2]+v]-S[3*s[h+1]+v],t[N]=S[3*s[h+2]+N]-S[3*s[h+1]+N],t[C]=S[3*s[h+2]+C]-S[3*s[h+1]+C],$[v]=c[N]*t[C]-c[C]*t[N],$[N]=c[C]*t[v]-c[v]*t[C],$[C]=c[v]*t[N]-c[N]*t[v];for(var f=0;3>f;f++)b[3*s[h+f]+v]+=$[v],b[3*s[h+f]+N]+=$[N],b[3*s[h+f]+C]+=$[C]}}else for(h=0;G>h;h+=3){var c=[],t=[],$=[];c[v]=S[3*(h+1)+v]-S[3*h+v],c[N]=S[3*(h+1)+N]-S[3*h+N],c[C]=S[3*(h+1)+C]-S[3*h+C],t[v]=S[3*(h+2)+v]-S[3*(h+1)+v],t[N]=S[3*(h+2)+N]-S[3*(h+1)+N],t[C]=S[3*(h+2)+C]-S[3*(h+1)+C],$[v]=c[N]*t[C]-c[C]*t[N],$[N]=c[C]*t[v]-c[v]*t[C],$[C]=c[v]*t[N]-c[N]*t[v];for(var f=0;3>f;f++)b[3*(h+f)+v]=$[v],b[3*(h+f)+N]=$[N],b[3*(h+f)+C]=$[C]}for(h=0;M>h;h+=3){var z=[];z[v]=b[h+v],z[N]=b[h+N],z[C]=b[h+C];var k=Y(z[v]*z[v]+z[N]*z[N]+z[C]*z[C]);0===k&&(k=mr),z[v]=z[v]/k,z[N]=z[N]/k,z[C]=z[C]/k,b[h+v]=z[v],b[h+N]=z[N],b[h+C]=z[C]}return new Nb(b)},pr=function(W,x,H,p){if(H||(H=W.createTexture()),x){var h=W.TEXTURE_2D,Y=W.REPEAT,T=W.CLAMP_TO_EDGE,Q=W.TEXTURE_MIN_FILTER;p!==W.NEAREST&&(p=W.LINEAR),an(W,H),W.texImage2D(h,0,W.RGBA,W.RGBA,W.UNSIGNED_BYTE,x),yo(W,W.TEXTURE_MAG_FILTER,p);var $=x.naturalWidth||x.width,B=x.naturalHeight||x.height;Ck($)&&Ck(B)&&!x.clampToEdge?(yo(W,W.TEXTURE_WRAP_S,Y),yo(W,W.TEXTURE_WRAP_T,Y),yo(W,Q,W.LINEAR_MIPMAP_LINEAR),W.generateMipmap(h)):(yo(W,W.TEXTURE_WRAP_S,T),yo(W,W.TEXTURE_WRAP_T,T),yo(W,Q,p)),an(W,V)}return H},ks=function(S,w){var c=new Uint8Array(4);return w=w||S.createTexture(),an(S,w),yo(S,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texImage2D(S.TEXTURE_2D,0,S.RGBA,1,1,0,S.RGBA,S.UNSIGNED_BYTE,c),w},hm=function(Q){Q._26I&&Q._prg&&(Q._26I.deleteProgram(Q._prg),Q._prg=V)},Ee=function(I,R,r,Y){var N=I.createShader(r);return I.shaderSource(N,Y),I.compileShader(N),I.attachShader(R,N),N},xe=function(v){return v.createBuffer()},an=function(W,w){W.bindTexture(W.TEXTURE_2D,w)},yo=function(o,T,d){o.texParameteri(o.TEXTURE_2D,T,d)},Cj=function(P,N){P.enable(P.POLYGON_OFFSET_FILL),P.polygonOffset(N[0],N[1])},Wb=function(x){x.disable(x.POLYGON_OFFSET_FILL)},vp=function(x,G){if(G){var G=Fe(G);x.clearColor(G[0],G[1],G[2],G[3])}},kg=function(h,z){rk(h,z.uFix,!0),Nf(h,z.aNormal)},Rp=function(q,C){rk(q,C.uFix,!1),os(q,C.aNormal)},Jm=function(X,P,j,f,g,x,O,E){X._picking||(j?(rk(X,P.uBlend,!0),rk(X,P.uBlendColor,j)):rk(X,P.uBlend,!1),rk(X,P.uLight,f==V?!0:f),Mj(g)&&1!==g&&rk(X,P.uPartOpacity,g),rk(X,P.uReverseFlip,x==V?!1:x),rk(X,P.uFixPickReverseColor,O||Mg)),E?X.enable(X.CULL_FACE):X.disable(X.CULL_FACE)},Mc=function(e,d){e._picking||rk(e,d.uPartOpacity,1)},Sj=function(){var f=[0,0,1,1];return function(D,M,Y,Z,c,s,O,e,K){return Y?(rk(D,M.uTexture,!0),rk(D,M.uDiscardSelectable,Hm(Z)?Z:!0),os(D,M.aUv),es(D,c,s,M.aUv,2),K?(rk(D,M.uBlendTexture,!0),D.activeTexture(D.TEXTURE1),an(D,K),D.uniform1i(M.uBlendSampler,1)):(rk(D,M.uBlendTexture,!1),D.activeTexture(D.TEXTURE1),an(D,D._emptyBlendTexture)),D.activeTexture(D.TEXTURE0),an(D,Y),D.uniform1i(M.uSampler,0),O?(f[0]=O[0],f[1]=O[1]):(f[0]=0,f[1]=0),e?(f[2]=e[0],f[3]=e[1]):(f[2]=1,f[3]=1),rk(D,M.uOffsetScale,f),void 0):(D.activeTexture(D.TEXTURE0),an(D,D._emptyTexture),D.activeTexture(D.TEXTURE1),an(D,D._emptyBlendTexture),void 0)}}(),tk=function(C,t,I){C.activeTexture(C.TEXTURE0),an(C,V),C.activeTexture(C.TEXTURE1),an(C,V),I&&(Nf(C,t.aUv),rk(C,t.uTexture,!1),rk(C,t.uBlendTexture,!1))},Ff=function(n,l,N,D,A,u){!N||Jk||ai||n.lineWidth(N),D&&!n._picking&&rk(n,l.uFixPickReverseColor,D),A&&es(n,A,u,l.aPosition)},Hj=function(m,p,u,k){Kb&&(k=m[Kb]),m.drawArrays(k==V?m.TRIANGLES:k,p,u);var A=m._renderInfo;A&&(A.calls++,A.vertices+=u,(k==V||k===m.TRIANGLES)&&(A.faces+=u/3),k===m.LINES&&(A.lines+=u/2))},hc=function(g,E,N,J){Kb&&(J=g[Kb]),g.drawElements(J==V?g.TRIANGLES:J,N,g.UNSIGNED_SHORT,E==V?0:2*E);var j=g._renderInfo;j&&(j.calls++,j.vertices+=N,(J==V||J===g.TRIANGLES)&&(j.faces+=N/3),J===g.LINES&&(j.lines+=N/2))},fk=function(C,Z,$,A,K){var P=C.ARRAY_BUFFER;C.bindBuffer(P,Z),$&&C.bufferData(P,$,C.STATIC_DRAW),A!=V&&C.vertexAttribPointer(A,K?K:3,C.FLOAT,!1,0,0)},es=function(t,f,B,j,e){return B?(Mi(t,t.ARRAY_BUFFER,f,B),j!=V&&t.vertexAttribPointer(j,e?e:3,t.FLOAT,!1,0,0),void 0):fk(t,f,B,j,e)},ak=function(A,Y,D){var g=A.ELEMENT_ARRAY_BUFFER;A.bindBuffer(g,Y),D&&A.bufferData(g,D,A.STATIC_DRAW)},yb=function(k,T,W){Mi(k,k.ELEMENT_ARRAY_BUFFER,T,W)},Mi=function(I,E,U,r){var X=r._bufId;X||(X=r._bufId=k.Math.generateIncreasingID());var U,s=I._bufPool;(U=s[X])&&U._buf?I.bindBuffer(E,U._buf):(U=s[X]={_buf:xe(I)},I.bindBuffer(E,U._buf),I.bufferData(E,r,I.STATIC_DRAW)),U._fid=I._renderInfo.frame},rk=function(U,K,I){if(I!=V&&K!=V){I=Fe(I);var Q=I.length;3===Q?U.uniform3fv(K,I):4===Q?U.uniform4fv(K,I):16===Q?U.uniformMatrix4fv(K,!1,I):Hm(I)?U.uniform1i(K,I?1:0):2===Q?U.uniform2fv(K,I):U.uniform1f(K,I)}},os=function(X,b){b!=V&&b>=0&&X.enableVertexAttribArray(b)},Nf=function(R,Z){Z!=V&&Z>=0&&R.disableVertexAttribArray(Z)},Vm=function(K,G){var h=K.getGL(),Y=K._prg;K._7O=K._8O.pop(),G&&(rk(h,Y.uMVMatrix,K._7O),K._6O=G,rk(h,Y.uNMatrix,G))},or=function(a,Z){return Z||(Z=Yq()),kn(Z,a),un(Z),md(Z),Z},we=function(b,L){var q=b.getGL(),H=b._prg,Q=b._7O;L&&(b._8O.push(ko(Q)),rk(q,H.uMMatrix,L),pb(Q,Q,L),b._7O=Q),rk(q,H.uMVMatrix,Q),rk(q,H.uNMatrix,or(Q,b._6O))},im=function(H,j,o,P,a,u){if(o){if(P){var S=o.value++,h=2147483648|S,$=[(255&h>>16)/255,(255&h>>8)/255,(255&h)/255,(255&h>>24)/255];o[S]={data:a,part:u}}else $=vn;return rk(H,j.uFixPickReverseColor,$),$}},ug=function(){var u={center:function(w,j,V,y,A){var u=-j[1]/2,X={x:-j[0]/2,y:u,width:j[0],height:j[1]},M=Lp(w,X,V);return[M.x+y,-M.y-A,qr()]},front:function(J,s,f,k,V){var h=-s[1]/2,B={x:-s[0]/2,y:h,width:s[0],height:s[1]},Y=Lp(J,B,f);return[Y.x+k,-Y.y-V,s[2]/2+qr()]},back:function(A,$,D,n,o){var t=-$[0]/2,N=-$[1]/2,x={x:t,y:N,width:$[0],height:$[1]},V=Lp(A,x,D);return[-V.x-n,-V.y-o,-$[2]/2-qr()]},left:function(A,n,o,_,J){var T=-n[1]/2,P={x:-n[2]/2,y:T,width:n[2],height:n[1]},Q=Lp(A,P,o);return[-n[0]/2-qr(),-Q.y-J,Q.x+_]},right:function(Q,B,Z,j,k){var y=-B[2]/2,i=-B[1]/2,E={x:y,y:i,width:B[2],height:B[1]},s=Lp(Q,E,Z);return[B[0]/2+qr(),-s.y-k,-s.x-j]},top:function(W,Q,I,A,y){var h={x:-Q[0]/2,y:-Q[2]/2,width:Q[0],height:Q[2]},b=Lp(W,h,I);return[b.x+A,Q[1]/2+qr(),b.y+y]},bottom:function(p,x,w,K,C){var O=-x[2]/2,j={x:-x[0]/2,y:O,width:x[0],height:x[2]},H=Lp(p,j,w);return[H.x+K,-x[1]/2-qr(),-H.y-C]}};return function(L,r,A,e,$,n){return u[e](L,r,A,$||0,n||0)}}(),kj=function(B,$,x,w,e,_,c,d,u,O){if(e&&($[0]+=e[0],$[1]+=e[1],$[2]+=e[2]),Xl(B,x),d){var Z=Yq();if(Mp(Z,u,O),Qf($,Z),Xl(B,$),B.auto=d,B.pos=Qf([0,0,0],B),_){var W=B.mat2=Yq();Mp(W,_,c)}}else Mp(B,u,O),Xl(B,$),w===ws?Pn(B,-X):w===Hn?Pn(B,X):w===qs?Ek(B,-X):w===rq?Ek(B,X):w===rg&&Pn(B,F),Mp(B,_,c);return B},ro=function(n,f){var t=f.auto,r=f.mat2,C=n.gv;if(t){var b,V=Yq(),c=[0,0,0,0];b="string"==typeof t?[t.indexOf("x")<0?C._eye[0]:C._center[0],t.indexOf("y")<0?C._eye[1]:C._center[1],t.indexOf("z")<0?C._eye[2]:C._center[2]]:C._eye,yp(c,zs(Yq(),b,C._center,C._up)),Wn(V,Eq(c,c),f.pos),r&&pb(V,V,r),we(C,V)}else we(C,f)},Gm=function($,Y,A,c,u){var O=$.s,y=$.gv,B=y.getGL(),V=y._prg,s=y._buffer,d=y._1O;pr(B,ub,d),ro($,A),Jm(B,V,O(Y+".blend"),O(Y+".light"),O(Y+".opacity"),O(Y+".reverse.flip"),O(Y+".reverse.color"),O(Y+".reverse.cull")),Sj(B,V,d,u,s.uv,ke),es(B,s.vs,c,V.aPosition),es(B,s.ns,Ye,V.aNormal),yb(B,s.is,tn),hc(B,0,tn.length),tk(B,V,d),Mc(B,V),Vm(y)},pe=function(v,L,m){var z=v.gv,b=v.data,g=v[L]={blend:z.getBodyColor(b)||z.getFaceBlend(b,L),light:z.getFaceLight(b,L),color:z.getFaceColor(b,L),opacity:z.getFaceOpacity(b,L),transparent:z.getFaceTransparent(b,L),reverseFlip:z.getFaceReverseFlip(b,L),reverseColor:z.getFaceReverseColor(b,L),reverseCull:z.getFaceReverseCull(b,L),texture:z.getFaceImage(b,L),blendTexture:z.getFaceBlendImage(b,L),discardSelectable:z.getFaceDiscardSelectable(b,L)};if("csg"!==L){g.uv=z.getFaceUv(b,L)||m&&m[L+"Uv"],g.uvScale=z.getFaceUvScale(b,L)||m&&m[L+"UvScale"],g.uvOffset=z.getFaceUvOffset(b,L)||m&&m[L+"UvOffset"];var e=z.getFaceMat(b,L);e&&(g.mat=pc(b,e))}return g},gg=function(z,E,Z,F,k){if(F){if(!k(F.transparent))return;var c=z.data,v=z.gv,C=v._buffer,d=v.getTexture(F.texture,c),j=v.getTexture(F.blendTexture,c);Sj(E,Z,d,F.discardSelectable,C.uv,F.tuv,F.uvOffset,F.uvScale,j),Jm(E,Z,F.blend,F.light,F.opacity,F.reverseFlip,F.reverseColor,F.reverseCull),rk(E,Z.uDiffuse,F.color||g["color.empty"]),es(E,C.vs,F.vs,Z.aPosition),es(E,C.ns,F.ns,Z.aNormal),Hj(E,0,F.vs.length/3),Mc(E,Z),tk(E,Z,d)}},dh=function(g,l,L,U,Q,M){var B,h,e,$,A,X,r,O,F,q,j,d=[U-l,Q-L],V=g?g.length:0;for(e=0;V>e;e++){for($=2,B=g[e],A=B[0],X=B[1];$+1<B.length;){if(r=B[$],O=B[$+1],h=Jc(l,L,U,Q,A,X,r,O,!0)){F=[r-A,O-X],q=_e(F),F[0]/=q,F[1]/=q,q=Ld(d,F),q=q>0?M:-M,j=[F[0]*q,F[1]*q];break}A=r,X=O,$+=2}if(j)break}if(j)for(U=l+j[0],Q=L+j[1],e=0;V>e;e++)for($=2,B=g[e],A=B[0],X=B[1];$+1<B.length;){if(r=B[$],O=B[$+1],h=Jc(l,L,U,Q,A,X,r,O,!0))return[0,0];A=r,X=O,$+=2}return j?j:[U-l,Q-L]},Yf=k.graph3d={},Cg=function($,m,G){Ir(N+".graph3d."+$,m,G)},wn="~<yfusfw!+!yjsubNQv!>!opjujtpQ`mh!gjeof$!~<fdobutjEfojMb!>!fdobutjEfojMw|*itbEv)gj!ITBE!gfegj$!!gjeof$!~<ttfouihjsCidubCb!>!ttfouihjsCidubCw|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!~<eofmCidubCb!>!eofmCidubCw|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!!gjeof$!~<spmpDidubCb!>!spmpDidubCw|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!~<wVb!>!wVs|*fsvuyfUeofmCv)gj~<x{/fmbdTuftggPv!+!wVb!,!zy/fmbdTuftggPv!>!wVw|*fsvuyfUv)gj~<**1/2!-opjujtpQb)5dfw!+!yjsubNNv)4dfw!>!emspXw<*yfusfw)4dfw!>!yfusfWw<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw|*ldjQva!%%!yjGva)gj<*1/2!-opjujtpQb)5dfw!+!yjsubNWNv!>!yfusfw!5dfw|!*ejpw)ojbn!ejpw!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEfojMb!ubpmg!fuvcjsuub<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCb!4dfw!fuvcjsuub<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCb!ubpmg!fuvcjsuub<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCb!5dfw!fuvcjsuub<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<emspXw!4dfw!hojzsbw<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<yjGv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjsubNxfjWv!5ubn!nspgjov<yjsubNOv!5ubn!nspgjov<yjsubNQv!5ubn!nspgjov<yjsubNNv!5ubn!nspgjov<yjsubNWNv!5ubn!nspgjov<opjujtpQb!4dfw!fuvcjsuub<mbnspOb!4dfw!fuvcjsuub<wVs!3dfw!hojzsbw<wVw!3dfw!hojzsbw<wVb!3dfw!fuvcjsuub<fmbdTuftggPv!5dfw!nspgjov<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov!YJGFSQ^#CBRBEJxTT87hJFI,,bX1XrIwcn3UM{ZeZ,M6HEN6nLxe2Z72s2:3johr6foKrpqwxNKYkdbJ2CN[mBbf[wXU,T0oGuSEd190ohLZkEn8IuCe[OHoWeKz:Sf,VS7xdSLw23W1YJLU:jdv2{hiDbhDzNNEh9tp3xsuEp94Sl4c3wRzqwShMDRhCLRjCDEBOH5BBVRBCFRE4cJTHrTDH1BNgHJN",Cr="~~<eJ!>!spmpDhbsG`mh~<spmpDsfmqnbTwv!>+!eJ<*wVs!-sfmqnbTeofmCv)E3fsvuyfu!>!spmpDsfmqnbTwv!5dfw|!*fsvuyfUeofmCv)!gj!!gjeof$!~<ttfouihjsCidubCw!>+!chs/eJ!!!|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!~<ttfouihjsCv!>+!chs/eJ!!!|*1/2!>a!ttfouihjsCv)gj~~<zujdbqPusbQv!>+!b/eJ!!!|*1/2!>a!zujdbqPusbQv)gj~!gjeof$!~<zujwjudfmgfSv!+!{zy/spmpDwof!>,!chs/eJ<*!spmpDwof!)sbfojMpUmfyfUqbNwof!>!spmpDwof<*!*!{z/dfWudfmgfs!-y/dfWudfmgfs)4dfw!-qbNwoFv!)fcvDfsvuyfu!>!spmpDwof!5dfw<*!mbnspOemspx!-yfusfWpUbsfnbd!)udfmgfs!>!dfWudfmgfs!4dfw<*!yjsubNxfjWv!-O!)opjudfsjEnspgtobsUftsfwoj!>!mbnspOemspx!4dfw<*!opjujtpQbsfnbDv!.!emspXw!)f{jmbnspo!>!yfusfWpUbsfnbd!4dfw|*qbNwoFftVv)!gj!QBNWOF`FTV!gfegj$!!gjeof$!<*spudbGhpg!-*x/eJ!-chs/spmpDhpGv)5dfw!-eJ)yjn!>!eJ<*iuqfe!-sbGhpGv!-sbfOhpGv)qfutiuppnt!>!spudbGhpg!ubpmg<x/esppDhbsG`mh0{/esppDhbsG`mh!>!iuqfe!ubpmg!HPG!gfegj$!!gjeof$!~~~~<chs/^j]spmpDupqTv!+!udfggFupqt!+!fhobSm!+!*1/1!-*mbnspOm.!-O)upe)ybn!>,!chs/eJ<*1/1!-*^j]uofopqyFupqTv!-udfggFupqt)xpq)ybn!>!udfggFupqt|*^j]fmhoBupqTv!?!udfggFupqt)gj<*mbnspOm!-^j]opjudfsjEupqTv)upe!>!udfggFupqt!ubpmg<*spudfWm)f{jmbnspo!>!mbnspOm!4dfw|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSupqTv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSupqTv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQupqTv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDupqTv)gj|!*,,j!<UPQT`YBN!=!j!<1>j!uoj)spg!1!?!UPQT`YBN!gj$!!gjeof$!~~~<chs/^j]spmpDuojpQv!+!fhobSm!+!*1/1!-**spudfWm)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSuojpQv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSuojpQv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQuojpQv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDuojpQv)gj|!*,,j!<UOJPQ`YBN!=!j!<1>j!uoj)spg!1!?!UOJPQ`YBN!gj$!!gjeof$!~~<chs/^j]spmpDsjEv!+!*1/1!-**^j]opjudfsjEsjEv)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!>>!x/^j]spmpDsjEv)gj|!*,,j!<SJE`YBN!=!j!<1>j!uoj)spg!1!?!SJE`YBN!gj$!~<chs/spmpDuihjmebfIv!+!nsfUusfcnbm!>+!chs/eJ~<*1/2!-fhobSuihjmebfIv0*yfusfWw)iuhofm)ojn!.!1/2!!>+!nsfUusfcnbm|*1/1!?!fhobSuihjmebfIv)gj<*1/1!-6/1!,!6/1!+!*M.!-O)upe)ybn!>!nsfUusfcnbm!ubpmg|*1/1!>>!x/spmpDuihjmebfIv)gj|*uihjMv)gj~!gjeof$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf~<eofmCidubCw!>+!chs/eJ|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!~~<esbdtje|*1/1!>>!x/eJ)gj!gjeof$!<ftvggjEv!>!eJ!ftmf$!~<ftvggjEv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|ftmf~<spmpDwv!>!eJ|*fsvuyfUv)gj|!ftmf~<spmpDftsfwfSldjQyjGv!>!eJ|*qjmGftsfwfSva!%%!ldbCtj)gj~<fvsu!>!ldbCtj<O.!>!O|*1/1!=!*O!-F)upe)gj<ftmbg!>!ldbCtj!mppc<F.!>!M!4dfw!gjeof$!<*yfusfWw.)f{jmbnspo!>!F!4dfw!ftmf$!<*2!-1!-1)4dfw!>!F!4dfw!DJIQBSHPIUSP!gfegj$!<*mbnspOw)f{jmbnspo!>!O!4dfw|!ftmf~!gjeof$!~~<ftvggjEv!>!eJ|ftmf~<esbdtje|*1/1!>>!x/ftvggjEv)gj|!*!fdobutjEitbEv!?!*!fdobutjEqbHitbEv!-fdobutjEfojMw!)epn!%%!itbEv)!gj!ITBE!gfegj$!!gjeof$!<spmpDftsfwfSldjQyjGv!>!eJ!ftmf$!~<spmpDftsfwfSldjQyjGv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*yjGv)gj<eJ!5dfw|ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDhbsG`mh)!gj!gjeof$!<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh!ftmf$!~<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh|ftmf~<spmpDidubCw!>!spmpDhbsG`mh|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*ldjQv)gj~~~!<esbdtje!|!*utfUbiqmBv!>=!b/spmpDwv)!gj!!!!|!ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDwv)!gj!!!!|!*uofsbqtobsUv)!gj<*wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv|**fmcbudfmfTesbdtjEv!%%!ldjQv)a!%%!fsvuyfUv)gj<spmpDwv!5dfw|!*ejpw)ojbn!ejpw~<*!{zy/*!yjsubn!+!*!1/1!-sje!)5dfw!)!)f{jmbnspo!osvufs|!*!yjsubn!5ubn!oj!-sje!4dfw!oj!)opjudfsjEnspgtobsUftsfwoj!4dfw~!<*!*!SPUDBG`BNNBH!)ubpmg!-fvmbw!)sbfojMpUbnnbH!osvufs!|!*!fvmbw!5dfw!)sbfojMpUmfyfUqbNwof!5dfw~<*!x/fvmbw!-*!*!spudbGbnnbh!)4dfw!-{zy/fvmbw!)xpq!)5dfw!osvufs|!*!spudbGbnnbh!ubpmg!oj!-fvmbw!5dfw!oj!)sbfojMpUbnnbH!5dfw<1/3!>!SPUDBG`BNNBH!ubpmg!utopd!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEqbHitbEv!ubpmg!nspgjov<fdobutjEitbEv!ubpmg!nspgjov<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<sbGhpGv!ubpmg!nspgjov<sbfOhpGv!ubpmg!nspgjov<spmpDhpGv!5dfw!nspgjov!HPG!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]fhobSupqTv!ubpmg!nspgjov<^UPQT`YBN]fmhoBupqTv!ubpmg!nspgjov<^UPQT`YBN]uofopqyFupqTv!ubpmg!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]fhobSuojpQv!ubpmg!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<spmpDuihjmebfIv!5dfw!nspgjov<fhobSuihjmebfIv!ubpmg!nspgjov<emspXw!4dfw!hojzsbw<opjujtpQbsfnbDv!4dfw!nspgjov<yjsubNxfjWv!5ubn!nspgjov!gjeof$!<zujwjudfmgfSv!ubpmg!nspgjov<qbNwoFv!fcvDsfmqnbt!nspgjov<qbNwoFftVv!mppc!nspgjov!QBNWOF`FTV!gfegj$!<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<ftvggjEv!5dfw!nspgjov<zujdbqPusbQv!ubpmg!nspgjov<ttfouihjsCv!ubpmg!nspgjov<uihjMv!mppc!nspgjov<spmpDeofmCv!5dfw!nspgjov<eofmCv!mppc!nspgjov<wVs!3dfw!hojzsbw<sfmqnbTeofmCv!E3sfmqnbt!nspgjov<sfmqnbTv!E3sfmqnbt!nspgjov<wVw!3dfw!hojzsbw<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov<uofsbqtobsUv!mppc!nspgjov<utfUbiqmBv!ubpmg!nspgjov<spmpDftsfwfSldjQyjGv!5dfw!nspgjov<qjmGftsfwfSv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjGv!mppc!nspgjov<fmcbudfmfTesbdtjEv!mppc!nspgjov!YJGFSQ!gjeof$!!gjeof$!!<ubpmg!qnvjefn!opjtjdfsq!!ftmf$!!<ubpmg!qihji!opjtjdfsq!!IHJI`OPJTJDFSQ`UOFNHBSG`MH!gfegj$!!TF`MH!gfegj$!";dc(m,{setBatchInfo:function(s,q){Ng[s]=q},getBatchInfo:function(b){return Ng[b]}},!0);var Cp=[1,1,1],Oi=[1,0,0,0,0,1,0,1,1,1,1,0],oe=[-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5],Kc=[.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5],wj=[.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5],$j=[.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5],aj=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5],yg=[-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5],ek=function(r,q){Vq(r,q,"_batchModelMap","_batchIndexMap"),Lc(r,q,"_wireframeModelMap","_wireframeIndexMap"),Lc(r,q,"_polylineModelMap","_polylineIndexMap"),Lc(r,q,"_wireframeModelMapSwap","_wireframeIndexMapSwap"),Lc(r,q,"_polylineModelMapSwap","_polylineIndexMapSwap")},Vq=function(M,q,h,o){if(!q)return M[h]={},M[o]={},void 0;var K=q._id,Z=M[o],E=Z[K];if(E){var y=M[h],k=E.batch,x=y[k],p=x.ds,D=E.index;if(x.invalidate=!0,delete Z[K],p.splice(D,1),eh(p))return delete y[k],void 0;for(var w=E.begin,H=E.size,a=3*w,N=3*H,R=4*w,v=4*H,A=x.vs,C=x.ps,j=x.uv,b=x.cs,G=x.bs,P=x.rs,n=x.ns,$=x.ls;D<p.length;D++)E=Z[p[D]._id],E.index--,E.begin-=H;A.splice(a,N),C.splice(R,v),j&&j.splice(2*w,2*H),b&&b.splice(R,v),G&&G.splice(a,N),P&&P.splice(w,H),n&&n.splice(a,N),$&&$.splice(w,H)}},Lc=Vq,Iq=function(T,s,W,t){if(!t)return V;var Y=s[t];if(!Y){var v=Ng[t]||op,D=v.image?[]:V;Y=s[t]={vs:[],ns:[],uv:D,cs:D?V:v.color?V:[],bs:v.blend?[]:V,ps:[],rs:v.brightness?[]:V,ds:[]}}return Y.invalidate=!0,T[W._id]={index:Y.ds.length,begin:Y.vs.length/3,batch:t},Y.ds.push(W),Y},xd=function(B,n){return n!=V&&1!==n?[B[0]*n,B[1]*n,B[2]*n,B[3]]:B},Lh=function(){var U;return function(F,z,q){var t=F.getData3dUI(z),X=t.shapeModel;X||(X=sr(t));var Q,T=z.s("wf.combineTriangle");if(q.geometry){if(!X&&(z instanceof k.Node&&!(z instanceof k.Shape)?(U||(U={vs:bh,is:Ef,uv:wr}),X=U):X=[t.left,t.front,t.right,t.back,t.top,t.bottom],!X))return C;if(Q=T!==!1?Al(X):Pg(X),!Q)return}else Q=q.short?vs:tf;var J=F.getBrightness(z),Z=Fe(q.color||"white"),b=Z[3]<1,s=Math.ceil(q.width)||1,v=(b?"T":"O")+s,Y=F._wireframeIndexMap,H=F._wireframeModelMap,l=H[v];
l||(l=H[v]={vs:[],cs:[],ps:[],ds:[],T:b,W:s}),l.invalidate=!0;var E=l.vs,j=l.cs,P=l.ds,i=Y[z._id]={index:P.length,begin:E.length/3,batch:v};P.push(z);var M=t.mat;if(!M){M=pc(z,q.mat);var G=t._calcAnchorMat(z);G&&pb(M,M,G)}Ze(E,M,Q);var u=i.size=E.length/3-i.begin;uf(j,xd(Z,J),u)}}(),Gl=function(k,Q,z,w,L,C,l,I,E){var Z=k.getBrightness(Q);Z==V&&(Z=1);var P=xd(Fe(w),Z),c=P[3]<1;C=Math.ceil(C)||1;var H=(c?"T":"O")+C;if(l){var R=l[0],$=(l[1]||R)+R;H+="-"+R+"-"+$,E&&(H+="-"+xk(E)+"-"+Z,E=xd(Fe(E),Z))}var p=k._polylineIndexMap,i=k._polylineModelMap,s=i[H];s||(s=i[H]={vs:[],cs:[],ps:[],ds:[],ls:l?[]:V,T:c,W:C},l&&(s.D=R,s.G=$,s.A=E)),s.invalidate=!0;var n,M=s.vs,h=s.cs,X=s.ds,t=s.ls,_=p[Q._id]={index:X.length,begin:M.length/3,batch:H};X.push(Q),Rd(M,z);var y,K=_.size=M.length/3-_.begin,e=z.length,q=0,F=[];if(l||L)for(n=0;e>n;n+=6)y=_e([z[n],z[n+1],z[n+2]],[z[n+3],z[n+4],z[n+5]]),F.push(y),q+=y;if(q&&L){var G,D=xd(Fe(L),Z),d=[D[0]-P[0],D[1]-P[1],D[2]-P[2],D[3]-P[3]],b=0;for(n=0;e>n;n+=6)G=b/q,uf(h,[P[0]+d[0]*G,P[1]+d[1]*G,P[2]+d[2]*G,P[3]+d[3]*G],1),b+=F[n/6],G=b/q,uf(h,[P[0]+d[0]*G,P[1]+d[1]*G,P[2]+d[2]*G,P[3]+d[3]*G],1)}else uf(h,P,K);if(l)for(b=I||0,n=0;e>n;n+=6)t.push(b),b+=F[n/6],t.push(b)},Qe=function(L,r,b){if(r)for(var p=4*r.begin,G=b[r.batch].ps,j=0;j<r.size;j++)G[p++]=L[0],G[p++]=L[1],G[p++]=L[2],G[p++]=L[3]},Kr=function(V,j){var I=j+["32"],T=V[j],n=V[I];T?n&&n.length===T.length?(n.set(T),n._bufId=null):V[I]=new Nb(T):delete V[I]},bg=function(l,j,o,v,F,p,B,L,n){if(lk(o))o.forEach(function(Q){bg(l,j,Q,v,F,p,B,L,n)});else if(Jh(o))bg(l,j,sr(v,o),v,F,p,B,L,n);else if(Ib(o)){var a,X=$d(o.mat,j,l),Q=$d(o.s3,j,l),H=$d(o.t3,j,l),C=$d(o.r3,j,l);if((Q||C||H||X)&&(a=Fp(X,Q,C,$d(o.rotationMode,j,l),H),p.push(a)),o.shape3d)bg(l,j,o.shape3d,v,F,p,B,L,o);else{var t=v.s;n=n||op;var I=p[0],U=p.length,s=t("shape3d.color",o.color,n.color);if(F||(F=t("shape3d.blend",o.blend,n.blend)),U>1){I=ko(I);for(var M=1;U>M;M++)pb(I,I,p[M])}o.vs&&t(ck,o.visible,n.visible)&&Fg(I,B,L,o.vs,o.uv,o.is,F,s),o.top_vs&&t(Ip,o.topVisible,n.topVisible)&&Fg(I,B,L,o.top_vs,o.top_uv,o.top_is,F,t("shape3d.top.color",o.topColor,n.topColor)||s),o.bottom_vs&&t(zo,o.bottomVisible,n.bottomVisible)&&Fg(I,B,L,o.bottom_vs,o.bottom_uv,o.bottom_is,F,t("shape3d.bottom.color",o.bottomColor,n.bottomColor)||s),o.from_vs&&t(jr,o.fromVisible,n.fromVisible)&&Fg(I,B,L,o.from_vs,o.from_uv,o.from_is,F,t("shape3d.from.color",o.fromColor,n.fromColor)||s),o.to_vs&&t(dq,o.toVisible,n.toVisible)&&Fg(I,B,L,o.to_vs,o.to_uv,o.to_is,F,t("shape3d.to.color",o.toColor,n.toColor)||s)}a&&p.pop()}},Fg=function(J,l,G,F,B,c,V,o){var q,g=l.cs,z=l.uv,K=l.bs;if(c){q=c.length;for(var n=0;q>n;n++){var C=c[n];Ze(G,J,[F[3*C],F[3*C+1],F[3*C+2]]),z&&Rd(z,[B[2*C],B[2*C+1]])}}else q=F.length/3,Ze(G,J,F),z&&Rd(z,B);g&&uf(g,o,q),K&&(V?$c(K,V,q):Rd(K,Cp,q))},Ge=function(N,Q,V,b){var I=[];b?bg(N.gv,N.data,b,N,N.getBodyColor(),[Q],V,I):(Bi(N,ws,Q,V,I),Bi(N,Hn,Q,V,I),Bi(N,Bn,Q,V,I),Bi(N,rg,Q,V,I),Bi(N,qs,Q,V,I),Bi(N,rq,Q,V,I),Bi(N,"csg",Q,V,I)),I.length&&(Rd(V.vs,I),Rd(V.ns,Hp(I)))},Bi=function(l,T,K,W,D){var I=l[T];if(I){var p=I.tuv;if(p){var X,B,Y,L,P=I.uvScale,w=I.uvOffset;if(P)for(X=p.length,B=P[0],Y=P[1],L=0;X>L;L+=2)p[L]*=B,p[L+1]*=Y;if(w)for(X=p.length,B=w[0],Y=w[1],L=0;X>L;L+=2)p[L]+=B,p[L+1]+=Y}Fg(K,W,D,I.vs,p,V,I.blend,I.color)}},Ag=function(t,c,W,E,w,V,G,r){var L,N=W.cs,z=W.uv,U=W.bs;if(t.getFaceVisible(c,V)){var C=t.getFaceMat(c,V);if(C&&(w=pc(c,C)),Ze(G,w,r),N&&uf(N,t.getFaceColor(c,V),6),z){var Z=t.getFaceUv(c,V)||E[V+"Uv"],n=t.getFaceUvScale(c,V)||E[V+"UvScale"],Y=t.getFaceUvOffset(c,V)||E[V+"UvOffset"];Z=Z?[Z[6],Z[7],Z[0],Z[1],Z[2],Z[3],Z[2],Z[3],Z[4],Z[5],Z[6],Z[7]]:Oi;var J=Z[0],j=Z[1],D=Z[2],a=Z[3],O=Z[4],Q=Z[5],d=Z[6],M=Z[7],m=Z[8],h=Z[9],p=Z[10],I=Z[11];if(n){var g=n[0],A=n[1];J*=g,j*=A,D*=g,a*=A,O*=g,Q*=A,d*=g,M*=A,m*=g,h*=A,p*=g,I*=A}if(Y){var l=Y[0],u=Y[1];J+=l,j+=u,D+=l,a+=u,O+=l,Q+=u,d+=l,M+=u,m+=l,h+=u,p+=l,I+=u}z.push(J,j,D,a,O,Q,d,M,m,h,p,I)}U&&(L=t.getBodyColor(c)||t.getFaceBlend(c,V),L?$c(U,L,6):Rd(U,Cp,6))}},vk=function(M,u,x,k){var N=M.getGL(),t=M._prg,w=M._buffer;if(!M.drawFilter&&!Bk(u)){we(M),kg(N,t);for(var R in u){var Y=u[R];if(!(k&&!Y.T||!k&&Y.T)){Y.invalidate?(Y.invalidate=!1,Kr(Y,"vs"),Kr(Y,"cs"),Kr(Y,"ls"),Kr(Y,"ps")):x&&Kr(Y,"ps");var h=Y.vs32,a=x?Y.ps32:Y.cs32;Ff(N,t,Y.W,V,w.vs,h);var O=Y.D,I=!M._dashDisabled&&O;rk(N,t.uAlphaTest,g.alphaTest),I&&(rk(N,t.uDash,!0),rk(N,t.uDashDistance,O),rk(N,t.uDashGapDistance,Y.G),os(N,t.aLineDistance),es(N,w.lineDistance,Y.ls32,t.aLineDistance,1),rk(N,t.uDiffuse,Y.A||g["color.empty"]));var l=!M._batchColorDisabled;l&&(rk(N,t.uBatchColor,!0),os(N,t.aBatchColor),es(N,w.batchColor,a,t.aBatchColor,4)),Sj(N),Hj(N,0,h.length/3,N.LINES),tk(N),l&&(rk(N,t.uBatchColor,!1),Nf(N,t.aBatchColor)),I&&(rk(N,t.uDash,!1),Nf(N,t.aLineDistance))}}Rp(N,t)}},An=function(l,H,e){var j,$,A,a,u,Z,i,O,c,R,t,q=l.getGL(),F=l._prg,U=l._buffer,G=l._batchModelMap;if(!Bk(G)){we(l);for(j in G)if($=Ng[j]||op,!(e&&!$.transparent||!e&&$.transparent)&&(A=G[j],H||!$.transparentMask)){var S=e&&$.autoSort!==!1&&(l._33Q||A.invalidate);if(A.invalidate?(A.invalidate=!1,Kr(A,"vs"),Kr(A,"ns"),Kr(A,"cs"),Kr(A,"rs"),Kr(A,"ps"),Kr(A,"bs"),Kr(A,"uv")):H&&Kr(A,"ps"),u=A.vs32,Z=H?A.ps32:A.cs32,c=A.uv32,i=A.bs32,O=A.rs32,t=u.length/3,S&&(A.is=as(u,l.getEye())),t){a=$.light,R=l.getTexture($.image),Jm(q,F,V,$.light,$.opacity,$.reverseFlip,$.reverseColor,$.reverseCull),Z?l._batchColorDisabled||(rk(q,F.uBatchColor,!0),os(q,F.aBatchColor),es(q,U.batchColor,Z,F.aBatchColor,4)):rk(q,F.uDiffuse,$.color||g["color.empty"]);var v=$.alphaTest;rk(q,F.uAlphaTest,v===C?g.alphaTest:v);var K=i&&!l._batchBlendDisabled;K&&(rk(q,F.uBatchBlend,!0),os(q,F.aBatchBlend),es(q,U.batchBlend,i,F.aBatchBlend));var _=O&&!l._batchBrightnessDisabled;_&&(rk(q,F.uBatchBrightness,!0),os(q,F.aBatchBrightness),es(q,U.batchBrightness,O,F.aBatchBrightness,1)),c?Sj(q,F,R,$.discardSelectable,U.uv,c,$.uvOffset,$.uvScale):Sj(q),es(q,U.vs,u,F.aPosition),es(q,U.ns,A.ns32,F.aNormal),A.is?(ak(q,U.is,A.is),hc(q,0,t)):Hj(q,0,t),c?tk(q,F,R):tk(q),Z&&!l._batchColorDisabled&&(rk(q,F.uBatchColor,!1),Nf(q,F.aBatchColor)),K&&(rk(q,F.uBatchBlend,!1),Nf(q,F.aBatchBlend)),_&&(rk(q,F.uBatchBrightness,!1),Nf(q,F.aBatchBrightness)),Mc(q,F)}}}},as=function(v,e){for(var S=v.length/3,i=new Array(S),T=S/3,D=new Array(T),M=0;T>M;M++)D[M]=M;D.sort(function(N,f){var I=9*N,u=[(v[I]+v[I+3]+2*v[I+6])/4,(v[I+1]+v[I+4]+2*v[I+7])/4,(v[I+2]+v[I+5]+2*v[I+8])/4];I=9*f;var z=[(v[I]+v[I+3]+2*v[I+6])/4,(v[I+1]+v[I+4]+2*v[I+7])/4,(v[I+2]+v[I+5]+2*v[I+8])/4],m=_e(e,u)-_e(e,z);return m>0?-1:0>m?1:0});for(var M=0;T>M;M++){var A=3*M,m=3*D[M];i[A]=m,i[A+1]=m+1,i[A+2]=m+2}return new Sl(i)},ds={obj:function(x,i){var T={mat:x.mat,s3:x.s3,r3:x.r3,rotationMode:x.rotationMode,t3:x.t3,cube:x.cube==V?!0:x.cube,center:x.center==V?!0:x.center,ignoreMtls:x.ignoreMtls,ignoreTransparent:x.ignoreTransparent,ignoreColor:x.ignoreColor,ignoreImage:x.ignoreImage,ignoreNormal:x.ignoreNormal,prefix:x.prefix,flipY:x.flipY,flipFace:x.flipFace,reverseFlipMtls:x.reverseFlipMtls,finishFunc:function(X,g){if(X){var g=[];for(var D in X){var Q=X[D];g.rawS3=Q.rawS3,g.push(Q),x.eachModel&&x.eachModel(D,Q)}g.json=x,i(g)}else i()}};m.loadObj(x.obj,x.mtl,T)}};m.getModelTypeHandlers=function(){return ds},m.setModelTypeHandler=function(G,R){ds[G]=R},m.getModelTypeHandler=function(M){return ds[M]},m.handleModelLoaded=function(){},m.handleUnfoundModel=function(){};var Jf=V,Qk=V,Ik=function(J){Jf&&!J._loadingModelView_&&(Qk||(Qk={}),Qk[J._loadingModelView_=Nk()]=J)},eq=function(T,s){Jf||(Jf={});var z=Jf[T];if(z){if(z.url===s)return;z.request.onload=Yk,z.request.onerror=Yk}var n=new lh;if(Jf[T]={request:n,url:s},s=m.beforeLoadURL(s),s.data){var t=m.parse(s.data);Gn(T,t,s)}else{n.onload=function(){if(200===this.status||0===this.status){delete Jf[T];var W=m.parse(n.getResponseText());Gn(T,W,s)}else Cl(T,m.handleUnfoundModel(T,s)||V)},n.onerror=function(){Cl(T,m.handleUnfoundModel(T,s)||V)};var N={};N.url=encodeURI(s),N.sync=!1,n.send(N)}},Gn=function(p,g,i){var K=g.modelType;if(!K)return Cl(p,g),m.handleModelLoaded(p,g),void 0;var B=m.getModelTypeHandler(K);if(B){if(Jf||(Jf={}),Jf[p])return;Jf[p]=!0;var $=function(y){y?(Cl(p,y),m.handleModelLoaded(p,y)):Cl(p,m.handleUnfoundModel(p,i)||V)};B(g,$)}else Cl(p,m.handleUnfoundModel(p,i)||V)},Cl=function(P,R){if(be[P]=R,delete Jf[P],Bk(Jf)&&(Jf=V,Qk)){for(var _ in Qk){var T=Qk[_];T.invalidateAll&&T.invalidateAll(C,"modelLoaded",P),T.redraw&&T.redraw(),T.iv(),delete T._loadingModelView_}Qk=V}if(R&&Qk)for(var _ in Qk){var T=Qk[_];T.invalidateAll&&T.invalidateAll(C,"modelLoading",P),T.redraw&&T.redraw(),T.iv()}},ke=new Nb([0,0,0,1,1,1,1,0]),Ye=new Nb([0,0,1,0,0,1,0,0,1,0,0,1]),tn=new Sl([0,1,2,2,3,0]),bh=new Nb([-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5]),Ef=new Sl([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),wr=new Nb([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),So=Hp(bh,Ef),Hg=(new Nb([-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5]),new Sl([0,1,2,3,0,7,5,4,6,7,5,3,2,4,6,1]),[ws,Bn,Hn,rg,qs,rq]),tf=[-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5],vs=[-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4],Kn=function(g,X,p,h,B,P){P=P||16,g=g||16,X=X||0,p=p||g;var o,s,J,z,Q,t,r,K,a=.5,H=[],G=[],L=w/g,d=F/P;for(o=0;P>o;o++)for(Q=o+1,z=o*d,K=Q*d,s=X;p>s;s++)t=s+1,J=s*L,r=t*L,H.push(a*U(z)*e(J),a*e(z),-a*U(z)*U(J),a*U(K)*e(r),a*e(K),-a*U(K)*U(r),a*U(z)*e(r),a*e(z),-a*U(z)*U(r),a*U(z)*e(J),a*e(z),-a*U(z)*U(J),a*U(K)*e(J),a*e(K),-a*U(K)*U(J),a*U(K)*e(r),a*e(K),-a*U(K)*U(r)),G.push(s/g,o/P,t/g,Q/P,t/g,o/P,s/g,o/P,s/g,Q/P,t/g,Q/P);if(h){var c=[],u=[];for(J=X*L,o=0;P>o;o++)Q=o+1,z=o*d,K=Q*d,c.push(0,0,0,a*U(K)*e(J),a*e(K),-a*U(K)*U(J),a*U(z)*e(J),a*e(z),-a*U(z)*U(J)),u.push(0,.5,X/g,Q/P,X/g,o/P)}if(B){var y=[],m=[];for(J=p*L,o=0;P>o;o++)Q=o+1,z=o*d,K=Q*d,y.push(0,0,0,a*U(z)*e(J),a*e(z),-a*U(z)*U(J),a*U(K)*e(J),a*e(K),-a*U(K)*U(J)),m.push(1,.5,p/g,o/P,p/g,Q/P)}return{vs:H,uv:G,from_vs:c,from_uv:u,to_vs:y,to_uv:m}},Cs=function(t,i,V){t=t||.17,i=i||12,V=V||18,0>t?t=0:t>.25&&(t=.25);var b,I,s,o,q,u,a,d=.5,L=[],c=[],r=[],v=w/V,k=w/i,Y=d-t;for(I=0;i>=I;I++)for(o=-F+I*k,u=e(o),q=U(o),b=0;V>=b;b++)s=b*v,a=Y+t*u,L.push(e(s)*a,q*t,-U(s)*a),c.push(b/V,1-I/i);for(I=0;i>I;I++){var T=I*(V+1),D=(I+1)*(V+1);for(b=0;V>b;b++)r.push(T+b,D+b+1,D+b,T+b,T+b+1,D+b+1)}return{vs:L,uv:c,is:r}},Kh=function(A,V,d,h,W,l,P){P=P||12,A=A||18,V=V||0,d=d||A,l=l||.17,0>l?l=0:l>.25&&(l=.25);var x,z,Y,c,n,G,$,T,f,N,m=.5,L=[],j=[],p=w/A,b=w/P,o=m-l;for(Y=0;P>Y;Y++)for(c=Y+1,$=-F+Y*b,T=-F+c*b,x=V;d>x;x++)z=x+1,n=x*p,G=z*p,f=o+l*e($),N=o+l*e(T),L.push(e(n)*f,U($)*l,-U(n)*f,e(G)*f,U($)*l,-U(G)*f,e(G)*N,U(T)*l,-U(G)*N,e(n)*f,U($)*l,-U(n)*f,e(G)*N,U(T)*l,-U(G)*N,e(n)*N,U(T)*l,-U(n)*N),j.push(x/A,1-Y/P,z/A,1-Y/P,z/A,1-c/P,x/A,1-Y/P,z/A,1-c/P,x/A,1-c/P);if(h){var D=[],Q=[];for(Y=0;P>Y;Y++)c=Y+1,$=-F+Y*b,T=-F+c*b,n=V*p,f=o+l*e($),N=o+l*e(T),D.push(e(n)*f,U($)*l,-U(n)*f,e(n)*N,U(T)*l,-U(n)*N,e(n)*o,0,-U(n)*o),Q.push(.5+.5*e($),.5-.5*U($),.5+.5*e(T),.5-.5*U(T),.5,.5)}if(W){var i=[],r=[];for(Y=0;P>Y;Y++)c=Y+1,$=-F+Y*b,T=-F+c*b,n=d*p,f=o+l*e($),N=o+l*e(T),i.push(e(n)*f,U($)*l,-U(n)*f,e(n)*o,0,-U(n)*o,e(n)*N,U(T)*l,-U(n)*N),r.push(.5-.5*e($),.5-.5*U($),.5,.5,.5-.5*e(T),.5-.5*U(T))}return{vs:L,uv:j,from_vs:D,from_uv:Q,to_vs:i,to_uv:r}},lg=function(g,Z){for(var m,N,l,r=.5,d=16,q=[],Y=[],p=[],I=w/d,$=0;d>=$;$++)m=$*I,N=e(m)*r,l=U(m)*r,q.push(N,-r,l,N,r,l),Y.push(1-$/d,1,1-$/d,0);for($=0;d>$;$++)p.push(2*$,2*$+1,2*$+3,2*$,2*$+3,2*$+2);if(Z){var E=[],F=[],a=[];for(E.push(0,-r,0),F.push(.5,.5),$=0;d>=$;$++)m=$*I,N=e(m),l=U(m),E.push(N*r,-r,-l*r),F.push(.5+.5*N,.5+.5*l);for($=0;d>$;$++)a.push(0,$+2,$+1)}if(g){var W=[],B=[],V=[];for(W.push(0,r,0),B.push(.5,.5),$=0;d>=$;$++)m=$*I,N=e(m),l=U(m),W.push(N*r,r,-l*r),B.push(.5+.5*N,.5-.5*l);for($=0;d>$;$++)V.push(0,$+1,$+2)}return{vs:q,uv:Y,is:p,bottom_vs:E,bottom_uv:F,bottom_is:a,top_vs:W,top_uv:B,top_is:V}},Dj=function(h,R,K,S,m,t,J){h=h||12,R=R||0,K=K||h;for(var C,b,p,c,Y,Q,i,D,g=.5,I=[],O=[],B=w/h,H=R;K>H;H++)C=H+1,b=H*B,p=C*B,c=e(b)*g,Y=U(b)*g,Q=e(p)*g,i=U(p)*g,I.push(c,-g,-Y,Q,-g,-i,c,g,-Y,Q,-g,-i,Q,g,-i,c,g,-Y),O.push(H/h,1,C/h,1,H/h,0,C/h,1,C/h,0,H/h,0);if(J){var _=[],G=[];for(H=R;K>H;H++)b=B*H,p=B*(H+1),c=e(b),Y=U(b),Q=e(p),i=U(p),_.push(c*g,-g,-Y*g,0,-g,0,Q*g,-g,-i*g),G.push(.5+.5*c,.5+.5*Y,.5,.5,.5+.5*Q,.5+.5*i)}if(t){var F=[],o=[];for(H=R;K>H;H++)b=B*H,p=B*(H+1),c=e(b),Y=U(b),Q=e(p),i=U(p),F.push(c*g,g,-Y*g,Q*g,g,-i*g,0,g,0),o.push(.5+.5*c,.5-.5*Y,.5+.5*Q,.5-.5*i,.5,.5)}if(S){var r=[],W=[];b=B*R,c=e(b)*g,Y=U(b)*g,D=R/h,r.push(0,g,0,0,-g,0,c,-g,-Y,c,-g,-Y,c,g,-Y,0,g,0),W.push(0,0,0,1,D,1,D,1,D,0,0,0)}if(m){var j=[],d=[];b=B*K,c=e(b)*g,Y=U(b)*g,D=K/h,j.push(0,-g,0,0,g,0,c,g,-Y,c,g,-Y,c,-g,-Y,0,-g,0),d.push(1,1,1,0,D,0,D,0,D,1,1,1)}return{vs:I,uv:O,bottom_vs:_,bottom_uv:G,top_vs:F,top_uv:o,from_vs:r,from_uv:W,to_vs:j,to_uv:d}},bf=function(M,P,R,W,u){P=P||18,R=R||0,W=W==V?w:W,u=u==V?.5:u;for(var n,t,f,D,E,s,J=[0,.5,.75,.875,.9375],Y=[],i=[],_=[],X=W/P,L=0;L<J.length;L++){var c=0===L%2?0:.5;for(n=0;P>=n;n++)t=(n+c)*X+R,f=1-J[L],Y.push(e(t)*u*f,-u+2*J[L]*u,-U(t)*u*f),i.push((n+c)/P,f)}for(L=0;L<J.length-1;L++){var q=L*(P+1),x=(L+1)*(P+1);for(n=0;P>n;n++)_.push(q+n,x+n+1,x+n,q+n,q+n+1,x+n+1)}for(s=Y.length/3-(P+1),n=0;P>n;n++)Y.push(0,u,0),i.push((n+.5)/P,0);for(n=0;P>n;n++)_.push(s+n,s+n+1,s+(P+1)+n);if(M){var o=[],B=[],$=[];for(o.push(0,-u,0),B.push(.5,.5),n=0;P>=n;n++)t=n*X+R,D=e(t),E=U(t),o.push(D*u,-u,-E*u),B.push(.5+.5*D,.5+.5*E);for(n=0;P>n;n++)$.push(0,n+2,n+1)}return{vs:Y,uv:i,is:_,bottom_vs:o,bottom_uv:B,bottom_is:$}},To=function(u,c,s,A,x,F){u=u||16,c=c||0,s=s||u;for(var V=.5,M=[],L=[],G=w/u,f=c;s>f;f++){var H=f+1,k=G*f,D=G*H;M.push(e(k)*V,-V,-U(k)*V,e(D)*V,-V,-U(D)*V,0,V,0),L.push(f/u,1,H/u,1,(f+H)/2/u,0)}if(F){var l=[],C=[];for(f=c;s>f;f++){k=G*f,D=G*(f+1);var p=e(k),P=U(k),I=e(D),i=U(D);l.push(p*V,-V,-P*V,0,-V,0,I*V,-V,-i*V),C.push(.5+.5*p,.5+.5*P,.5,.5,.5+.5*I,.5+.5*i)}}if(A){var _=[],Q=[];k=G*c,_.push(0,V,0,0,-V,0,e(k)*V,-V,-U(k)*V),Q.push(0,0,0,1,c/u,1)}if(x){var S=[],J=[];k=G*s,S.push(0,-V,0,0,V,0,e(k)*V,-V,-U(k)*V),J.push(1,1,1,0,s/u,1)}return{vs:M,uv:L,bottom_vs:l,bottom_uv:C,from_vs:_,from_uv:Q,to_vs:S,to_uv:J}},Ao=function(g,h,v,L,D,T,j,x){for(var Y=[],c=0;c<g.length-1;c+=2)Y.push({x:g[c],y:g[c+1]});return Up(Y,h,v,L,D,T,j,x,!1)},Dh={roundRect:function(m,N){return Ao([.5,.4,.5,.442,.471,.471,.442,.5,.4,.5,-.4,.5,-.442,.5,-.471,.471,-.5,.442,-.5,.4,-.5,-.4,-.5,-.442,-.471,-.471,-.442,-.5,-.4,-.5,.4,-.5,.442,-.5,.471,-.471,.5,-.442,.5,-.4,.5,.4],[1,3,3,2,3,3,2,3,3,2,3,3,2],m,N,3)},star:function(X,i){return Ao([.193,.079,.333,.5,0,.233,-.333,.5,-.194,.079,-.5,-.167,-.112,-.167,0,-.5,.111,-.167,.5,-.167],[1,2,2,2,2,2,2,2,2,2,5],X,i)},rect:function(j,F){return Ao([.5,-.5,.5,.5,-.5,.5,-.5,-.5],[1,2,2,2,5],j,F)},billboard:function(){return{vs:[-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}},plane:function(){return{vs:[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,.5],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]}},triangle:function(z,d){return Ao([0,-.5,.5,.5,-.5,.5],[1,2,2,5],z,d)},rightTriangle:function(Q,X){return Ao([.5,.5,-.5,.5,-.5,-.5],[1,2,2,5],Q,X)},parallelogram:function(M,D){return Ao([.5,-.5,.25,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],M,D)},trapezoid:function(z,L){return Ao([.25,-.5,.5,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],z,L)}},er={sphere:1,cylinder:1,cone:1,torus:1},cr={torus:1,sphere:1},le=dc(Zq(Dh),{cylinder:1}),fh=dc(Zq(Dh),{cylinder:1,cone:1}),ln=function(x,U,z){var B,i=$d(x.anchor3d,z,U),e=$d(x.mat,z,U),V=$d(x.s3,z,U),$=$d(x.t3,z,U),Y=$d(x.r3,z,U),F=V||Y||$||e;if(i||F){B=ko(U._6O);var D=F?Fp(e,V,Y,$d(x.rotationMode,z,U),$):Yq();i&&Xl(D,[.5-i[0],.5-i[1],.5-i[2]]),we(U,D)}return B},Yc=function(Y,W,n,_,L,e,H){if(lk(n))n.forEach(function(Q){Yc(Y,W,Q,_,L,e,H)});else if(Jh(n))Yc(Y,W,sr(_,n),_,L,e,H);else if(Ib(n))if(n.shape3d){var y=ln(n,Y,W);Yc(Y,W,n.shape3d,_,L,e,n),y&&Vm(Y,y)}else Gp(Y,W,n,_.s,L,e,H)},Gp=function(Z,O,N,T,Y,H,G){if(G=G||op,!H||H(T("shape3d.transparent",N.transparent,G.transparent))){var o=ln(N,Z,O);Ii(N);var J=Z._26I,W=Z._prg,S=Z._buffer,b=T("shape3d.color",N.color,G.color);Y||(Y=T("shape3d.blend",N.blend,G.blend));var L,k=N.opacity==V?G.opacity:N.opacity,R=T("shape3d.opacity");L=R!=V&&k!=V?k*R:k!=V?k:R,Jm(J,W,Y,T("shape3d.light",N.light,G.light),L,T("shape3d.reverse.flip",N.reverseFlip,G.reverseFlip),T("shape3d.reverse.color",N.reverseColor,G.reverseColor),T("shape3d.reverse.cull",N.reverseCull,G.reverseCull));var r=T("polygonOffset",N.polygonOffset,G.polygonOffset);N.vs&&T(ck,N.visible,G.visible)&&oh(J,W,S,b,Z.getTexture(T("shape3d.image",N.image,G.image),O),T("shape3d.discard.selectable",N.discardSelectable,G.discardSelectable),N.vs,N.uv,N.ns,N.is,T("shape3d.uv.offset",N.uvOffset,G.uvOffset),T("shape3d.uv.scale",N.uvScale,G.uvScale),r),N.top_vs&&T(Ip,N.topVisible,G.topVisible)&&oh(J,W,S,T("shape3d.top.color",N.topColor,G.topColor)||b,Z.getTexture(T("shape3d.top.image",N.topImage,G.topImage),O),T("shape3d.top.discard.selectable",N.topDiscardSelectable,G.topDiscardSelectable),N.top_vs,N.top_uv,N.top_ns,N.top_is,T("shape3d.top.uv.offset",N.topUvOffset,G.topUvOffset),T("shape3d.top.uv.scale",N.topUvScale,G.topUvScale),r),N.bottom_vs&&T(zo,N.bottomVisible,G.bottomVisible)&&oh(J,W,S,T("shape3d.bottom.color",N.bottomColor,G.bottomColor)||b,Z.getTexture(T("shape3d.bottom.image",N.bottomImage,G.bottomImage),O),T("shape3d.bottom.discard.selectable",N.bottomDiscardSelectable,G.bottomDiscardSelectable),N.bottom_vs,N.bottom_uv,N.bottom_ns,N.bottom_is,T("shape3d.bottom.uv.offset",N.bottomUvOffset,G.bottomUvOffset),T("shape3d.bottom.uv.scale",N.bottomUvScale,G.bottomUvScale),r),N.from_vs&&T(jr,N.fromVisible,G.fromVisible)&&oh(J,W,S,T("shape3d.from.color",N.fromColor,G.fromColor)||b,Z.getTexture(T("shape3d.from.image",N.fromImage,G.fromImage),O),T("shape3d.from.discard.selectable",N.fromDiscardSelectable,G.fromDiscardSelectable),N.from_vs,N.from_uv,N.from_ns,N.from_is,T("shape3d.from.uv.offset",N.fromUvOffset,G.fromUvOffset),T("shape3d.from.uv.scale",N.fromUvScale,G.fromUvScale),r),N.to_vs&&T(dq,N.toVisible,G.toVisible)&&oh(J,W,S,T("shape3d.to.color",N.toColor,G.toColor)||b,Z.getTexture(T("shape3d.to.image",N.toImage,G.toImage),O),T("shape3d.to.discard.selectable",N.toDiscardSelectable,G.toDiscardSelectable),N.to_vs,N.to_uv,N.to_ns,N.to_is,T("shape3d.to.uv.offset",N.toUvOffset,G.toUvOffset),T("shape3d.to.uv.scale",N.toUvScale,G.toUvScale),r),Mc(J,W),o&&Vm(Z,o)}},oh=function(w,C,x,r,y,R,B,j,a,H,t,Q,A){B&&(A&&Cj(w,A),rk(w,C.uDiffuse,r||g["color.empty"]),j?Sj(w,C,y,R,x.uv,j,t,Q):Sj(w),es(w,x.vs,B,C.aPosition),es(w,x.ns,a,C.aNormal),H?(yb(w,x.is,H),hc(w,0,H.length)):Hj(w,0,B.length/3),j?tk(w,C,y):tk(w),A&&Wb(w))},sr=function(c,r){var y=c.s;if(r||(r=y(Hc)),!r)return V;var e=no(r);if(e)return e;if("text"===r){var s={amount:y("shape3d.text.amount"),size:y("shape3d.text.size"),font:y("shape3d.text.font"),style:y("shape3d.text.style"),weight:y("shape3d.text.weight"),fill:y("shape3d.text.fill"),curveSegments:y("shape3d.text.curveSegments"),spacing:y("shape3d.text.spacing")},R=c.gv.getShape3dText(c.data),U=R;for(var g in s)U+="_"+(s[g]===C?"U":s[g]);return c._cachedTextKey===U?c._cachedTextGeometry:(c._cachedTextKey=U,c._cachedTextGeometry=m.createTextGeometry(R,s))}var g=r;if(er[r]){var h=y("shape3d.side"),O=y("shape3d.side.from"),H=y("shape3d.side.to"),t=y(jr),J=y(dq);3>h?(h=0,O=0,H=0,t=!1,J=!1):((O==V||0>O)&&(O=0),(H==V||H>h)&&(H=h),0===O&&H===h&&(t=!1,J=!1)),g+="-"+h+"-"+O+"-"+H+"-"+t+"-"+J}if(le[r]){var Q=y(Ip);g+="-"+Q}if(fh[r]){var f=y(zo);g+="-"+f}if("torus"===r){var j=y("shape3d.torus.radius");0>j?j=0:j>.25&&(j=.25),g+="-"+j}if(cr[r]){var i=y(Vp);g+="-"+i}return e=rj[g],e||("box"===r?e=m.createBoxModel():Dh[r]?e=Dh[r](Q,f):"sphere"===r?e=m.createSphereModel(h,O,H,t,J,i):r===Pj?e=m.createCylinderModel(h,O,H,t,J,Q,f):"cone"===r?e=m.createConeModel(h,O,H,t,J,f):"torus"===r&&(e=m.createTorusModel(h,O,H,t,J,j,i)),rj[g]=e),e},Ii=function(){var k=["vs","ns","uv","top_vs","top_ns","top_uv","bottom_vs","bottom_ns","bottom_uv","from_vs","from_ns","from_uv","to_vs","to_ns","to_uv","er","al"],O=["is","top_is","bottom_is","from_is","to_is"];return R=kd(wn.substr(wn.indexOf("^#")+2)),Jb(m[sc(ce+k[15]+"n"+k[16])]())&&qp()?function(x){x&&!x._complete_&&(x._complete_=!0,x.vs&&eh(x.ns)&&(x.ns=Hp(x.vs,x.is)),x.top_vs&&eh(x.top_ns)&&(x.top_ns=Hp(x.top_vs,x.top_is)),x.bottom_vs&&eh(x.bottom_ns)&&(x.bottom_ns=Hp(x.bottom_vs,x.bottom_is)),x.from_vs&&eh(x.from_ns)&&(x.from_ns=Hp(x.from_vs,x.from_is)),x.to_vs&&eh(x.to_ns)&&(x.to_ns=Hp(x.to_vs,x.to_is)),k.forEach(function(t){var h=x[t];lk(h)&&(x[t]=new Nb(h))}),O.forEach(function(r){var H=x[r];lk(H)&&(x[r]=new Sl(H))}))}:void 0}(),dg=function(e,P){var N=e[P];lk(N)&&(e[P]=new Nb(N))};dc(Xc,{_25Q:function(m){m._16O=function(d,U,h,D,q,b,E,x,p){var k=this.info;if(k){var F,e,I,G,v,A,w=Yq();if(Eo[U]?(F=k.p3,e=k.c1,I=k.c2):dk[U]?(e=k.s1||k.c1,I=k.s2||k.c2):(e=k.t1||k.c1,I=k.t2||k.c2),F)A=ug(U,Ti,h,D,x,p);else{var z=Nn(I,e),S=_e(e,I);G=[0,-s(z[2],z[0]),o(z[1]/S)],v="zyx",F=[(e[0]+I[0])/2,(e[1]+I[1])/2,(e[2]+I[2])/2],A=ug(U,[S,0,0],h,D,x,p)}return kj(w,A,F,D,q,b,E,d,G,v)}return gs},m._80o=function(A,T,Y){var D=this,V=D.shapeModel;if(V){var X=D.gv;we(X),Yc(X,D.data,V,D,D.getBodyColor(),Y)}},m.createLineModel=function(X,$,I,a,S){for(var j=this,v=j.s,c=Oe(X,$,v(Vp)),G=[],f=0;f<c.length;f++){var o=c[f],L=o.length;if(L>1){var m=o[0];G.push(m.x,m.y,m.z);for(var r=1;L-1>r;r++)m=o[r],G.push(m.x,m.y,m.z),G.push(m.x,m.y,m.z);m=o[L-1],G.push(m.x,m.y,m.z)}}var u,h,K,d=v(a+".color"),B=v(S),H=0;return B&&(h=v(S+".color"),u=v(S+".pattern"),H=v(S+".offset"),K=d),Gl(j.gv,j.data,G,h||d,K?V:v(a+".gradient.color"),I,u||v(a+".pattern"),H,K),c},m.createTubeModel=function(U,w,c,l){for(var g=this,R=g.s,I=R("shape3d.side")||sn,z=R("shape3d.start.angle"),G=R("shape3d.sweep.angle"),J=R(Ip)?R("shape3d.top.cap"):V,v=R(zo)?R("shape3d.bottom.cap"):V,r="flat"===J,e="flat"===v,_=r&&(l?l.uv:R("shape3d.top.image")),Z=e&&(l?l.uv:R("shape3d.bottom.image")),B=l?l.uv:R("shape3d.image"),F={vs:[],uv:B?[]:V,top_vs:r?[]:V,top_uv:_?[]:V,bottom_vs:e?[]:V,bottom_uv:Z?[]:V},b=Oe(U,w,R(Vp),c),Q=0,D=b.length;D>Q;Q++)No(F,b[Q],R(Le),c,I,z,G,J,v);if(l){var C=[];bg(g.gv,g.data,F,g,g.getBodyColor(),[],l,C),C.length&&(Rd(l.vs,C),Rd(l.ns,Hp(C)))}else g.shapeModel=F;return b},m.getCache=function(){var a=this.info;if(a){var v=a.list;if(v){var P=a.cache;return P||(P=a.cache=js(v)),P}}return V}}});var fj=function(R,o){for(var E,K=0,N=R.length,z=0,j=N-1;j>=z;)if(K=$(z+(j-z)/2),E=R[K].length-o,0>E)z=K+1;else{if(!(E>0)){j=K;break}j=K-1}K=j;var _=R[K],w=_.point;return K===N-1||_.length===o||(w=(new qk).subVectors(R[K+1].point,w).normalize().multiplyScalar(o-_.length).add(w)),{point:w,tangent:_.tangent}},js=function(G){for(var r,s,E=[],B=0,Y=0;Y<G.length;Y++){for(var T=G[Y],x=0;x<T.length;x++){r=T[x],s&&(B+=s.distanceTo(r));var A=new qk,z=T[x+1];z?A.subVectors(z,r):s?A.subVectors(r,s):A.x=1,A.normalize(),E.push({point:r,length:B,tangent:A}),s=r}s=null}return E},Oe=function(K,S,D,H){D=D||Ej;for(var l=[],Y=0,n=K.size();n>Y;Y++){var i=K.get(Y);l.push(new qk(i.x,i.e||0,i.y))}S&&(br(S)&&(S=S._as),S.length||(S=null));for(var v,J,U,L,t,z=[],e=0,u=0,M=S?S.length:n;M>u;u++)if(t=S?S[u]:0===u?1:2,1===t)z.push(U=[]),U.push(l[e++]);else if(2===t||5===t)if(L=2===t?l[e++]:U[0],H){var N=S?S[u+1]:M>u+1?2:V;if(2===N||5===N){var r=U[U.length-1],P=2===N?l[e]:U[0],o=(new qk).subVectors(r,L),W=(new qk).subVectors(P,L),O=o.length(),d=W.length();if(O&&d)if(H>O/2&&H>d/2)U.push(L);else for(o.multiplyScalar(f(H,O/2)/O).add(L),W.multiplyScalar(f(H,d/2)/d).add(L),v=new Xj(o,L,W).getPoints(D),J=0;D>=J;J++)U.push(v[J])}else U.push(L)}else U.push(L);else if(3===t)for(v=new Xj(U[U.length-1],l[e++],l[e++]).getPoints(D),J=1;D>=J;J++)U.push(v[J]);else if(4===t)for(v=new Vo(U[U.length-1],l[e++],l[e++],l[e++]).getPoints(D),J=1;D>=J;J++)U.push(v[J]);return z},Sh=function(I){for(var v,E,N=new qk,r=[],J=[],d=[],_=0,C=I.length;C>_;_++)v=I[_],E=I[_+1],E?N.subVectors(E,v):N.subVectors(v,I[_-1]),r.push(N.normalize().clone());var p,e,j,Z,K=new qk,R=new qk,Q=new Be,i=1e-4,P=Number.MAX_VALUE,h=r[0],W=J[0]=new qk,Y=d[0]=new qk;for(e=M(h.x),j=M(h.y),Z=M(h.z),P>=e&&(P=e,K.set(1,0,0)),P>=j&&(P=j,K.set(0,1,0)),P>=Z&&K.set(0,0,1),R.crossVectors(h,K).normalize(),W.crossVectors(h,R),Y.crossVectors(h,W),_=1;C>_;_++)J[_]=J[_-1].clone(),d[_]=d[_-1].clone(),R.crossVectors(r[_-1],r[_]),R.length()>i&&(R.normalize(),p=q(xo(r[_-1].dot(r[_]),-1,1)),J[_].applyMatrix4(Q.makeRotationAxis(R,p))),d[_].crossVectors(r[_],J[_]);return{B:d,T:r,N:J}},No=function(){var X=function(h){for(var O=1;O<arguments.length;O++){var x=arguments[O];h.push(x.x,x.y,x.z)}},M=function(i){for(var I=1;I<arguments.length;I++){var x=arguments[I].uv;i.push(x[0],x[1])}},$=function(W,p,R,K,Z){var J=-K*e(Z),m=K*U(Z);return new qk(W.x+J*R.x+m*p.x,W.y+J*R.y+m*p.y,W.z+J*R.z+m*p.z)},b=function(E,F,N,i,Q,g,z,R){z=z||w;for(var X=[],o=z/Q,f=0;Q>=f;f++){var c=$(E,F,N,i,f*o+g);X.push(c),R!=V&&(c.uv=[R,f/Q])}return X},_=function(J,u,B,y,j,M,G,i,s){s=s||w;var l=u?J.top_vs:J.bottom_vs;if(l)for(var C=u?J.top_uv:J.bottom_uv,K=s/G,d=0;G>d;d++){var m,H;u?(m=d*K+i,H=(d+1)*K+i):(H=d*K+i,m=(d+1)*K+i),X(l,$(B,y,j,M,m),$(B,y,j,M,H),B),C&&C.push(.5-.5*e(m),.5-.5*U(m),.5-.5*e(H),.5-.5*U(H),.5,.5)}};return function(p,z,U,B,K,$,I,s,d){var R=z.length;if(R>1){var k,L,e,m,g,r,q,H=Sh(z),Z=H.T,S=H.N,y=H.B;"flat"===s&&_(p,!0,z[0],y[0],S[0],B,K,$,I),"flat"===d&&_(p,!1,z[R-1],y[R-1],S[R-1],B,K,$,I);var o,i,x=[],O=j(K/2),N="round"===s,c="round"===d,f=z[0],J=Z[0],E=y[0],t=S[0],W=z[R-1],a=Z[R-1],n=y[R-1],w=S[R-1];if(N){for(e=1;O>=e;e++)S.splice(0,0,t),y.splice(0,0,E),Z.splice(0,0,J),i=-e/O*B,z.splice(0,0,J.clone().multiplyScalar(i).add(f)),x[O-e]=Y(B*B-i*i);R+=O}if(c){for(e=1;O>=e;e++)S.push(w),y.push(n),Z.push(a),i=e/O*B,z.push(a.clone().multiplyScalar(i).add(W)),x[z.length-1]=Y(B*B-i*i);R+=O}if(p.uv){var T=0,u=0,l=[];for(U&&(T=U),g=z[0],l[0]=0,e=1;R>e;e++)m=z[e],l[e]=g.distanceTo(m),g=m,U||(T+=l[e]);for(o=[],e=0;R>e;e++)u+=l[e],o[e]=T?u/T:0}for(e=0;R>e;e++){if(m=z[e],r=y[e],q=S[e],k=b(m,r,q,x[e]===C?B:x[e],K,$,I,o?o[e]:V),L)for(var v=0;K>v;v++){var h=L[v],F=L[v+1]||L[0],Q=k[v],P=k[v+1]||k[0];X(p.vs,F,h,Q,Q,P,F),p.uv&&M(p.uv,F,h,Q,Q,P,F)}L=k}}}}();dc(m,{getLineLength:function(R){return R[R.length-1].length},getLineOffset:function(H,P){return fj(H,P)},getLineCacheInfo:function(j,f,p,V){return js(Oe(j,f,p,V))}});var Vk=k.graph3d.RenderLite={},sl=new Array(0),Wo=Vk.Buffer=function(D,F,R,d){this.gl=D,this.buffer=D.createBuffer(),this.type=F||D.ARRAY_BUFFER,this.drawType=d||D.STATIC_DRAW,this.data=sl,R&&this.upload(R)};Wo.prototype.upload=function(h,I,z){z||this.bind();var Z=this.gl;h=h||this.data,I=I||0,this.data.byteLength>=h.byteLength?Z.bufferSubData(this.type,I,h):Z.bufferData(this.type,h,this.drawType),this.data=h},Wo.prototype.bind=function(){var f=this.gl;f.bindBuffer(this.type,this.buffer)},Wo.createVertexBuffer=function(I,s,b){return new Wo(I,I.ARRAY_BUFFER,s,b)},Wo.createIndexBuffer=function(a,$,J){return new Wo(a,a.ELEMENT_ARRAY_BUFFER,$,J)},Wo.create=function(y,v,_,$){return new Wo(y,v,$)},Wo.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};var Yg=Vk.Shader=function(k,M,A){this.gl=k,this.program=Tq(k,M,A),this.attributes=Tl(k,this.program);var o=Aq(k,this.program);this.uniforms=wq(k,o)};Yg.prototype.bind=function(){this.gl.useProgram(this.program)},Yg.prototype.destroy=function(){this.gl};var Tq=function(N,A,J){var q=Sf(N,N.VERTEX_SHADER,A),Z=Sf(N,N.FRAGMENT_SHADER,J);N.getShaderParameter(Z,N.COMPILE_STATUS)||console.error(N.getError());var U=N.createProgram();return N.attachShader(U,q),N.attachShader(U,Z),N.linkProgram(U),N.getProgramParameter(U,N.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",N.getProgramParameter(U,N.VALIDATE_STATUS)),console.error("gl.getError()",N.getError()),""!==N.getProgramInfoLog(U)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",N.getProgramInfoLog(U)),N.deleteProgram(U),U=null),N.deleteShader(q),N.deleteShader(Z),U},Sf=function(Q,N,Z){var z=Q.createShader(N);return Q.shaderSource(z,Z),Q.compileShader(z),Q.getShaderParameter(z,Q.COMPILE_STATUS)?z:(console.log(Q.getShaderInfoLog(z)),null)},Aq=function(K,d){for(var B={},e=K.getProgramParameter(d,K.ACTIVE_UNIFORMS),g=0;e>g;g++){var _=K.getActiveUniform(d,g),h=_.name.replace(/\[.*?\]/,""),y=hk(K,_.type);B[h]={type:y,size:_.size,location:K.getUniformLocation(d,h),value:Oj(y,_.size)}}return B},Tl=function(o,V){for(var N={},A=o.getProgramParameter(V,o.ACTIVE_ATTRIBUTES),n=0;A>n;n++){var k=o.getActiveAttrib(V,n),z=hk(o,k.type);N[k.name]={type:z,size:mn(z),gl:o,location:o.getAttribLocation(V,k.name),pointer:jf}}return N},jf=function(q,Z,T,H,c){var V=this.gl;V.enableVertexAttribArray(this.location),V.bindBuffer(q.type,q.buffer),V.vertexAttribPointer(this.location,this.size,Z||V.FLOAT,T||!1,H||0,c||0)},mn=function(E){return jb[E]},jb={"float":1,vec2:2,vec3:3,vec4:4,"int":1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1},hk=function(l,y){if(!de){var J=H.keys(bp);de={};for(var M=0;M<J.length;++M){var N=J[M];de[l[N]]=bp[N]}}return de[y]},de=null,bp={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"},Oj=function(y,f){switch(y){case"float":return 0;case"vec2":return new Float32Array(2*f);case"vec3":return new Float32Array(3*f);case"vec4":return new Float32Array(4*f);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*f);case"ivec3":return new Int32Array(3*f);case"ivec4":return new Int32Array(4*f);case"bool":return!1;case"bvec2":return Bg(2*f);case"bvec3":return Bg(3*f);case"bvec4":return Bg(4*f);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},Bg=function(r){for(var J=new Array(r),E=0;E<J.length;E++)J[E]=!1;return J},wq=function(S,o){var U={data:{}};U.gl=S;for(var q=H.keys(o),A=0;A<q.length;A++){var l=q[A],F=l.split("."),T=F[F.length-1],c=cj(F,U),d=o[l];c.data[T]=d,c.gl=S,H.defineProperty(c,T,{get:Fr(T),set:is(T,d)})}return U},Fr=function(A){var l=zm.replace("%%",A);return new Function(l)},is=function(M,i){var a,S=Fh.replace(/%%/g,M);return a=1===i.size?Zf[i.type]:lm[i.type],a&&(S+="\nthis.gl."+a+";"),new Function("value",S)},cj=function(V,H){for(var m=H,I=0;I<V.length-1;I++){var y=m[V[I]]||{data:{}};m[V[I]]=y,m=y}return m},zm=["return this.data.%%.value;"].join("\n"),Fh=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),Zf={"float":"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])","int":"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)"},lm={"float":"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)","int":"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"},Cd=k.Light=function(){Hh(Cd,this),this.s(kl,g[kl]),this.s(Hc,"sphere"),this.s3(20,20,20)
};Ni("Light",Gk,{_image:"light_icon",_icon:"light_icon",onStyleChanged:function(q,v,l){Cd.superClass.onStyleChanged.apply(this,arguments),q===kl&&this.s("shape3d.color",l)}});var Ad=Yf.Graph3dView=function(z,J){var I=this;I._webGLVersion=1,I._attributes=J||m.graph3dViewAttributes,I._25I={},I._view=np(1,I);var L=I._canvas=sk(I._view);L.addEventListener("webglcontextlost",function($){$.preventDefault(),hm(I),I._26I&&I._doBufferGC(I._26I,!0),I._26I=V,I._1o.texture=V,I._35O=!0},B),L.addEventListener("webglcontextrestored",function(){I._35O=!1,I.iv()},B),I._batchIndexMap={},I._batchModelMap={},I._wireframeIndexMap={},I._wireframeModelMap={},I._wireframeIndexMapSwap={},I._wireframeModelMapSwap={},I._polylineIndexMap={},I._polylineIndexMap={},I._polylineIndexMapSwap={},I._polylineIndexMapSwap={},I._8O=[],I._7O=Yq(),I._6O=Yq(),I._1o=new vd(I),I._30O=new po(I),I._31O=new di(I),I._32O=new id(I),I._raycaster=new Ei(I),I._highlightHelper=new jj(I),I._postProcessing=new mi(I),I._cameras=[],I._cameraId=0,I.vr=new wb(I),I._33Q=!0,I._eye=Zq(m.graph3dViewEye),I._center=Zq(m.graph3dViewCenter),I._up=Zq(m.graph3dViewUp),I._lightChanged=!1,I._59O=[],I._spots=[],I._dirs=[],I._frameId=0,I.overlappingBox=new Il(I),I.dm(z?z:new bi),I._coreInteractor=new sm(this),I.setInteractors([new Ic(I)])},lq={fogDisabled:1,dashDisabled:1,batchColorDisabled:1,batchBlendDisabled:1,batchBrightnessDisabled:1,ortho:1},lj=function(E,t,o,p){E.clearColor(0,0,0,0),E.clearDepth(1),E.enable(E.DEPTH_TEST),E.depthFunc(E.LEQUAL),E.disable(E.CULL_FACE),E.enable(E.BLEND),E.blendFuncSeparate(E.SRC_ALPHA,E.ONE_MINUS_SRC_ALPHA,E.ONE,E.ONE_MINUS_SRC_ALPHA),E.useProgram(o),rk(E,o.uBrightness,1),rk(E,o.uOpacity,1),rk(E,o.uPartOpacity,1),rk(E,o.uPick,p._picking),rk(E,o.uTexture,!1),rk(E,o.uBlendTexture,!1),rk(E,o.uAlphaTest,g.alphaTest),rk(E,o.uTransparent,!1),rk(E,o.uFix,!1),rk(E,o.uBatchColor,!1),rk(E,o.uBatchBlend,!1),rk(E,o.uBatchBrightness,!1),rk(E,o.uReflectivity,p._envmapReflectivity),rk(E,o.uCameraPosition,t.getEye()),rk(E,o.uPMatrix,p._projectMatrix),rk(E,o.uViewMatrix,p._viewMatrix),t.bindEnvMap(E),p._picking||(vq(t,E,o),t._fogDisabled||(rk(E,o.uFogColor,t._fogColor),rk(E,o.uFogNear,t._fogNear),rk(E,o.uFogFar,t._fogFar))),os(E,o.aPosition),os(E,o.aNormal),Nf(E,o.aUv),Nf(E,o.aBatchColor),Nf(E,o.aBatchBlend),Nf(E,o.aBatchBrightness),Nf(E,o.aLineDistance),E.depthMask(!0)},um=0;Cg("Graph3dView",H,{ms_v:1,ms_tip:1,ms_gv:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_51o:1,ms_ac:["devicePixelRatio","boundaries","moveStep","rotateStep","editHelperDisabled","sizeEditableFunc","rotationEditableFunc","editableFunc","rotatable","zoomable","pannable","walkable","resettable","mouseRoamable",_r,Cf,"firstPersonMode",_d,"movableFunc","gridVisible","gridSize","gridGap","gridColor","originAxisVisible","centerAxisVisible","axisXColor","axisYColor","axisZColor","editSizeColor","rectSelectable","rectSelectBackground","headlightRange","headlightColor","headlightIntensity","headlightDisabled","ortho","orthoWidth","fovy","near","far",Cb,zg,"up","aspect","fogDisabled","fogColor","fogNear","fogFar","dashDisabled","batchColorDisabled","batchBlendDisabled","batchBrightnessDisabled","hoverDelay"],_editable:!1,_editHelperDisabled:m.graph3dViewEditHelperDisabled,_devicePixelRatio:C,_boundaries:C,_moveStep:m.graph3dViewMoveStep,_rotateStep:m.graph3dViewRotateStep,_pannable:m.graph3dViewPannable,_rotatable:m.graph3dViewRotatable,_walkable:m.graph3dViewWalkable,_resettable:m.graph3dViewResettable,_zoomable:m.graph3dViewZoomable,_firstPersonMode:m.graph3dViewFirstPersonMode,_mouseRoamable:m.graph3dViewMouseRoamable,_gridVisible:m.graph3dViewGridVisible,_gridSize:m.graph3dViewGridSize,_gridGap:m.graph3dViewGridGap,_gridColor:m.graph3dViewGridColor,_originAxisVisible:m.graph3dViewOriginAxisVisible,_centerAxisVisible:m.graph3dViewCenterAxisVisible,_axisXColor:m.graph3dViewAxisXColor,_axisYColor:m.graph3dViewAxisYColor,_axisZColor:m.graph3dViewAxisZColor,_ortho:m.graph3dViewOrtho,_orthoWidth:m.graph3dViewOrthoWidth,_fovy:m.graph3dViewFovy,_near:m.graph3dViewNear,_far:m.graph3dViewFar,_headlightColor:m.graph3dViewHeadlightColor,_headlightIntensity:m.graph3dViewHeadlightIntensity,_headlightRange:m.graph3dViewHeadlightRange,_headlightDisabled:m.graph3dViewHeadlightDisabled,_rectSelectable:m.graph3dViewRectSelectable,_rectSelectBackground:m.graph3dViewRectSelectBackground,_editSizeColor:m.graph3dViewEditSizeColor,_autoMakeVisible:Ai,_fogDisabled:m.graph3dViewFogDisabled,_fogColor:m.graph3dViewFogColor,_fogNear:m.graph3dViewFogNear,_fogFar:m.graph3dViewFogFar,_dashDisabled:m.graph3dViewDashDisabled,_batchColorDisabled:m.graph3dViewBatchColorDisabled,_batchBlendDisabled:m.graph3dViewBatchBlendDisabled,_batchBrightnessDisabled:m.graph3dViewBatchBrightnessDisabled,addCamera:function(O){var Q=H.freeze({id:this._cameraId++,priority:O.priority||0,ignoreInPick:!!O.ignoreInPick,useDefaultProgram:!!O.useDefaultProgram,render:O.render});this._cameras.push(Q),this._cameras.sort(function(s,E){return s.priority!==E.priority?s.priority-E.priority:s.id-E.id})},setEye:function(M,G,e){1===arguments.length&&(G=M[1],e=M[2],M=M[0]);var J=this._eye;J[0]=M,J[1]=G,J[2]=e,this.fp(Cb,V,J)},setCenter:function(G,_,f){1===arguments.length&&(_=G[1],f=G[2],G=G[0]);var I=this._center;I[0]=G,I[1]=_,I[2]=f,this.fp(zg,V,I)},setUp:function(r,T,O){1===arguments.length&&(T=r[1],O=r[2],r=r[0]);var i=this._up;i[0]=r,i[1]=T,i[2]=O,this.fp("up",V,i)},getDevicePixelRatio:function(){return this._devicePixelRatio||lo},isTransparentMask:function(w){return w.s("transparent.mask")},getCoreInteractor:function(){return this._coreInteractor},getHighlightHelper:function(){return this._highlightHelper},getRaycaster:function(){return this._raycaster},getAspect:function(){var G=this,k=G._aspect;return k?k:(k=G.getWidth()/G.getHeight(),k||1.2)},getCanvas:function(){return this._canvas},setDataModel:function(h){var F=this,Z=F._dataModel,W=F._selectionModel;Z!==h&&(Z&&(Z.ump(F.handleDataModelPropertyChange,F),Z.umm(F.handleDataModelChange,F),Z.umd(F.handleDataPropertyChange,F),W||Z.sm().ums(F.handleSelectionChange,F)),F._dataModel=h,h.mp(F.handleDataModelPropertyChange,F),h.mm(F.handleDataModelChange,F),h.md(F.handleDataPropertyChange,F),W?W._21I(h):h.sm().ms(F.handleSelectionChange,F),F._postProcessing.handleDataModleChange(Z,h),F.invalidateAll(!0),F.invalidateLight(),F.fp(al,Z,h),F._canvas.style.background=h.getBackground()||"")},handleDataModelPropertyChange:function(m){if("background"===m.property){var k=this._canvas.style.background,i=m.newValue||"";this._canvas.style.background=i,this.fp("canvasBackground",k,i)}else"envmap"===m.property&&this.iv()},handleDataPropertyChange:function(J){var Y=J.data;this.invalidateData(Y),Sk(Y)&&"s:light.type"===J.property&&this.invalidateLight()},invalidateLight:function(){this._lightChanged||(this._lightChanged=!0,this.iv())},onPropertyChanged:function(e){var D=this,n=e.property;D.iv(),D._18Q=V,"eye"===n?D._33Q=!0:"devicePixelRatio"===n?D._42(V,D.getDevicePixelRatio()):lq[n]&&hm(D)},_5O:function(K){var z=K._22Q();return z?new z(this,K):V},getData3dUI:function(K){var r=this._25I[K._id];return r===C&&(r=this._5O(K),this._25I[K._id]=r),r},invalidateAll:function(P){var p=this;if(P){for(var U in p._25I){var c=p._25I[U];c&&c.dispose()}p._25I={},p.iv(),ek(p)}else ek(p),p.dm().each(function(Q){p.invalidateData(Q)})},invalidateSelection:function(){var I=this;I.sm().each(function(N){I.invalidateData(N)})},invalidateData:function(m){var q=this,y=q.getData3dUI(m);y&&(y.iv(),q.iv()),ek(q,m)},getShape3dText:function(C){return C.getStyle("shape3d.text")||this.getLabel(C)},invalidateBatch:function(g){var y=this,c=y._batchModelMap,r=c[g],Y=[],T={};if(r){r.ds.forEach(function(H){var d=y.getData3dUI(H);d&&d.iv(),delete y._batchIndexMap[H._id],Y.push(H._id)}),delete c[g];for(var H,J,L,e,A,V,n,f,k,X=["_wireframeModelMap","_polylineModelMap","_wireframeModelMapSwap","_polylineModelMapSwap"],W=["_wireframeIndexMap","_polylineIndexMap","_wireframeIndexMapSwap","_polylineIndexMapSwap"],h=0;h<X.length;h++){var Q=y[X[h]],x=y[W[h]];for(T={},f=0;f<Y.length;f++){var m=x[Y[f]];if(m){delete x[Y[f]],k=m.batch,H=Q[k];var u=m.begin,b=m.size,R=3*u,z=3*b,O=4*u,D=4*b;for(J=H.ds,L=H.vs,e=H.cs,A=H.ps,V=H.ls,n=m.index,H.invalidate=!0,J[n]=C,n=R;R+z>n;n++)L[n]=C;for(n=O;O+D>n;n++)e[n]=C;for(n=O;O+D>n;n++)A[n]=C;if(V)for(n=R;R+z>n;n++)V[n]=C;T[k]=!0}}for(k in T){H=Q[k],J=H.ds,L=H.vs,e=H.cs,A=H.ps,V=H.ls;var K=[];for(n=0;n<J.length;n++)J[n]!==C&&K.push(J[n]);if(0===K.length)delete Q[k];else{for(H.ds=K,K=[],n=0;n<L.length;n++)L[n]!==C&&K.push(L[n]);for(H.vs=K,K=[],n=0;n<e.length;n++)e[n]!==C&&K.push(e[n]);for(H.cs=K,K=[],n=0;n<A.length;n++)A[n]!==C&&K.push(A[n]);if(H.ps=K,V){for(K=[],n=0;n<V.length;n++)V[n]!==C&&K.push(V[n]);H.ls=K}}}}y.iv()}},handleDataModelChange:function(H){var P=this,J=H.kind,W=H.data;if("add"===J)P.invalidateData(W),ee(W)&&W.getEdgeGroup()&&W.getEdgeGroup().eachSiblingEdge(P.invalidateData,P),Sk(W)&&P.invalidateLight();else if(J===ih){var A=W._id,b=P._25I[A];b&&(b.dispose(),delete P._25I[A],P.iv()),W===P._currentSubGraph&&P.setCurrentSubGraph(V),ek(P,W),Sk(W)&&P.invalidateLight()}else J===cn&&(P.invalidateAll(!0),P.setCurrentSubGraph(V),ek(P),P.invalidateLight())},toCanvas:function(s,l,r){var y=this,W=y.getGL();if(y.validate(),s){var B=W.getParameter(W.COLOR_CLEAR_VALUE);vp(W,s)}y._42(V,1);var U=y.getWidth(),o=y.getHeight(),x=new Uint8Array(4*U*o),H=sk(),I=H.getContext("2d");W.readPixels(0,0,U,o,W.RGBA,W.UNSIGNED_BYTE,x),ye(H,U,o,1);for(var f=I.getImageData(0,0,U,o),n=f.data,u=0;u<n.length;u+=4){var k=u/4,L=$(k/U),w=k-L*U;k=4*((o-1-L)*U+w),n[k]=x[u],n[k+1]=x[u+1],n[k+2]=x[u+2],n[k+3]=x[u+3]}if(I.putImageData(f,0,0),s&&vp(W,B),y._42(V,y.getDevicePixelRatio()),l&&r){var Z=sk(),i=Z.getContext("2d");return l=l,r=r,ye(Z,l,r,1),m.drawImage(i,H,0,0,l,r),Z}return H},toDataURL:function(o,h){var a=this,M=a.getGL();if(a.validate(),o){var u=M.getParameter(M.COLOR_CLEAR_VALUE);vp(M,o)}a._42(V,1);var I=a._canvas.toDataURL(h||"image/png",1);return o&&vp(M,u),a._42(V,a.getDevicePixelRatio()),I},getGL:function(){var j=this._26I;if(j)return this.acquireProgram(),j;var N=this,l=N._canvas,_=N._attributes;try{j=l.getContext("webgl2",_)||l.getContext("experimental-webgl2",_),j&&(N._webGLVersion=2,N._26I=j)}catch(w){}if(!j)try{j=l.getContext("webgl",_)||l.getContext("experimental-webgl",_)}catch(w){throw new Error("WebGL not supported")}if(!j)throw new Error("WebGL not supported");N._26I=j,N._glExtensions=new c(j),N._glCapabilities=new E(j,N._glExtensions),N._2O={},j._emptyTexture=ks(j),j._emptyBlendTexture=ks(j),j._bufPool={},j._id=++um,N._buffer={vs:xe(j),ns:xe(j),is:xe(j),uv:xe(j),batchColor:xe(j),batchBlend:xe(j),batchBrightness:xe(j),lineDistance:xe(j)},N._1O=pr(j);var p=N._cube={vs:xe(j),ns:xe(j),is:xe(j),uv:xe(j)};return fk(j,p.vs,bh),fk(j,p.ns,So),fk(j,p.uv,wr),ak(j,p.is,Ef),N.acquireProgram(),j},getEnvmap:function(){return this._glCapabilities&&this._glCapabilities.maxVertexTextures<16?null:this.dm().getEnvmap()},acquireProgram:function(){var Z=this,l=Z._26I;if(l){var T=k.Default.getImage(Z.getEnvmap())?!0:!1,y=Z._prg&&Z._prg.envMapFlag?!0:!1;if(!Z._prg||T!==y){var F=Z._prg=l.createProgram();if(!F)return V;F.envMapFlag=T;var s=Z._dirs.length,D=Z._spots.length,A=Z._59O.length,g=["uPMatrix","uMVMatrix","uMMatrix","uReflectivity","uViewMatrix","uUseEnvMap","uEnvMap","uCameraPosition","uNMatrix","uViewMatrix","aNormal","aUv","uOffsetScale","uDiffuse","uBlend","uBlendColor","uBrightness","uPartOpacity","uAlphaTest","uTransparent","uTexture","uBlendTexture","uSampler","uBlendSampler","uDiscardSelectable","uFix","uPick","uReverseFlip","uFixPickReverseColor","uBatchBrightness","aBatchBrightness","uBatchColor","aBatchColor","uBatchBlend","aBatchBlend","uDash","aLineDistance","uDashDistance","uDashGapDistance","uLight","uHeadlightRange","uHeadlightColor","uFogColor","uFogNear","uFogFar"];s&&g.push("uDirColor","uDirDirection"),D&&g.push("uSpotColor","uSpotRange","uSpotAngle","uSpotExponent","uSpotPosition","uSpotDirection"),A&&g.push("uPointColor","uPointRange","uPointPosition"),vp(l,[0,0,0,0]),l.clearDepth(1),l.enable(l.DEPTH_TEST),l.depthFunc(l.LEQUAL),l.enable(l.BLEND),l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA),Zh||(wn=kd(wn.substring(0,wn.indexOf("^#"))),Cr=kd(Cr),Zh=!0);var m=["#define MAX_DIR "+s,"#define MAX_SPOT "+D,"#define MAX_POINT "+A,Z._fogDisabled?"":"#define FOG",Z._dashDisabled?"":"#define DASH",T?"#define USE_ENVMAP":"",Z.isOrtho()?"#define ORTHOGRAPHIC":"",Z._batchColorDisabled?"":"#define BATCHCOLOR",Z._batchBlendDisabled?"":"#define BATCHBLEND",Z._batchBrightnessDisabled?"":"#define BATCHBRIGHTNESS",""].join("\n"),C=Ee(l,F,l.VERTEX_SHADER,wn.replace("PREFIX",m));l.getShaderParameter(C,l.COMPILE_STATUS)||console.error("compile vs shader faild, error info : ",l.getShaderInfoLog(C));var h=Ee(l,F,l.FRAGMENT_SHADER,Cr.replace("PREFIX",m));l.getShaderParameter(h,l.COMPILE_STATUS)||console.error("compile fs shader faild, error info : ",l.getShaderInfoLog(h)),Jk?g.push("aPosition"):(F.aPosition=0,l.bindAttribLocation(F,0,"aPosition")),l.linkProgram(F),g.forEach(function(m){F[m]=/^u/.test(m)?l.getUniformLocation(F,m):l.getAttribLocation(F,m)}),l.useProgram(F),l.deleteShader(C),l.deleteShader(h)}}},getBrightness:function(i){var x=i.s("brightness"),z=this.isSelected(i)?i.s("select.brightness"):V;return x==V?z:z==V?x:x*z},setHighlightMode:function(K){var x;x="selection"===K?jj.Mode.Selection:"mouseover"===K?jj.Mode.MouseOver:jj.Mode.Disable,this._highlightHelper.mode=x},getHighlightMode:function(){var z=this._highlightHelper.mode;return z===jj.Mode.Selection?"selection":z===jj.Mode.MouseOver?"mouseover":"disable"},bindEnvMap:function(g){var b=this,u=b._prg,K=5,O=b.getEnvmap(),d=k.Default.getImage(O);if(d){if(O!==b._lastEnvMap){b._envMapTexture&&g.deleteTexture(b._envMapTexture);var M=b._envMapTexture=g.createTexture();g.activeTexture(g.TEXTURE0),g.bindTexture(g.TEXTURE_CUBE_MAP,M),g.texParameteri(g.TEXTURE_CUBE_MAP,g.TEXTURE_MAG_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_CUBE_MAP,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,d),g.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,d),g.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,d),g.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,d),g.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,d),g.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,d),g.bindTexture(g.TEXTURE_CUBE_MAP,null),b._lastEnvMap=O}g.activeTexture(g.TEXTURE0+K),g.bindTexture(g.TEXTURE_CUBE_MAP,b._envMapTexture),g.uniform1i(u.uEnvMap,K)}},getWireframe:function(P){var y=P.s("wf.visible"),_=P.s("wf.width");return y===!0||_>0&&"selected"===y&&this.isSelected(P)?{color:P.s("wf.color"),width:_,"short":P.s("wf.short"),mat:P.s("wf.mat")}:void 0},_transformPointToViewSpace:function(L){var V=[L[0],L[1],L[2]];return Qf(V,this._viewMatrix),V},_transformDirectionToViewSpace:function(k,i){var P=[k[0],k[1],k[2]];Qf(P,this._viewMatrix);var z=i?[i[0],i[1],i[2]]:[0,0,0];Qf(z,this._viewMatrix);var d=z[0]-P[0],D=z[1]-P[1],h=z[2]-P[2],v=Math.sqrt(d*d+D*D+h*h);return v?[d/v,D/v,h/v]:[d,D,h]},getWireframeGeometry:function(G){return G.s("wf.geometry")?{color:G.s("wf.color"),width:G.s("wf.width"),mat:G.s("wf.mat"),geometry:!0}:void 0},getBodyColor:function(C){return C.s("body.color")},getMat:function(H){return H.getMat?H.getMat():H.s("mat")},getFaceMat:function(m,o){return m.getFaceMat?m.getFaceMat(o):m.s(o+".mat")},getFaceBlend:function(i,K){return i.s(K+".blend")||i.s("all.blend")},getFaceColor:function(n,N){return n.s(N+".color")||n.s("all.color")},getFaceImage:function(j,z){return j.s(z+".image")||j.s("all.image")},getFaceBlendImage:function(K,s){return K.s(s+".blend.image")||K.s("all.blend.image")},getFaceDiscardSelectable:function(y,R){var t=y.s(R+".discard.selectable");return t==V?y.s("all.discard.selectable"):t},getFaceUv:function(v,i){return v.s(i+".uv")||v.s("all.uv")},getFaceUvOffset:function(X,s){return X.s(s+".uv.offset")||X.s("all.uv.offset")},getFaceUvScale:function(W,m){return W.s(m+".uv.scale")||W.s("all.uv.scale")},getFaceLight:function(v,P){var G=v.s(P+".light");return G==V?v.s("all.light"):G},getFaceVisible:function(I,J){var Q=I.s(J+".visible");return Q==V?I.s("all.visible"):Q},getFaceOpacity:function(o,M){var U=o.s(M+".opacity");return U==V?o.s("all.opacity"):U},getFaceTransparent:function(u,Z){var B=u.s(Z+".transparent");return B==V?u.s("all.transparent"):B},getFaceReverseColor:function(u,d){return u.s(d+".reverse.color")||u.s("all.reverse.color")},getFaceReverseFlip:function(G,K){var c=G.s(K+".reverse.flip");return c==V?G.s("all.reverse.flip"):c},getFaceReverseCull:function(S,h){var t=S.s(h+".reverse.cull");return t==V?S.s("all.reverse.cull"):t},getTextureMap:function(){return this._2O},deleteTexture:function(G){var A=this,p=A._2O[G];p&&(delete A._2O[G],A.getGL().deleteTexture(p))},invalidateShape3dCachedImage:function(N){var m=this.getData3dUI(N);m.invalidateCachedTexture(this.getGL())},isInteractive:function(N){return N.s("interactive")},getTexture:function(s,K){if(!s)return V;var h=this,o=h.getGL(),G=h._2O[s];if(!G){var n=hs(s);if(!n)return o._emptyTexture;if(n.uuid||(n.uuid=k.Math.generateUUID()),n.tagName){if(n.dynamic)return pr(o,n,h._1O);G=h._2O[s]=pr(o,n)}else{var H,x=K&&K.s("shape3d.image.cache")&&!h.isInteractive(K),L=h.vr.isPresenting();if(L&&(K._textureUpdateFrame===o._renderInfo.frame?x=!0:K._textureUpdateFrame=o._renderInfo.frame),x&&(H=h.getData3dUI(K),G=H.getCachedTexture()),!G){if(x){if(o._renderInfo.cacheTimeCost>m.graph3dMaxVectorCacheTime)return h.redraw(),o._emptyTexture;if(!Th(n,K))return o._emptyTexture}var $,t=K&&K.s("shape3d.fixSizeOnScreen"),f=t?o.NEAREST:o.LINEAR;t||K&&K.s("shape3d.vector.dynamic")&&(H||(H=h.getData3dUI(K)),t=H.getVectorDynamicSize(),t&&($=h.getDevicePixelRatio(),t[0]*=$,t[1]*=$));var F,J,d=K&&K.s("shape3d.texture.scale")||1;if(t?($||($=h.getDevicePixelRatio()),F=t[0]>0?t[0]:d*si(n,K)*$,J=t[1]>0?t[1]:d*of(n,K)*$):(F=d*si(n,K),J=d*of(n,K)),F>=1&&J>=1){var y=0;x&&(y=Date.now());var D=Uf(F,J);if(!H&&K&&(H=h.getData3dUI(K)),H&&H.interactiveInfo){var U=s;"object"==typeof U&&(U=U.uuid||(U.uuid=k.Math.generateUUID()));var B=H.interactiveInfo[U]={};D.interactiveInfo=B.bodyInfo={compInfos:[],matrix:new Eh,rect:{x:0,y:0,width:F,height:J}}}Af(D,n,0,0,F,J,K,h),D.interactiveInfo&&(D.interactiveInfo=null),D.restore(),x||L?(G=pr(o,ub,null,f),H.setCachedTexture(G),o._renderInfo.cacheTimeCost+=Date.now()-y,ub=null):G=pr(o,ub,h._1O,f)}}}}return G},redraw:function(){this.iv()},validateImpl:function(){var O=this;if(O._lightChanged){O._lightChanged=!1;var F=[],z=[],Y=[];O.dm().each(function(g){if(Sk(g)){var h=g.s("light.type");h===sh?F.push(g):h===Wr?z.push(g):h===El&&Y.push(g)}}),(F.length!==O._59O.length||z.length!==O._spots.length||Y.length!==O._dirs.length)&&hm(O),O._59O=F,O._spots=z,O._dirs=Y}O._42(),O._1o.iv()},getRenderInfo:function(){var h=this.getGL();return h?h._renderInfo:void 0},getDebugTip:function(){var k=this,b=k.getRenderInfo();if(b){var $=k.getGL()._validBufCount||0,l="Draw Calls: "+b.calls+"<br/>"+"Vertices: "+b.vertices+"<br/>"+"Faces: "+b.faces+"<br/>"+"Lines: "+b.lines+"<br/>"+"Buffer Count: "+$;return k.vr.isPresenting()&&(l+="<br/>VR fps: "+k.vr.getFps()),l}},_42:function(M,e){var r=this;if(!r._35O&&(!Pe||Km(Pe))){var X,S;M&&(M instanceof Gk?S=M:X=M);var u=r._canvas,h=r.getGL(),C=r._prg;if(h){var Y=r.getWidth(),b=r.getHeight();if(Y&&b){e?M||ye(u,Y,b,e):(e=r.getDevicePixelRatio(),M||Y===u.clientWidth&&b===u.clientHeight||ye(u,Y,b,e)),h.clear(h.COLOR_BUFFER_BIT),r.drawFilter||(h._renderInfo={calls:0,vertices:0,faces:0,lines:0,frame:M?r._frameId:++r._frameId,cacheTimeCost:0});var z,x=this._cameras,I=0,d=x.length,B=!1,D=k.Default.cameraPriority.skybox,p=k.Default.cameraPriority.main,m=k.Default.cameraPriority.top,f=Y*e,_=b*e,A=function(){r.overlappingBox.clear(),r._81O=V,h.clear(h.DEPTH_BUFFER_BIT),h._picking=!!M;var P={_picking:!!M,_envmapReflectivity:r._envmapReflectivity||.5,_projectMatrix:r._projectMatrix=sj(r),_viewMatrix:Bl(r,r._7O)};if(r._viewMatrix=ko(r._7O),S){lj(h,r,C,P);var a=h.getParameter(h.COLOR_CLEAR_VALUE);h.clearColor(0,0,0,0),h.disable(h.BLEND),Nf(h,C.aNormal),fk(h,r._cube.vs,V,C.aPosition),ak(h,r._cube.is),jd(S,r,ws,0),jd(S,r,Bn,6),jd(S,r,Hn,12),jd(S,r,rg,18),jd(S,r,qs,24),jd(S,r,rq,30),os(h,C.aNormal),vp(h,a)}else if(X){for(X.value=2;d>I;I++)if(z=x[I],!z.ignoreInPick){if(z.priority>=p)break;z.useDefaultProgram&&lj(h,r,C,P),z.render(h,r,X)}lj(h,r,C,P);var a=h.getParameter(h.COLOR_CLEAR_VALUE);for(h.clearColor(0,0,0,0),h.disable(h.BLEND),r._95I(h,C,X),An(r,X),vk(r,r._polylineModelMap,X),vk(r,r._wireframeModelMap,X),rk(h,C.uTransparent,!0),r._95I(h,C,X,!0),An(r,X,!0),vk(r,r._polylineModelMap,X,!0),vk(r,r._wireframeModelMap,X,!0),rk(h,C.uTransparent,!1);d>I;I++)if(z=x[I],!z.ignoreInPick){if(z.priority>=m)break;z.useDefaultProgram&&lj(h,r,C,P),z.render(h,r,X),B=!0}for(B&&(lj(h,r,C,P),B=!1),h.clear(h.DEPTH_BUFFER_BIT),r._swapLineMap(),r._95I(h,C,X,!1,!0),vk(r,r._polylineModelMap,X),vk(r,r._wireframeModelMap,X),r._swapLineMap(),r._swapLineMap(),r._95I(h,C,X,!1,!0),vk(r,r._polylineModelMap,X),vk(r,r._wireframeModelMap,X),rk(h,C.uTransparent,!0),r._95I(h,C,X,!0,!0),vk(r,r._polylineModelMap,X,!0),vk(r,r._wireframeModelMap,X,!0),rk(h,C.uTransparent,!1),r._swapLineMap(),h.disable(h.DEPTH_TEST),r.drawFilter||r._30O._42(h,C,X),h.enable(h.DEPTH_TEST);d>I;I++)z=x[I],z.ignoreInPick||(z.useDefaultProgram&&lj(h,r,C,P),z.render(h,r,X));vp(h,a)}else{for(;d>I&&(z=x[I],!(z.priority>=D));I++)z.useDefaultProgram&&lj(h,r,C,P),z.render(h,r);for(lj(h,r,C,P),h.disable(h.BLEND),r.drawSky(h,C),r.drawReflectors(h,f,_,A,M)&&(P._projectMatrix=r._projectMatrix=sj(r),P._viewMatrix=Bl(r,r._7O),r._viewMatrix=ko(r._7O),lj(h,r,C,P));d>I&&(z=x[I],!(z.priority>=p));I++)z.useDefaultProgram&&lj(h,r,C,P),z.render(h,r),B=!0;for(B&&(lj(h,r,C,P),B=!1),r._31O._42(h,C),r._95I(h,C),An(r),vk(r,r._polylineModelMap),vk(r,r._wireframeModelMap),h.enable(h.BLEND),h.depthMask(!1),rk(h,C.uTransparent,!0),r._95I(h,C,V,!0),An(r,V,!0),vk(r,r._polylineModelMap,V,!0),vk(r,r._wireframeModelMap,V,!0),h.depthMask(!0),rk(h,C.uTransparent,!1);d>I&&(z=x[I],!(z.priority>=m));I++)z.useDefaultProgram&&lj(h,r,C,P),z.render(h,r),B=!0;for(B&&(lj(h,r,C,P),B=!1),h.clear(h.DEPTH_BUFFER_BIT),r._swapLineMap(),h.disable(h.BLEND),r._95I(h,C,V,!1,!0),vk(r,r._polylineModelMap),vk(r,r._wireframeModelMap),h.enable(h.BLEND),rk(h,C.uTransparent,!0),h.depthMask(!1),r._95I(h,C,V,!0,!0),vk(r,r._polylineModelMap,V,!0),vk(r,r._wireframeModelMap,V,!0),h.depthMask(!0),rk(h,C.uTransparent,!1),r._swapLineMap(),h.disable(h.DEPTH_TEST),h.disable(h.BLEND),r._32O._42(h,C),r._30O._42(h,C),r._highlightHelper._42(h,C),h.enable(h.DEPTH_TEST);d>I;I++)z=x[I],z.useDefaultProgram&&lj(h,r,C,P),z.render(h,r)}fk(h,V),ak(h,V)},O=!1,L=r.vr;L.enable&&L._42(h,f,_,A)&&(O=!0);var U=r.envRenderer;U&&U.enable&&U._42(h,f,_,A)&&(O=!0);var c=r._postProcessing;c._42(h,f,_,A,M)&&(O=!0),O||(r.setViewport(h,0,0,Y*e,b*e),A()),r._33Q=!1,r.drawFilter||r.countFrame(),r._doBufferGC(h)}}}},drawReflectors:function(r,N,o,$,Y){var H,J,m,U=this,P=U._dataModel.getReflectors(),d=!1;for(H in P)J=P[H],U.isVisible(J)&&(m=U.getData3dUI(J),m&&m.drawReflector(r,N,o,$,Y)&&(d=!0));return d},enablePostProcessing:function(X,F){return this._postProcessing.enableModule(X,F)},getPostProcessingModule:function(W){return this._postProcessing.getModule(W)},setViewport:function(e,o,n,J,Z){this._viewport=[o,n,J,Z],e.viewport(o,n,J,Z)},getViewport:function(){return this._viewport},setBufferGCInterval:function(B){this._bufferGCInterval=B},_doBufferGC:function(z,C){var r,h,W=z._bufPool,Z=0,B=0,F=z._renderInfo.frame,D=this._bufferGCInterval||10;for(r in W)Z++,h=W[r],h&&(C||F-h._fid>D?(z.deleteBuffer(h._buf),h._buf=null,W[r]=null):B++);if(Z/2>B&&Z>128){var T={};for(r in W)W[r]&&(T[r]=W[r]);z._bufPool=T}z._validBufCount=B},_swapLineMap:function(){var N=this;Z=N._polylineModelMap,N._polylineModelMap=N._polylineModelMapSwap,N._polylineModelMapSwap=Z,Z=N._wireframeModelMap,N._wireframeModelMap=N._wireframeModelMapSwap,N._wireframeModelMapSwap=Z,Z=N._polylineIndexMap,N._polylineIndexMap=N._polylineIndexMapSwap,N._polylineIndexMapSwap=Z,Z=N._wireframeIndexMap,N._wireframeIndexMap=N._wireframeIndexMapSwap,N._wireframeIndexMapSwap=Z},_updateSkyBox:function(j){if(this._skyBox&&j){var v=j.property,z=!1,D=this._skyBox;if("eye"===v||"forceUpdate"===v){var o=this._eye;D.p3(o[0],o[1],o[2]),z=!0}if("near"===v||"far"===v||"forceUpdate"===v){var B=this._near,S=this._far,T=D.getFinalScale3d();if(T[0]/=2,T[1]/=2,T[2]/=2,T[0]<=B||T[0]>=S||T[1]<=B||T[1]>=S||T[2]<=B||T[2]>=S){var U=2*B*S/(B+S),i=Math.min(T[0],T[1],T[2]),N=U/i,u=D.getScale3d();D.setScale3d(u[0]*N,u[1]*N,u[2]*N),z=!0}}z&&this.invalidateData(D)}},getSkyBox:function(){return this._skyBox},setSkyBox:function(X){var t=this._skyBox;t&&(this._skyBoxStyleMap&&t.setStyleMap(this._skyBoxStyleMap),this._skyBoxStyleMap=null,this._skyBoxAnchor3d&&t.setAnchor3d(this._skyBoxAnchor3d),this._skyBoxAnchor3d=null,this._skyBoxP3&&t.p3(this._skyBoxP3),this._skyBoxP3=null),this._skyBox=X,this.ump(this._updateSkyBox,this),X&&(X.dm()&&X.dm().remove(X),this._skyBoxStyleMap=k.Default.clone(X.getStyleMap()),this._skyBoxAnchor3d=X.getAnchor3d(),X.setAnchor3d(.5,.5,.5),this._skyBoxP3=X.p3().slice(0),X.s({"shape3d.reverse.flip":!0,"shape3d.reverse.cull":!1,"all.reverse.flip":!0,"all.reverse.cull":!1,"front.reverse.flip":!0,"front.reverse.cull":!1,"back.reverse.flip":!0,"back.reverse.cull":!1,"left.reverse.flip":!0,"left.reverse.cull":!1,"right.reverse.flip":!0,"right.reverse.cull":!1,"top.reverse.flip":!0,"top.reverse.cull":!1,"bottom.reverse.flip":!0,"bottom.reverse.cull":!1}),this.mp(this._updateSkyBox,this),this._updateSkyBox({property:"forceUpdate"})),this.fp("skyBox",t,X)},drawSky:function(T,u,P){var K=this,G=K._skyBox;if(G){var n=K._headlightIntensity,J=Fe(K._headlightColor),u=K._prg;1!==n&&(J=[J[0]*n,J[1]*n,J[2]*n]),rk(T,u.uHeadlightColor,[J[0],J[1],J[2],1]);var g=K.getData3dUI(G);if(g){var N,S=K.isOrtho(),f=S||this._computedProjectMatrix;f&&(N=K._projectMatrix,S&&(K._ortho=!1),rk(T,u.uPMatrix,K._projectMatrix=sj(K,!0))),g._42(T,u,P,function(){return!0}),f&&(S&&(K._ortho=!0),rk(T,u.uPMatrix,K._projectMatrix=N))}T.clear(T.DEPTH_BUFFER_BIT),rk(T,u.uHeadlightColor,[J[0],J[1],J[2],K._headlightDisabled?1:0])}},_95I:function(L,R,a,t,U){function M(N){if(!!N.s("shape3d.alwaysOnTop")==!!U&&s.isVisible(N)&&(!l||d)){if(!a&&s.isTransparentMask(N))return;var P=s.getData3dUI(N);P&&P._42(L,R,a,f)}}var s=this,f=function(O){return t?O:!O};s.sky&&L.clear(L.DEPTH_BUFFER_BIT);var P=s.drawFilter;P?s.dm().each(function(z){P(z)||M(z)}):s.dm().each(function(O){M(O)})},getLogicalPoint:function(I){return Gh(I,this._canvas)},isRectOverlapping:function(v){var $=this.getData3dUI(v);return $._rectOverlapping},getHitFaceInfo:function(G){G.target&&(G=this.lp(G));var M=this.getDataInfoAt(G);if(M){var Z=this._1o.face(M.data,Gr(G.x,G.y));if(Z)return{data:M.data,face:Z}}return V},unproject:function(t,j){var L=this,m=L.getWidth(),h=L.getHeight(),F=t.target?L.lp(t):t,v=F.x-m/2,R=F.y-h/2,J=2*(v/m),f=2*(-1*R/h);j=j||0;var k=Yq(),w=sj(L),p=Bl(L);pb(k,w,p),un(k);var l=jk([J,f,j,1],k);return[l[0]/l[3],l[1]/l[3],l[2]/l[3]]},getDataAt:function(l){var d=this.getDataInfoAt(l);return d?d.data:V},getDataInfoAt:function($,z){return $.target&&($=this.lp($)),this._1o.get(Gr($.x,$.y,z),!0)},getDatasInRect:function(M){return this._1o.get(M)},setEditable:function(d){var F=this,h=F._editable;F._editable=d,this.fp(ne,h,d)},isEditable:function(j){var D=this;return D._editable?rd(j)?j.s("3d.editable")?D._editableFunc?D._editableFunc(j):!0:!1:!1:!1},isSelectable:function(Q){return Q.s("3d.selectable")&&this.sm().isSelectable(Q)},isMovable:function(y){var z=this;return ee(y)&&y.getStyle(Bb)!==Lg?!1:y.s("3d.movable")?z._movableFunc?z._movableFunc(y):!0:!1},isSizeEditable:function(j){return rd(j)?this._sizeEditableFunc?this._sizeEditableFunc(j):!0:!1},isRotationEditable:function(x){return rd(x)&&x.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(x):!0:!1},handleDelete:function(){this._editable&&this.removeSelection()},zoomIn:function(A){this.setZoom(Yp,A)},zoomOut:function(G){this.setZoom(1/Yp,G)},setZoom:function(n,l){if(1!==n){var G=this;if(G._ortho)return G.setOrthoZoom(n,l),void 0;G._14o&&G._14o.stop(!0);var e=1/n,P=G._eye,k=G._center,K=k[0]+(P[0]-k[0])*e-P[0],C=k[1]+(P[1]-k[1])*e-P[1],J=k[2]+(P[2]-k[2])*e-P[2];if(!(_e(P,k)<G._moveStep&&1>e)){if(l=Ah(l)){var N=Zq(P);return l.action=function(R){G.fi({kind:G._zooming?"betweenZoom":"beginZoom"}),G._zooming=1,P[0]=N[0]+K*R,P[1]=N[1]+C*R,P[2]=N[2]+J*R,G.fp(Cb,V,P)},l._37o=function(){delete G._14o,delete G._zooming,G.fi({kind:"endZoom"}),G.onZoomEnded()},G._14o=rl(l)}P[0]+=K,P[1]+=C,P[2]+=J,G.fp(Cb,V,P)}}},setOrthoZoom:function(L,h){if(1!==L){var d=this;d._14o&&d._14o.stop(!0);var M=d._orthoWidth,A=M/L-M;if(!(M<d._moveStep&&L>1))return(h=Ah(h))?(h.action=function(z){d.fi({kind:d._zooming?"betweenZoom":"beginZoom"}),d._zooming=1,d.setOrthoWidth(M+A*z)},h._37o=function(){delete d._14o,delete d._zooming,d.fi({kind:"endZoom"}),d.onZoomEnded()},d._14o=rl(h)):(d.setOrthoWidth(M/L),void 0)}},getPositionInfo:function(O){var Y=this,D=Y._eye,e=Y._center,u=Y.getAspect(),s=O?Ld(Nn(e,D,!0),Nn(O,D)):_e(D,e);if(Y._ortho){var T=Y._orthoWidth;return{length:s,height:T/u,width:T}}var d=2*I(Y._fovy/2)*s;return{length:s,height:d,width:d*u}},getCenterInfo:function(){var j=this;return j._81O||(j._81O=j.getPositionInfo()),Zq(j._81O)},rotate:function(E,T,G,f){var I=this;if(E||T){f==V&&(f=I._firstPersonMode),I._88O&&I._88O.stop(!0);var P=I._center,H=I._eye,t=I.getCenterInfo().length,h=f?P:H,q=f?H:P,w=Nn(h,q),N=s(w[0],w[2]),a=s(Y(w[0]*w[0]+w[2]*w[2]),w[1]),X=f?zg:Cb;return f&&(T=-T),(G=Ah(G))?(G.action=function(u){I.fi({kind:I._rotating?"betweenRotate":"beginRotate"}),I._rotating=1;var W=N+E*u,O=a+T*u;O=Xh(O),w[0]=t*U(O)*U(W),w[1]=t*e(O),w[2]=t*U(O)*e(W),h[0]=q[0]+w[0],h[1]=q[1]+w[1],h[2]=q[2]+w[2],I.fp(X,V,h)},G._37o=function(){delete I._88O,delete I._rotating,I.fi({kind:"endRotate"}),I.onRotateEnded()},I._88O=rl(G)):(N+=E,a+=T,a=Xh(a),w[0]=t*U(a)*U(N),w[1]=t*e(a),w[2]=t*U(a)*e(N),h[0]=q[0]+w[0],h[1]=q[1]+w[1],h[2]=q[2]+w[2],I.fp(X,V,h),void 0)}},pan:function(G,f,F,l){if(G||f){var z=this;l==V&&(l=z._firstPersonMode),z._89O&&z._89O.stop(!0);var t=Bl(z),w=[t[0]*G,t[4]*G,t[8]*G],x=[t[1]*f,t[5]*f,t[9]*f],S=w[0]+x[0],u=w[1]+x[1],W=w[2]+x[2],P=z._center,y=z._eye;if(l){var b=dh(z.getBoundaries(),y[0],y[2],y[0]+S,y[2]+W,Y(S*S+W*W));S=b[0],W=b[1]}if(F=Ah(F)){var D=Zq(y),T=Zq(P);return F.action=function(x){z.fi({kind:z._panning?"betweenPan":"beginPan"}),z._panning=1,P[0]=T[0]+S*x,P[1]=T[1]+u*x,P[2]=T[2]+W*x,y[0]=D[0]+S*x,y[1]=D[1]+u*x,y[2]=D[2]+W*x,z.fp(Cb,V,y),z.fp(zg,V,P)},F._37o=function(){delete z._89O,delete z._panning,z.fi({kind:"endPan"}),z.onPanEnded()},z._89O=rl(F)}P[0]+=S,P[1]+=u,P[2]+=W,y[0]+=S,y[1]+=u,y[2]+=W,z.fp(Cb,V,y),z.fp(zg,V,P)}},walk:function(L,t,p){if(L){var h=this;p==V&&(p=h._firstPersonMode),h._90O&&h._90O.stop(!0);var f=h._center,z=h._eye,J=Nn(f,z,!0);if(p){var d=dh(h.getBoundaries(),z[0],z[2],z[0]+J[0]*L,z[2]+J[2]*L,M(L));if(L=_e(d),!L)return;J=[d[0]/L,0,d[1]/L]}if(t=Ah(t)){var _=Zq(z),B=Zq(f);return t.action=function(e){h.fi({kind:h._walking?"betweenWalk":"beginWalk"}),h._walking=1;var u=L*e;z[0]=_[0]+J[0]*u,z[1]=_[1]+J[1]*u,z[2]=_[2]+J[2]*u,f[0]=B[0]+J[0]*u,f[1]=B[1]+J[1]*u,f[2]=B[2]+J[2]*u,h.fp(Cb,V,z),h.fp(zg,V,f)},t._37o=function(){delete h._90O,delete h._walking,h.fi({kind:"endWalk"}),h.onWalkEnded()},h._90O=rl(t)}z[0]+=J[0]*L,z[1]+=J[1]*L,z[2]+=J[2]*L,f[0]+=J[0]*L,f[1]+=J[1]*L,f[2]+=J[2]*L,h.fp(Cb,V,z),h.fp(zg,V,f)}},handleScroll:function(M,H){M.preventDefault();var c=this,A=c._moveStep,v=c.getDataInfoAt(M);if(v){var s=v.data;if(s&&c.isInteractive(s)){var K=c.intersectObject(M,s);if(K){var x=K.part,Y=hs(s.s(x+".image")||s.s("shape3d."+x+".image")||s.s("all.image")||s.s("shape3d.image"));
if(Y&&$d(Y.scrollable,s,c))return}}}c.isFirstPersonMode()?c.isPannable()&&c.pan(0,H>0?A:-A):c.isZoomable()&&c.setZoom(0>H?1/$n:$n)},handlePinch:function(X,s){this.isZoomable()&&this.setZoom(s>X?1/hn:hn)},reset:function(){this.setCenter(m.graph3dViewCenter),this.setEye(m.graph3dViewEye),this.setUp(m.graph3dViewUp)},moveSelection:function(V,e,d){var y=this;y.dm().beginTransaction(),nq(this.sm().toSelection(this.isMovable,this),V,e,d),y.dm().endTransaction()},getMoveMode:function($,M){var e=M.s("3d.move.mode");if(e)return e;var L="88",c="89",D="90";return gh($)||Gd[L]&&Gd[c]&&Gd[D]?"xyz":Gd[L]&&Gd[c]?"xy":Gd[L]&&Gd[D]?"xz":Gd[c]&&Gd[D]?"yz":Gd[L]?"x":Gd[c]?"y":Gd[D]?"z":"xz"},handleTick:function(){var t=this,u=!1,y=t._moveStep,W=y,l=!1,d=!0,S=t._rotateStep*(d?-1:1);if(t.isWalkable()||(W=0),t.isPannable()||(y=0),t.isRotatable()||(S=0),t._32Q){var k=(Zd()-t._32Q)/50;W*=k,y*=k,S*=k}t._31Q&&(aq(t._31Q),delete t._31Q,delete t._32Q),Qh()&&(u=!0,t.pan(-y,0,l,d)),Wk()&&(u=!0,t.pan(y,0,l,d)),zk()&&(u=!0,gh()?t.pan(0,y,l,d):t.walk(W,l,d)),Lk()&&(u=!0,gh()?t.pan(0,-y,l,d):t.walk(-W,l,d)),hr()&&(u=!0,t.rotate(-S,0,l,d)),rc()&&(u=!0,t.rotate(S,0,l,d)),Zp()&&(u=!0,t.rotate(0,-S/2,l,d)),Bh()&&(u=!0,t.rotate(0,S/2,l,d)),u&&(t._32Q=Zd(),t._31Q=Md(t.handleTick,t))},handleKeyDown:function(N){var f=this;!Kg(N)&&bo[N.keyCode]?f.handleTick():_n(N)?f.selectAll():Ol(N)?f.handleDelete(N):on(N)&&this.isResettable()&&f.reset()},checkDoubleClickOnNote:function(O,H,Q){var d=this;if(Q===_c){if(H.s("note.toggleable"))return H.s(Di,!H.s(Di)),d.fi({kind:"toggleNote",event:O,data:H,part:Q}),!0}else if(Q===Vg&&H.s("note2.toggleable"))return H.s(fs,!H.s(fs)),d.fi({kind:"toggleNote2",event:O,data:H,part:Q}),!0;return!1},checkDoubleClickOnRotation:function(l,v,f){return f===kk?(v.setRotationX(0),!0):f===nl?(v.setRotationY(0),!0):f===Hl?(v.setRotationZ(0),!0):!1},onRotateEnded:function(){},onWalkEnded:function(){},getViewRatio:function(E){var K=this;if(K.isOrtho())return K.getWidth()/K.getOrthoWidth();var i=K.getCenter(),D=K.getHeight(),V=K.getEye(),F=[i[0]-V[0],i[1]-V[1],i[2]-V[2]],P=[E[0]-V[0],E[1]-V[1],E[2]-V[2]],I=Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]),O=1/Math.tan(K.getFovy()/2);return D*I*O/(P[0]*F[0]+P[1]*F[1]+P[2]*F[2])},inViewSpace:function(p){var t,i=this,q=i._transformPointToViewSpace(p),K=i.getAspect(),L=i.getNear(),x=i.getFar();return-q[2]<L||-q[2]>x?!1:i.isOrtho()?(t=i.getOrthoWidth()/2,Math.abs(q[0])<=t&&Math.abs(q[1]*K)<=t):(t=Math.sqrt(q[0]*q[0]+q[1]*q[1]+q[2]*q[2])*Math.tan(i.getFovy()/2),Math.abs(q[1]<=t)&&Math.abs(q[0])<=t*K)},getPVMatrix:function(){var N=this,R=N.getWidth()/2,Q=N.getHeight()/2,x=N._18Q;return x&&x._wh===R/Q||(x=sj(N),N._18Q=pb(x,x,Bl(N)),N._18Q._wh=R/Q),x},toViewPosition:function(j){var O=this,v=O.getWidth()/2,T=O.getHeight()/2,G=O.getPVMatrix();return j=jk([j[0],j[1],j[2],1],G),{x:v+v*j[0]/j[3],y:T-T*j[1]/j[3],z:j[2]/j[3]}},getHitPosition:function(T,o,E){var y=this,G=y.getWidth(),B=y.getHeight(),h=T.target?y.lp(T):T,C=h.x-G/2,I=h.y-B/2,c=y.getCenterInfo(),H=Bl(y);o=o?o:[0,0,0],E=E?E:[0,1,0],C=C/G*c.width,I=-1*I/B*c.height;var e=[H[0]*C,H[4]*C,H[8]*C],j=[H[1]*I,H[5]*I,H[9]*I],f=[e[0]+j[0],e[1]+j[1],e[2]+j[2]],R=y.getCenter(),t=zb(y,o,E,[f[0]+R[0],f[1]+R[1],f[2]+R[2]]);return t?t:[0,0,0]},intersectObject:function(w,u){return this._raycaster.intersectObject(w,u)},intersectObjects:function(R,s,i){return this._raycaster.intersectObjects(R,s,i)},getLineLength:function(f){this.validate();var w=this.getData3dUI(f);if(w&&w.getCache){var b=w.getCache();if(b)return b[b.length-1].length}return 0},getLineOffset:function(E,z){var g=this.getData3dUI(E);if(g&&g.getCache){var G=g.getCache();if(G){var O=fj(G,z),m=E.r3();if(0===m[0]&&0===m[1]&&0===m[2])return O;var B=new ah(E.p3()),L=new ah(O.point).sub(B),k=new ah(O.tangent).add(L),Y=(new bn).setFromEuler(new Tc(m,E.getRotationMode(),!0));return L.applyQuaternion(Y),k.applyQuaternion(Y),{point:L.add(B),tangent:k.sub(L).normalize()}}}return V},isLabelVisible:function(){return!0},isNoteVisible:function(){return!0},moveCamera:function(A,Q,U){var L=this,P=L.getEye();P=[P[0],P[1],P[2]];var g=L.getCenter();if(g=[g[0],g[1],g[2]],A||(A=P),Q||(Q=g),L._flyAnim&&L._flyAnim.stop(!0),U=Ah(U),!U)return L.setEye(A[0],A[1],A[2]),L.setCenter(Q[0],Q[1],Q[2]),delete L._flyAnim,!0;var v=[A[0]-P[0],A[1]-P[1],A[2]-P[2]],W=[Q[0]-g[0],Q[1]-g[1],Q[2]-g[2]];return U.action=function(m){L.setCenter(g[0]+W[0]*m,g[1]+W[1]*m,g[2]+W[2]*m),L.setEye(P[0]+v[0]*m,P[1]+v[1]*m,P[2]+v[2]*m)},U._37o=function(){delete L._flyAnim},L._flyAnim=rl(U)},flyTo:function(){function U(G,c,o){if(o instanceof k.Node){H.fromArray(pc(o,c.getMat(o)));var p=o.getAnchor3d();G.push((new ah).set(0-p.x,0-p.y,0-p.z).applyMatrix4(H)),G.push((new ah).set(0-p.x,0-p.y,1-p.z).applyMatrix4(H)),G.push((new ah).set(0-p.x,1-p.y,0-p.z).applyMatrix4(H)),G.push((new ah).set(0-p.x,1-p.y,1-p.z).applyMatrix4(H)),G.push((new ah).set(1-p.x,0-p.y,0-p.z).applyMatrix4(H)),G.push((new ah).set(1-p.x,0-p.y,1-p.z).applyMatrix4(H)),G.push((new ah).set(1-p.x,1-p.y,0-p.z).applyMatrix4(H)),G.push((new ah).set(1-p.x,1-p.y,1-p.z).applyMatrix4(H))}}var _=new ah,t=new ah,f=new ah,o=new ah,H=new Dg,Y=new k.Math.Quaternion,l=new Tc;return function(G,v,V){var i=this;if(V!==C)v={animation:v,ratio:V};else{var B=typeof v;("boolean"===B||"object"===B&&v.duration)&&(v={animation:v})}v=v||{},_.fromArray(i.getEye()),t.fromArray(i.getCenter());var X,N,L=[],Q=v.center,e=v.distance===C;if(Q&&f.fromArray(Q),G instanceof k.Node)Q||f.fromArray(G.p3()),e&&(U(L,i,G),X=L.length);else{if(G||(G=i.dm().getDatas()),!G.length)return;if((e||!Q)&&(L=[],G.forEach(function(f){U(L,i,f)}),X=L.length),!X)return;if(!Q){for(f.set(0,0,0),N=0;X>N;N++)f.add(L[N]);f.multiplyScalar(1/X)}}if(i.setCenter(f.x,f.y,f.z),o.subVectors(_,t),v.direction||v.worldDirection){!v.worldDirection&&G instanceof k.Node?Y.setFromEuler(l.set(G.r3(),G.getRotationMode(),!0)):Y.set(0,0,0,1);var c=o.length();o.fromArray(v.worldDirection||v.direction).applyQuaternion(Y).setLength(c)}if(e){for(var p,A,E,S,H,a=i.getNear(),$=10,V=v.ratio||.8;$--;){for(i._eye[0]=o.x+f.x,i._eye[1]=o.y+f.y,i._eye[2]=o.z+f.z,p=sj(i),pb(p,p,Bl(i)),S=!0,H=-1/0,N=0;X>N;N++){if(E=L[N],A=jk([E.x,E.y,E.z,1],p),A[3]<a&&$){o.multiplyScalar(2),S=!1;break}H=Math.max(H,Math.max(Math.abs(A[0]),Math.abs(A[1]))/V-A[3])}if(S)break}o.setLength(H+o.length()).add(f)}else o.setLength(v.distance).add(f);i._flyAnim&&i._flyAnim.stop(!0);var z=Ah(v.animation);if(z){i.setEye(_.x,_.y,_.z),i.setCenter(t.x,t.y,t.z);var h=(new ah).subVectors(o,_),J=(new ah).subVectors(f,t),u=new ah,b=new ah;return z.action=function(e){u.copy(_).addScaledVector(h,e),b.copy(t).addScaledVector(J,e),i.setCenter(b.x,b.y,b.z),i.setEye(u.x,u.y,u.z)},z._37o=function(){delete i._flyAnim},{lastEye:_,lastCenter:t,eye:o,center:f,animation:i._flyAnim=rl(z)}}return i.setEye(o.x,o.y,o.z),delete i._flyAnim,{lastEye:_,lastCenter:t,eye:o,center:f}}}(),getBoundingBox:function(){function D(j,D,a){c.fromArray(pc(a,D.getMat(a)));var V=a.getAnchor3d();j.push((new ah).set(0-V.x,0-V.y,0-V.z).applyMatrix4(c)),j.push((new ah).set(0-V.x,0-V.y,1-V.z).applyMatrix4(c)),j.push((new ah).set(0-V.x,1-V.y,0-V.z).applyMatrix4(c)),j.push((new ah).set(0-V.x,1-V.y,1-V.z).applyMatrix4(c)),j.push((new ah).set(1-V.x,0-V.y,0-V.z).applyMatrix4(c)),j.push((new ah).set(1-V.x,0-V.y,1-V.z).applyMatrix4(c)),j.push((new ah).set(1-V.x,1-V.y,0-V.z).applyMatrix4(c)),j.push((new ah).set(1-V.x,1-V.y,1-V.z).applyMatrix4(c))}var c=new Dg;return function(P){if(P=P||this.sm().getSelection(),P instanceof k.Node&&(P=[P]),0===P.length)return V;var H=[];P.forEach(function(r){D(H,this,r)},this);var W=[1/0,1/0,1/0],y=[-1/0,-1/0,-1/0];return H.forEach(function($){W[0]=Math.min($.x,W[0]),W[1]=Math.min($.y,W[1]),W[2]=Math.min($.z,W[2]),y[0]=Math.max($.x,y[0]),y[1]=Math.max($.y,y[1]),y[2]=Math.max($.z,y[2])}),{min:W,max:y}}}()}),Yf.RenderEnv=function(W){this.gv=W,this.enable=!1},H.defineProperties(Yf.RenderEnv.prototype,{debugOn:{get:function(){return this._debugOn},set:function(F){this._debugOn=F,this.capture&&this.capture()}}}),H.assign(Yf.RenderEnv.prototype,{renderEnvToCube:function(u,O,L,Z){var t=this,T=t.gv;if(!u||!O||!L)return t.enable=!1,t._42=null,void 0;t.enable=!0;var q=Math.floor(Z/u*O),N=T.getGL(),Q=t._renderTargets;Q?Q.length<L&&(Q=t._renderTargets=Q.concat(new Array(L-Q.length))):Q=t._renderTargets=new Array(L);for(var B=0;L>B;B++)Q[B]?Q[B].setSize(N,Z,q):Q[B]=new Yf.RenderTarget(T,N,Z,q);var $=!1;t.capture=function(){$=!0,T._42(),$=!1};var G=new ah,S=new ah,n=new ah,P=new ah,A=(new ah).setY(0),C=2*Math.PI/L,w=u/2/Math.tan(Math.PI/L),U=2*Math.atan2(O/2,w),s=u/O;t._42=function(m,h,Y,K){var o=t._debugOn;if(!$&&!o)return!1;G.copy(T.getEye()),P.copy(T.getCenter()).sub(G);var u=Math.atan2(P.z,P.x),Z=T.getNear(),H=T.getFovy(),b=T.getAspect();S.copy(T.getCenter());for(var F,V=0;L>V;V++)if(F=Q[V],A.setZ(Math.cos(u)).setX(Math.sin(u)).multiplyScalar(w),u-=C,n.addVectors(G,A),T.setNear(w),T.setCenter([n.x,n.y,n.z]),T.setFovy(U),T.setAspect(s),o){var X=Math.round(h/L);m.viewport(X*V,0,X,Y),K()}else Hq(m,F.frame),m.viewport(0,0,F.width,F.height),m.clear(m.COLOR_BUFFER_BIT),K(),oo(m),F.assureTexture();return T.setNear(Z),T.setCenter([S.x,S.y,S.z]),T.setFovy(H),T.setAspect(b),!0},t.capture()},getTextureInfo:function(m){var R=this._renderTargets;if(!R)return null;var z=this._renderTargets[m];return z?{index:m,texture:z.texture,textureName:z.uuid}:null}}),H.assign(Yf.Graph3dView.prototype,{renderEnvToCube:function(X,M,i,K){var Q=this;Q.envRenderer||(Q.envRenderer=new Yf.RenderEnv(Q)),Q.envRenderer.renderEnvToCube(X,M,i,K)}}),Yf.RenderTarget=function(Y,y,I,V,M){var r=this;M=M||{},M.samples=Math.min(Y._glCapabilities.maxSamples,M.samples&&M.samples>1&&2===Y._webGLVersion?M.samples:0),r.options=M,r.uuid=k.Math.generateUUID(),r.gv=Y,r.init(Y,y,M),r.setSize(y,I,V)},H.assign(Yf.RenderTarget.prototype,{bind:function(S){Hq(S,this.options.samples?this._MSAAFbo:this.frame)},unbind:function(Y){oo(Y),this.options.samples&&(Y.bindFramebuffer(Y.READ_FRAMEBUFFER,this._MSAAFbo),Y.bindFramebuffer(Y.DRAW_FRAMEBUFFER,this.frame),Y.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,Y.COLOR_BUFFER_BIT,Y.NEAREST),Y.bindFramebuffer(Y.READ_FRAMEBUFFER,null),Y.bindFramebuffer(Y.DRAW_FRAMEBUFFER,null))},init:function(P,M,f){var V=this,X=V.texture=M.createTexture();M.activeTexture(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,X),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_S,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_T,M.CLAMP_TO_EDGE);var z=f.samples,i=z?M.NEAREST:M.LINEAR;M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,f.minFilter||i),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,f.magFilter||i),M.bindTexture(M.TEXTURE_2D,null),V.render=M.createRenderbuffer(),V.frame=M.createFramebuffer(),z&&(V._MSAAFbo=M.createFramebuffer(),V._MSAARbO=M.createRenderbuffer()),P._2O[V.uuid]=X},assureTexture:function(){var D=this,E=D.uuid,i=D.gv._2O;i[E]||(i[E]=D.texture)},setSize:function(Y,A,r){var S=this;if(A&&r&&(S.width!==A||S.height!==r)){var b=Y.RGBA,m=Y.TEXTURE_2D,v=Y.RENDERBUFFER,y=Y.FRAMEBUFFER,T=S.options.samples;an(Y,S.texture),Y.texImage2D(m,0,b,A,r,0,b,Y.UNSIGNED_BYTE,V),Y.bindRenderbuffer(v,S.render),T?Y.renderbufferStorageMultisample(v,T,Y.DEPTH_COMPONENT16,A,r):Y.renderbufferStorage(v,Y.DEPTH_COMPONENT16,A,r),Hq(Y,S.frame),Y.framebufferTexture2D(y,Y.COLOR_ATTACHMENT0,m,S.texture,0),T||Y.framebufferRenderbuffer(y,Y.DEPTH_ATTACHMENT,v,S.render),oo(Y),T&&(Y.bindRenderbuffer(Y.RENDERBUFFER,S._MSAARbO),Y.renderbufferStorageMultisample(Y.RENDERBUFFER,T,Y.RGBA8,A,r),Hq(Y,S._MSAAFbo),Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.RENDERBUFFER,S._MSAARbO),Y.framebufferRenderbuffer(y,Y.DEPTH_ATTACHMENT,v,S.render),oo(Y)),an(Y,V),Y.bindRenderbuffer(v,V),S.width=A,S.height=r}},toCanvas:function(){var p=this,z=p.gv.getGL();Hq(z,p.frame);var x=p.width,Y=p.height,R=new Uint8Array(4*x*Y);z.readPixels(0,0,x,Y,z.RGBA,z.UNSIGNED_BYTE,R),oo(z);var A=T.createElement("canvas");A.width=x,A.height=Y;var L=A.getContext("2d"),b=L.createImageData(x,Y);return b.data.set(R),L.putImageData(b,0,0),A}});var xb=Yf.Interactor=function(h){this.gv=h};Cg("Interactor",H,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners()}});var Ic=Yf.DefaultInteractor=function(i){Hh(Ic,this,[i])};Cg("DefaultInteractor",xb,{handle_contextmenu:function(m){Mf(m)},handle_mousewheel:function(R){this.gv.handleScroll(R,R.wheelDelta/40)},handle_DOMMouseScroll:function(z){2===z.axis&&this.gv.handleScroll(z,-z.detail)},handle_keydown:function(n){this.gv.handleKeyDown(n)},handle_mousedown:function(k){this.handle_touchstart(k)},handle_touchstart:function(f){Mf(f);var C=this,L=C.gv,H=Te(f),M=L.getDataInfoAt(f),I=M?M.data:V,Y=M?M.part:V,P=L.sm(),K=Br(f),p=Sg(f);L.setFocus(f)&&(C._62O=V,C._57I=V,I?Kg(f)?P.co(I)?P.rs(I):P.as(I):P.co(I)||P.ss(I):H&&(Kg(f)?L.isRectSelectable()&&(C._62O=Ho):C._57I=_h(f)),C._31Q&&(aq(C._31Q),delete C._31Q,delete C._32Q),C._62O||(L.isFirstPersonMode()&&(gh(f)||ef(f)||p>2?C._62O="pan":L.isMouseRoamable()||fn?(C._62O="roaming",C.foward=K&&Te(f),C._32Q=Zd(),C._31Q=Md(C.tick,C)):H||(C._62O="roaming")),C._62O||(H&&K&&Jg[Y]?(C._62O=Y,C.p3=I.p3()):H&&K&&rd(I)&&L.isSelected(I)?L.isMovable(I)?(C._62O="move",C.p3=I.p3(),C.movedata=I):L.isInteractive(I)&&(C._62O="none"):fn&&(p>2?C._62O="pan":2===p&&(C.dist=xi(f),C._62O="pinch")))),C.point=L.lp(f),cp(C,f),$e(f)?L.handleDoubleClick(f,I,Y):L.handleClick(f,I,Y))},tick:function(){var D=this,y=D.gv,j=y._moveStep;D.point&&y.isWalkable()&&(D._32Q&&(j*=(Zd()-D._32Q)/50),y.walk(D.foward?j:-j),D._32Q=Zd(),D._31Q=Md(D.tick,D))},handle_mouseup:function($){this.handle_touchend($)},handle_touchend:function(x){var R=this._57I;R&&(_e(R,_h(x))<=1&&this.gv.sm().cs(),this._57I=V)},handleWindowMouseMove:function(S){this.handleWindowTouchMove(S)},handleWindowTouchMove:function(P){var K,R,o=this,k=o.gv,a=o._62O,n=o.point,b=k.dm(),A=k.lp(P),X=A.x-n.x,j=A.y-n.y,L=k.getWidth(),e=k.getHeight();if(L&&e){var S=-w*X/L,r=-w*j/e;if("roaming"===a)o.rotate(P,S/2,r/2);else if(a===kk||a===nl||a===Hl)k._86O||b.beginTransaction(),k.fi({kind:k._86O?"betweenEditRotation":"beginEditRotation",event:P}),k._86O=1,k.sm().each(function(j){if(rd(j)&&k.isRotationEditable(j)){var E=M(S)>M(r)?S:r;a===kk?j.setRotationX(j.getRotationX()+E):a===nl?j.setRotationY(j.getRotationY()+E):a===Hl&&j.setRotationZ(j.getRotationZ()+E)}});else if("move"===a||Jg[a]){a===ii||a===$l||a===Mn?(k._87O||b.beginTransaction(),k.fi({kind:k._87O?"betweenEditScale":"beginEditScale",event:P}),k._87O=1):(k._moving||b.beginTransaction(),k.fi({kind:k._moving?"betweenMove":"beginMove",event:P}),k._moving=1);var O,g=o.p3,s=k.getPositionInfo(g),z=Bl(k);O=a===rh?"x":a===se?"y":a===rn?"z":a===ii?"sx":a===$l?"sy":a===Mn?"sz":k.getMoveMode(P,o.movedata),X=X/L*s.width,j=-1*j/e*s.height;var Y,q,H=[z[0]*X,z[4]*X,z[8]*X],m=[z[1]*j,z[5]*j,z[9]*j],f=H[0]+m[0],J=H[1]+m[1],E=H[2]+m[2],C=[g[0]+f,g[1]+J,g[2]+E],$=Nn(k.getEye(),C,!0);if("xyz"===O?(Y=C,k.moveSelection(f,J,E)):"xz"===O?(Y=zb(k,g,[0,1,0],C),Y&&k.moveSelection(Y[0]-g[0],0,Y[2]-g[2])):"xy"===O?(Y=zb(k,g,[0,0,1],C),Y&&k.moveSelection(Y[0]-g[0],Y[1]-g[1],0)):"yz"===O?(Y=zb(k,g,[1,0,0],C),Y&&k.moveSelection(0,Y[1]-g[1],Y[2]-g[2])):"x"===O||"sx"===O?($[0]=0,Y=zb(k,g,$,C),Y&&(q=Y[0]-g[0],"x"===O?k.moveSelection(q,0,0):k.sm().each(function(T){rd(T)&&k.isSizeEditable(T)&&(K=T.getScaleX()+q/100,R=K/T.getScaleX(),T.setScaleX(K),gh(P)&&(T.setScaleY(T.getScaleY()*R),T.setScaleTall(T.getScaleTall()*R)))}))):"y"===O||"sy"===O?($[1]=0,Y=zb(k,g,$,C),Y&&(q=Y[1]-g[1],"y"===O?k.moveSelection(0,q,0):k.sm().each(function(c){rd(c)&&k.isSizeEditable(c)&&(K=c.getScaleTall()+q/100,R=K/c.getScaleTall(),c.setScaleTall(K),gh(P)&&(c.setScaleY(c.getScaleY()*R),c.setScaleX(c.getScaleX()*R)))}))):("z"===O||"sz"===O)&&($[2]=0,Y=zb(k,g,$,C),Y&&(q=Y[2]-g[2],"z"===O?k.moveSelection(0,0,q):k.sm().each(function(T){rd(T)&&k.isSizeEditable(T)&&(K=T.getScaleY()+q/100,R=K/T.getScaleY(),T.setScaleY(K),gh(P)&&(T.setScaleX(T.getScaleX()*R),T.setScaleTall(T.getScaleTall()*R)))}))),!Y)return;o.p3=Y}else if(a===Ho){var p=o.div;p||(p=o.div=Ij(),Kl(o.getView(),p),p.op=n,p.style.background=k.getRectSelectBackground()),k.fi({kind:k._rectSelecting?"betweenRectSelect":"beginRectSelect",event:P}),k._rectSelecting=1,p.rect=fr(p.op,A),xg(p,p.rect)}else if("pinch"===a&&2===Sg(P)){k.fi({kind:k._pinching?"betweenPinch":"beginPinch",event:P}),k._pinching=1;var q=xi(P);k.handlePinch(q,o.dist),o.dist=q}else"pan"===a||gh(P)||ef(P)?o.pan(P,X,j):"none"===a||k.isFirstPersonMode()||(Te(P)?o.rotate(P,S,r):(o.pan(P,X,0),k.isWalkable()&&(k.fi({kind:k._walking?"betweenWalk":"beginWalk",event:P}),k._walking=1,k.walk(j/k.getHeight()*k.getCenterInfo().height))));o.point=A}},pan:function(S,w,V){var Q=this.gv;if(Q.isPannable()){var q=Q.getWidth(),Y=Q.getHeight();if(!q||!Y)return;var h=Q.getCenterInfo(),P=w/q*h.width,H=-1*V/Y*h.height;Q.fi({kind:Q._panning?"betweenPan":"beginPan",event:S}),Q._panning=1,Q.pan(-P,-H)}},rotate:function(M,f,H){var Z=this.gv;Z.isRotatable()&&(Z.fi({kind:Z._rotating?"betweenRotate":"beginRotate",event:M}),Z._rotating=1,Z.rotate(f,H))},handleWindowMouseUp:function(h){this.handleWindowTouchEnd(h)},handleWindowTouchEnd:function($){var h=this,v=h.gv,F=v.dm(),M=h.div;if(M){var O=v.getDatasInRect(M.rect);if(!O.isEmpty()){var s=v.sm(),D=s.toSelection();O.each(function(i){s.co(i)?D.remove(i):D.add(i)}),s.ss(D)}Nr(M)}v._moving&&(delete v._moving,v.fi({kind:"endMove",event:$}),v.onMoveEnded(),F.endTransaction()),v._panning&&(delete v._panning,v.fi({kind:"endPan",event:$}),v.onPanEnded()),v._rotating&&(delete v._rotating,v.fi({kind:"endRotate",event:$}),v.onRotateEnded()),v._86O&&(delete v._86O,v.fi({kind:"endEditRotation",event:$}),F.endTransaction()),v._87O&&(delete v._87O,v.fi({kind:"endEditScale",event:$}),F.endTransaction()),v._pinching&&(delete v._pinching,v.fi({kind:"endPinch",event:$}),v.onPinchEnded()),v._rectSelecting&&(delete v._rectSelecting,v.fi({kind:"endRectSelect",event:$}),v.onRectSelectEnded()),v._walking&&(delete v._walking,v.fi({kind:"endWalk",event:$}),v.onWalkEnded()),h.dist=h.point=h._62O=h.p3=h.movedata=h.div=h._57I=h._32Q=h._31Q=h.foward=V}});var Kk=Yf.MapInteractor=function(k){Hh(Kk,this,[k]),this._minPhi=0,this._maxPhi=5*F/12,this._keepHorizon=!0,this._threshold=2,this._touchScaleThreshold=.05,this._touchRotateThreshold=.03,this._touchScaleCheckAccuracy=.01,this._panButton="right"};Cg("MapInteractor",xb,{handle_contextmenu:function(G){Mf(G)},handle_mousewheel:function(m){this.gv.handleScroll(m,m.wheelDelta/40)},handle_DOMMouseScroll:function(g){2===g.axis&&this.gv.handleScroll(g,-g.detail)},handle_keydown:function(Z){this.gv.handleKeyDown(Z)},handle_mousedown:function(R){this.handle_touchstart(R)},handle_touchstart:function(H){Mf(H);var n=this,x=n.gv;if(x.setFocus(H)){x.lp(H);var N=x.getDataInfoAt(H),l=N?N.data:V,k=N?N.part:V;if(!l||!x.isInteractive(l)){var D=n.editing={point:x.lp(H)};fn?D.touch=!0:(D.touch=!1,D.clickLeft=Te(H),D.pan=ef(H)?!0:"left"===this.panButton===D.clickLeft),cp(n,H)}$e(H)?x.handleDoubleClick(H,l,k):x.handleClick(H,l,k)}},handle_mouseup:function(z){this.handle_touchend(z)},handle_touchend:function(){},handleWindowMouseMove:function(m){this.handleWindowTouchMove(m)},handleWindowTouchMove:function(i){var L=this,x=L.gv,p=L.editing;if(p){var B=x.lp(i),M=p.point,W=B.x-M.x,J=B.y-M.y;if(!p.moved){if(Math.abs(W)<L.threshold&&Math.abs(J)<L.threshold&&!(i.touches&&i.touches.length>1))return;p.moved=!0}if(p.point=B,p.touch){var O=i.touches.length;if(2!==O)L.pan(i,W,J);else{if(1>=O)return;var q=i.touches,S={x:q[0].clientX,y:q[0].clientY},f={x:q[1].clientX,y:q[1].clientY},R={x:f.x-S.x,y:f.y-S.y},b=p.lastCenter,v=Math.atan2(R.y,R.x),Y=p.theta,u=0;Y==V?Y=p.theta=v:(u=v-Y,p.thetaStarted||Math.abs(u)>L.touchRotateThreshold?(p.thetaStarted=!0,p.theta=v):u=0);var E=F*(S.y+f.y)/2/x.getHeight(),l=p.phi,r=0;l==V?l=p.phi=E:(r=E-l,p.phiStarted||Math.abs(r)>L.touchRotateThreshold?(p.phiStarted=!0,p.phi=E):r=0);var G,c=Math.sqrt(R.x*R.x+R.y*R.y),T=p.vlen;if(T){var X=S.x-b.x,$=S.y-b.y,k=f.x-b.x,s=f.y-b.y,P=Math.sqrt(X*X+$*$),o=Math.sqrt(k*k+s*s),N=T/2,a=L._sign2(P-N),d=L._sign2(o-N);0>a*d||0===a&&0===d?(G=1,p.vlen=c):(G||(G=c/T),p.scaleStarted||Math.abs(G-1)>L.touchScaleThreshold?(p.vlen=c,p.scaleStarted=!0):G=1)}else T=p.vlen=c,G=1;1!==G&&x.setZoom(G),(r||u)&&L.rotate(i,u,-r),p.lastCenter={x:(f.x+S.x)/2,y:(f.y+S.y)/2}}}else if(p.pan)L.pan(i,W,J);else{var C=x.getWidth(),U=x.getHeight();if(!C||!U)return;var j=-w*W/C,e=-w*J/U;L.rotate(i,j,e)}}},_sign2:function(u){return Math.abs(u)<this._touchScaleCheckAccuracy?0:u>0?1:-1},handleWindowMouseUp:function(w){this.handleWindowTouchEnd(w)},handleWindowTouchEnd:function(f){var m=this,U=m.editing;if(m.editing=null,U){var w=m.gv;if(!U.moved&&U.clickLeft){var X=w.getDataAt(f);X?w.sm().setSelection([X]):w.sm().clearSelection()}else w._panning=null,w._rotating=null,w.fi({kind:U.pan?"endPan":"endRotate",event:f})}},pan:function(z,f,u){var k=this,S=k.gv;if(S.isPannable()){var N=S.getWidth(),l=S.getHeight();if(N&&l){var s=S.getCenterInfo(),C=-f/N*s.width,v=1*u/l*s.height;S.fi({kind:S._panning?"betweenPan":"beginPan",event:z}),S._panning=1;var b=k.keepHorizon,T=k.editing.touch;if((T&&z.touches&&z.touches.length>1||!T&&gh(z))&&(b=!b),!b)return S.pan(C,v);if(C||v){var j=Bl(S),Q=[j[0]*C,j[4]*C,j[8]*C],M=[j[1],0,j[9]],g=Math.sqrt(M[0]*M[0]+M[2]*M[2]);g&&(M=[M[0]/g*v,0,M[2]/g*v]);var i=Q[0]+M[0],W=Q[1]+M[1],I=Q[2]+M[2],E=S._center,h=S._eye;E[0]+=i,E[1]+=W,E[2]+=I,h[0]+=i,h[1]+=W,h[2]+=I,S.fp(Cb,V,h),S.fp(zg,V,E)}}}},rotate:function(K,z,A){var i=this,t=i.gv;if(t.isRotatable()){var J=t._center,C=t._eye,y=Nn(C,J),E=s(Y(y[0]*y[0]+y[2]*y[2]),y[1]),U=E+A;U=Math.max(i.minPhi,Math.min(i.maxPhi,U)),A=U-E,t.fi({kind:t._rotating?"betweenRotate":"beginRotate",event:K}),t._rotating=1,t.rotate(z,A)}}}),H.defineProperties(Kk.prototype,{panButton:{get:function(){return this._panButton},set:function(m){this._panButton=m}},minPhi:{get:function(){return this._minPhi},set:function(F){this._minPhi=F}},maxPhi:{get:function(){return this._maxPhi},set:function(v){this._maxPhi=v}},keepHorizon:{get:function(){return this._keepHorizon},set:function(r){this._keepHorizon=r}},threshold:{get:function(){return this._threshold},set:function(L){this._threshold=L}},touchScaleThreshold:{get:function(){return this._touchScaleThreshold},set:function(T){this._touchScaleThreshold=T}},touchRotateThreshold:{get:function(){return this._touchRotateThreshold},set:function(B){this._touchRotateThreshold=B}}});var vd=function(f){this.gv=f};Ir(vd,H,{_iv:!0,iv:function(){this._iv=!0},face:function(I,D){var Z=this,i=Z.gv.getGL();if(!i||!rd(I))return V;var v=D.x,L=D.width,E=D.height,j=Z.height-D.y-E,Q=$(L/2),Y=new Uint8Array(4*L*E),e=0;for(Z.iv(),Z.validate(I),Hq(i,Z.frame),i.readPixels(v,j,L,E,i.RGBA,i.UNSIGNED_BYTE,Y),oo(i),Z.iv();Q>=e;e++)for(var y=Q-e,O=Q+e,P=y;O>=P;P++)for(var M=y;O>=M;M++)if(P===y||P===O||M===y||M===O){var R=el.m[Y[4*(P*L+M)]];if(R)return R}},get:function(S,m){this.validate();var Y=this,D=Y.gv.getGL();if(!D)return V;var g,k,E=S.x,R=S.width,s=S.height,X=Y.height-S.y-s,Q=$(R/2),F=new Uint8Array(4*R*s),y=0,L=F.length,r=m?V:new Vd,w=m?V:{};if(Hq(D,Y.frame),D.readPixels(E,X,R,s,D.RGBA,D.UNSIGNED_BYTE,F),oo(D),m){for(;Q>=y;y++)for(var e=Q-y,A=Q+y,a=e;A>=a;a++)for(var C=e;A>=C;C++)if((a===e||a===A||C===e||C===A)&&(g=Y.info(F,4*(a*R+C))))return g}else for(;L>y;y+=4)g=Y.info(F,y),g&&(k=g.data,w[k._id]||(r.add(k),w[k._id]=k));return r},info:function(b,U){return this.colorMap[(b[U]<<16)+(b[U+1]<<8)+b[U+2]+((127&b[U+3])<<24)]},validate:function(u){var E=this,t=E.gv,w=t.getGL();if(w){var l=t.getWidth(),e=t.getHeight(),s=w.RGBA,y=w.TEXTURE_2D,n=w.RENDERBUFFER,O=w.FRAMEBUFFER;E.texture||(E.texture=pr(w),E.render=w.createRenderbuffer(),E.frame=w.createFramebuffer()),(E.width!==l||E.height!==e)&&(an(w,E.texture),w.texImage2D(y,0,s,l,e,0,s,w.UNSIGNED_BYTE,V),yo(w,w.TEXTURE_MIN_FILTER,w.LINEAR),w.bindRenderbuffer(n,E.render),w.renderbufferStorage(n,w.DEPTH_COMPONENT16,l,e),Hq(w,E.frame),w.framebufferTexture2D(O,w.COLOR_ATTACHMENT0,y,E.texture,0),w.framebufferRenderbuffer(O,w.DEPTH_ATTACHMENT,n,E.render),an(w,V),w.bindRenderbuffer(n,V),oo(w),E.width=l,E.height=e),E._iv&&(E._iv=!1,Hq(w,E.frame),t._42(u||(E.colorMap={}),1),oo(w))}}});var di=function(o){this.gv=o};Ir(di,H,{gap:0,size:0,_42:function(a,I){var d=this,M=d.gv,g=M._gridGap,p=M._gridSize;if(M._gridVisible){if(d.gap!==g||d.size!==p){for(var R=[],J=M._gridSize/2,Z=g*J,X=0;2*J+1>X;X++){var k=6*X,o=6*(2*J+1)+k;R[k]=-Z,R[k+1]=0,R[k+2]=-Z+X*g,R[k+3]=Z,R[k+4]=0,R[k+5]=-Z+X*g,R[o]=-Z+X*g,R[o+1]=0,R[o+2]=-Z,R[o+3]=-Z+X*g,R[o+4]=0,R[o+5]=Z}d.vs=new Nb(R),d.gap=g,d.size=p}we(M),kg(a,I),Sj(a),Ff(a,I,1,M._gridColor,M._buffer.vs,d.vs),Hj(a,0,d.vs.length/3,a.LINES),tk(a),Rp(a,I)}else d.vs=d.gap=d.size=V}});var id=function(u){this.gv=u};Ir(id,H,{_42:function(Y,o){var z=this.gv,q=z._buffer.vs,m=z._axisXColor,b=z._axisYColor,a=z._axisZColor,C=z._originAxisVisible,O=z._centerAxisVisible;if(C||O){var e=Jk?Y.TRIANGLES:Y.TRIANGLE_FAN,g=Y.LINES;if(we(z),kg(Y,o),Sj(Y),C){var R=z.getCenterInfo(),p=f(R.width,R.height)/5,E=.8*p,r=.05*p;Ff(Y,o,1.5,m,q,new Nb([0,0,0,p,0,0,E,r,0,E,0,r,E,-r,0,E,0,-r,E,r,0,0,0,0,0,p,0,r,E,0,0,E,r,-r,E,0,0,E,-r,r,E,0,0,0,0,0,0,p,r,0,E,0,r,E,-r,0,E,0,-r,E,r,0,E])),Hj(Y,0,2,g),Hj(Y,1,6,e),Ff(Y,o,V,b),Hj(Y,7,2,g),Hj(Y,8,6,e),Ff(Y,o,V,a),Hj(Y,14,2,g),Hj(Y,15,6,e)}if(O){var Q=z._center,L=Q[0],I=Q[1],G=Q[2],R=z.getPositionInfo(Q);p=f(R.width,R.height)/20,Ff(Y,o,1.5,m,q,new Nb([L,I,G,L+p,I,G,L,I,G,L,I+p,G,L,I,G,L,I,G+p])),Hj(Y,0,2,g),Ff(Y,o,V,b),Hj(Y,2,2,g),Ff(Y,o,V,a),Hj(Y,4,2,g)}tk(Y),Rp(Y,o)}}});var jj=function(i){this.gv=i,this.onMouseOver=this.onMouseOver.bind(this),this.mode=jj.Mode.Disable};jj.Mode={Disable:0,Selection:1,MouseOver:2},Ir(jj,H,{onMouseOver:function(T){m.preventDefault(T);var Q=this.gv.getDataAt(T);Q!==this.mouseOverData&&(this.mouseOverData=Q,this.gv.iv())},setFetchTargetFunc:function(Y){this.fetchTargetFunc=Y},_42:function(K,U){var G,S=this,H=S._mode;if(H!==jj.Mode.Disable&&(H===jj.Mode.Selection?G=S.gv.sm().getSelection().toArray(function(J){return J.s("highlight.visible")}):H===jj.Mode.MouseOver&&S.mouseOverData&&S.mouseOverData.s("highlight.visible")&&(G=[S.mouseOverData]),S.fetchTargetFunc&&(G=S.fetchTargetFunc(G)),G&&G.length)){var w=S.gv,N=w.vr.isPresenting(),B=w.getWidth();if(N){var J=w.getWidth;B/=2,w.getWidth=function(){return B};var u=w.getViewport()}var M,i=w.getDevicePixelRatio(),x=B*i,o=w.getHeight()*i;(M=S._renderTarget)?M.setSize(K,x,o):S._renderTarget=M=new Yf.RenderTarget(w,K,x,o),Hq(K,M.frame),w.drawFilter=function(C){return G.indexOf(C)<0?!0:void 0},w._42({}),w.drawFilter=null,oo(K),N&&(w.getWidth=J,w.setViewport(K,u[0],u[1],u[2],u[3])),S.shader||(S.shader=new Vk.Shader(K,Mk.vs,Mk.fs));var s=S.shader;if(S.shader.bind(),K.enable(K.BLEND),K.activeTexture(K.TEXTURE0+0),K.bindTexture(K.TEXTURE_2D,M.texture),s.uniforms.image=0,s.uniforms.textureSize=[x,o],s.uniforms.edgeWidth=g["highlight.width"],S.highlightColor!==g["highlight.color"]){var c=xk(S.highlightColor=g["highlight.color"]);S.highlightColorData=[c[0]/255,c[1]/255,c[2]/255,c[3]/255]}s.uniforms.edgeColor=S.highlightColorData,S.ibuffer?(S.ibuffer.upload(),S.vbuffer.upload()):(S.ibuffer=Vk.Buffer.createIndexBuffer(K,new Uint16Array([0,2,1,1,2,3])),S.vbuffer=Vk.Buffer.createVertexBuffer(K,new Float32Array([0,0,1,0,0,1,1,1]))),s.attributes.pos.pointer(S.vbuffer),K.drawElements(K.TRIANGLES,6,K.UNSIGNED_SHORT,0),K.disable(K.BLEND),K.bindTexture(K.TEXTURE_2D,null),K.useProgram(U)}}}),H.defineProperties(jj.prototype,{mode:{get:function(){return this._mode},set:function(d){var c=this._mode;d!==c&&(this._mode=d,d===jj.Mode.MouseOver?this.gv.getView().addEventListener("mousemove",this.onMouseOver,!1):c===jj.Mode.MouseOver&&this.gv.getView().removeEventListener("mousemove",this.onMouseOver))}}});var Mk={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","uniform vec2 textureSize;","uniform float edgeWidth;","uniform vec4 edgeColor;","varying vec2 vUv;","float getCol(vec2 coord) {","return texture2D(image, coord).a;","}","void main() {","vec2 cc = vUv;","float center = getCol(cc);","float dx = edgeWidth / textureSize.x;","float dy = edgeWidth / textureSize.y;","vec2 coord;","float topLeft = getCol(cc+vec2(-dx, -dy));","float top = getCol(cc+vec2(0.0, -dy));","float topRight = getCol(cc+vec2(dx, -dy));","float left = getCol(cc+vec2(-dx, 0.0));","float right = getCol(cc+vec2(dx, 0.0));","float bottomLeft = getCol(cc+vec2(-dx, dy));","float bottom = getCol(cc+vec2(0.0, dy));","float bottomRight = getCol(cc+vec2(dx, dy));","float v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;","float h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;","float edge = sqrt(h * h + v * v);","edge = smoothstep(0.9, 1.0, edge);","if (edge < 0.5) {","discard;","}","gl_FragColor = edgeColor;","}"].join("\n")},po=function(q){this.gv=q},rh="edit_tx",se="edit_ty",rn="edit_tz",kk="edit_rx",nl="edit_ry",Hl="edit_rz",ii="edit_sx",$l="edit_sy",Mn="edit_sz",Jg={};Jg[rh]=1,Jg[se]=1,Jg[rn]=1,Jg[kk]=1,Jg[nl]=1,Jg[Hl]=1,Jg[ii]=1,Jg[$l]=1,Jg[Mn]=1,Ir(po,H,{_42:function(Q,A,E){var V=this,g=V.gv,$=g.sm().ld();if($&&g.isEditable($)&&!g.isEditHelperDisabled()&&rd($)&&(!g.isFirstPersonMode()||!g.isMouseRoamable()&&!fn)){we(g);var F,j,J=g.isMovable($),i=g.isRotationEditable($),I=g.isSizeEditable($),C=g._axisXColor,m=g._axisYColor,W=g._axisZColor,o=g._editSizeColor,M=$.p3(),c=_e(g.getEye(),M)/10,X=c/(E?5:10),P=.7*c,k=.4*P,d=M[0],x=M[1],w=M[2];F=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],J&&V._17O(Q,A,$,E,rh,C,F,[d,x-X,w,d+P,x-X,w,d+P,x,w,d+P,x,w,d,x,w,d,x-X,w,d,x-X,w+X,d+P,x-X,w+X,d+P,x-X,w,d+P,x-X,w,d,x-X,w,d,x-X,w+X]),j=d+P,I&&V._17O(Q,A,$,E,ii,o,F,[j,x-X,w,j+k,x-X,w,j+k,x,w,j+k,x,w,j,x,w,j,x-X,w,j,x-X,w+X,j+k,x-X,w+X,j+k,x-X,w,j+k,x-X,w,j,x-X,w,j,x-X,w+X]),j+=k,i&&V._17O(Q,A,$,E,kk,C,F,[j,x-X,w,j+k,x-X,w,j+k,x,w,j+k,x,w,j,x,w,j,x-X,w,j,x-X,w+X,j+k,x-X,w+X,j+k,x-X,w,j+k,x-X,w,j,x-X,w,j,x-X,w+X]),F=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],J&&V._17O(Q,A,$,E,se,m,F,[d,x,w,d,x+P,w,d-X,x+P,w,d-X,x+P,w,d-X,x,w,d,x,w,d,x,w,d,x,w-X,d,x+P,w-X,d,x+P,w-X,d,x+P,w,d,x,w]),j=x+P,I&&V._17O(Q,A,$,E,$l,o,F,[d,j,w,d,j+k,w,d-X,j+k,w,d-X,j+k,w,d-X,j,w,d,j,w,d,j,w,d,j,w-X,d,j+k,w-X,d,j+k,w-X,d,j+k,w,d,j,w]),j+=k,i&&V._17O(Q,A,$,E,nl,m,F,[d,j,w,d,j+k,w,d-X,j+k,w,d-X,j+k,w,d-X,j,w,d,j,w,d,j,w,d,j,w-X,d,j+k,w-X,d,j+k,w-X,d,j+k,w,d,j,w]),F=[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],J&&V._17O(Q,A,$,E,rn,W,F,[d,x,w,d,x,w+P,d,x-X,w+P,d,x-X,w+P,d,x-X,w,d,x,w,d,x-X,w,d-X,x-X,w,d-X,x-X,w+P,d-X,x-X,w+P,d,x-X,w+P,d,x-X,w]),j=w+P,I&&V._17O(Q,A,$,E,Mn,o,F,[d,x,j,d,x,j+k,d,x-X,j+k,d,x-X,j+k,d,x-X,j,d,x,j,d,x-X,j,d-X,x-X,j,d-X,x-X,j+k,d-X,x-X,j+k,d,x-X,j+k,d,x-X,j]),j+=k,i&&V._17O(Q,A,$,E,Hl,W,F,[d,x,j,d,x,j+k,d,x-X,j+k,d,x-X,j+k,d,x-X,j,d,x,j,d,x-X,j,d-X,x-X,j,d-X,x-X,j+k,d-X,x-X,j+k,d,x-X,j+k,d,x-X,j])}},_17O:function(n,P,q,L,J,U,M,x){var j=this.gv._buffer;im(n,P,L,!0,q,J),Jm(n,P,V,!0,V,!0,V,!1),rk(n,P.uDiffuse,U),fk(n,j.vs,new Nb(x),P.aPosition),fk(n,j.ns,new Nb(M),P.aNormal),Sj(n),Hj(n,0,12),tk(n),Mc(n,P)}});var Ei=k.Raycaster=function(p){this.gv=p,this.maxTriangleTest=1/0};Ni("Raycaster",H,{intersect:function(h){var e=this,x=e.gv,d=x.getDataAt(h);return d?e.intersectObject(h,d):null},intersectObjects:function(Q,c,P){var r,T,H,b,M=this,e=1/0,X=Q.origin||(new ah).fromArray(M.gv.getEye()),u=M.maxTriangleTest,l=[];return c.forEach(function(m){P&&P(m)===!1||m.s("intersect")!==!1&&l.push(m)}),l.sort(function(H,f){return X.distanceToSquared2(H.p3())-X.distanceToSquared2(f.p3())}),M.countTriangles=0,l.forEach(function(N){M.countTriangles>u||(r=M.intersectObject(Q,N),r&&(T=X.distanceToSquared(r.world),e>T&&(H=N,b=r,e=T)))}),M.countTriangles=0,{data:H,intersect:b}},intersectObject:function(U,J){if(U instanceof ij)return this._intersectObjectImpl(U,J);
var N=this,K=N.gv,g=K.unproject(U),T=new ah,i=K.getEye(),v=new ah;if(K.isOrtho()){var C=new ah(i);v.copy(K.getCenter()).sub(C).normalize();var y=T.copy(g).sub(C).dot(v);T.copy(v).setLength(-y).add(C.copy(g))}else T.copy(i),v.copy(g).sub(T).normalize();var q=new k.Math.Ray(T,v);return N._intersectObjectImpl(q,J)},_intersectObjectImpl:function(){function S(){var V=new ah;return V.subVectors(_,N),Z.subVectors(I,N),V.cross(Z).normalize(),V}function y(s,k,F,J,Y,R,O){return tm.barycoordFromPoint(s,k,F,J,r),Y.multiplyScalar(r.x),R.multiplyScalar(r.y),O.multiplyScalar(r.z),Y.add(R).add(O),Y.clone()}var i=new Dg,P=new Dg,R=new ij,X=new ah,t=new ah,H=new ah,M=new ah,b=new ah,I=new ah,N=new ah,_=new ah,g=new nj,B=new nj,c=new nj,Z=new ah,D={vs:bh,is:Ef,uv:wr},r=new ah;return function($,w){var r=this.gv.getData3dUI(w),Z=w.mat||r.mat;if(Z){i.fromArray(Z),P.getInverse(i),R.copy($).applyMatrix4(P);var O,A,U="body",z=r.shapeModel;if(z||(z=sr(r)),z||(w instanceof k.Node&&!(w instanceof k.Shape)?(O=!0,z=D):(A=!0,z=[r.left,r.front,r.right,r.back,r.top,r.bottom])),!z)return console.log("Can not find shape model."),null;lk(z)||(z=[z]);var f,o,q,C,K,e,V,m,p,u,d,v,h,F,x,j,n=1/0,L=["","top_","bottom_"],T=!1;for(f=0,o=z.length;o>f;f++)if(h=z[f])for(q=0,C=L.length;C>q;q++)if(F=L[q],V=h[F+"vs"],m=h[F+"is"],p=h[F+"uv"]||h[F+"tuv"],V){if(x=h[F+"boundingBox"]){var d=R.intersectBox(x);if(!d)continue;if(R.origin.distanceTo(d)>n)continue;j=!1}else h[F+"boundingBox"]=x=new k.Math.Box3,j=!0;for(K=0,e=m?m.length:V.length/3;e>K;K+=3)this.countTriangles++,m?(t.fromArray(V,3*m[K]),H.fromArray(V,3*m[K+1]),M.fromArray(V,3*m[K+2])):(t.fromArray(V,3*K),H.fromArray(V,3*(K+1)),M.fromArray(V,3*(K+2))),j&&(x.expandByPoint(t),x.expandByPoint(H),x.expandByPoint(M)),u=R.intersectTriangle(t,H,M,!0,X),u&&(v=R.origin.distanceTo(u),n>v&&(n=v,b.copy(u),I.copy(t),N.copy(H),_.copy(M),""!==F?U=F.slice(0,-1):O?U=Hg[Math.floor(K/6)]:A&&(U=Hg[f]),p&&(T=!0,m?(g.fromArray(p,2*m[K]),B.fromArray(p,2*m[K+1]),c.fromArray(p,2*m[K+2])):(g.fromArray(p,2*K),B.fromArray(p,2*(K+1)),c.fromArray(p,2*(K+2))))))}if(!isFinite(n))return null;var E,l=b.clone().applyMatrix4(i);T&&(E=y(b,I,N,_,g,B,c));var W=S(I,N,_),s=S(I.applyMatrix4(i),N.applyMatrix4(i),_.applyMatrix4(i)),Q=R.direction.dot(W);return Q>0&&(W.multiplyScalar(-1),s.multiplyScalar(-1)),{world:l,local:b.clone(),worldNormal:s,normal:W,uv:E,part:U}}}}()});var bd=function(z,T){this.gv=z,this.s=function(t,$,c){return $==V&&($=c),$==V?T.getStyle(t):$d($,T,z)},this.data=T};Ir(bd,H,{I3d:!0,ms_icons:1,_iv:!0,iv:function(){this._iv=!0},_42:function(W,a,f,p){var O=this,U=O.data;if(!(U instanceof Cn)){var I,e,Z,K,g,c,d,m=O.gv,u=U._id,z=O.s("shape3d.alwaysOnTop")?null:O.s("batch"),w=m._batchIndexMap,v=m._batchModelMap,X=m.isSelectable(U),J=m.getBrightness(U),P=J!=V&&1!==J;if(O.needValidate(W)){if(Z=Iq(w,v,U,z),O.validate(Z,z?Ng[z]||op:V),Z&&(K=w[u],g=K.size=Z.vs.length/3-K.begin,d=Z.rs))for(J=P?J:1,c=0;g>c;c++)d.push(J);if(rd(U)){var C=m.getWireframeGeometry(U);if(C)Lh(m,U,C);else{var i=m.getWireframe(U);i&&Lh(m,U,i)}}O.labelInfo=O.label2Info=O.noteInfo=O.note2Info=O._38o=V,O._24O(Lr,"getLabel"),O._24O(nb,"getLabel2"),O._26O(_c,"getNote"),O._26O(Vg,"getNote2"),O._15O(),O.interactiveInfo=m.isInteractive(U)?{}:V,O._iv=!1}P&&rk(W,a.uBrightness,J),rk(W,a.uAlphaTest,O.s("alphaTest")),rk(W,a.uUseEnvMap,U.s("envmap")?!0:!1),rk(W,a.uReflectivity,U.s("envmap")||.01),e=im(W,a,f,X,U,gj),e&&(Qe(e,w[u],v),Qe(e,m._polylineIndexMap[u],m._polylineModelMap),Qe(e,m._wireframeIndexMap[u],m._wireframeModelMap)),w[u]||O._80o(W,a,p),m.isLabelVisible(U)&&((I=O.labelInfo)&&(im(W,a,f,X,U,Lr),O._28O(I,Lr,p)),(I=O.label2Info)&&(im(W,a,f,X,U,nb),O._28O(I,nb,p))),m.isNoteVisible(U)&&((I=O.noteInfo)&&(im(W,a,f,X,U,_c),O._29O(I,_c,p)),(I=O.note2Info)&&(im(W,a,f,X,U,Vg),O._29O(I,Vg,p))),(I=O._38o)&&O._99O(W,a,I,f,X,p),P&&rk(W,a.uBrightness,1)}},needValidate:function(){return this._iv},validate:function(){},_16O:function(){return gs},_80o:function(){},dispose:function(){},_calcAnchorMat:function(q){if(q.hasOwnProperty("_anchor")||q.hasOwnProperty("_anchorElevation")){var l=q.getAnchor3d(),W={x:l.x-.5,y:l.y-.5,z:l.z-.5},y=Yq();return Xl(y,[-W.x,-W.y,-W.z]),y}},getBodyColor:function(J){var B=this.data,D=this.gv.getBodyColor(B);return D?D:J?B.getStyle(J):V},_24O:function(y,u){var q=this,G=q.data,K=q.gv,c=q.s,_=K[u](G);if(_!=V){var a=c(y+".scale"),w=c(y+".max"),j=q[y+"Info"]={label:_,textureScale:c(y+".texture.scale"),color:K[u+"Color"](G),font:c(y+".font"),align:c(y+".align"),background:K[u+"Background"](G)},v=j.rect=tb(j,_);w>0&&w<v.width&&(j.labelWidth=v.width,v.width=w),v.x=v.y=0,v.width*=a,v.height*=a,j.mat=q._16O(c(y+".autorotate"),c(y+".position"),v,c(y+".face"),c(y+".t3"),c(y+".r3"),c(y+".rotationMode"));var i=v.width/2,t=v.height/2;j.vs=new Nb([-i,t,0,-i,-t,0,i,-t,0,i,t,0]),v.width/=a,v.height/=a}},_26O:function(A,x){var v=this,j=v.data,X=v.gv,G=v.s,t=X[x](j);if(t!=V){var p=G(A+".scale"),D=this[A+"Info"]={note:t,textureScale:G(A+".texture.scale"),expanded:G(A+".expanded"),font:G(A+".font"),color:G(A+".color"),align:G(A+".align"),borderWidth:G(A+".border.width"),borderColor:G(A+".border.color"),background:X[x+"Background"](j)};if(D.expanded){var Q=G(A+".max"),n=tb(D,t);n.width+=6,n.height+=2,Q>0&&Q<n.width&&(D.labelWidth=n.width,n.width=Q);var W={x:-n.width/2,y:-8-n.height,width:n.width,height:n.height+8}}else W={x:-6,y:-18,width:12,height:18};D.mat=v._16O(G(A+".autorotate"),G(A+".position"),V,G(A+".face"),G(A+".t3"),G(A+".r3"),G(A+".rotationMode")),D.rect=W,1!==p&&(W=Zq(W),W.x*=p,W.height*=p,W.y=-W.height,W.width*=p);var i=W.x,N=W.y,C=W.width,B=W.height;D.vs=new Nb([i,-N,0,i,-N-B,0,i+C,-N-B,0,i+C,-N,0])}},_28O:function(N,r,U){if(U(this.s(r+".transparent"))){var M=N.rect,k=N.textureScale,l=M.width*k,o=M.height*k;if(l>=1&&o>=1){var x=Uf(l,o);1!==k&&(x.translate(x,M.x,M.y),x.scale(k,k),x.translate(x,-M.x,-M.y)),Cc(x,N),x.restore(),Gm(this,r,N.mat,N.vs,!0)}}},_29O:function(p,G,k){if(k(this.s(G+".transparent"))){var N=p.rect,x=p.textureScale,_=N.x,i=N.y,s=N.width*x,j=N.height*x;if(s>=1&&j>=1){N.x=N.y=0;var R=Uf(s,j);1!==x&&R.scale(x,x),pd(R,p),R.restore(),N.x=_,N.y=i,Gm(this,G,p.mat,p.vs,!1)}}},_99O:function(y,h,C,K,z,_){if(C){var u=this,k=u.gv,c=u.data,j=k._buffer,B=k._1O,X=C.icons;for(var D in X){var q=X[D],H=C.rects[D];if(H&&_($d(q.transparent,c,k))){im(y,h,K,z,c,D);var l=$d(q.shape3d,c,k),d=l?[l]:$d(q.names,c,k),e=d?d.length:0,F=$d(q.textureScale,c,k)||1,E=$d(q.light,c,k);E==V&&(E=l?!0:!1),Jm(y,h,$d(q.blend,c,k),E,$d(q.opacity,c,k),$d(q.reverseFlip,c,k),$d(q.reverseColor,c,k),$d(q.reverseCull,c,k));for(var b=0;e>b;b++){var a=d[b],M=H[b];if(ro(u,M.mat),l)Yc(k,c,sr(u,l),u);else{var P=hs(a);if(P){var m=M.width*F,Q=M.height*F;if(m>=1&&Q>=1){var J=Uf(m,Q);re(J,P,$d(q.stretch,c,k),0,0,m,Q,c,k),J.restore(),pr(y,ub,B),Sj(y,h,B,$d(q.discardSelectable,c,k),j.uv,ke),fk(y,j.vs,M.vs,h.aPosition),es(y,j.ns,Ye,h.aNormal),yb(y,j.is,tn),hc(y,0,tn.length),tk(y,h,B)}}}Vm(k)}Mc(y,h)}}}}});var sg=function(R,x){Hh(sg,this,[R,x])};Ir(sg,bd,{_16O:function(Q,w,O,M,z,Z,c,K,j){var X=this.data,k=X.getFinalScale3d(),A=ug(w,k,O,M,K,j);if(X.hasOwnProperty("_anchor")||X.hasOwnProperty("_anchorElevation")){var t=X.getAnchor3d();A[0]-=(t.x-.5)*k[0],A[1]-=(t.y-.5)*k[1],A[2]-=(t.z-.5)*k[2]}return kj(Yq(),A,X.p3(),M,z,Z,c,Q,X.getFinalRotation3d(),X.getRotationMode())},clear:function(){var $=this;$.faceMat=$.mat=$.shapeModel=$.left=$.right=$.front=$.back=$.top=$.bottom=$.csg=V},needValidate:function(i){if(this._iv)return this._validateFrameId=i._renderInfo.frame,!0;if(this.s("shape3d.autorotate")||this.s("shape3d.fixSizeOnScreen")||this.s("hide.overlapping.group")){var A=i._renderInfo.frame;if(this._validateFrameId!==A)return this._validateFrameId=A,!0}return!1},validate:function(q,o){var d=this,Y=d.gv,E=d.data,l=d.shapeName=d.s(Hc),D=sr(d,l);d._updateAutoRotation(),d._updateFixSize2d(),d._updateOverlapping(),(this.s("shape3d.autorotate")||this.s("shape3d.fixSizeOnScreen"))&&(Lc(Y,E,"_wireframeModelMap","_wireframeIndexMap"),Lc(Y,E,"_wireframeModelMapSwap","_wireframeIndexMapSwap"));var R=pc(E,Y.getMat(E),D?d.s("shape3d.scaleable"):!0),u=d._calcAnchorMat(E);if(u&&pb(R,R,u),E.mat=R,d.clear(),D||!l)if(q){var x=[];D?bg(Y,E,D,d,d.getBodyColor(),[R],q,x):(Ag(Y,E,q,o,R,ws,x,oe),Ag(Y,E,q,o,R,Hn,x,Kc),Ag(Y,E,q,o,R,qs,x,wj),Ag(Y,E,q,o,R,rq,x,$j),Ag(Y,E,q,o,R,Bn,x,aj),Ag(Y,E,q,o,R,rg,x,yg)),x.length&&(Rd(q.vs,x),Rd(q.ns,Hp(x)))}else d.mat=R,(d.shapeModel=D)||(d._cubeUvs=null,d.vf(ws,0),d.vf(Hn,16),d.vf(Bn,8),d.vf(rg,24),d.vf(qs,32),d.vf(rq,40))},_updateAutoRotation:function(){var h=new Tc,M=new Dg,X=new ah,A=new ah,J=new ah;return function(){var e=this,N=e.data,D=e.s("shape3d.autorotate");if(!D)return N._dynamicRotation&&delete N._dynamicRotation,void 0;var f=e.gv;J.copy(e.s("shape3d.autorotate.up")||f._up);var o;o="string"==typeof D?[D.indexOf("x")<0?f._eye[0]:f._center[0],D.indexOf("y")<0?f._eye[1]:f._center[1],D.indexOf("z")<0?f._eye[2]:f._center[2]]:f._eye;var s=f._center,H=N.p3();X.copy(H),A.set(o[0]-s[0],o[1]-s[1],o[2]-s[2]).add(X),M.lookAt(A,X,J),h.set(0,0,0,N.getRotationMode(),!0).setFromRotationMatrix(M);var c=N._dynamicRotation;c&&Math.abs(c[0]-h.x)<1e-5&&Math.abs(c[1]-h.y)<1e-5&&Math.abs(c[2]-h.z)<1e-5||(N._dynamicRotation=[h.x,h.y,h.z])}}(),_updateFixSize2d:function(){var J=this,t=J.data,a=J.s("shape3d.fixSizeOnScreen");if(!a)return t._dynamicScale3d&&delete t._dynamicScale3d,void 0;var Z=J.gv;t.getFinalScale3d();var I=pc(t,Z.getMat(t)),M=Qf([0,0,0],I),X=Z.toViewPosition(M);if(!isNaN(X.x)&&!isNaN(X.y)){var m=Qf([1,0,0],I),k=Z.toViewPosition(m),T=Qf([0,1,0],I),l=Z.toViewPosition(T),Y=k.x-X.x,v=l.y-X.y;if(Y&&v){var e=t._dynamicScale3d||[1,1,1],P=hs(t.s("shape3d.image")),c=a[0]>0?a[0]:P?si(P,t):20,s=a[1]>0?a[1]:P?of(P,t):20,O=Math.abs(Y/c),g=Math.abs(v/s);Math.abs(O-1)<.001&&Math.abs(g-1)<.001||(t._dynamicScale3d=[e[0]/O,e[1]/g,e[2]])}}},_updateOverlapping:function(){var w=this,N=w.s("hide.overlapping.group");if(!N)return w._rectOverlapping&&(w._rectOverlapping=C),void 0;var u,G,V,$=w.gv,z=w.data,M=pc(z,$.getMat(z)),E=1/0,X=1/0,L=-1/0,Q=-1/0,B=z.getAnchor3d(),J=B.x,k=B.y,_=B.z;for(u=0;8>u;u++){if(G=Qf([(u>>2)-J,(1&u>>1)-k,(1&u)-_],M),V=$.toViewPosition(G),isNaN(V.x)||isNaN(V.y))return;E=Math.min(E,V.x),L=Math.max(L,V.x),X=Math.min(X,V.y),Q=Math.max(Q,V.y)}var T={x:E,y:X,w:L-E,h:Q-X};w._rectOverlapping=$.overlappingBox.isOverlapping(N,T)},getVectorDynamicSize:function(){var B,e=this,K=e.s("shape3d"),w=e.data;if("billboard"===K||"plane"===K||(B=w._currentCubeElementId)!=V){var $,U,p=e.gv,x=pc(w,p.getMat(w)),H=w.getAnchor3d(),O=.5-H.x,M=.5-H.y,S=.5-H.z,C=e.s("shape3d.vector.dynamic.maxsize"),N=function(J,_){J[0]+=O,J[1]+=M,J[2]+=S,_[0]+=O,_[1]+=M,_[2]+=S;var Q=p.toViewPosition(Qf(J,x)),q=p.toViewPosition(Qf(_,x)),T=Q.x-q.x,w=Q.y-q.y;return Math.min(C,Math.sqrt(T*T+w*w))};if("billboard"===K)$=N([-.5,0,0],[.5,0,0]),U=N([0,-.5,0],[0,.5,0]);else if("plane"===K)$=N([-.5,0,0],[.5,0,0]),U=N([0,0,-.5],[0,0,.5]);else if(w._currentCubeElementId!=V){var d=3*Ef[B+1],R=3*Ef[B],A=3*Ef[B+2];$=N([bh[d],bh[d+1],bh[d+2]],[bh[A],bh[A+1],bh[A+2]]),U=N([bh[d],bh[d+1],bh[d+2]],[bh[R],bh[R+1],bh[R+2]])}return[$,U]}},getCachedTexture:function(){var a=this,Y=a.data,U=Y._currentCubeElementId;return U!=V?a._cubeCachedImage?a._cubeCachedImage[U]:null:a._shape3dCachedImage},setCachedTexture:function(p){var X=this,_=X.data,n=_._currentCubeElementId;n!=V?(X._cubeCachedImage||(X._cubeCachedImage={}),X._cubeCachedImage[n]=p):X._shape3dCachedImage=p},invalidateCachedTexture:function(h){var A,p,C,m=this;if((C=m._shape3dCachedImage)&&(h.deleteTexture(C),m._shape3dCachedImage=null),p=m._cubeCachedImage){for(A in p)h.deleteTexture(p[A]);m._cubeCachedImage=null}},vf:function(o,H){var R=this;if(R.gv.getFaceVisible(R.data,o)){var e=pe(R,o);e.mat&&(R.faceMat=!0);var O=e.uv;if(O){var U=R._cubeUvs;U||(U=R._cubeUvs=new Nb([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]));for(var J=0;8>J;J++)U[H+J]=O[J]}return e}},_billboardInView:function(){var M=[-.5,-.5,0,-.5,.5,0,.5,-.5,0,.5,.5,0],u=[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,.5],N=new Fd,X=new ah,V=new Dg,A=new Of,Z=new Array(16);return function(Q){var L=this;if(!L.mat)return!0;for(var D=L.gv.getPVMatrix(),P=!1,g=0;16>g;g++)D[g]!==Z[g]&&(P=!0,Z[g]=D[g]);P&&A.setFromMatrix(V.fromArray(D));var Y="billboard"===Q?M:u;N.makeEmpty(),V.fromArray(L.mat);for(var g=0,d=Y.length;d>g;g+=3)N.expandByPoint(X.fromArray(Y,g).applyMatrix4(V));return A.intersectsBox(N)}}(),_80o:function(D,m,e){var s=this;if(s._rectOverlapping)return!0;var d=s.shapeModel;if(d||!s.shapeName){var j=s.s("shape3d");if(("billboard"===j||"plane"===j)&&!s._billboardInView(j))return!0;var b=s.gv,p=s.data,U=b._cube;we(b,s.mat),s.s("shape3d.reflector")&&!D._picking||(d?Yc(b,p,d,s,s.getBodyColor(),e):(fk(D,U.vs,V,m.aPosition),fk(D,U.ns,V,m.aNormal),ak(D,U.is),s._18O(D,m,s.left,0,e),s._18O(D,m,s.front,6,e),s._18O(D,m,s.right,12,e),s._18O(D,m,s.back,18,e),s._18O(D,m,s.top,24,e),s._18O(D,m,s.bottom,30,e))),Vm(b),s.faceMat&&(s._18O(D,m,s.left,0,e,!0),s._18O(D,m,s.front,6,e,!0),s._18O(D,m,s.right,12,e,!0),s._18O(D,m,s.back,18,e,!0),s._18O(D,m,s.top,24,e,!0),s._18O(D,m,s.bottom,30,e,!0))}},_18O:function(P,s,H,M,K,t){if(H){if(!K(H.transparent))return;if(t&&!H.mat||!t&&H.mat)return;var y=this.data.s("polygonOffset");y&&Cj(P,y),t&&we(this.gv,H.mat);var w=this,Z=w.data;Z._currentCubeElementId=M;var k=w.gv,e=k.getTexture(H.texture,Z),p=H.uv,F=H.uvScale,z=H.uvOffset,_=H.discardSelectable;e?p?Sj(P,s,e,_,k._buffer.uv,w._cubeUvs,z,F):Sj(P,s,e,_,k._cube.uv,V,z,F):Sj(P),Jm(P,s,H.blend,H.light,H.opacity,H.reverseFlip,H.reverseColor,H.reverseCull),rk(P,s.uDiffuse,H.color||g["color.empty"]),hc(P,M,6),Mc(P,s),tk(P,s,e),t&&Vm(k),y&&Wb(P),Z._currentCubeElementId=null}},drawReflector:function(){var c=new ah,W=new ah,E=new Tc,q=new Dg,p=new ah,a=new ah,f=new ah,d=new ah,z=new Dg,h=new Dg,X=new nn,U=new vb,n=new vb,s=function(g,F,z){g[z]=F[0],g[z+1]=F[1],g[z+2]=F[2]},M=function(P,S){s(P,S.getEye(),0),s(P,S.getCenter(),3),s(P,S.getUp(),6)},_=function(u,f){f._eye=[u[0],u[1],u[2]],f._center=[u[3],u[4],u[5]],f._up=[u[6],u[7],u[8]],f._18Q=V;var o=f._skyBox;o&&(o.p3([u[0],u[1],u[2]]),f.getData3dUI(o).iv())};return function(u,Y,F,j,B){var P=this;P._reflectorInfo=null;var r=P.data;if(r._reflecting)return!1;var l=P.gv;if(B)return!1;var L=P._reflectorRenderTarget;L?L.setSize(u,Y,F):L=P._reflectorRenderTarget=new Yf.RenderTarget(l,u,Y,F),c.copy(r.p3()),W.copy(l.getEye()),q.makeRotationFromEuler(E.set(r.r3(),r.getRotationMode(),!0));var J;if(!P._reflectNormal){var J=sr(P,P.s("shape3d"));if(!J)return!1;if(!J.ns&&J.length&&(J=J[0]),!J.ns||!J.vs)return!1;P._reflectNormal=[J.ns[0],J.ns[1],J.ns[2]],P._reflectorVbuffer=Vk.Buffer.createVertexBuffer(u,new Float32Array(J.vs))}if(p.copy(P._reflectNormal),p.applyMatrix4(q),a.subVectors(c,W),a.dot(p)>0)return!1;a.reflect(p).negate(),a.add(c),f.copy(l.getCenter()).negate().add(c),f.reflect(p).negate(),f.add(c),d.copy(l.getUp()),d.reflect(p);var s=[0,0,0,0,0,0,0,0,0];M(s,l),l._eye=a.toArray(),l._center=f.toArray(),l._up=d.toArray(),l._18Q=V;var b=l._skyBox;b&&(b.p3(l._eye),l.getData3dUI(b).iv()),Hq(u,L.frame),u.viewport(0,0,L.width,L.height),u.clearColor(0,0,0,1),u.clear(u.COLOR_BUFFER_BIT);var I=sj(l),x=Bl(l);X.setFromNormalAndCoplanarPoint(p,c),X.applyMatrix4(h.fromArray(x)),U.set(X.normal.x,X.normal.y,X.normal.z,X.constant),n.x=(Math.sign(U.x)+I[8])/I[0],n.y=(Math.sign(U.y)+I[9])/I[5],n.z=-1,n.w=(1+I[10])/I[14],U.multiplyScalar(2/U.dot(n));var A=r.s("shape3d.reflector.clip"),K=A===C?.003:A;I[2]=U.x,I[6]=U.y,I[10]=U.z+1-K,I[14]=U.w;var g=l._computedProjectMatrix;l._computedProjectMatrix=I,r._reflecting=!0,j(),l._computedProjectMatrix=g,z.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),z.multiply(h.fromArray(l._projectMatrix)),z.multiply(h.fromArray(l._viewMatrix)),oo(u),_(s,l);var R=$g.Reflector.shader;return R||(R=$g.Reflector.shader=new Vk.Shader(u,$g.Reflector.vs,$g.Reflector.fs)),R.bind(),u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,L.texture),R.uniforms.tDiffuse=0,R.uniforms.color=Fe(r.s("shape3d.reflector.color")||"rgb(128,128,128)"),R.uniforms.textureMatrix=z.toArray(),R.uniforms.modelMatrix=pc(r),R.uniforms.viewMatrix=Bl(l),R.uniforms.projectionMatrix=sj(l),P._reflectorVbuffer.upload(),R.attributes.pos.pointer(P._reflectorVbuffer),u.drawArrays(u.TRIANGLES,0,6),r._reflecting=!1,u.useProgram(l._prg),!0}}()}),$g.Reflector={vs:["attribute vec3 pos;","uniform mat4 textureMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying vec4 vUv;","void main() {","	vUv = textureMatrix * modelMatrix * vec4( pos, 1.0 );","	gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( pos, 1.0 );","}"].join("\n"),fs:["precision highp float;","uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","	return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","	return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","	vec4 base = texture2DProj( tDiffuse, vUv );","   vec2 tUv = vUv.xy / vUv.w;","   if (tUv.x < .0 || tUv.y < .0 || tUv.x > 1. || tUv.y > 1.) discard;","	gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var yn=function(o,z){Hh(yn,this,[o,z])};Ir(yn,bd,{_25Q:1,validate:function(G){var A=this,s=A.gv,o=A.data,E=A.s,N=E("edge.width"),Y=o._40I,_=o._41I;if(A.shapeModel=A.info=V,Y&&_){var g,v,i,L,U,R,C,P,z,w,b=o.isLooped(),x=E(Bb),k=m.getEdgeType(x);if(k){var T=k(o,uh(A,s,o,b,x),s,A._19Q);if(!T.points||T.points.isEmpty())return;R=A.info={},C=T.segments,U=T.points,P=U.size();for(var q=Y.getElevation(),I=_.getElevation(),e=0;P>e;e++){var K=U.get(e);K.e==V&&(K.e=q+(I-q)*e/(P-1))}z=$i(U.get(0)),w=$i(U.get(P-1));var p=P%2;0===p?(R.c1=$i(U.get(P/2-1)),R.c2=$i(U.get(P/2))):R.p3=$i(U.get((P-p)/2)),R.s1=z,R.s2=$i(U.get(1)),R.t1=$i(U.get(P-2)),R.t2=w}else{U=new Vd,R=A.info={};var F=E("edge.offset"),j=E("edge.center"),Q=E("edge.source.t3"),u=E("edge.target.t3"),t=Y.p3(),H=_.p3();if(Q&&(t[0]+=Q[0],t[1]+=Q[1],t[2]+=Q[2]),u&&(H[0]+=u[0],H[1]+=u[1],H[2]+=u[2]),x===Lg){C=E("edge.segments");var y=R.points=E(sb)||Lj;if(P=y.size()){z=$i(y.get(0)),w=$i(y.get(P-1)),!j&&F&&(i=Nn(z,t,!0),F=f(F,_e(t,z)),t=[t[0]+i[0]*F,t[1]+i[1]*F,t[2]+i[2]*F],i=Nn(H,w,!0),F=f(F,_e(w,H)),H=[H[0]-i[0]*F,H[1]-i[1]*F,H[2]-i[2]*F]);var p=P%2;0===p?(g=$i(y.get(P/2-1)),v=$i(y.get(P/2))):R.p3=$i(y.get((P-p)/2)),R.s1=t,R.s2=z,R.t1=w,R.t2=H}else!j&&F&&(i=Nn(H,t,!0),L=_e(t,H),F=yf(F,L),t=[t[0]+i[0]*F,t[1]+i[1]*F,t[2]+i[2]*F],H=[H[0]-i[0]*F,H[1]-i[1]*F,H[2]-i[2]*F]),g=t,v=H;U.add({x:t[0],y:t[2],e:t[1]}),U.addAll(y),U.add({x:H[0],y:H[2],e:H[1]})}else{var l=uh(A,s,o,b,x);if(A._19Q||(l=-l),b){var W=t[0],J=t[1],h=t[2],$=Y.getTall()/2+l;g=[W-l,J+$,h],v=[W+l,J+$,h],U.add({x:W-l,y:h,e:J}),U.add({x:W-l,y:h,e:J+$}),U.add({x:W+l,y:h,e:J+$}),U.add({x:W+l,y:h,e:J})}else{i=Nn(H,t,!0),L=_e(t,H);var S={x:t[0],y:t[2]},d={x:H[0],y:H[2]},O=wo(V,S,d,l),X=O.x-S.x,D=O.y-S.y;F=yf(F,L),i[0]*=F,i[1]*=F,i[2]*=F,g=[t[0]+i[0]+X,t[1]+i[1],t[2]+i[2]+D],v=[H[0]-i[0]+X,H[1]-i[1],H[2]-i[2]+D],j?(U.add({x:t[0],y:t[2],e:t[1]}),U.add({x:g[0],y:g[2],e:g[1]}),U.add({x:v[0],y:v[2],e:v[1]}),U.add({x:H[0],y:H[2],e:H[1]})):(U.add({x:g[0],y:g[2],e:g[1]}),U.add({x:v[0],y:v[2],e:v[1]}))}}R.c1=g,R.c2=v}R.list=E(Hc)===Pj?A.createTubeModel(U,C,N/2,G):A.createLineModel(U,C,N,"edge","edge.dash")}}});var tc=function(z,s){Hh(tc,this,[z,s])};Ir(tc,sg,{_80o:function(c,D,$){var q=this,W=q.gv,k=q.shapeModel;we(W,q.mat),k?Yc(W,q.data,k,q,q.getBodyColor(),$):(gg(q,c,D,q.left,$),gg(q,c,D,q.front,$),gg(q,c,D,q.right,$),gg(q,c,D,q.back,$),gg(q,c,D,q.top,$),gg(q,c,D,q.bottom,$)),Vm(W)},validate:function(G,g){var F,x,h=this,i=h.s,X=h.data,m=X.p3(),d=X._thickness/2,O=X.isClosePath(),k=X.getPoints(),c=X.getSegments(),Z=i(Vp),Q=G&&G.uv;if(h.clear(),0>d)x=h.shapeModel=Up(k,c,i(Ip),i(zo),Z,i(Le),X.getTall(),X.getShapeElevation(),O),i(ck)?i("shape3d.image")||delete x.uv:(delete x.vs,delete x.ns,delete x.uv),i("shape3d.top.image")||delete x.top_uv,i("shape3d.bottom.image")||delete x.bottom_uv;else if(i(Hc)===Pj)F=so(k,c,Z,O),x=h.shapeModel={vs:[]},i("shape3d.image")&&(x.uv=[],x.sum=i(Le)||Od(F)||1,x.len=0),i(Ip)&&!O&&(x.top_vs=[],i("shape3d.top.image")&&(x.top_uv=[])),i(zo)&&!O&&(x.bottom_vs=[],i("shape3d.bottom.image")&&(x.bottom_uv=[])),h._12O(F,d);else{var j,a,C,b,v,P,o,K,D,r;if(F=so(k,c,Z,O),v=h.vf(Bn,Q,!1,g),d&&(P=h.vf(rg,Q,!1,g),o=O?V:h.vf(ws,Q,!1,g),K=O?V:h.vf(Hn,Q,!1,g),D=h.vf(qs,Q,!1,g),r=h.vf(rq,Q,!1,g)),d){for(var y=0,E=F.length;E>y;y++)F[y]=h._tryRemoveBezierPoints(F[y],d);h._12O(F,d)}else v&&F.forEach(function(g){if(b=g.length,b>0)for(j=g[0],C=1;b>C;C++)a=g[C],h.addV(v.vs,j,a),j=a});h._20Q(F),G||(v&&(v.ns=Hp(v.vs),dg(v,"vs"),dg(v,hq)),d&&(P&&(P.ns=Hp(P.vs),dg(P,"vs"),dg(P,hq)),o&&(o.ns=Hp(o.vs),dg(o,"vs"),dg(o,hq)),K&&(K.ns=Hp(K.vs),dg(K,"vs"),dg(K,hq)),D&&(D.ns=Hp(D.vs),dg(D,"vs"),dg(D,hq)),r&&(r.ns=Hp(r.vs),dg(r,"vs"),dg(r,hq))))}var Y=h.mat=Yq();Xl(Y,m),Mp(Y,X.getFinalRotation3d(),X.getRotationMode());var f=X.getScale3d(),I=X._dynamicScale3d;I&&(f[0]*=I[0],f[1]*=I[1],f[2]*=I[2]),Dr(Y,f),Xl(Y,Im(m)),G&&(Ge(h,Y,G,x),h.clear())},_20Q:function(W){var S,U,G,q,O,w,D,y=this,T=y.front,j=y.back,_=y.top,B=y.bottom,u=T?T.tuv:V,J=j?j.tuv:V,k=_?_.tuv:V,X=B?B.tuv:V,n=0;(u||J||k||X)&&(S=y.s(Le)||Od(W)||1,W.forEach(function(f){if(U=f.length,U>0)for(w=f[0],G=1;U>G;G++)D=f[G],q=n/S,n+=_e(w,D),O=n/S,y._14O(T,q,O),y._14O(j,1-O,1-q),y._14O(_,q,O),y._14O(B,q,O),w=D}))},_14O:function(J,a,Q){if(J){var z=J.uv,i=J.tuv;if(i){if(z)var X=z[0]+(z[6]-z[0])*a,v=z[1]+(z[7]-z[1])*a,t=z[2]+(z[4]-z[2])*a,G=z[3]+(z[5]-z[3])*a,D=z[2]+(z[4]-z[2])*Q,h=z[3]+(z[5]-z[3])*Q,L=z[0]+(z[6]-z[0])*Q,A=z[1]+(z[7]-z[1])*Q;else X=a,v=0,t=a,G=1,D=Q,h=1,L=Q,A=0;i.push(t,G,D,h,L,A,L,A,X,v,t,G)}}},_13O:function(l){var _=l.uv,b=l.tuv;b&&(_?b.push(_[2],_[3],_[4],_[5],_[6],_[7],_[6],_[7],_[0],_[1],_[2],_[3]):b.push(0,1,1,1,1,0,1,0,0,0,0,1))},_tryRemoveBezierPoints:function(j,H){var b=j.length;if(4>b)return j;var f,V,c,d,B,o,z=!1,x=function(w){return j[w]},G=function(F){return j[b-1-F]};for(B=0;1>=B;B++)for(o=B?G:x,V=o(0),c=o(1),f=2;b-1>f;f++)if(d=o(f),!d.remove)if(d.b){var y=wo(V,c,d,H);y.adjust?(d.remove=!0,z=!0):(V=c,c=d)}else V=c,c=d;if(!z)return j;var m=[];for(f=0;b>f;f++)j[f].remove||m.push(j[f]);return m},_12O:function(c,l){var D,P,o,v,e,K=this.s("shape3d.point.epsilon"),n=this;c.forEach(function(w){if(e=w.length,e>0)for(D={p:w[0],n:!0},v=1;e>v;v++)P=w[v],o=e-1>v?w[v+1]:V,o&&Math.abs(P.x-o.x)<K&&Math.abs(P.y-o.y)<K||n.addPoint(D,P,o,l,w)})},addPoint:function(s,R,r,x,o){var I,T,f,Z,D,J,_,P,E,A=this,w=s.p,O=s.f,v=s.b,S=A.s("shape3d.side")||sn,y=A.s("shape3d.start.angle"),h=A.s("shape3d.sweep.angle"),d=A.shapeModel,G=A.data.isClosePath();if(s.n&&(s.n=!1,O=G&&o.length>2?wo(o[o.length-2],w,R,x):wo(V,w,R,x),v=_i(w,O),d?d.top_vs&&A._10O(v,O,S,y,h,d.top_vs,d.top_uv):(I=A.left)&&(A.addV(I.vs,v,O),A._13O(I))),T=r?wo(w,R,r,x):G&&o.length>2?wo(w,R,o[1],x):wo(w,R,V,x),f=_i(R,T),d){var k,m,l=d.vs,b=d.uv,e=d.sum;for(b&&(k=d.len/e,d.len+=_e(w,R),m=d.len/e),J=A._9O(v,O,S,y,h),_=A._9O(f,T,S,y,h),P=0;S>P;P++)E=P+1,Rd(l,J[E]),Rd(l,_[P]),Rd(l,J[P]),Rd(l,_[P]),Rd(l,J[E]),Rd(l,_[E]),b&&(Z=P/S,D=E/S,b.push(k,D,m,Z,k,Z,m,Z,k,D,m,D));!r&&d.bottom_vs&&A._10O(f,T,S,y,h,d.bottom_vs,d.bottom_uv,!0)}else!r&&(I=A.right)&&(A.addV(I.vs,T,f),A._13O(I)),(I=A.front)&&A.addV(I.vs,O,T),(I=A.back)&&A.addV(I.vs,f,v),(I=A.top)&&A.addH(I.vs,O,T,f,v,!0),(I=A.bottom)&&A.addH(I.vs,v,f,T,O);s.p=R,s.f=T,s.b=f},_10O:function(D,Z,f,g,M,h,q,s){var L,T,d=this,x=d.data,S=d._9O(D,Z,f,g,M),G=(D.x+Z.x)/2,i=(D.y+Z.y)/2,p=x.getShapeElevation(),N=0;for(N=0;f>N;N++)s?(Rd(h,S[N]),Rd(h,S[N+1])):(Rd(h,S[N+1]),Rd(h,S[N])),Rd(h,[G,p,i]),q&&(s?(L=w*(N+1)/f+g,T=w*N/f+g):(L=w*N/f+g,T=w*(N+1)/f+g),q.push(.5-.5*e(T),.5-.5*U(T),.5-.5*e(L),.5-.5*U(L),.5,.5))},_9O:function(n,M,d,A,v){var p,y,X=this,o=X.data,L=[],P=(n.x+M.x)/2,z=(n.y+M.y)/2,D=o.getTall()/2,$=o.getShapeElevation(),Y=0;for(v=v||w;d>=Y;Y++)p=v*Y/d+A,y=e(p),L.push([P+(n.x-P)*y,$+D*U(p),z+(n.y-z)*y]);return L},addV:function(a,h,y){var Y=h.x,g=h.y,d=y.x,m=y.y,l=this.data,_=l.getShapeElevation(),E=l.getTall()/2;a.push(Y,_-E,g,d,_-E,m,d,_+E,m,d,_+E,m,Y,_+E,g,Y,_-E,g)},addH:function(R,G,i,D,k,W){var v=this.data,w=v.getTall()/2,t=v.getShapeElevation()+(W?w:-w);R.push(G.x,t,G.y,i.x,t,i.y,D.x,t,D.y,D.x,t,D.y,k.x,t,k.y,G.x,t,G.y)},vf:function(x,J,y,L){var N,T=this,g=T.gv.getFaceVisible(T.data,x);return(y||g)&&(N=pe(T,x,L),N.vs=[],N.tuv=g&&(N.texture||J)?[]:V,N.visible=g),N}});var go=function(W,v){Hh(go,this,[W,v])};Ir(go,bd,{_25Q:1,validate:function(w){var I=this,F=I.data,s=I.s,Q=F.getPoints(),_=Q.size();if(I.shapeModel=I.info=V,_>1){var G=I.info={},O=F.getSegments(),x=F.getThickness(),A=$i(Q.get(0)),W=$i(Q.get(_-1)),m=_%2;0===m?(G.c1=$i(Q.get(_/2-1)),G.c2=$i(Q.get(_/2))):G.p3=$i(Q.get((_-m)/2)),G.s1=A,G.s2=$i(Q.get(1)),G.t1=$i(Q.get(_-2)),G.t2=W,G.list=s(Hc)===Pj?I.createTubeModel(Q,O,x/2,w):I.createLineModel(Q,O,x,"shape.border","shape.dash")}var r=F.p3(),n=I.mat=Yq();Xl(n,r),Mp(n,F.getFinalRotation3d(),F.getRotationMode());var k=F.getScale3d(),D=F._dynamicScale3d;D&&(k[0]*=D[0],k[1]*=D[1],k[2]*=D[2]),Dr(n,k),Xl(n,Im(r))},_80o:function(g,m,o){var C=this,R=C.shapeModel;if(R){var M=C.gv;we(M,C.mat),Yc(M,C.data,R,C,C.getBodyColor(),o),Vm(M)}}});var wb=k.graph3d.VR=function(M){var s=this;s.gv=M,s._controllers=[],s.switch=new Li(s),s._enable=!1,s._defaultCallLater=k.Default.callLater,s._defaultCancelLater=aq,"undefined"!=typeof K&&"VRFrameData"in K&&(s._frameData=new K.VRFrameData),s.measureOflength=1,s.eyesOffset=[0,0,0],s._orientation=new k.Math.Quaternion,s._lastHeadPose=[0,0,0],s._offsetToBeAdd=[0,0,0],s._fpsInfo={time:0,fps:0,frames:0}};Ir(wb,H,{ms_fire:!0,_42:function(R,J,B,E){var s=this,C=s.gv;if(!C.drawFilter&&s._deviceInAction){var d=s._device;if(d){var g=s._measureOflength;d.depthNear=C.getNear()*g,d.depthFar=C.getFar()*g;var o=s._offsetToBeAdd;if(s.eyesOffset[0]+=o[0],s.eyesOffset[1]+=o[1],s.eyesOffset[2]+=o[2],o[0]=0,o[1]=0,o[2]=0,d.isPresenting===!1)return s._controllers.forEach(function(W){W&&W.update()}),C.iv(),!1;var Z=s._frameData;d.getFrameData(Z);var I=Z.pose.position;if(I){var P=s.toViewPosition(I);C.setEye(P),s._orientation.fromArray(Z.pose.orientation);var W=new k.Math.Vector3(0,0,-10*s._scaleFactor);W.applyQuaternion(s._orientation),C.setCenter([P[0]+W.x,P[1]+W.y,P[2]+W.z])}s._controllers.forEach(function(u){u&&u.update()}),C.setViewport(R,0,0,J/2,B),s._viewMatrix=s._copyViewMatrix(Z.leftViewMatrix),s._projectMatrix=s._copyProjectMatrix(Z.leftProjectionMatrix),E(),C.setViewport(R,J/2,0,J/2,B),s._viewMatrix=s._copyViewMatrix(Z.rightViewMatrix),s._projectMatrix=s._copyProjectMatrix(Z.rightProjectionMatrix),E(),s._lastViewMatrix=s._viewMatrix,s._lastProjectMatrix=s._projectMatrix,s._viewMatrix=null,s._projectMatrix=null,s.submitFrame();var u=Date.now(),D=s._fpsInfo;return u-D.time>1e3?(D.fps=Math.round(1e3*(D.frames+1)/(u-D.time)),D.time=u,D.frames=0):D.frames++,!0}}},onVRDisplayPresentChange:function(){var B=this.isPresenting();this._injectGraphView(B),this.fp("present",!B,B)},getOrientation:function(){return this._orientation},addController:function(y){y=y||0;var w=this,z=w.getController(y);return z?z:(z=new em(w,y),w._controllers.push(z),z)},getController:function(H){H=H||0;for(var f=this._controllers,Q=0,z=f.length;z>Q;Q++)if(f[Q]&&f[Q].id===H)return f[Q];return null},removeController:function(M){M=M||0;for(var J=this._controllers,k=0,V=J.length;V>k;k++)if(J[k]&&J[k].id===M)return J.splice(k,1),!0;return!1},getLastHeadPose:function(){return this._lastHeadPose},toViewPosition:function(X,F){var g=this,c=g._scaleFactor,z=g._eyesOffset,x=g._lastHeadPose;return x[0]=X[0]*c,x[1]=X[1]*c,x[2]=X[2]*c,F?(F[0]=x[0]+z[0],F[1]=x[1]+z[1],F[2]=x[2]+z[2],F):[x[0]+z[0],x[1]+z[1],x[2]+z[2]]},addEyesOffset:function(S,_,y){var z=this._offsetToBeAdd;z[0]+=S,z[1]+=_,z[2]+=y},_copyViewMatrix:function(e){var z=this.dup(e),o=this._scaleFactor;z[12]*=o,z[13]*=o,z[14]*=o;var w=this._eyesOffset;if(w&&(w[0]||w[1]||w[2])){var L=w[0],Y=w[1],O=w[2];z[12]-=z[0]*L+z[4]*Y+z[8]*O,z[13]-=z[1]*L+z[5]*Y+z[9]*O,z[14]-=z[2]*L+z[6]*Y+z[10]*O}return z},shutdown:function(){var K=this._device;K&&K.isPresenting&&K.exitPresent()},isPresenting:function(){var W=this._device;return W&&W.isPresenting},_copyProjectMatrix:function(J){var n=this.dup(J),L=this._scaleFactor;return n[14]*=L,n},dup:function(x,U){for(var y=x.length,b=U||new Array(y);y--;)b[y]=x[y];return b},getViewMatrix:function(B){var Q=this._viewMatrix;return Q?this.dup(Q,B):void 0},getProjectMatrix:function(){var O=this._projectMatrix;return O?this.dup(O):void 0},submitFrame:function(){var s=this;if(s._enable&&s._deviceInAction){var M=s._device;M&&M.isPresenting&&(M.submitFrame(),s.gv.iv())}},getFps:function(){return this._fpsInfo.fps},intersectWorld:function(s){var c=this.gv;return c.intersectObjects(s,c.dm().getDatas())},setDevice:function(e){var F=this;F._device=e},_injectGraphView:function(){var x,a,z;return function(L){var E=this.gv;if(!L)return x&&(E.getWidth=x,E.getHeight=a,E.getDevicePixelRatio=z),void 0;var R=this._device,d=R.getEyeParameters("left"),y=d.renderWidth,S=d.renderHeight;x=E.getWidth,a=E.getHeight,z=E.getDevicePixelRatio,E.getWidth=function(){return 2*y},E.getHeight=function(){return S},E.getDevicePixelRatio=function(){return 1}}}(),_injectCallLaterFunc:function(R){var Q=this;if(!R)return Md=k.Default.callLater=Q._defaultCallLater,aq=k.Default.cancelLater=Q._defaultCancelLater,void 0;var Q=this;Md=k.Default.callLater=function(U,h,n,m){var O=Q._device;return O&&O.isPresenting?m?G(function(){Md(U,h,n)},m):O.requestAnimationFrame(function(){Q._deviceInAction=!0,U.apply(h,n),Q._deviceInAction=!1}):Q._defaultCallLater(U,h,n,m)},aq=k.Default.cancelLater=function(U,p){var C=Q._device;return C&&C.isPresenting?p?W(U):C.cancelAnimationFrame(U):Q._defaultCancelLater(U,p)}}}),H.defineProperties(wb.prototype,{enable:{get:function(){return this._enable},set:function(M){var _=this;_._enable!==M&&(_._enable=M,M?(_.switch.showButton(),_._injectCallLaterFunc(!0)):(_.shutdown(),_.switch.hideButton(),_._injectCallLaterFunc(!1)),_.fp("enable",!M,M))}},measureOflength:{get:function(){return this._measureOflength},set:function(C){this._measureOflength=C;var H=this._scaleFactor=1/C;this._controllers.forEach(function(W){W&&W._setScaleFactor(H)})}},eyesOffset:{get:function(){return this._eyesOffset},set:function(z){this._eyesOffset=z}},controllerModel:{get:function(){return this._controllerModel},set:function(H){var h;"object"==typeof H?(h=H.mtl,H=H.obj):(h=H+".mtl",H+=".obj");var w=this,X=w._controllerModel;X&&X.obj===H&&X.mtl===h||(X=w._controllerModel={obj:H,mtl:h},m.loadObj(H,h,{finishFunc:function(y,q){w._controllerModel===X&&m.setShape3dModel("vrControllerModel",q)}}))}},interactive:{get:function(){return!!this._interactive},set:function(w){!!w!=!!this._interactive&&(this._interactive=w,w&&this.addController(0),this.gv.getCoreInteractor().enableVR(w))}}});var em=function(D,h){function M(v){var x=navigator.getGamepads&&navigator.getGamepads();if(x)for(var h=0,T=0,Y=x.length;Y>h;h++){var y=x[h];if(y){var D=y.id;if("OpenVR Gamepad"===D||"OpenVR Controller"===D||0===D.indexOf("Oculus Touch")||0===D.indexOf("Spatial Controller")){if(T===v)return y;T++}}}}function w(R,F,U){return Math.abs(R[0]-F[0])<U&&Math.abs(R[1]-F[1])<U&&Math.abs(R[2]-F[2])<U?!0:!1}var Z=this;Z.vr=D,Z.id=h;var o,P,q=[0,0],B=[{id:"thumbpad",pressed:!1},{id:"trigger",pressed:!1},{id:"grips",pressed:!1},{id:"menu",pressed:!1}],t=new Gk;t.s("shape3d","vrControllerModel"),t.isController=!0,t.s("intersect",!1),Z.getGamepad=function(){return P},Z.isButtonPressed=function(p){for(var o,J=0,i=B.length;i>J;J++)if(o=B[J],o.id===p)return o.pressed;return!1},Z.getNode=function(){return t};var V=.003;Z.setRotationEpsilon=function(w){V=w};var l=5e-4,L=l;Z.setPositionEpsilon=function(A){l=A,L=A*Z.vr._scaleFactor},Z._setScaleFactor=function(K){t.s3(K,K,K),L=l*K
},Z._setScaleFactor(Z.vr._scaleFactor);var g,y=new bn,p=new Dg,e=[0,0,0],X=[0,0,0],c=new Tc,J=new ah,E=new ij;Z.getRay=function(){return g?(E.origin.fromArray(e),E.direction.copy(J),g=!1,E):E},Z.update=function(){if(o=P,P=M(h),o!=P&&console.log("gamepad changed",P),!P||P.pose===C)return P=null,t.s("3d.visible",!1),void 0;if(m.getShape3dModel("vrControllerModel")){t.dm()||D.gv.dm().add(t),t.s("3d.visible",!0);var N=P.pose;if(null!==N){N.position&&(Z.vr.toViewPosition(N.position,e),w(t.p3(),e,L)||(g=!0,t.p3(e))),N.orientation&&(y.fromArray(N.orientation),J.set(0,0,-1).applyQuaternion(y).normalize(),p.makeRotationFromQuaternion(y),c.set(0,0,0,t.getRotationMode(),!0).setFromRotationMatrix(p),X[0]=c.x,X[1]=c.y,X[2]=c.z,w(t.r3(),X,V)||(g=!0,t.r3(X))),g&&D.fp("gamepad.pose",null,{position:e,rotation:X,id:h});var d=P.axes;(q[0]!==d[0]||q[1]!==d[1])&&(q=[d[0],d[1]],D.fp("gamepad.axes",null,{id:h,axes:q}));var x,b,Q,j,W=P.buttons;for(x=0,b=W.length;b>x;x++)if(Q=W[x],j=Q.pressed,j!==B[x].pressed){B[x].pressed=j;var s={id:h},i="state";s[i]=s._62O=j?"down":"up",D.fp("gamepad.button."+B[x].id,null,s)}}}}},Li=function(C){this.vr=C,this._button=null};Ir(Li,H,{showButton:function(){var c=this.assureButton();if(!c.parentNode){var o=this.vr.gv,b=o.getView();o._79O?b.insertBefore(c,o._79O):b.appendChild(c)}},hideButton:function(){var c=this._button;c&&c.parentNode&&c.parentNode.removeChild(c)},assureButton:function(){var b=this._button;return b?b:this._button=this.createButton(this.vr.gv)},createButton:function(c){function p(w,V){w.textContent=V&&V.isPresenting?"关闭 VR 显示":"开启 VR 显示"}function A(f){l.style.display="",l.style.cursor="pointer",l.style.left="calc(50% - 50px)",l.style.width="100px",p(l,f),l.onmouseenter=function(){l.style.opacity="1.0"},l.onmouseleave=function(){l.style.opacity="0.5"},l.onclick=function(){f.isPresenting?f.exitPresent():f.requestPresent([{source:c.getCanvas()}])},c.vr.setDevice(f)}function x(){l.style.display="",l.style.cursor="auto",l.style.left="calc(50% - 75px)",l.style.width="150px",p(l,null),l.onmouseenter=null,l.onmouseleave=null,l.onclick=null,c.vr.setDevice(null)}function s(w){w.style.position="absolute",w.style.bottom="20px",w.style.padding="12px 6px",w.style.border="1px solid #fff",w.style.borderRadius="4px",w.style.color="#000",w.style.font="normal 13px sans-serif",w.style.textAlign="center",w.style.opacity="0.5",w.style.outline="none",w.style.zIndex="999"}if("getVRDisplays"in navigator){var l=this._button=T.createElement("button");return l.style.display="none",s(l),K.addEventListener("vrdisplayconnect",function(S){A(S.display)},B),K.addEventListener("vrdisplaydisconnect",function(){x()},B),K.addEventListener("vrdisplaypresentchange",function(g){p(l,g.display),c.vr.onVRDisplayPresentChange()},B),navigator.getVRDisplays().then(function(G){G.length>0?A(G[0]):x()}),l}var u=T.createElement("a");return u.href="https://webvr.info",u.innerHTML="当前不支持 webvr",u.style.left="calc(50% - 90px)",u.style.width="180px",u.style.textDecoration="none",s(u),u}}),H.defineProperties(Li.prototype,{});var mi=k.graph3d.PostProcessing=function(m){function D(){if(!B){var k=m.getGL();B=new Yf.RenderTarget(m,k,null,null,{samples:g.renderTextureSamples||1}),v=new Vk.Shader(k,q.vs,q.fs),Q=Vk.Buffer.createIndexBuffer(k,new Uint16Array([0,2,1,1,2,3])),r=Vk.Buffer.createVertexBuffer(k,new Float32Array([0,0,1,0,0,1,1,1]))}}var B,v,Q,r,c=this,P={},j=!1;!function(){H.keys(mi).forEach(function(W){P[W]=new mi[W](m)})}(),c.getModule=function(u){return u?P[u]:c},c.getModuleList=function(){return H.keys(P)},c.handleDataModleChange=function(J,K){J&&(J.setPostProcessingData(c.serialize()),J.removeSerializeListener(c.onDataModelSerialize,c)),K&&(K.addSerializeListener(c.onDataModelSerialize,c),c.deserialize(K.getPostProcessingData()))},c.onDataModelSerialize=function(y){"serialize"===y.type?m.dm()._postProcessingData=c.serialize():"deserialize"===y.type&&c.deserialize(m.dm().getPostProcessingData())},c.serialize=function(){var f,g,u,r,T={};for(f in P)u=P[f],g=f.toLowerCase(),T[g]={enable:u.enable},r=u.serializeProperties,r&&r.forEach(function(i){T[g][i]=u[i]});return T},c.deserialize=function(K){if(K){var z,i,I,H,B;for(i in K)if(i&&(z=i[0].toUpperCase()+i.slice(1),I=P[z])){H=K[i],c.enableModule(z,H.enable);for(B in H)"enable"!==B&&(I[B]=H[B])}}else{var z,I;for(z in P)I=P[z],I.enable=!1,I.resetProperties&&I.resetProperties()}},c.decodeShader=function(n){var M,Z,t,L="",v="";for(t=0;t<n.length;t++)M=n[t],"%"===M?M="'":"a"===M?M='"':"]"===M&&(M="\\"),Z=String.fromCharCode(M.charCodeAt(0)-1),t%2?v+=Z:L=Z+L;return v+L},c.createShader=function(A,C,Z){var M=C.indexOf("^#"),y=c.decodeShader(C.substr(0,M)),t=c.decodeShader(C.substr(M+2));if(Z){var p=Z(y,t);p&&p.vs&&(y=p.vs),p&&p.fs&&(t=p.fs)}return new Vk.Shader(A,y,t)},c.enableModule=function(N,d){var r,h,W,Y=N.split(",");for(r=0,h=Y.length;h>r;r++)W=Y[r].trim(),P[W]&&(P[W].enable=d);j=!1;for(W in P)if(P[W].enable){j=!0;break}j&&D()};var q={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")};c._42=function($,S,p,n,N){if(j&&!N){B.setSize($,S,p),B.bind($),$.clear($.COLOR_BUFFER_BIT|$.DEPTH_BUFFER_BIT),m.setViewport($,0,0,S,p),n(),B.unbind($);for(var l=0,_=m._glCapabilities.maxAttributes;_>l;l++)$.disableVertexAttribArray(l);var L,W=B;for(L in P)W=P[L]._42($,W)||W;return m.setViewport($,0,0,S,p),$.clear($.COLOR_BUFFER_BIT|$.DEPTH_BUFFER_BIT),v.bind(),$.activeTexture($.TEXTURE0+0),$.bindTexture($.TEXTURE_2D,W.texture),v.uniforms.image=0,Q.upload(),r.upload(),v.attributes.pos.pointer(r),$.drawElements($.TRIANGLES,6,$.UNSIGNED_SHORT,0),$.bindTexture($.TEXTURE_2D,null),$.useProgram(m._prg),!0}}},Ih=k.graph3d.PostProcessing.Bloom=function(b){function D(){var B=b.getWidth(),l=b.getHeight();if(B&&l){w=[B,l],N=!0;var i,D=b.getGL(),A=Math.round(w[0]/2),W=Math.round(w[1]/2);for(y=new Yf.RenderTarget(b,D,A,W),i=0;P>i;i++)f.push(new Yf.RenderTarget(b,D,A,W)),G.push(new Yf.RenderTarget(b,D,A,W)),A=Math.round(A/2),W=Math.round(W/2);var Y=b._postProcessing;m=Y.createShader(D,Ih._34Q);for(var i=0;P>i;i++)O[i]=Y.createShader(D,Ih._35Q,function(H,v){return{fs:v.replace(/DEFINE_VALUE/g,c[i])}});z=Y.createShader(D,Ih._36Q,function(r,C){return{fs:C.replace(/NUM_MIPS/g,P)}}),n=Y.createShader(D,Ih.finalShader),Q=Vk.Buffer.createIndexBuffer(D,new Uint16Array([0,2,1,1,2,3])),$=Vk.Buffer.createVertexBuffer(D,new Float32Array([0,0,1,0,0,1,1,1]))}}var K,Y,T,Q,$,p=this,W=!1,N=!1;this.serializeProperties="strength,threshold,radius".split(","),this.resetProperties=function(){K=1.5,Y=.55,T=.4},H.defineProperties(p,{enable:{get:function(){return W},set:function(x){!!W!=!!x&&(W=x,x&&!N&&D())}},strength:{get:function(){return K},set:function(O){K=O}},threshold:{get:function(){return Y},set:function(X){Y=X}},radius:{get:function(){return T},set:function(B){T=B}}}),this.resetProperties();var y,m,z,n,w=[256,256],f=[],G=[],P=5,c=[3,5,7,9,11],O=[];p._42=function(g,v){function _(X,l,w,B){Hq(g,l.frame),b.setViewport(g,0,0,l.width,l.height),B?B(g):g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT),r!==X&&X.bind();var C=0;for(var u in w){var h=w[u];h instanceof WebGLTexture&&(g.activeTexture(g.TEXTURE0+C),g.bindTexture(g.TEXTURE_2D,h),h=C,C++),X.uniforms[u]=h}for(r!==X&&(Q.upload(),$.upload(),X.attributes.pos.pointer($),r=X),g.drawElements(g.TRIANGLES,6,g.UNSIGNED_SHORT,0);C--;)g.activeTexture(g.TEXTURE0+C),g.bindTexture(g.TEXTURE_2D,null);oo(g)}if(W&&(N||(D(),N))){var r;_(m,y,{smoothWidth:.01,luminosityThreshold:Y,tDiffuse:v.texture});var B,U=y,V=Math.round(w[0]/2),a=Math.round(w[1]/2);for(B=0;P>B;B++)_(O[B],f[B],{colorTexture:U.texture,direction:[1,0],texSize:[V,a]}),_(O[B],G[B],{colorTexture:f[B].texture,direction:[0,1],texSize:[V,a]}),V=Math.round(V/2),a=Math.round(a/2),U=G[B];return _(z,f[0],{blurTexture1:G[0].texture,blurTexture2:G[1].texture,blurTexture3:G[2].texture,blurTexture4:G[3].texture,blurTexture5:G[4].texture,bloomStrength:K,bloomRadius:T,bloomTintColor:[1,1,1]}),_(n,v,{image:f[0].texture},function(B){B.enable(B.BLEND),B.blendEquation(B.FUNC_ADD),B.blendFunc(B.SRC_ALPHA,B.ONE)}),g.blendEquationSeparate(g.FUNC_ADD,g.FUNC_ADD),g.blendFuncSeparate(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA,g.ONE,g.ONE_MINUS_SRC_ALPHA),v}}};Ih._34Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!jbtijqpmob!!i-jmhfiyqf!ug!m-psbpum<pDvuovjqgupvspn!!)tybjnnq!m>f!ss3pEm!puDEhjbgsgGv`tmfh<<v*o!jwg!p-sinu!egjmXpibuup!pmnvtn!j,o!petmjpuiztUfissifUtziupjmtep<ojvnovjmg!p-senm!pgimtpfbsui!UtznupjptupioXjjnevumi!<)qwfbustzijuophp!nwtf!d>3!!bwiVqwm<b!wupbjpem!gnb<j*o1)/*1!!|-1w/f1d!5-!1u/f1y!f-m1!/>1!)u5fdyfuwv!s>f!3sEp)m!puDEujvgqguvvtpf!-5!dwfVww!<**<!bwnfvdm4!!-m{vznyb/!m>f!ywffud!4))u!p1e/!3>:!:w-!!u1b/p6m9g8-<!*1!/522",Ih._35Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d1j/t2j!p-on!viTjuhiihqj!fgxm0pnbvuT<ftwvbgsgzjjeo)h5!dwffwd!3>!!wsVpwm<pDvhobjsgGp`smnh!t~bn<qxm!f+s!31E/!3d!p>m,p!snUvfTyuuivhsjff<xv<oxj!g+p!s*n3!fwmfqdn3b!tu!f,y!T2jf{mfq<nbvto)j!g>p,s!nn!vwTffdt3v!gegjjsefd<ucjhpso/<*u$fetfgggjPowfv!!L.F!SwOVFwM!`-SfBsEvJuVyTf!UEsFpGmJpOdF!`)WEB3MfVsFvu$yeffug!j>o!f3!fTmJqHnNbBt!!E4FdGfJwOF<`cWhBsM/V*FufgtmgpgbPuw!vh!b,v!twtVjwb!o-Qfesgv)ujyof!Ugsmppmbpud!!y)-E!3jfos!vgumypfbuu!!>t!j2hfnmbq*n!b|t!s4fdufvwso<!y1!/+4!:f9{:j5T!w+o!jf!y+q!)o!p.j1u/d6f!s+j!ey!!>+!!uyf0t)g!gtPjwhvn!b3!d+f!wtj<h*nbbn*h*j0Ttgj!h-nyb)<ge~Qowbpjjtet!vnbbhj!o>)!*x!!|ubwpfmdg3!<j*ojw)Tujb{pfm!g>!!>2!/y1!!u0b!pumfgyT|j!{*f!<,,g!mjp!b<uT!VgJTEjBhSn`bM!F>O!SgFmLp!b=u!)jT!J<H2N!B>*!<j!gumopjb!u)!sxpfgjh<inuvTTvuni!h>j!fhxb!v+t!tcjhbso/Q*ewgV)w1!/-1f-s!vguTyjfhUnsbp*m<pdw!f)dE43!fesjvgugyvftuf!T>v!n",Ih._36Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!j*twjVpwo!!-i6jfhsivqu!ygfmUpsbvum<c)wEb3sfzsjvouhy!fwuf!d+3!!*w1V/w2<!-vsopjmgppDsuno!jtUbnnpqpmmfcs)35Ed!fcwm!v+s!U*f3y/u1v)ssfp2u<dbvGonjpgppmsCnq!stfbmnq!m,f!s*3wEV!wc!m-v5sfUsfvyuuyvfsUfs3v<mcv)oEj3gfpssvnu!ytfbun!q+m!f*s13/E2!!c-msvpsmUpfDyuuovjsUfn4p<pmvco)j5gdpfswn!!+t!b*n5q/m1f)ss3pEu!dcbmGvnspUpfmyCuqvssffm5<!,v!o*jwgVpws!n-!4tfbsnvqumyffsU3sEv!mccm)vEs3Uffsyvuuvysffu6!<+!v*o1j/g2p!s-ns!ptmbpnDqumofjsU3nEp!pemjcs)u5Udffywu!v+s!f*<7/v1o)jsgppusdnb!GgnmpppbmuC!qcsmfpmpn!T,u!s*fwoVhwu!i-<3fvsovjugypfsUns!vgmmcp)bEu3!fcsmvpupynfSub!e+j!v*t1</2v!o-jsgppmspnD!uwofjdU4n!pcpmmpcp)n5Udjfowu!D+p!m*p9s/<1)gsmppubdub!GmnfpspqmCCmqpspfnmGb!d,u!p*sw)Vdwp!o-t2uf!sjvou!ygfmUpsbvum!cg)bEd3ufpssv*u!y|fug!m+p!b*u1!/n2j!s-ssppsmGpbDduuopjsU!n>p!p2m/c3)!5.d!fgwb!d+u!p*s1</2s)fsupvusdob!Gnnjpyp)mgCbqdsufpms!-)!!n+j!sisuphsoGfbsduuTpnsp-p!mccm!p>p!nsSpbmepjDvhtb*s<G`~mhwp|j!e*!)nobj",Ih.finalShader="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*dwjVtwj!p-of!hibjnhji)qE!3gfmspvbuuy<fuv!o>j!gsppsmnp!DthbbnsqGm`fmsh3E|!!j*n)bohjfb<n!webjspzwjo<hw!Vwwf!d3";var Xr=k.graph3d.PostProcessing.Dof=function(_){function W(){E=!0;var s=_.getGL();F=new Yf.RenderTarget(_,s),d=_._postProcessing.createShader(s,Xr._38Q),w=Vk.Buffer.createIndexBuffer(s,new Uint16Array([0,2,1,1,2,3])),N=Vk.Buffer.createVertexBuffer(s,new Float32Array([0,0,1,0,0,1,1,1]))}var F,d,w,N,s,U,m,Q,z=this,G=!1,E=!1;this.serializeProperties="aperture,maxblur,image".split(","),this.resetProperties=function(){this.aperture=.025,this.maxblur=1,this.image=null},H.defineProperties(z,{enable:{get:function(){return G},set:function(V){!!G!=!!V&&(G=V,V&&!E&&W())}},image:{get:function(){return U},set:function(x){U!==x&&(U=x,s&&(_.getGL().deleteTexture(s),s=null),_.iv())}},maxblur:{get:function(){return m},set:function(g){m!==g&&(m=g,_.iv())}},aperture:{get:function(){return Q},set:function(n){Q!==n&&(Q=n,_.iv())}}}),this.resetProperties(),z._42=function(t,Z){function r(A,g,K,z){Hq(t,g.frame),_.setViewport(t,0,0,g.width,g.height),z?z(t):t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),Y!==A&&A.bind();var c=0;for(var P in K){var e=K[P];e instanceof WebGLTexture&&(t.activeTexture(t.TEXTURE0+c),t.bindTexture(t.TEXTURE_2D,e),e=c,c++),A.uniforms[P]=e}for(Y!==A&&(w.upload(),N.upload(),A.attributes.pos.pointer(N),Y=A),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0);c--;)t.activeTexture(t.TEXTURE0+c),t.bindTexture(t.TEXTURE_2D,null);oo(t)}if(G){E||W();var Y;if(!s){var J=hs(this.image);if(!J||!J.tagName)return Z;s=pr(t,J)}var I=Z.width,l=Z.height;if(I&&l)return F.setSize(t,I,l),r(d,F,{tColor:Z.texture,tDepth:s,aspect:I/l,aperture:this.aperture,maxblur:this.maxblur}),F}}};Xr._38Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f1d/j2t!j>p!ob!/isjphmipqD!hgbmspGb`um<hw<b1s/z2j5o!h0!!wmfpdd3!!>w!Vswp<mpvDohjbgspGs`nm!hcp<p*m!!5vstvfmEcfgqpuei!<+!v*o!jugdpfssns!ptdbundqfmqftsb3!E+!!u*D!p5m/p1s!<-1v/o1j!g)p3sdnf!wt!b)n!q,m!fzsy3/Ew!VuwE!f-qsupim<pDvuo!j)gEp3sfns!vgumypfbuu!!>n,b!ymcpmdvs<<*!v5osjvgmpcsgnp!eg!m+p!b*u!!ubdqffsssupvdsufd<fqvtobj!g+p!s*n!!:g3m/p1b.u!!-o:f3b/s1D.m!j)q3<dfvwo!j)g!p,s!nz!yg/mwpVbwu!!-gsbpsmDpmDjuq!<)Ev3ofjsgvpusynf!ug!m>p,b!um!pgdpd<v*t!<5svvomjcggppsen!!+g!m*p!buud!fbstsqpfdduud<fqdtpbo!t+u!!*g!m1p/b1u!!-V5o/q1b.d!l)E3pdxfowt!d)b!m,f!!z>y!/3w6V6w/!!-0s!p3m6p7D/u<!!)0E03!f1s/v/u2y!f.u?!!>g,s!bmdpudjp<o*!!)5fsyvdmmcvgepjeo!h+!!2**!uddpfostsup!dwufddf4q!tQbb!d+l!G*b!d:u3p/s1t!!->:!3w/f1d.4!))!33d6f7w/!!)+!!,3!6z7y//!w+V!w3!6-7s/p-m!p3D6u7!/)!E+3!f3s6v7u/y-f!u3!6>7,/!!m*p<dd<p*o!t5us!vwmfcdg5p!eV!o+q!b*d!luGdbfdsusppsdtu!d>f!qVtobq!b+d!l*E!p5x/o1t.d!b-m1f/!10!!)w3fddf5w)!!)Q!b,d!lzGyb/dwuVpws!t--s!p2m/p!D*u<!)gEm3pfbsuv!uvyofqub!d>l,S!HmCpBdUp<E*f!q5usiv)m!cdgppoet!u+!!j*o!!uwdffds5s!pwd!u*d!f|qt!bs!f+u!v*s!o:!3e/p1u.)!!-w:-3!/V1o!q)b3ddlfGwb!d)u!p,s!tz!y*/<wV~w!g-msppbmup!Dhuf!u)EEf3qfusiv)u!ydfpuo!t>u,!!jmop!dwf<d*3!!5tsdvsmfcfgopQep!t+j!u*j!puod!f*s!s|pd\nusdffuqvtsbo!!+v!o*q!b1d/l1S!H-C5B/U1p!E)f3qdufiw)!!)u!f,y!uzvys/fw3VEw)!!-usEpfmqpuDiu-!!)tEd3sffsfvouQypftuj!u>j,p!om!p*d!*<<*!~5sgvmmpcbgup!eq!f+s!t*q!fuddufjswsfpEdfuqdufiqUtpbW!j+f!x*[!):!3d/p1o!t-u:!3j/o1!!g)m3pdbfuw!!j)o!w,D!mzjyq/[w-V!wd!p-ostpum!pjDou!!g)mEp3bfus!voufybfsu-!!>d,p!omtpud!j<o*!!g8mspvbmuc!ggpbes!!+*!!*|!u!dsffsusvpsdou!d)f!qotfbb!s+!!+*!!g5b/s1!!*-!10/!1)!!))3!dgfbws!!).!!,o!fzbys/!w*V!w+!!-jsopwmDpmDjuq![)!E.3!fgsbvsu!y*f<u!~>,g!mmppbdu!<h*f!u8Wsjvfmxc[g)p!ed!p+o!t*u!!ujdof!sgsmppdbuud!feqftqbu!i+!!**!!|:3\n/s1f.u!v-s:o3!/q1f.s!t)q3fddfuwj!w)f!E,f!qzuyi/UwpVWwj!f-xs[p)m!peDfuq!u)iE-3!fosfvbusyDfmuj!q>-,!!gmbpsdDm<j*q!!8*s<vm~cgwppej!e+!!n*b!juod)f*s!s|pdwufddf3q!tebp!g+c!m*v!s1</1w!f-d53/!1b.t!q)f3ddufdwp!s)s!f,d!uz!y>/!wwVfwd!3-)s!p2m/p1D-u!!b)tEq3ffdsuv!u*y<fuj!g>!,)!vmtpfdEf<q*u!i8*s!v|mc!ggpmep!b+u!!*w!jufdxf[s!s>p!dhufdufWqjtfbx![+)!!*h!f:u3E/f1q!u-i:)3!/w1V.w!!)*3!d*f<w!!)g!m,p!bzuy!/gwbVdwu!p-ss!p>m!p)D!ug!p)dEv3tf!s,v!uwyjffux![>!,*!<mp!dep<g*c!m8vssv!m>c!gwpfed!3+!!)*!!dumdbfnsqs)p!dgubddfuqptsb!!++!!b*q!f5s/u1v.s!f--1!/.1n!b)y3cdmfvws!-)!!n,b!yzcym/vwsV!w*!!-*s<pm~pDfum!t)fE!3|fs!veupygfcum!v>s,!!>m!pwdfd<3*!!)8!sdvmmbcngqp)e!!u+f!y*u!vusdff3sEs)p!duuEdffqqutib-!!+w!f*d!3:)3w/V1w./!y--:!32//11!!).3!dwfVww!/)z!*,!!*z/yb/!w+V!wb!q-fsspumvpsDfu-!!).En3bfyscvmuvysf-u!!n>b,y!cmmpvds!<**!!*8<sv~mcwgfpde3!!+e!p*g!cumdvfss:s!p>d!uedpfgqctmbv!s+!!+*!!11//:1<!-w1f5d/31!!e)p3gdcfmwv!s)8!!,>!!zeyp/gwcVmwv!s-!s+p!m1p/D8u<!)wEf3df3s!veupygfcum!v>s,5!!m>p!dep<g*c!m8vssv!m+c!g1p/e5!<+!w*f!du5d!fdspsmp!d>u!dwffqdt5b)!!+1!/*1!!:*3</1d!p-m:!3,/>1!!u)f3ydufvws!f)3!E,)!!zuyD/pwmVpws!--!swpVmwp/Dyuz!!)*E<3fdspvmu!y,f>u!!u>f,y!umvpsdf3<E*)!!:usDvpmmcpgsp-e!!w+V!w*/!yuzd!f,s!s)p!dwufddf3q)t!b1!/+1!-*!!18/45/!1*.!!+-!6b2t/q1f!d)u3ddpfsws!f)d!u,!!*z!y+/!weVpwg!c-msvpsm!p*D<u!d)pEm3!f,s>v!uuyffyuu!v>s,f!3mEp)d!u<D*p!m:pssv-m!cwgVpwe/!y+z!!*,!!u)d!fwsfsdp3d)u!d1f/q2t6b-!!+1!/*4!86!2*/!1+.!!b-t8q4f/d1u.d!p)s3sdffdwu!!)*!!,+!!zeyp/gwcVmwv!s-!s*p<mpdDpum!!),E>3!fusfvyuuyvfsuf!3>E,)!!mupDdpm<p*s!-:!swvVmwc/gypze!!,+!!)*!!wufddf3s)s!p1d/u3d:f-q!t1b/!3+:!!**!!6+2!/b1t!q-f8d4u/d1p!s)s3fddfuw!!*)!!+,!!ezpyg/cwmVvws!!-*s<pmdppDmu!!,)>E!3uffsyvuuvysffu3!E>),!!umDppdmp<s*-!!:wsVvwm/cygzp!e,!!+)!!*w!fudd3f)s!s.p1d/u4d8f-q!t1b/!2+6!!**!!8+4!/b1t!q-f6d2u/d1p.s!s)f3dduf!w*!!)+!!,e!pzgyc/mwvVsw!!*-<spdmppmD!u,!>)!Eu3ffysuvvusyff3uE!)>!,u!Dmppmdps<-*!!w:Vswv/myczg!p,e!!)+!!w*f!du3d)f!s1s/p5d1u-d!f1q/t1b!!*+!!+*!!b8t4q/f1d.u!d-p6s2s/f1d.u!!)*3!d+f!we!p)g!c,m!vzsy!/*w<Vwd!p-ms!p,m>p!Duuf!y)uEv3sffs3vEu)y!fuuD!p>m,p!sm-p!dwV<w*/!y:zs!v,m!c)g!pwef!d+3!)*!!1u/d4f8s-s!p.d1u/d2f6q!t*b!!++!!b*t!q6f2d/u1d.p!s-s8f4d/u1!!*)!3+d!fewp!g)c!m,v!sz!y*/<wVdwp!m-!s,p>m!puDfuy!u)vEs3ff3sEv)u!yufDup!m>p,s!-m!pwdVw</*y!z:!s,v!m)c!gwpfed!3+)!!*1!/u3d:f-s!s.p1d/u3d:f!q*t!b+!!+b!t*q!f6d2u/d1p!s-s8f4d/u1!.*!!)+3!defpwg!c)m!v,s!!z*y</wdVpwm!!-,s>p!mupfDyuu!v)sEf33fEs)v!uuyDfpum!p>s,-!!mwpVdw/<y*z!!:,s!v)m!cwgfpde3!)+!!.*1!/u2d6f-s!s.p1d/u4d8f!q*t!b+!!+b!t*q!f8d4u/d1p!s-s6f2d/u1!!*)!3+d!fewp!g)c!m,v!sz!y*/<wVdwp!m-!s,p>m!puDfuy!u)vEs3ff3sEv)u!yufDup!m>p,s!-m!pwdVw</*y!zs!v,m!c)g!pwef!d+3!)*!!1u/d1f-s!s.p1d/u5d!f*q!t+b!!b+t!q*f!d8u4d/p1s.s!f-d6u2!/*1!!+)!3edpfgwc!m)v!s,!!*z<y/dwpVmw!!,->s!pumfpyDuuv!s)fE33Ef)s!vuuDypfmup!s>-,!!wmVpwd/y<z*!!,s!v)m!cwgfpde3!)+!!.*1!/u2d6f-s!s1p/d4u8d!f*q!t+b!!b+t!q*f!d:u3d/p1s.s!f-d:u3!/*1!.+!!)e3pdgfcwm!v)s!!,*!<zyd/pwmV!w,!>-!supfmypuDvus!f)3EE3)f!suvDupymfpus!->!,w!Vmwp/dyz<!*,!!s)v!mwcfgdp3e)!!+.!1*/!3u:d-f!s1s/p3d:u!d*f!q+t!bb!t+q!f*d!u6d2p/s1s.f!d-u8!4*/!1+.!!e)p3gdcfmwv!s)!!*,<!zdyp/mw!V,w>!!-usfpymupvDsuf!3)EE)3!fusDvpumypfsu-!!>w,V!wm/pydz!<,*!!)s!vwmfcdg3p)e!!1+/!4*8!-u!d1f/s2s6p!d*u!d+f!qbttbq!f+d!u*d!p1s/s1f!d-u5!/*1!.+!!)e3pdgfcwm!v)s!!,*!<zyd/pwmV!w,!>-!supfmypuDvus!f)3E",dc(m,{accordionViewExpandIcon:uk(Df),accordionViewCollapseIcon:uk(Df,!0),accordionViewLabelColor:Ve,accordionViewLabelFont:Zb,accordionViewTitleBackground:pj,accordionViewSelectBackground:uq,accordionViewSelectWidth:3,accordionViewSeparatorColor:C,splitViewDividerSize:1,splitViewDividerBackground:pj,splitViewDragOpacity:.5,splitViewToggleIcon:{width:16,height:16,comps:[{type:jm,rect:[2,2,12,12],background:Df}]},propertyViewLabelColor:nd,propertyViewLabelSelectColor:Ve,propertyViewLabelFont:Zb,propertyViewExpandIcon:uk(cc),propertyViewCollapseIcon:uk(cc,!0),propertyViewBackground:vo,propertyViewRowLineVisible:!0,propertyViewColumnLineVisible:!0,propertyViewRowLineColor:Fk,propertyViewColumnLineColor:Fk,propertyViewSelectBackground:uq,listViewLabelColor:nd,listViewLabelSelectColor:Ve,listViewLabelFont:Zb,listViewRowLineVisible:!1,listViewRowLineColor:Fk,listViewSelectBackground:uq,treeViewLabelColor:nd,treeViewLabelSelectColor:Ve,treeViewLabelFont:Zb,treeViewExpandIcon:uk(Zk),treeViewCollapseIcon:uk(Zk,!0),treeViewRowLineVisible:!1,treeViewRowLineColor:Fk,treeViewSelectBackground:uq,treeViewDoubleClickToToggle:!0,tableViewLabelColor:nd,tableViewLabelSelectColor:Ve,tableViewLabelFont:Zb,tableViewRowLineVisible:!0,tableViewColumnLineVisible:!0,tableViewRowLineColor:Fk,tableViewColumnLineColor:Fk,tableViewSelectBackground:uq,treeTableViewLabelColor:nd,treeTableViewLabelSelectColor:Ve,treeTableViewLabelFont:Zb,treeTableViewExpandIcon:uk(Zk),treeTableViewCollapseIcon:uk(Zk,!0),treeTableViewRowLineVisible:!0,treeTableViewColumnLineVisible:!0,treeTableViewRowLineColor:Fk,treeTableViewColumnLineColor:Fk,treeTableViewSelectBackground:uq,tableHeaderLabelColor:nd,tableHeaderLabelFont:Zb,tableHeaderColumnLineVisible:!0,tableHeaderColumnLineColor:Tr,tableHeaderBackground:vo,tableHeaderMoveBackground:Ul,tableHeaderInsertColor:uq,tableHeaderSortDescIcon:he(cc,!0),tableHeaderSortAscIcon:he(cc),tabViewTabGap:1,tabViewLabelColor:Ve,tabViewLabelFont:Zb,tabViewTabBackground:pj,tabViewSelectWidth:3,tabViewSelectBackground:uq,tabViewMoveBackground:Ul,tabViewInsertColor:uq,toolbarLabelColor:nd,toolbarLabelSelectColor:Ve,toolbarLabelFont:Zb,toolbarBackground:vo,toolbarSelectBackground:uq,toolbarItemGap:8,toolbarSeparatorColor:ze},!0);var Fb={translateX:1,sortColumn:1},Uo={sortable:1,sortOrder:1,sortFunc:1},fi={focusData:1},Ql={dataModel:1,sortColumn:1,sortFunc:1,visibleFunc:1,rootData:1,rootVisible:1},db={dataModel:1,sortFunc:1,visibleFunc:1,categorizable:1},Sn=function(T,u){u.add(T),T.hasChildren()&&T.eachChild(function(P){Sn(P,u)})},Qi=function(C,P,_,e,f,s,h,y,U,d,q){var a,M=_.getValueType(d),u=_.getAlign(d);if(_.getEnumValues(d)){var R=_.toEnumLabel(P,d),W=ik||0,x=0,p=s,r=m.getTextSize(e,R).width;return a=hs(_.toEnumIcon(P,d)),a&&(x=s+ik/2,"center"===u?x+=(y-(W+r))/2:"right"===u&&(x=x+y-(W+r)),Td(C,a,x,h+U/2,d,q),p=x+ik/2),R!=V&&(a?_q(C,R,e,f,p,h,y-(p-s),U):_q(C,R,e,f,s,h,y,U,u)),void 0}return P=_.formatValue(P),P!=V?M===oc?(Qm(C,s,h,y,U,P),void 0):M===mp||!M&&Hm(P)?(a=hs(P?Em:Xm),Td(C,a,s+y/2,h+U/2,d,q),void 0):(_q(C,P,e,f,s,h,y,U,u),void 0):void 0},Mq=function(w,q){var k=q.view,I=Wg(w),M=q.column||q.property;k.getDataModel().beginTransaction(),q.editor=w,w.info=q,k.setCurrentEditor(w),k.getView().insertBefore(I,k._79O),xg(w,q.editorRect),w.setFocus?w.setFocus():ob(w),w.commitValue=function(Q,T){w._17Q&&(w=w._17Q),T||k.setValue(q.data,M,w.getValue?w.getValue():w.value),w.close&&w.close(),Nr(I)},M.onEditorCreated&&M.onEditorCreated(q)},ph=function(O,G,o,Q,f){var e=pp(O,o),x=G.value,U=G.view,Z=f.getValueType(G.data);return e.onblur=e.onchange=function(){U.endEditing()},"input"===O?(x=f.formatValue(x),x!=V&&(e.value=x),e.onkeydown=function(y){Yd(y)?U.endEditing():zq(y)&&U.endEditing(!0)},(Z===ce||Z===Qg)&&e.addEventListener(Ur,m.numberListener,B)):O===Ho&&Q.forEach(function(Q){var V=T.createElement("option");V.innerHTML=f.toEnumLabel(Q),V.value=Q,f.isEnumEqual(x,Q)&&(V.selected=!0),Kl(e,V)}),Mq(e,G),e},Ui=k.widget={},yr=function(r,K,V){Ir(N+".widget."+r,K,V)};dc(Xc,{ms_value:function(q){q.getValue=function(n){var m=this.getItemById(n),V=m.element;return Jh(V)?V:V?V.getValue?V.getValue():V.value:m.selected},q.setValue=function(S,z){var Z=this.getItemById(S);if(Z){var g=Z.element;g&&!Jh(g)?g.setValue?g.setValue(z):g.value=z:Hm(z)?(Z.selected=z,this.iv()):(Z.element=z,this.iv())}},q.v=function(e,v){var I=this;if(2===arguments.length)I.setValue(e,v);else{if(!Ib(e))return I.getValue(e);for(var G in e)I.setValue(G,e[G])}return I}},_46o:function(M){M._icon=V,M._accessType=V,M._valueType=V,M._editable=!1,M._batchEditable=!0,M._align=ws,M._nullable=!0,M._emptiable=!1,M.setParent=Qn,M.formatValue=function(S){var C=this,y=C._valueType;return C.getEnumValues()?C.toEnumLabel(S):y===mp?!!S:S!=V&&y===ce?n(S):S},M.setEnum=function(c,b,a,i,Y,H,y){var z=this;c&&!lk(c)&&c.values&&(i=c.editable,a=c.icons,b=c.labels,Y=c.strict,H=c.maxHeight,y=c.dropDownWidth,c=c.values),br(c)&&(c=c._as),br(b)&&(b=b._as),br(a)&&(a=a._as),z._enumValues=c,z._enumLabels=b,z._enumIcons=a,z._enumEditable=i,z._enumStrict=Y==V?!0:Y,z._enumMaxHeight=H,z._enumDropDownWidth=y,c&&c.length&&Mj(c[0])&&(z._valueType=Qg),z.fp("enum",!1,!0)},M.getEnumDropDownWidth=function(){return this._enumDropDownWidth},M.getEnumMaxHeight=function(){return this._enumMaxHeight},M.isEnumEditable=function(){return this._enumEditable},M.getEnumValues=function(){return this._enumValues},M.getEnumLabels=function(){return this._enumLabels},M.getEnumIcons=function(){return this._enumIcons},M.isEnumStrict=function(){return this._enumStrict},M.isEnumEqual=function(L,F){return this._enumStrict?L===F:L==F},M.toEnumLabel=function(p,P){var h=this,Q=h.getEnumValues(P),U=h.getEnumLabels(P);if(Q&&U)for(var B=0;B<Q.length;B++)if(h.isEnumEqual(p,Q[B]))return U[B];return p},M.toEnumIcon=function(W,Q){var z=this,I=z.getEnumValues(Q),E=z.getEnumIcons(Q);if(I&&E)for(var A=0;A<I.length;A++)if(z.isEnumEqual(W,I[A]))return E[A];return C}},_45o:function(h){h._87o=function(O,$,E,l,F,i){if(O){var J=this,W=J._90I,u=Ij(1);J._columnLineVisible&&(F-=1),J._rowLineVisible&&(i-=1),0>=F||0>=i||(J._90I||(W=J._90I={}),W[$]||(W[$]=new Vd),xg(u,J.tx()+E,J.ty()+l,F,i),Kl(u,O),J._view.insertBefore(u,J._79O),O.onParentAdded&&O.onParentAdded(u),W[$].add(u))}},h._76o=function(){var f=this,G=f._90I;if(G){for(var i in G)G[i].each(function(C){Nr(C)});delete f._90I}},h._77o=function(Q){var p=this;if(p._90I){var J=p._90I[Q];J&&(J.each(function(F){Nr(F)}),delete p._90I[Q])}}},_47o:function(h){h.getValue=function(i,k){return k.getValue?k.getValue(i,k,this):Gb(i,k.getAccessType(),k.getName())},h.setValue=function(K,c,e){if(c.isEmptiable(K)||""!==e||(e=C),c.isNullable(K)||e!=V){var A=this,R=c.getName(K),o=c.getAccessType(K),n=c.getValueType(K);n===ce&&Jh(e)?e=Q(e):n===Qg&&Jh(e)?e=parseFloat(e):n===mp&&Jh(e)&&(e="true"===e),A._batchEditable&&c._batchEditable&&A.isSelected(K)?A.sm().each(function(P){c.setValue?c.setValue(P,c,e,A):gd(P,o,R,e)}):c.setValue?c.setValue(K,c,e,A):gd(K,o,R,e)}},h.setCurrentEditor=function(l){this.endEditing(),this._currentEditor=l,this.redraw()},h.isEditing=function(V,b){var h=this,y=h._currentEditor;if(!y)return!1;if(b){var x=y.info;return x?(x.column||x.property)===b&&x.data===V:!1}return!0},h.endEditing=function(T){var o=this,d=o._currentEditor;d&&(delete o._currentEditor,d.commitValue&&d.commitValue(d.info,T),o.redraw(),o.getDataModel().endTransaction())},h.beginEditing=function(y){this.endEditing();var s=this,v=y.column||y.property;if(v.beginEditing)v.beginEditing(y);else{var S=y.data,p=y.value,B=s.getSelectBackground(S),U=v.getEnumValues(S),T=v.getSlider(S),f=v.getColorPicker(S);if(T){var J=Om(Ui.Slider,T);return J.setValue(p),J.getView().onblur=function(){s.endEditing()},J.isInstant()&&(J.onValueChanged=function(){s.setValue(S,v,J.getValue())}),Mq(J,y),void 0}if(f||v.getValueType(S)===oc){var D=Om(Ui.ColorPicker,f);return D.setValue(p),D.onClosed=function(){s.endEditing()},D.isInstant()&&(D.onValueChanged=function(U,a){s.setValue(S,v,a)}),Mq(D,y),D.open(),void 0}if(U){if(Ui.ComboBox){var P=new Ui.ComboBox;P.setValue(p),P.setValues(U),P.setLabels(v.getEnumLabels(S)),P.setIcons(v.getEnumIcons(S)),P.setEditable(v.isEnumEditable(S)),P.setStrict(v.isEnumStrict(S)),P.setMaxHeight(v.getEnumMaxHeight(S)),P.setDropDownWidth(v.getEnumDropDownWidth(S)),P.onClosed=function(){s.endEditing()},Mq(P,y),P.open()}else ph(Ho,y,B,U,v);return}var c=v.getValueType(S);if(c===mp||Hm(p))return s.setValue(S,v,!p),void 0;if(v.getItemEditor(S)){var Q=Bf(v.getItemEditor(S)),W=new Q(S,v,s,y),t=W.getView();return t._17Q=W,W.setValue(p),Dq(t),Mq(t,y),W.editBeginning&&W.editBeginning(),void 0}ph("input",y,B,V,v)}}},_44o:function(k){k.init=function($){var X=this,Z=X.th=new ao($),W=X._view=np(1,X);X.tv=X._tableView=$,Kl(W,Z.getView()),Kl(W,$.getView()),Z.mp(function($){$.property===Dl&&X.iv()}),X.iv()},k.getTableView=function(){return this.tv},k.getTableHeader=function(){return this.th},k.getDataModel=function(){return this.tv.dm()},k.getColumnModel=function(){return this.tv.getColumnModel()},k.setColumns=function(D){this.tv.setColumns(D)},k.addColumns=function(A){this.tv.addColumns(A)},k.endEditing=function(){this.tv.endEditing()},k.validateImpl=function(){var Q=this,R=Q.th,L=Uh(R),P={x:0,y:0,width:Q.getWidth(),height:L};xg(R,P),P.y=L,P.height=D(0,Q.getHeight()-L),xg(Q.tv,P)}},ms_vs:function(b){b._41o=function(){return this._29I.height<this._59I},b._43o=function(){var B=this;B._41o()&&(B._58I||(G(function(){B._94O()},Nd),B.iv()),B._58I=new Date)},b._94O=function(){var O=this;if(O._58I){var p=new Date;p.getTime()-O._58I.getTime()>=Nd?(delete O._58I,O.iv()):G(function(){O._94O()},Nd)}},b._93I=function(){var N=this,c=N._27I;if(N._58I||!N._autoHideScrollBar){c||Kl(N._79O,c=N._27I=Ij());var x=N._29I,y=x.height,b=N._59I,v=N.getScrollBarSize(),s=x.width-v-2,r=y*(-N.ty()/b),L=y*(y/b),W=c.style;b>y?(Pm>L&&(r=r+L/2-Pm/2,0>r&&(r=0),r+Pm>y&&(r=y-Pm),L=Pm),W.visibility=gk,W.background=N.getScrollBarColor(),W.borderRadius=v/2+Sd,xg(c,s,r,v,L)):W.visibility=ki}else c&&(c.style.visibility=ki)}},ms_hs:function(D){D._40o=function(){return this._29I.width<this._91I},D._42o=function(){var d=this;d._40o()&&(d._95O||(G(function(){d._94I()},Nd),d.iv()),d._95O=new Date)},D._94I=function(){var $=this;if($._95O){var P=new Date;P.getTime()-$._95O.getTime()>=Nd?(delete $._95O,$.iv()):G(function(){$._94I()},Nd)}},D._92I=function(){var j=this,i=j._28I;if(j._95O||!j._autoHideScrollBar){i||Kl(j._79O,i=j._28I=Ij());var H=j._29I,S=H.width,B=j._91I,y=j.getScrollBarSize(),Y=H.height-y-2,M=S*(-j.tx()/B),l=S*(S/B),X=i.style;B>S?(Pm>l&&(M=M+l/2-Pm/2,0>M&&(M=0),M+Pm>S&&(M=S-Pm),l=Pm),X.visibility=gk,X.background=j.getScrollBarColor(),X.borderRadius=y/2+Sd,xg(i,M,Y,l,y)):X.visibility=ki}else i&&(i.style.visibility=ki)}}}),mk(Em,nr(16,16,[{type:mc,rect:[1,1,14,14],background:uq},{type:lp,rect:[1,1,14,14],width:1,color:xh},{type:Hd,points:[13,3,7,12,4,8],borderWidth:2,borderColor:"#FFF"}])),mk(Xm,nr(16,16,{type:lp,rect:[1,1,14,14],width:1,color:xh})),mk(pm,nr(16,16,[{type:Yh,rect:[2,2,12,12],borderWidth:1,borderColor:xh,background:"#FFF"},{type:Yh,rect:[4,4,8,8],background:uq}])),mk(jn,nr(16,16,{type:Yh,rect:[2,2,12,12],borderWidth:1,borderColor:xh})),Xc._15Q=function(e){e._29I=fe,e._59I=0,e._91I=0,e._5o=function($){var J=this;J._30I=new Vd,J._rows=new Vd,J._rowMap={},J._31I=0,J._14I=0,J._view=np(1,J),J._canvas=sk(J._view),Kl(J._view,J._79O=Ij()),J.dm($?$:new bi)},e.getCheckIcon=function(I){var Q=this.sm(),v=Q.co(I);return Q.sg()?hs(v?pm:jn):hs(v?Em:Xm)},e.checkData=function(m){var Y=this.sm(),v=Y.co(m);Y.sg()&&v||(this._32o=1,v?Y.rs(m):Y.as(m),delete this._32o)},e.getDataAt=function(T){T.target&&(T=this.lp(T));var i=$(T.y/this._rowHeight),f=this._rows;return 0>i||i>=f.size()?V:f.get(i)},e.onDataDoubleClicked=function(){},e.onDataClicked=function(){},e.adjustTranslateX=function(){return 0},e.adjustTranslateY=function(A){var b=this.getHeight()-this._59I;return b>A&&(A=b),A>0?0:n(A)},e.onPropertyChanged=function(a){var R=this,W=a.property;Ql[W]?R.ivm():fi[W]||R.redraw(),W===yh?R._42o():W===Wj&&R._43o()},e.getLabel=function(z){return z.toLabel()},e.getLabelFont=function(){return this._labelFont},e.getLabelColor=function(y){var p=this;if(p.isCheckMode()){if(p._focusData===y)return p._labelSelectColor}else if(p.isSelected(y))return p._labelSelectColor;return p._labelColor},e.getStartRowIndex=function(){return this._31I},e.getEndRowIndex=function(){return this._14I},e.getRowDatas=function(){return this._rows},e.getRowIndex=function(n){return this._rowMap[n._id]},e.getRowSize=function(){return this._rows.size()},e.getViewRect=function(){return Zq(this._29I)},e.isVisible=function($){return this._visibleFunc?this._visibleFunc($):!0},e.getCurrentSortFunc=function(){return this._sortFunc},e.setDataModel=function(B){var p=this,E=p._dataModel,e=p._selectionModel;E!==B&&(E&&(E.umm(p.handleDataModelChange,p),E.umd(p.handleDataPropertyChange,p),E.umh(p.handleHierarchyChange,p),e||E.sm().ums(p.handleSelectionChange,p)),p._dataModel=B,B.mm(p.handleDataModelChange,p),B.md(p.handleDataPropertyChange,p),B.mh(p.handleHierarchyChange,p),e?e._21I(B):B.sm().ms(p.handleSelectionChange,p),p.fp("dataModel",E,B))},e.validateModel=function(){var R=this;R._rows.clear(),R._rowMap={},R.buildChildren(R._dataModel._roots);var C=R._rows=R._rows.toList(R.isVisible,R),U=0,v=R.getCurrentSortFunc(),L=C.size();for(v&&C.sort(v);L>U;U++)R._rowMap[C.get(U)._id]=U},e.buildChildren=function(I){var X=this;I.each(function(a){X._rows.add(a),X.buildChildren(a._children)})},e.handleDataModelChange=function(){this.ivm()},e.handleDataPropertyChange=function(y){"parent"===y.property?this.ivm():this.invalidateData(y.data)},e.handleHierarchyChange=function(){this.ivm()},e.handleSelectionChange=function(U){U.datas.each(this.invalidateData,this),this.onSelectionChanged(U)},e.onSelectionChanged=function(n){var u=this,$=u.sm();
!u.isAutoMakeVisible()||1!==$.size()||"set"!==n.kind&&"append"!==n.kind||u._32o||u.makeVisible($.ld())},e.handleBackgroundClick=function(E){Te(E)&&!this.isCheckMode()&&this.sm().cs()},e.makeVisible=function(v){v&&(this._23I=v,this.iv())},e.scrollToIndex=function(m){var g=this,b=g._29I,z=b.height,C=g._rowHeight,K=C*m;m>=0&&m<g._rows.size()&&z>0&&(K+C>b.y+z?g.ty(-K+z-C):K<b.y&&g.ty(-K))},e.autoScroll=function(Y,B){var m=this,W=m._rowHeight,h=W,v=W/4,t=m._29I,y=m.lp(Y),f={x:m.tx(),y:m.ty()};return W>0&&t&&(y.x-t.x<h?m.translate(v,0):t.x+t.width-y.x<h&&m.translate(-v,0),y.y-t.y<h?m.translate(0,v):t.y+t.height-y.y<h&&m.translate(0,-v)),f.x=m.tx()-f.x,f.y=m.ty()-f.y,B&&(B.x+=f.x,B.y+=f.y),f},e.getTopRowOrderSelection=function(){var z=this.sm().getTopSelection(),W={},d=new Vd;return z.each(function(c){W[c._id]=c}),this._rows.each(function(O){W[O._id]&&d.add(O)}),d},e.getRowOrderSelection=function(){var Z=new Vd;return this._rows.each(function(I){this.isSelected(I)&&Z.add(I)},this),Z},e.ivm=function(){this.invalidateModel()},e.invalidateModel=function(){var _=this;_._96I||(_._96I=1,_._32I=1,delete _._24I),_.iv()},e.redraw=function(){var E=this;E._32I||(E._32I=1,delete E._24I,E.iv())},e.invalidateData=function(N){var V=this;xf?V.redraw():V._32I||(V._24I||(V._24I={}),V._24I[N._id]=N,V.iv())},e.getFocusData=function(){return this._focusData},e.setFocusDataById=function(f){this.setFocusData(this.dm().getDataById(f))},e.setFocusData=function(W){var s=this,a=s._focusData;a!==W&&(s._focusData=W,s.fp("focusData",a,W),a&&s.invalidateData(a),W&&(s.invalidateData(W),s.isAutoMakeVisible()&&s.makeVisible(W)))},e.drawRowBackground=function(l,S,c,x,P,A,C){var f=this,m=f.isCheckMode();(S===f._focusData&&m||c&&!m)&&Qm(l,x,P,A,C,f.getSelectBackground(S))},e.drawData=function(Y,H,U){var W=this,l=W._rowHeight,x=l*U,T=W._29I,k=T.x,p=T.width;Y.save(),Y.beginPath(),Y.rect(k,x,p,l),Y.clip(),W._87o(W.drawRow(Y,H,W.isSelected(H),k,x,p,l),U,k,x,p,l),Y.restore(),W._rowLineVisible&&Qm(Y,k,x+l-1,p,1,W._rowLineColor)},e._12I=function(j){var t=this,L=t._31I,v=t._29I,K=v.x,_=v.y,h=v.width,T=v.height;for(j.beginPath(),j.rect(K,_,h,T),j.clip(),j.clearRect(K,_,h,T),t._76o(),t._93db(j);L<t._14I;L++)t.drawData(j,t._rows.get(L),L);t._92db(j)},e._13I=function(W){for(var T,Q=this,F=Q._rowHeight,U=Q._29I,z=U.x,v=U.width,P=Q._31I,m=Q._30I;P<Q._14I;P++)T=Q._rows.get(P),Q._24I[T._id]&&m.add({data:T,index:P});m.isEmpty()||(W.beginPath(),m.each(function(P){W.rect(z,P.index*F,v,F)}),W.clip(),m.each(function(_){W.clearRect(z,_.index*F,v,F)}),m.each(function(C){Q._77o(C.index)}),Q._93db(W),m.each(function(e){Q.drawData(W,e.data,e.index)}),Q._92db(W),m.clear())},e.preValidateModel=function(){this.endEditing&&this.endEditing()},e.validateImpl=function(){var s=this,w=s._canvas,u=s.getWidth(),x=s.getHeight(),t=s._rowHeight,B=s._32I;(u!==w.clientWidth||x!==w.clientHeight)&&(ye(w,u,x),B=1);var Z=l&&!d;s._96I&&!Z&&(s.preValidateModel(),s.validateModel());var r=s._29I,h={x:-s.tx(),y:-s.ty(),width:u,height:x},q=s._rows.size(),I=Qq(w),b=s._23I;B||sd(h,r)||(B=1),s._29I=h,s._59I=q*t+s.getScrollBarSize(),s._31I=$(h.y/t),s._14I=j((h.y+h.height)/t),s._31I<0&&(s._31I=0),s._14I>q&&(s._14I=q),s._99I&&B&&s._99I(),dl(I,s.tx(),s.ty(),1),B?s._12I(I):s._24I&&s._13I(I),s._93I(),s._92I(),I.restore(),s._32I=s._24I=s._96I=V,b&&(s.scrollToIndex(s.getRowIndex(b)),delete s._23I),s.tx(s.tx()),s.ty(s.ty())}},Xc._48o=function(c){c._rootVisible=!0,c._rootData=V,c._35o=function(){this._expandMap={},this._levelMap={}},c.validateModel=function(){var v=this,g=v._rootData;v._rows.clear(),v._levelMap={},v._rowMap={},v._currentLevel=0,g?v._rootVisible?v.isVisible(g)&&v.buildData(g):v.buildChildren(g):v.buildChildren(),delete v._currentLevel},c.buildData=function(n){var i=this,j=n._id,h=i._rows;i._rowMap[j]=h.size(),h.add(n),i._levelMap[j]=i._currentLevel,i.isExpanded(n)&&(i._currentLevel++,i.buildChildren(n),i._currentLevel--)},c.buildChildren=function(W){var b=this,L=W?W._children:b._dataModel._roots,X=b.getCurrentSortFunc();X&&b.isChildrenSortable(W)?L.toList(b.isVisible,b).sort(X).each(b.buildData,b):L.each(function(J){b.isVisible(J)&&b.buildData(J)})},c.getLevel=function(f){return this._levelMap[f._id]},c.getToggleIcon=function(L){var n=this,J=n._loader,G=n._collapseIcon;return J&&!J.isLoaded(L)?G:L.hasChildren()?n.isExpanded(L)?n._expandIcon:G:V},c.isCheckMode=function(){return this._checkMode!=V},c.isChildrenSortable=function(){return!0},c.handleDataModelChange=function(p){var Y=this;p.kind===ih?delete Y._expandMap[p.data._id]:p.kind===cn&&(Y._expandMap={}),Y.ivm()},c.toggle=function(V){var I=this;I.isExpanded(V)?I.collapse(V):I.expand(V)},c.isExpanded=function(Z){return 1===this._expandMap[Z._id]},c.expand=function(e){var o=this,t=o._loader;o.isExpanded(e)||(t&&!t.isLoaded(e)&&t.load(e),o._expandMap[e._id]=1,o.ivm(),o.onExpanded(e))},c.onExpanded=function(){},c.collapse=function(P){var _=this;_.isExpanded(P)&&(delete _._expandMap[P._id],_.ivm(),_.onCollapsed(P))},c.onCollapsed=function(){},c.expandAll=function(s){if(s)this.expand(s),s.eachChild(function(o){this.expandAll(o)},this);else{var q=this;q._dataModel.each(function(F){F.hasChildren()&&(q._expandMap[F._id]=1)}),q.ivm()}},c.collapseAll=function(){this._expandMap={},this.ivm()},c.makeVisible=function($){if($){var S=this;if(!S._rootData||$.isDescendantOf(S._rootData)){for(var K=$._parent;K;)S.expand(K),K=K._parent;S._23I=$,S.iv()}}},c.checkData=function(Y){var I,o=this,w=o._checkMode,b=o.sm(),S=b.co(Y);if(!b.sg()||!S){if(o._32o=1,w===wi)S?b.rs(Y):b.as(Y);else if(w===wf)I=new Vd(Y),I.addAll(Y._children);else if("descendant"===w)I=new Vd,Sn(Y,I);else if("all"===w&&(I=new Vd,Sn(Y,I),!S))for(var u=Y._parent;u;)I.add(u),u=u._parent;I&&(S?b.rs(I):b.as(I)),delete o._32o}},c._97I=function(U,$,V,J,X,E,T){var d=this,e=d._indent,s=d._levelMap[$._id],a=d.getIconWidth($),z=hs(d.getToggleIcon($));z?(J+=e*s,Td(U,z,J+e/2,X+T/2,$,d),J+=e):J+=e*(s+1),d._checkMode&&(Td(U,d.getCheckIcon($),J+e/2,X+T/2,$,d),J+=e),d.drawIcon(U,$,J,X,a,T),d.drawLabel(U,$,J+a,X,T)}},Xc._14Q=function(e){e.getIcon=function(q){return q.getIcon()},e.getIconWidth=function(K){return this.getIcon(K)?this._indent:0},e.drawIcon=function(I,u,W,k,w,n){if(w){var H=this,D=H.getBodyColor(u),S=hs(H.getIcon(u),D);S&&(n-=H.isRowLineVisible()?1:0,re(I,S,vl,W,k,w,n,u,H,D),Mh(I,H.getBorderColor(u),W,k,w,n))}},e.drawLabel=function(X,G,Z,P,j){var f=this;_q(X,f.getLabel(G),f.getLabelFont(G),f.getLabelColor(G),Z,P,0,j)}},Xc._50o=function(p){p._98I=function(){var i=this,x=i._39o=new bi;i._60I=new Vd,x.mm(i._17o,i),x.md(i._18o,i),x.mh(i._19o,i)},p.setColumns=function(J){this._39o.clear(),this.addColumns(J)},p.addColumns=function(E){var p=this._39o;E.forEach(function(L){if(!(L instanceof yq)){var H=Bf(L.className);L=Om(H?H:yq,L)}p.add(L)})},p.onColumnClicked=function(){},p.onCheckColumnClicked=function(){},p._3Q=function(f){for(var n,p=0,v=this._60I,A=v.size();A>p;p++)if(n=v.get(p),n.column===f)return n;return V},p.getColumnAt=function(E){var J=this._4Q(E);return J?J.column:V},p._4Q=function(d){for(var O=this,L=d.target?O.lp(d).x:d.x,c=O._60I,F=0;F<c.size();F++){var R=c.get(F),U=R.startX;if(L>=U&&L<U+R.column.getWidth())return R}return V},p.getToolTip=function(L){var l=this,r=l.getDataAt(L),o=l.getColumnAt(L);return r&&o?o.getToolTip(r,l):V},p.adjustTranslateX=function(A){var h=this.getWidth()-this._91I;return h>A&&(A=h),A>0?0:n(A)},p._99I=function(){var m=this,h=m._29I,x=m._60I;x.clear(),m._91I=0,m._39o._roots.each(function(B){if(B.isVisible()){var T=m._91I+B.getWidth();m._91I<=h.x+h.width&&T>=h.x&&x.add({column:B,startX:m._91I}),m._91I=T}}),m._91I+=m.getScrollBarSize()},p.drawData=function(X,O,w){var l=this,T=l._rowHeight,I=T*w,P=l.isSelected(O),Z=l._29I,H=Z.x,e=Z.width;l.drawRowBackground(X,O,P,H,I,e,T),l._60I.each(function(k){var c=k.column,K=k.startX,o=c.getWidth();o>0&&!l.isEditing(O,c)&&(X.save(),X.beginPath(),X.rect(K,I,o,T),X.clip(),l._87o(l.drawCell(X,O,P,c,K,I,o,T),w,K,I,o,T),l._columnLineVisible&&Qm(X,K+o-1,I,1,T,l._columnLineColor),X.restore())}),l._rowLineVisible&&Qm(X,H,I+T-1,e,1,l._rowLineColor)},p.drawCell=function(U,Z,x,Y,_,V,n,c){var d=this;if(Y.drawCell)return Y.drawCell(U,Z,x,Y,_,V,n,c,d);var M=d.getValue(Z,Y);Qi(U,M,Y,d.getLabelFont(Z,Y,M),d.getLabelColor(Z,Y,M),_,V,n,c,Z,d)},p.getColumnModel=function(){return this._39o},p._17o=function(){this.redraw()},p._18o=function(g){var Q=this;g.data===Q._sortColumn&&Uo[g.property]?Q.ivm():(Q._42o(),Q.redraw())},p._19o=function(){this.redraw()},p.getCurrentSortFunc=function(){var p=this,f=p._sortColumn;if(f&&f.isSortable()){var c=f.getSortFunc(),V=ff===f.getSortOrder()?1:-1;return c||(c=cd),function(M,$){return c.call(p,p.getValue(M,f),p.getValue($,f),M,$)*V}}return p._sortFunc},p.isCellEditable=function(w,j,M){return j.isEditable()&&this.isEditable()?j.isCellEditable?j.isCellEditable(w,j,M,this):!0:!1},p._37O=function(V,c){if(Te(c))for(var y=this,M=y.lp(c),Y=y._60I,Z=y._rowHeight,x=y._29I,P=x.x,z=x.y,l=x.width,_=x.height,g=0;g<Y.size();g++){var b=Y.get(g),G=b.startX,u=b.column,S=u.getWidth();if(u!==y._31o&&u!==y._4o&&M.x>=G&&M.x<G+S&&y.isCellEditable(V,u,c)){var H={x:G,y:y.getRowIndex(V)*Z,width:S,height:Z},p={x:H.x+y.tx(),y:H.y+y.ty(),width:H.width,height:H.height},B=0,T=0;return H.x<P?B=H.x-P:H.x+H.width>P+l&&(B=H.x+H.width-P-l),B&&(y.tx(y.tx()-B),p.x-=B),H.y<z?T=H.y-z:H.y+Z>z+_&&(T=H.y+Z-z-_),T&&(y.ty(y.ty()-T),p.y-=T),y.beginEditing({data:V,column:u,value:y.getValue(V,u),event:c,rect:H,editorRect:p,view:y}),void 0}}}},Ui.BaseItemEditor=function(s,y,A,m){this._data=s,this._column=y,this._master=A,this._editInfo=m},yr("BaseItemEditor",H,{ms_ac:["data","column","master","editInfo"],editBeginning:function(){},getView:function(){},getValue:function(){},setValue:function(){}});var Fn=k.Tab=function(){Hh(Fn,this)};Ni("Tab",oj,{ms_ac:["view","closable","disabled","visible"],_icon:V,_closable:!1,_disabled:!1,_visible:!0,setParent:Qn});var yq=k.Column=function(){Hh(yq,this)};Ni("Column",oj,{_46o:1,ms_ac:["accessType","valueType",gk,ne,Fc,th,"align",oc,"sortOrder",Lq,"sortable","clickable","nullable","emptiable","slider","colorPicker","itemEditor"],_visible:!0,_width:80,_sortOrder:ff,_sortFunc:V,_sortable:!0,_clickable:!0,setWidth:function(D){16>D&&(D=16);var M=this._width;this._width=D,this.fp(th,M,D)},getToolTip:function(V,z){return this.formatValue(z.getValue(V,this))}});var gl=k.Property=function(){Hh(gl,this)};Ni("Property",oj,{_46o:1,ms_ac:["accessType","valueType",ne,Fc,"categoryName",oc,"align","nullable","emptiable","slider","itemEditor","colorPicker"],_categoryName:V,getToolTip:function(h,y,n){var Q=this;return y?Q.formatValue(n.getValue(h,Q)):n.getPropertyName(Q)}}),Ui.AccordionView=function(){var Y=this;Y._20o={},Y._21o=new Vd,Y._10o=V,Y._9o=V,Y._11o=V,Y._view=np(0,Y),Y.iv()},yr("AccordionView",H,{ms_v:1,ms_fire:1,ms_ac:[De,Pb,"titleHeight",Xp,tl,"titleBackground","selectWidth",Xd,"orientation","separatorColor"],_expandIcon:m.accordionViewExpandIcon,_collapseIcon:m.accordionViewCollapseIcon,_titleHeight:qq,_labelColor:m.accordionViewLabelColor,_labelFont:m.accordionViewLabelFont,_titleBackground:m.accordionViewTitleBackground,_selectBackground:m.accordionViewSelectBackground,_selectWidth:m.accordionViewSelectWidth,_orientation:"v",_separatorColor:m.accordionViewSeparatorColor,onPropertyChanged:function(){this.iv()},getView:function(){return this._view},getTitles:function(){return this._21o},getCurrentTitle:function(){return this._10o},add:function(i,p,K,n){var U=this,G=Ij();if(U._20o[i])throw i+" already exists";G.onmousedown=Mf,G.style.cursor=Ig,G.addEventListener(fn?hg:Bj,function(V){Mf(V)},B),G.addEventListener(fn?Aj:mm,function(I){Mf(I),Te(I)&&(U._10o===i?U.collapse():U.expand(i))},B),Kl(U._view,G),U._20o[i]={content:p,div:G,canvas:sk(G),icon:n},U._21o.add(i),K&&U.expand(i),U.iv()},remove:function(S){var j=this,A=j._20o[S];A&&(Nr(A.div),delete j._20o[S],j._21o.remove(S),j.iv())},clear:function(){var c=this;c._21o.toArray().forEach(c.remove,c),c._20o={},c._21o.clear(),c.iv()},isExpanded:function(T){return this._10o===T},expand:function(r){var l=this;l._20o[r]&&l._10o!==r&&(l._10o=r,l.onExpanded(r),l.iv())},onExpanded:function(){},collapse:function(){var I=this;I._10o&&(I.onCollapsed(I._10o),delete I._10o,I.iv())},onCollapsed:function(){},initCanvas:function(i,f,A){ye(i,f,A);var F=Qq(i);return dl(F,0,0,1),F.clearRect(0,0,f,A),F},drawTitle:function(F,J,E,b,t){var i=this,B=hs(t.icon),q=i.isExpanded(J),u=i._titleHeight,U=i._titleBackground,K=i._selectWidth,f=i._separatorColor,M=hs(q?i._expandIcon:i._collapseIcon),Y=K+4;Qm(F,0,0,E,b,U),q&&K&&Qm(F,0,0,K,b,i._selectBackground),(q||i._21o.get(i._21o.size()-1)!==J)&&Qm(F,0,b-1,E,1,f?f:Tn(U)),B&&(Td(F,B,Y+si(B)/2,u/2),Y+=si(B)+2),_q(F,J,i.getLabelFont(J),i.getLabelColor(J),Y,0,0,u),M&&Td(F,M,E-si(M)/2-4,u/2)},validateImpl:function(){var a=this,F=a._view,w=0,K=0,Q=a.getWidth(),R=a.getHeight(),_=a._titleHeight,Z=a._21o.size()*_,h=a._11o,v=a._9o;delete a._11o,delete a._9o,a._21o.each(function(e){var y,E,G=a._20o[e],F=G.content,V=a._10o===e;Ap(a)?(xg(G.div,w,0,_,R),y=a.initCanvas(G.canvas,_,R),Zo(y,0,R),zi(y,-X),a.drawTitle(y,e,R,_,G),y.restore(),V?(E=D(0,Q-Z),F&&(a._11o=F,a._9o=Wg(F),xg(F,w+_,0,E,R)),w+=_+E):w+=_):(xg(G.div,0,K,Q,_),y=a.initCanvas(G.canvas,Q,_),a.drawTitle(y,e,Q,_,G),y.restore(),V?(E=D(0,R-Z),F&&(a._11o=F,a._9o=Wg(F),xg(F,0,K+_,Q,E)),K+=_+E):K+=_)});var P=a._9o;h&&h!==a._11o&&h.endEditing&&h.endEditing(),P&&P!==v&&Kl(F,P),v&&v!==P&&Nr(v)}}),Ui.SplitView=function(K,X,Z,G){var F=this,B=F._dividerDiv=Ij(),M=F._60O=sk(),T=F._61O=sk(),r=M.style,P=T.style;F._view=np(1,F),Kl(F._view,B),r.msTouchAction=us,r.pointerEvents=us,r.cursor=Ig,P.msTouchAction=us,P.pointerEvents=us,P.cursor=Ig,K&&F.setLeftView(K),X&&F.setRightView(X),Z&&F.setOrientation(Z),G!=V&&F.setPosition(G),F.setStatus(mf),new Gc(F)},yr("SplitView",H,{ms_v:1,ms_fire:1,ms_ac:["continuousLayout","dividerSize","dividerBackground","toggleIcon","togglable","dragOpacity","orientation","draggable","status"],_continuousLayout:!1,_position:.5,_togglable:!0,_orientation:"h",_draggable:!0,_dividerSize:m.splitViewDividerSize,_dividerBackground:m.splitViewDividerBackground,_dragOpacity:m.splitViewDragOpacity,_toggleIcon:m.splitViewToggleIcon,onPropertyChanged:function(){this.iv()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(a,X){var m=this,n=m._position;isNaN(a)||(X||(m._82O=0>a?-1:a>1?1:0),m._position=a,m.fp(kc,n,a))},getLeftView:function(){return this._leftView},setLeftView:function(u){var V=this,d=V._leftView,h=V._view;if(V._leftView!==u){if(d&&d!==V._rightView){var A=Wg(d);A.parentNode===h&&Nr(A)}if(V._leftView=u,u){var q=Wg(u);q.parentNode!==h&&h.insertBefore(q,V._dividerDiv)}V.fp("leftView",d,u)}},getRightView:function(){return this._rightView},setRightView:function(G){var n=this,b=n._rightView,M=n._view;if(n._rightView!==G){if(b&&b!==n._leftView){var F=Wg(b);F.parentNode===M&&Nr(F)}if(n._rightView=G,G){var B=Wg(G);B.parentNode!==M&&M.insertBefore(B,n._dividerDiv)}n.fp("rightView",b,G)}},validateImpl:function(){var o=this,H=o._draggable,p=o._position,i=o.getWidth(),k=o.getHeight(),J=o._dividerSize,V=o._dividerBackground,s=fn?18:8,R=o._dividerDiv,q=o._82O,K=o._60O,w=o._61O,P=o._toggleIcon,d=o._status,x=R.style,I=null,e=fn?20:4,h=P.comps[0];J>=s||0===J?o._coverDiv&&(Nr(o._coverDiv),delete o._coverDiv):o._coverDiv||(o._coverDiv=Ij(),Jk&&(o._coverDiv.style.background=cm),Kl(R,o._coverDiv)),o._togglable?K.parentNode||(Kl(R,K),Kl(R,w)):(Nr(K),Nr(w));var T=o._coverDiv,E=o._leftView,z=o._rightView;if(Ap(o)){if(J>i&&(J=i),d===mf)if(1===q)var A=f(p,i),m=D(0,i-J-A);else-1===q?(m=f(-p,i),A=D(0,i-J-m)):(A=n((i-J)*p),m=D(0,i-J-A));else"cl"===d?(A=0,m=D(0,i-J)):"cr"===d&&(m=0,A=D(0,i-J));E&&xg(E,0,0,A,k),z&&xg(z,A+J,0,m,k),xg(R,A,0,J,k),o._22o=A,T&&(xg(T,J/2-s/2,0,s,k),T.style.cursor=H?bq:""),R.style.cursor=H?bq:"";var _=R.clientHeight/2,u=R.clientWidth;ye(K,u,u),xg(K,0,_-u-e,u,u),I=Qq(K),dl(I,0,0,1),h.rotation=-X,Af(I,P,0,0,u,u),I.restore(),ye(w,u,u),xg(w,0,_+e,u,u),I=Qq(w),dl(I,0,0,1),h.rotation=X,Af(I,P,0,0,u,u),I.restore()}else{if(J>k&&(J=k),d===mf)if(1===q)var Q=f(p,k),U=D(0,k-J-Q);else-1===q?(U=f(-p,k),Q=D(0,k-J-U)):(Q=n((k-J)*p),U=D(0,k-J-Q));else"cl"===d?(Q=0,U=D(0,k-J)):"cr"===d&&(U=0,Q=D(0,k-J));E&&xg(E,0,0,i,Q),z&&xg(z,0,Q+J,i,U),xg(R,0,Q,i,J),o._22o=Q,T&&(xg(T,0,J/2-s/2,i,s),T.style.cursor=H?Ke:""),x.cursor=H?Ke:"";var g=R.clientWidth/2,u=R.clientHeight;ye(K,u,u),xg(K,g-u-e,0,u,u),I=Qq(K),dl(I,0,0,1),h.rotation=0,Af(I,P,0,0,u,u),I.restore(),ye(w,u,u),xg(w,g+e,0,u,u),I=Qq(w),dl(I,0,0,1),h.rotation=F,Af(I,P,0,0,u,u),I.restore()}x.background=V}});var Gc=function(I){this.sv=I,this.addListeners()};Ir(Gc,H,{ms_listener:1,getView:function(){return this.sv.getView()},handle_touchstart:function(f){var Z=this,X=Z.sv,U=X._dividerDiv,$=X._60O,H=X._61O,T=X._status,p=f.target;if(p===$)T===mf?X.setStatus("cl"):"cr"===T&&X.setStatus(mf);else if(p===H)T===mf?X.setStatus("cr"):"cl"===T&&X.setStatus(mf);else if(Br(f)&&(p===U||p===X._coverDiv)&&(Mf(f),X.isDraggable())){X.getLeftView(),X.getRightView();var u=Z.maskDiv=Ij();if(u.style.left=0,u.style.top=0,u.style.width=X.getWidth()+"px",u.style.height=X.getHeight()+"px",X.getView().appendChild(u),!X.isContinuousLayout()){var L=Z.resizeDiv=Ij();L.style.left=U.style.left,L.style.top=U.style.top,L.style.width=U.style.width,L.style.height=U.style.height,L.style.opacity=X.getDragOpacity(),L.style.background=X.getDividerBackground(),Kl(Z.getView(),L)}Z._lastAbsPosition=X._22o,Z._86o=Ap(X)?_h(f).x:_h(f).y,cp(Z,f)}},handleWindowTouchMove:function(T){Br(T)&&this.update(T,this.sv.isContinuousLayout())},handleWindowTouchEnd:function(X){var $=this;$.update(X,!0),$.sv.setStatus(mf),$.maskDiv&&Nr($.maskDiv),$.resizeDiv&&Nr($.resizeDiv),$.maskDiv=$.resizeDiv=V},handle_mousedown:function(W){Te(W)&&this.handle_touchstart(W)},handleWindowMouseMove:function(H){this.handleWindowTouchMove(H)},handleWindowMouseUp:function(P){this.handleWindowTouchEnd(P)},update:function(D,V){var n=this,J=n.sv,d=Ap(J)?J.getWidth():J.getHeight(),Z=J._dividerSize,_=n._lastAbsPosition-n._86o;Ap(J)?(_+=_h(D).x,_>d-Z&&(_=d-Z),0>_&&(_=0),n.resizeDiv&&(n.resizeDiv.style.left=_+Sd)):(_+=_h(D).y,_>d-Z&&(_=d-Z),0>_&&(_=0),n.resizeDiv&&(n.resizeDiv.style.top=_+Sd)),V&&d!==Z&&(1===J._82O?J.setPosition(_,1):-1===J._82O?J.setPosition(_-d+Z,1):J.setPosition(_/(d-Z),1))}}),Ui.TabView=function(){var h=this,n=h._view=np(1,h),g=h._91O=Ij(1),T=h._tabModel=new bi,q=T.sm(),o=h.invalidate;h._7o=new Vd,h._canvas=sk(g),Kl(n,g),Kl(n,h._92O=Ij(1)),q.setSelectionMode(ir),q.ms(h.handleSelectionChange,h),T.mm(o,h),T.mh(o,h),T.md(o,h),h._interactor=new zd(h),h.iv()},yr("TabView",H,{ms_v:1,ms_fire:1,ms_tx:1,ms_ty:1,ms_lp:1,ms_ac:["movable","tabGap","tabHeight","tabPosition",Xp,tl,"tabHPadding","tabBackground","selectWidth",Xd,"moveBackground","insertColor"],_tabHPadding:0,_tabPosition:qs,_tabHeight:qq,_tabGap:m.tabViewTabGap,_labelColor:m.tabViewLabelColor,_labelFont:m.tabViewLabelFont,_tabBackground:m.tabViewTabBackground,_selectWidth:m.tabViewSelectWidth,_selectBackground:m.tabViewSelectBackground,_moveBackground:m.tabViewMoveBackground,_insertColor:m.tabViewInsertColor,_movable:!0,handleSelectionChange:function(){this._selectionChanged=!0,this.invalidate()},getContentDiv:function(){return this._92O},getTitleDiv:function(){return this._91O},getTabModel:function(){return this._tabModel},add:function(C,t,s){var T,w=this._tabModel;return C instanceof Fn?(T=C,t&&T.setView(t)):(T=new Fn,T.setName(C),T.setView(t)),w.add(T),s&&w.sm().ss(T),T},getLabel:function(K){return K.toLabel()},onPropertyChanged:function(){this.iv()},_7Q:function(L){this._23o=L,this.iv()},get:function(w){var D=this,s=D._tabModel;if(Mj(w))return s._roots.get(w);if(Jh(w)){var J;return s.each(function($){w===D.getLabel($)&&(J=$)}),J}return w instanceof Fn?w:V},select:function(o){this._tabModel.sm().ss(this.get(o))},remove:function(v){var e=this;if(v=e.get(v)){var x=e._tabModel,B=x._roots.indexOf(v);e._tabModel.remove(v),e.selectByIndex(--B)}},getCurrentTab:function(){return this._8o},hideTabView:function(E,w){w.parentNode===this._92O&&(wd(w)?(w.style.display=Fi,w._tab_=E):Nr(w),_g())},showTabView:function(s,d){wd(d)&&(d.style.display="block",d._tab_=s),d.parentNode!==this._92O&&(Kl(this._92O,d),_g())},_24o:function(){var p,z=this,Z=z._8o,b=z._9o,k=z._tabModel.sm().ld();k&&(p=Wg(k.getView())),p!==b&&(b&&(Z.getView()&&Z.getView().endEditing&&Z.getView().endEditing(),z.hideTabView(Z,b)),p&&z.showTabView(k,p)),z._8o=k,z._9o=p,Z!==k&&z.onTabChanged(Z,k)},onTabClosing:function(){return!0},onTabChanged:function(){},onTabClosed:function(U,f){this.selectByIndex(--f)},selectByIndex:function(O){var F=this,U=F._tabModel,M=U.size();if(M&&!U.sm().ld()){O==V&&(O=0),O>=M&&(O=M-1),0>O&&(O=0);for(var L=O;L>=0;L--){var q=F.get(L);if(!q.isDisabled())return F.select(q),q}for(L=O+1;M>L;L++)if(q=F.get(L),!q.isDisabled())return F.select(q),q}},getTabWidth:function(y){var F=this.getTabHPadding(),Y=4+2*F,n=hs(y.getIcon());n&&(Y+=si(n,y)+4);var U=this.getLabel(y);return U&&(Y+=hd(this.getLabelFont(y),U).width+4),y.isClosable()&&(Y+=10),Y},drawTab:function(h,m,D,A,d,x,_){var H,z=this,l=z._tabPosition,f=this.getTabHPadding(),$=D+4+f,U=z._selectWidth,L=hs(m.getIcon()),w=m.isDisabled(),q=z.getLabelColor(m),e=z.getLabelFont(m),G=z.getLabel(m),k=z._selectBackground,N=l===ws+"-vertical",J=l===Hn+"-vertical";(N||J)&&($=A+4+f),w&&(h.globalAlpha=rr),Qm(h,D,A,d,x,_),m===z._8o&&U&&(l===qs?Qm(h,D,A+x-U,d,U,k):l===ws?Qm(h,D+d-U,A,U,x,k):l===Hn?Qm(h,D,A,U,x,k):N?Qm(h,D+d-U,A,U,x,k):J?Qm(h,D,A,U,x,k):Qm(h,D,A,d,U,k));var g=d/2;if(N&&(Zo(h,g,A+x/2),zi(h,F),Zo(h,-g,-A-x/2)),L){var o=of(L,m),P=si(L,m);if(N||J){var u=D+d/2,M=$+o/2;Zo(h,u,M),zi(h,X),Zo(h,-u,-M),Td(h,L,D+d/2,$+o/2,m,z),Zo(h,u,M),zi(h,-X),Zo(h,-u,-M),$+=o+4}else Td(h,L,$+P/2,A+x/2,m,z),$+=P+4}return N||J?(Zo(h,d/2,$+d/2),zi(h,X),Zo(h,-d/2,-$-d/2),_q(h,G,e,q,D,$,x,d),Zo(h,d/2,$+d/2),zi(h,-X),Zo(h,-d/2,-$-d/2)):_q(h,G,e,q,$,A,d,x),N&&(Zo(h,g,A+x/2),zi(h,-F),Zo(h,-g,-A-x/2)),m.isClosable()&&(H=J?{x:D+d-12,y:A+x-12,width:12,height:12}:{x:D+d-12,y:A+2,width:12,height:12},this.drawCloseIcon(m,h,q,H)),w&&(h.globalAlpha=1),H},drawCloseIcon:function(k,y,g,M){var E=M.x,U=M.y;y.strokeStyle=g,y.lineWidth=1,y.beginPath(),y.moveTo(E+2,U+8),y.lineTo(E+8,U+2),y.moveTo(E+8,U+8),y.lineTo(E+2,U+2),y.stroke()},getTabAt:function(S){var D=this._interactor._8Q(S);return D?D.tab:null},validateImpl:function(){var _=this;_._24o();var E,Z=_._canvas,c=_._tabPosition,V=_._91O,s=_._92O,y=_._tabModel,o=_.getWidth(),z=_.getHeight(),H=_._tabHeight,t=_._7o,Y=_._tabGap,j=c===qs,T=c===ws,O=c===Hn,d=c===ws+"-vertical",I=c===Hn+"-vertical",F=_._23o,L=0;if((T||O)&&y._roots.each(function(b){L=D(_.getTabWidth(b),L)}),j?(xg(V,0,0,o,H),E={x:0,y:H,width:o,height:D(0,z-H)}):T?(xg(V,0,0,L,z),E={x:L,y:0,width:D(0,o-L),height:z}):O?(xg(V,o-L,0,L,z),E={x:0,y:0,width:D(0,o-L),height:z}):d?(xg(V,0,0,H,z),E={x:H,y:0,width:D(0,o-H),height:z}):I?(xg(V,o-H,0,H,z),E={x:0,y:0,width:D(0,o-H),height:z}):(xg(V,0,z-H,o,H),E={x:0,y:0,width:o,height:D(0,z-H)}),xg(s,E),d||I){_._9o&&(E.x=0,xg(_._8o.getView(),E)),ye(Z,H,z);var m=Qq(Z),g=0;if(dl(m,0,_.ty(),1),m.clearRect(0,0,H,z),t.clear(),y._roots.each(function(B){if(B.isVisible()){var q,i=_.getTabWidth(B);F&&F.tab===B||(q=_.drawTab(m,B,0,g,H,i,_._tabBackground)),t.add({_75o:q,tab:B,startY:g,endY:g+i,height:i}),g+=i+Y}}),_._23Q=D(0,g-Y),F){var l=F.position;_.drawTab(m,F.tab,0,F.startY,H,F.height,_._moveBackground),Qm(m,0,l,H,1,_._insertColor)}if(m.restore(),_._selectionChanged){_._selectionChanged=!1;for(var q=_.ty(),X=0;X<t.size();X++){var k=t.get(X);if(k.tab===_._8o){if(k.endY+q<0){_.ty(-k.startY);break}if(k.startY+q>z){_.ty(z-k.endY);break}}}}_.ty(_.ty())}else if(T||O){_._9o&&(E.x=0,xg(_._8o.getView(),E)),ye(Z,L,z);var m=Qq(Z),g=0;if(dl(m,0,_.ty(),1),m.clearRect(0,0,L,z),t.clear(),y._roots.each(function(w){if(w.isVisible()){var p;F&&F.tab===w||(p=_.drawTab(m,w,0,g,L,H,_._tabBackground)),t.add({_75o:p,tab:w,startY:g,endY:g+H,height:H}),g+=H+Y}}),_._23Q=D(0,g-Y),F){var l=F.position;_.drawTab(m,F.tab,0,F.startY,L,F.height,_._moveBackground),Qm(m,0,l,L,1,_._insertColor)}if(m.restore(),_._selectionChanged){_._selectionChanged=!1;for(var q=_.ty(),X=0;X<t.size();X++){var k=t.get(X);if(k.tab===_._8o){if(k.endY+q<0){_.ty(-k.startY);break}if(k.startY+q>z){_.ty(z-k.endY);break}}}}_.ty(_.ty())}else{_._9o&&(E.y=0,xg(_._8o.getView(),E)),ye(Z,o,H);var m=Qq(Z),v=0;if(dl(m,_.tx(),0,1),m.clearRect(0,0,o,H),t.clear(),y._roots.each(function(B){if(B.isVisible()){var g,J=_.getTabWidth(B);F&&F.tab===B||(g=_.drawTab(m,B,v,0,J,H,_._tabBackground)),t.add({_75o:g,tab:B,startX:v,endX:v+J,width:J}),v+=J+Y}}),_._64I=D(0,v-Y),F){var l=F.position;_.drawTab(m,F.tab,F.startX,0,F.width,H,_._moveBackground),Tf(m,_._insertColor,l,0,H)}if(m.restore(),_._selectionChanged){_._selectionChanged=!1;for(var n=_.tx(),X=0;X<t.size();X++){var k=t.get(X);if(k.tab===_._8o){if(k.endX+n<0){_.tx(-k.startX);break}if(k.startX+n>o){_.tx(o-k.endX);break}}}}_.tx(_.tx())}for(var N=[],a=s.children,X=0;X<a.length;X++){var i=a[X],K=i._tab_;K&&!y.contains(K)&&N.push(i)}N.forEach(function(A){s.removeChild(A)})}});var zd=function(m){this.tv=m,this.addListeners()};Ir(zd,H,{ms_listener:1,getView:function(){return this.tv._91O},handle_mousewheel:function(X){this.handleScroll(X,10*(X.wheelDelta/40))},handle_DOMMouseScroll:function(A){this.handleScroll(A,10*-A.detail)},handleScroll:function(P,t){Mf(P);var D=this.tv,i=D._tabPosition;!D._40o()||i!==qs&&i!==rq||D.tx(this.tv.tx()+t),!D._41o()||i!==ws&&i!==Hn&&i!==ws+"-vertical"&&i!==Hn+"-vertical"||D.ty(this.tv.ty()+t)},_8Q:function(p){var s,z,E=this.tv,j=E._tabPosition,O=E._7o;if(j===qs||j===rq){var x=E.lp(p).x;for(s=0;s<O.size();s++)if(z=O.get(s),z.startX<=x&&x<=z.endX)return z}else if(j===ws||j===Hn||j===ws+"-vertical"||j===Hn+"-vertical"){var w=E.lp(p).y;for(s=0;s<O.size();s++)if(z=O.get(s),z.startY<=w&&w<=z.endY)return z}return V},isClickable:function(V){var L=this.tv,f=L._tabPosition,s=this._73o=this._8Q(V);return!L._40o()||f!==qs&&f!==rq?!L._41o()||f!==ws&&f!==Hn&&f!==ws+"-vertical"&&f!==Hn+"-vertical"?s&&(!s.tab.isDisabled()||L.isMovable()):!0:!0},handle_mousemove:function(M){var f=this;bl?f._74o=f._8Q(M):f.getView().style.cursor=f.isClickable(M)?Ig:""},handle_mousedown:function(_){this.handle_mousemove(_),this.handle_touchstart(_)},handle_touchstart:function(k){var U=this,h=U.tv,l=h._tabPosition;Mf(k),Te(k)&&U.isClickable(k)&&(l===qs||l===rq?(U.x=_h(k).x,U.lp=h.lp(k),U.tx=h.tx()):(U.y=_h(k).y,U.lp=h.lp(k),U.ty=h.ty()),cp(U,k))},handleWindowMouseMove:function(k){this.handleWindowTouchMove(k)},handleWindowTouchMove:function(z){var H,V=this,i=V.tv,O=i._tabPosition,C=V._73o;if(O===qs||O===rq){if(H=_h(z).x-V.x,!V._25o&&!V.moving&&M(H)>2&&(i._40o()&&!Kg(z)?V._25o=1:C&&i.isMovable()&&(V.moving=1)),V._25o)i.tx(V.tx+H);else if(V.moving){var X=V.lp.x+H,v=i._tabGap/2;i._7o.each(function(k){var j=k.endX,t=X-k.startX<j-X;X>=k.startX&&j>=X&&i._7Q({tab:C.tab,startX:C.startX+H,width:C.width,front:t,insertTab:k.tab,position:t?D(0,k.startX-v):f(i._64I,j+v)})})}}else if(H=_h(z).y-V.y,!V._25o&&!V.moving&&M(H)>2&&(i._41o()&&!Kg(z)?V._25o=1:C&&i.isMovable()&&(V.moving=1)),V._25o)i.ty(V.ty+H);else if(V.moving){var F=V.lp.y+H,v=i._tabGap/2;i._7o.each(function(p){var $=p.endY,o=F-p.startY<$-F;F>=p.startY&&$>=F&&i._7Q({tab:C.tab,startY:C.startY+H,height:C.height,front:o,insertTab:p.tab,position:o?D(0,p.startY-v):f(i._23Q,$+v)})})}},handleWindowMouseUp:function(D){this.handleWindowTouchEnd(D)},handleWindowTouchEnd:function(){var G=this,s=G.tv,u=s._tabPosition,n=s.getTabModel(),m=n._roots,p=G._73o;if(G.moving){var q=s._23o;if(q&&q.insertTab!==q.tab){var b=q.tab,J=m.remove(b),h=m.indexOf(q.insertTab);h>=0&&(q.front||h++,h<=m.size()&&(m.add(b,h),n._38I(b,J,h)))}s._7Q(V),delete G.moving}else if(!G._25o&&p){b=p.tab;var N=G._74o;if(!N||N.tab===b)if(!b.isDisabled()&&zc(p._75o,G.lp)){var $=function(){var i=m.indexOf(b);n.remove(b),s.onTabClosed(b,i)};s.onTabClosing(b,$)&&$()}else b.isDisabled()||s._8o===b||n.sm().ss(b)}G._25o=G._73o=G._74o=u===qs||u===rq?G.x=G.lp=G.tx=V:G.y=G.lp=G.ty=V}}),Ui.PropertyView=function(v){var c=this;c._view=np(1,c),c._canvas=sk(c._view),Kl(c._view,c._79O=Ij()),c._rows=new Vd,c._28o=new Vd,c._26o={},c._26Q={};var C=c._propertyModel=new bi,I=c.ivm;C.mm(I,c),C.md(I,c),C.mh(I,c),c.dm(v?v:new bi),new ip(c)},yr("PropertyView",H,{ms_ac:[Xp,Un,tl,ne,Fc,"categorizable",ag,Lq,_d,De,Pb,Qc,Qj,ts,"selectRowIndex",Xd,"background",lr,ok,cq,dm,Vh],ms_v:1,ms_dm:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,_45o:1,_47o:1,ms_tip:1,_29I:fe,_59I:0,_9I:0,_selectRowIndex:-1,_editable:!0,_batchEditable:!0,_categorizable:!0,_indent:ik,_background:m.propertyViewBackground,_expandIcon:m.propertyViewExpandIcon,_collapseIcon:m.propertyViewCollapseIcon,_scrollBarColor:Dd,_scrollBarSize:Lb,_autoHideScrollBar:Uq,_selectBackground:m.propertyViewSelectBackground,_rowHeight:bk,_rowLineVisible:m.propertyViewRowLineVisible,_rowLineColor:m.propertyViewRowLineColor,_10I:.5,_columnLineVisible:m.propertyViewColumnLineVisible,_columnLineColor:m.propertyViewColumnLineColor,_labelColor:m.propertyViewLabelColor,_labelSelectColor:m.propertyViewLabelSelectColor,_labelFont:m.propertyViewLabelFont,getRows:function(){return this._rows},getColumnPosition:function(){return this._10I},setColumnPosition:function(d){0>d&&(d=0),d>1&&(d=1);var R=this,n=R._10I;R._10I=d,R.fp("columnPosition",n,d)},getPropertyName:function(p){return p.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(r,H,c){return c===this._selectRowIndex?this._labelSelectColor:this._labelColor},getPropertyFont:function(){return this._labelFont},getPropertyColor:function(P,n){return n===this._selectRowIndex?this._labelSelectColor:P.getColor()||this._labelColor},getCategoryFont:function(){return this._labelFont},getCategoryColor:function(){return this._labelColor},adjustTranslateX:function(){return 0},adjustTranslateY:function(B){var d=this.getHeight()-this._59I;return d>B&&(B=d),B>0?0:n(B)},isExpanded:function(h){if(!h)return!0;var a=this._26o[h];return a?a.isExpanded:!(this._26Q[h]===!1)},toggle:function(V){var e=this;e.isExpanded(V)?e.collapse(V):e.expand(V)},expandAll:function(){this.validate();for(var s in this._26o)this.expand(s)},expand:function(h){if(h&&h!==Fi){var D=this,J=D._26o[h];J&&!J.isExpanded&&(J.isExpanded=!0,D.onExpanded(h),D.ivm())}},onExpanded:function(){},collapseAll:function(){this.validate();for(var Q in this._26o)this.collapse(Q)},collapse:function(E){if(E&&E!==Fi){var m=this,q=m._26o[E];q&&q.isExpanded&&(q.isExpanded=!1,m.onCollapsed(E),m.ivm())}},onCollapsed:function(){},getCategoryName:function(N){if(!this.isCategorizable())return Fi;var T=N.getCategoryName();return T?T:Fi},getPropertyModel:function(){return this._propertyModel},handleSelectionChange:function(){this.ivm()},setDataModel:function(n){var _=this,m=_._dataModel;m!==n&&(m&&(m.umd(_.handlePropertyChange,_),_._selectionModel||m.sm().ums(_.handleSelectionChange,_)),_._dataModel=n,n.md(_.handlePropertyChange,_),_._selectionModel?_._selectionModel._21I(n):n.sm().ms(_.handleSelectionChange,_),_.fp(al,m,n))},isVisible:function(J){return this._visibleFunc?this._visibleFunc(J):!0},onPropertyChanged:function(x){var G=this,P=x.property;db[P]?G.ivm():G.iv(),P===Wj&&G._43o()},getCurrentData:function(){return this._27o},updateCurrentData:function(){this._27o=this.sm().ld()},getRawProperties:function(){return this._27o?this._propertyModel._roots:Lj},handlePropertyChange:function(R){this._27o===R.data&&this.iv()},ivm:function(){this.invalidateModel()},invalidateModel:function(){var g=this;g._96I||(g.setSelectRowIndex(-1),g._96I=1,g.iv())},redraw:function(){this.iv()},validateModel:function(){var v=this,N=v._rows,O=v._28o,M={},J=new Vd,o=v._27o;v.updateCurrentData(),o!==v._27o&&v.endEditing(),N.clear(),O.clear(),v.getRawProperties().each(function(F){if(v.isVisible(F)){J.add(F);var q=v.getCategoryName(F);M[q]||(O.add(q,q===Fi?0:C),M[q]={isExpanded:v.isExpanded(q),properties:new Vd})}}),v._sortFunc&&J.sort(v._sortFunc);for(var h in v._26o)v._26Q[h]=v.isExpanded(h);
v._26o=M,O.each(function(U){U!==Fi&&N.add(U);var S=M[U];S.isExpanded&&J.each(function(l){v.getCategoryName(l)===U&&(S.properties.add(l),N.add({property:l,data:v._27o}))},v)})},validateImpl:function(){var I=this;I._76o(),I._96I&&(I.validateModel(),delete I._96I);var D=I._canvas,B=I.getWidth(),Y=I.getHeight(),g=-I.ty(),s=I._rowHeight,m=I._indent,b=B-m,h=I._rows,J=h.size(),l=I._9I=m+b*I._10I,K=I._59I=J*s;ye(D,B,Y),I._29I={x:0,y:g,width:B,height:Y},I._31I=$(g/s),I._14I=j((g+Y)/s),I._31I<0&&(I._31I=0),I._14I>J&&(I._14I=J);var A,c=Qq(D),d=I._background;dl(c,0,-g,1),c.beginPath(),c.rect(0,g,B,Y),c.clip(),c.clearRect(0,g,B,Y),I._93db(c),d&&Qm(c,0,0,m,K,d);for(var C=I._31I;C<I._14I;C++){var P=h.get(C),g=s*C;if(Jh(P))d&&Qm(c,m,g,b,s,d),A=hs(I.isExpanded(P)?I._expandIcon:I._collapseIcon),A&&re(c,A,vl,0,g,m,s),c.save(),c.beginPath(),c.rect(m,g,b,s),c.clip(),I.drawCategoryName(c,P,C,m,g,b,s),c.restore();else{var H=P.property,F=P.data,A=hs(H.getIcon()),p=I._selectRowIndex===C?I.getSelectBackground():V;if(A&&re(c,A,vl,0,g,m,s),p&&Qm(c,m,g,b,s,p),c.save(),c.beginPath(),c.rect(m,g,l-m,s),c.clip(),I.drawPropertyName(c,H,C,m,g,l-m,s),c.restore(),!I.isEditing(F,H)){var z=l+1,Q=B-l-1;c.save(),c.beginPath(),c.rect(z,g,Q,s),c.clip(),I._87o(I.drawPropertyValue(c,H,I.getValue(F,H),C,z,g,Q,s,F),C,z,g,Q,s),c.restore()}}I._rowLineVisible&&Qm(c,m,g+s-1,b,1,I._rowLineColor)}I._columnLineVisible&&(Qm(c,l,0,1,K,I._columnLineColor),Qm(c,B-1,0,1,K)),I._92db(c),I._93I(),c.restore(),I.ty(I.ty())},drawCategoryName:function(R,G,_,E,L,r,v){_q(R,G,this.getCategoryFont(G),this.getCategoryColor(G),E,L,r,v)},drawPropertyName:function(Z,r,b,j,s,D,e){return r.drawPropertyName?(r.drawPropertyName(Z,r,b,j,s,D,e,this),void 0):(_q(Z,this.getPropertyName(r),this.getPropertyFont(r,b),this.getPropertyColor(r,b),j,s,D,e),void 0)},drawPropertyValue:function(v,G,f,L,y,m,U,s,D){return G.drawPropertyValue?G.drawPropertyValue(v,G,f,L,y,m,U,s,D,this):(Qi(v,f,G,this.getLabelFont(G,f,L),this.getLabelColor(G,f,L),y,m,U,s,D,this),void 0)},isPropertyEditable:function(r){return r.isEditable()&&this.isEditable()},setProperties:function(X){this._propertyModel.clear(),this.addProperties(X)},addProperties:function(u){if(u){var q=this._propertyModel;u.forEach(function(k){if(!(k instanceof gl)){var d=Bf(k.className);k=Om(d?d:gl,k)}q.add(k)})}},getRowIndexAt:function(r){var x=this,d=$(x.lp(r).y/x._rowHeight);return d>=0&&d<x._rows.size()?d:-1},getPropertyAt:function(R){var D=this,F=D.getRowIndexAt(R);return F>=0?D._rows.get(F).property:V},getToolTip:function(E){var Z=this,b=Z.getPropertyAt(E),N=Z._27o;return b&&N?b.getToolTip(N,Z._9I<Z.lp(E).x,Z):V}});var ip=function(_){this.pv=_,this.addListeners()};Ir(ip,H,{ms_listener:1,getView:function(){return this.pv._view},setCursor:function(N){this.getView().style.cursor=N},clear:function(){var g=this;g._62O=g.cp=g.ty=g.p=V,g.setCursor(wi)},handle_mousedown:function(p){this.handle_touchstart(p)},handle_touchstart:function(g){var $=this,R=$.pv;Mf(g),R.setFocus(g)&&(Te(g)?($.cp=_h(g),$.ty=R.ty(),$.p=R.getColumnPosition(),$.handle_touchmove(g)):R.setSelectRowIndex(R.getRowIndexAt(g)))},handleWindowMouseUp:function(){this.clear()},handleWindowTouchEnd:function(){this.clear()},handle_mouseup:function(B){this.handle_touchend(B)},handle_touchend:function(n){var B=this;if(B.cp&&!B._62O){var w=B.pv,z=w.lp(n),K=z.x,A=z.y,e=w._indent,$=w.getRowIndexAt(n),h=w._9I;if($>=0){var Q=w._rowHeight,s=Q*$,D=w._rows.get($),O=D.property;if(Jh(D))hs(w.isExpanded(D)?w._expandIcon:w._collapseIcon)&&K>=0&&e>=K&&A>=s&&s+Q>=A?w.toggle(D):$e(n)&&w.toggle(D);else if(K>h&&w.isPropertyEditable(O,n)){var X={x:h+1,y:s,width:w.getWidth()-h-1,height:Q},U={x:X.x+w.tx(),y:X.y+w.ty(),width:X.width,height:X.height},j=0,R=w._29I;X.y<R.y?j=X.y-R.y:X.y+Q>R.y+R.height&&(j=X.y+Q-R.y-R.height),j&&(w.ty(w.ty()-j),U.y-=j),w.beginEditing({data:D.data,property:O,value:w.getValue(D.data,O),event:n,rect:X,editorRect:U,view:w})}}w.setSelectRowIndex($)}B.clear()},handleWindowMouseMove:function(t){this.handleWindowTouchMove(t)},handleWindowTouchMove:function(R){var Q=this,s=Q.pv,b=Q.ty,y=Q.cp,n=_h(R),i=Q._62O;if("p"===i)s.setTranslateY(b+n.y-y.y);else if("c"===i){var f=s.getWidth()-s._indent;if(f>16){var A=Q.p-(y.x-n.x)/f,m=16/f;m>A&&(A=m),A>1-m&&(A=1-m),s.setColumnPosition(A)}}else"s"===i&&s.setTranslateY(b+(y.y-n.y)*s._59I/s._29I.height)},handle_mousemove:function(q){this.handle_touchmove(q)},handle_touchmove:function(U){if(!bl&&Te(U)){var o=this,D=o.pv,K=M(D.lp(U).x-D._9I)<=(fn?8:3);o.cp?o._62O||(K?(o._62O="c",cp(o)):M(_h(U).y-o.cp.y)>=2&&(o._62O=o.isV(U)?"s":"p",cp(o))):(K?o.setCursor(bq):o.setCursor(wi),o.isV(U)&&D._43o())}},isV:function(z){var p=this.pv,$=p._29I;return p._41o()&&$.x+$.width-p.lp(z).x<je},handle_mousewheel:function(I){this.handleScroll(I,I.wheelDelta/40)},handle_DOMMouseScroll:function(d){2===d.axis&&this.handleScroll(d,-d.detail)},handleScroll:function(T,r){var f=this.pv;Mf(T),f.endEditing(),f.translate(0,r*f.getRowHeight())},handle_keydown:function(V){var r=this.pv,P=r._rows.size(),E=r._selectRowIndex+(Zp(V)?-1:1);(Zp(V)||Bh(V))&&(0>E&&(E=0),E>=P&&(E=P-1),r.setSelectRowIndex(E))}}),Ui.ListView=function(o){this._5o(o),new Bm(this)},yr("ListView",H,{ms_ac:[Xp,Un,tl,lr,ag,ok,cq,Lq,_d,Qc,Qj,ts,Cf,Xd],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,_14Q:1,ms_dm:1,_45o:1,_checkMode:!1,_indent:ik,_rowHeight:bk,_rowLineVisible:m.listViewRowLineVisible,_rowLineColor:m.listViewRowLineColor,_scrollBarColor:Dd,_scrollBarSize:Lb,_autoMakeVisible:Ai,_autoHideScrollBar:Uq,_selectBackground:m.listViewSelectBackground,_labelColor:m.listViewLabelColor,_labelSelectColor:m.listViewLabelSelectColor,_labelFont:m.listViewLabelFont,isCheckMode:function(){return this._checkMode},setCheckMode:function(w){var u=this,q=u._checkMode;u._checkMode=w,u.fp(io,q,w)},drawRow:function(C,Q,U,w,P,h,e){var Z=this,f=0,a=Z._indent,n=Z.getIconWidth(Q);Z.drawRowBackground(C,Q,U,w,P,h,e),Z._checkMode&&(Td(C,hs(Z.getCheckIcon(Q)),f+a/2,P+e/2,Q,Z),f+=a),Z.drawIcon(C,Q,f,P,n,e),Z.drawLabel(C,Q,f+n,P,e)}});var Bm=function(N){this.list=N,this._lastSelectDataTime=Zd(),this.addListeners()};Ir(Bm,H,{ms_listener:1,getView:function(){return this.list._view},clear:function(I){var U=this,l=U.list;I&&"d"===U._62O&&!U.dragCancel&&l.handleDragAndDrop(I,"end"),l.draggingData&&(l.draggingData=null,l.redraw()),U.dragCancel=U._62O=U._isV=U._isH=U.cp=U.tx=U.ty=V},handle_mousedown:function(w){this.handle_touchstart(w)},handle_touchstart:function(l){var m=this,o=m.list;if(Mf(l),o.setFocus(l)){var T=o.getDataAt(l);m.cp=_h(l),m.tx=o.tx(),m.ty=o.ty(),Te(l)?T&&o.handleDragAndDrop&&!m.isV(l)&&!m.isH(l)&&(o.draggingData=T,o.redraw(),o.handleDragAndDrop(l,"prepare")):(T&&m._33o(l,T),m.clear(l))}},handleWindowMouseUp:function(O){this.clear(O)},handleWindowTouchEnd:function(i){this.clear(i)},handle_mouseup:function(w){this.handle_touchend(w)},handle_touchend:function(i){var O=this,e=O.list;if(!O._isV&&!O._isH&&O.cp&&!O._62O){var Y=e.getDataAt(i);Y?(e.isCheckMode()?O._34o(i,Y):O._33o(i,Y),$e(i)?e.onDataDoubleClicked(Y,i):e.onDataClicked(Y,i)):e.handleBackgroundClick(i)}O.clear(i)},handleWindowMouseMove:function(U){this.handleWindowTouchMove(U)},handleWindowTouchMove:function(Z){var I=this,r=I.list,$=I._62O,e=I.tx,C=I.ty,h=I.cp,J=_h(Z),D=r._29I;"p"===$?r.setTranslate(e+J.x-h.x,C+J.y-h.y):"v"===$?r.ty(C+(h.y-J.y)*r._59I/D.height):"h"===$?r.tx(e+(h.x-J.x)*r._91I/D.width):"d"===$&&(I.dragCancel||r.handleDragAndDrop(Z,"between"))},handle_mousemove:function(a){this.handle_touchmove(a)},handle_touchmove:function(d){if(!bl&&Te(d)){var g=this,I=g.list;if(g._isV=g.isV(d),g._isH=g.isH(d),g.cp){if(!g._62O){if(_e(_h(d),g.cp)<2)return;g._isV?g._62O="v":g._isH?g._62O="h":I.draggingData&&!this.dragCancel?(g._62O="d",I.handleDragAndDrop(d,"begin")):g._62O="p",g._62O&&"d"!==g._62O&&I.draggingData&&(I.draggingData=null,I.redraw()),cp(g)}}else g._isV&&I._43o(),g._isH&&I._42o()}},isV:function(E){var T=this.list,Q=T._29I;return T._41o()&&Q.x+Q.width-T.lp(E).x<je},isH:function(m){var s=this.list,X=s._29I;return s._40o()&&X.y+X.height-s.lp(m).y<je},handle_mousewheel:function(u){this.handleScroll(u,u.wheelDelta/40,u.wheelDelta!==u.wheelDeltaX)},handle_DOMMouseScroll:function(s){this.handleScroll(s,-s.detail,1)},handleScroll:function(A,R,v){var q=this.list;Mf(A),q.endEditing&&q.endEditing(),v&&q._41o()?q.translate(0,R*q.getRowHeight()):q._40o()&&q.translate(10*R,0)},handle_keydown:function(W){if(!m.isInput(W.target)){var o,R=this.list,L=R.sm(),k=R._rows,b=k.size();if(_n(W))R.selectAll();else if(Ol(W))R.handleDelete&&R.handleDelete(W);else if(zq(W))"d"!==this._62O||this.dragCancel||(R.handleDragAndDrop(W,"cancel"),this.dragCancel=!0);else if(on(W))R.isCheckMode()&&(o=R.getFocusData(),o&&R.checkData(o));else if(Zp(W)||Bh(W)){var z=R.isCheckMode();if(o=z?R.getFocusData():L.ld()){var t=R.getRowIndex(o);t>=0&&(Zp(W)?0!==t&&(o=k.get(t-1),z?R.setFocusData(o):L.ss(o)):t!==b-1&&(o=k.get(t+1),z?R.setFocusData(o):L.ss(o)))}else b>0&&(o=k.get(0),z?R.setFocusData(o):L.ss(o))}}},_34o:function(c,x){var n=this.list,L=n.lp(c).x;return L>=0&&L<=n._indent?(n.checkData(x),void 0):(n.setFocusData(x),void 0)},_33o:function(m,W){var f=this.list,C=f.sm(),s=C.ld();if(Kg(m))f.isSelected(W)?C.rs(W):C.as(W);else if(gh(m))if(s)for(var K=f.getRowIndex(s),i=f.getRowIndex(W);K!==i;)K+=i>K?1:-1,C.as(f._rows.get(K));else C.ss(W);else if(Te(m)){var M=Zd();if(C.contains(W)){var u=M-this._lastSelectDataTime;f.handleDataDoubleSelect&&u>500&&1500>u&&f.handleDataDoubleSelect(m,W)}C.ss(W),this._lastSelectDataTime=M}else C.contains(W)||C.ss(W)}}),Ui.TreeView=function(E){var N=this;N._35o(),N._5o(E),new Hk(N)},yr("TreeView",H,{ms_ac:[Xp,Un,tl,"rootVisible",io,"rootData",Lq,_d,Qc,Qj,ts,ag,lr,ok,cq,De,Pb,Cf,Xd,"loader","doubleClickToToggle"],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,_48o:1,_14Q:1,_45o:1,_checkMode:V,_indent:ik,_rowHeight:bk,_rowLineVisible:m.treeViewRowLineVisible,_rowLineColor:m.treeViewRowLineColor,_scrollBarColor:Dd,_scrollBarSize:Lb,_autoHideScrollBar:Uq,_expandIcon:m.treeViewExpandIcon,_collapseIcon:m.treeViewCollapseIcon,_autoMakeVisible:Ai,_selectBackground:m.treeViewSelectBackground,_labelColor:m.treeViewLabelColor,_labelSelectColor:m.treeViewLabelSelectColor,_labelFont:m.treeViewLabelFont,_doubleClickToToggle:m.treeViewDoubleClickToToggle,drawRow:function(x,P,n,b,d,R,C){var J=this;J.drawRowBackground(x,P,n,b,d,R,C),J._97I(x,P,n,0,d,R,C)},isOnToggleIcon:function(q){var V=this.getDataAt(q);if(V){var s=this.getIndent(),Y=this.lp(q).x;if(hs(this.getToggleIcon(V))){var g=s*this.getLevel(V);if(Y>=g&&g+s>=Y)return!0}}return!1}});var Hk=function(t){Hh(Hk,this,[t])};Ir(Hk,Bm,{toggle:function(C,G,$,z){var L=this.list,y=L.lp(C).x;if(hs(L.getToggleIcon(G))){var v=$*z;if(y>=v&&v+$>=y)return L.toggle(G),!0}return L.isDoubleClickToToggle()&&$e(C)?(L.toggle(G),!0):!1},_34o:function(p,R){var I=this.list,f=I.lp(p).x,S=I._levelMap[R._id],v=I._indent,o=v*(S+1);return f>=o&&o+v>=f?(I.checkData(R),void 0):(this.toggle(p,R,v,S)||I.setFocusData(R),void 0)},_33o:function(Y,K){var o=this,h=o.list;o.toggle(Y,K,h._indent,h.getLevel(K))||Hk.superClass._33o.call(o,Y,K)},handle_keydown:function(r){if(hr(r)||rc(r)){var e=this.list,k=e._rows,T=e.isCheckMode(),F=e.sm(),X=T?e.getFocusData():F.ld();X?X.hasChildren()&&(hr(r)?e.collapse(X):e.expand(X)):k.size()>0&&(X=k.get(0),T?e.setFocusData(X):F.ss(X))}else Hk.superClass.handle_keydown.call(this,r)}});var ab=Ui.TableView=function(H){this._98I(),this._5o(H),new Bc(this)};yr("TableView",H,{ms_ac:[Xp,Un,tl,"sortMode",ne,Fc,lr,ok,cq,dm,Vh,"sortColumn",Lq,_d,Qc,Qj,ts,Cf,Xd],ms_v:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_45o:1,_47o:1,_sortMode:ys,_editable:!0,_batchEditable:!1,_rowHeight:bk,_rowLineVisible:m.tableViewRowLineVisible,_rowLineColor:m.tableViewRowLineColor,_columnLineVisible:m.tableViewColumnLineVisible,_columnLineColor:m.tableViewColumnLineColor,_scrollBarColor:Dd,_scrollBarSize:Lb,_autoHideScrollBar:Uq,_autoMakeVisible:Ai,_selectBackground:m.tableViewSelectBackground,_labelColor:m.tableViewLabelColor,_labelSelectColor:m.tableViewLabelSelectColor,_labelFont:m.tableViewLabelFont,getCheckColumn:function(){var z=this;if(!z._31o){var o=z._31o=new yq;o.setEditable(!0),o.setWidth(40),o.getValue=z.getCheckColumValue,o.drawCell=z.drawCheckColumnCell}return z._31o},isCheckMode:function(){return this._39o.contains(this._31o)},setCheckMode:function(M){var x=this,d=x._39o,f=x.getCheckColumn();M!==x.isCheckMode()&&(M?d.add(f,0):d.remove(f),x.fp(io,!M,M))},getCheckColumValue:function(A,l,M){return M.isSelected(A)},drawCheckColumnCell:function(J,G,W,C,L,y,o,t,i){Td(J,i.getCheckIcon(G),L+o/2,y+t/2,G,i)}});var Bc=function(J){Hh(Bc,this,[J])};Ir(Bc,Bm,{_34o:function(M,F){var C=this.list,o=C._31o;if(C.isCellEditable(F,o,M)){var x=C._3Q(o),P=C.lp(M).x;if(x&&P>=x.startX&&P<x.startX+o.getWidth())return C.checkData(F),void 0}C._37O(F,M),C.setFocusData(F)},_33o:function(U,t){this.list._37O(t,U),Bc.superClass._33o.apply(this,arguments)}});var Xg=Ui.TreeTableView=function(w){var a=this,l=a._4o=new yq;a._35o(),a._98I(),a._5o(w),l.setDisplayName("Name"),l.setEditable(!0),l.setWidth(180),l.drawCell=Eg,l.getValue=tp,a._39o.add(l),new gn(a)},Eg=function(C,m,O,y,H,l,M,x,h){h._97I(C,m,O,H,l,M,x)},tp=function(r,G,Y){return Y.getLabel(r)};yr("TreeTableView",H,{ms_ac:[Xp,Un,tl,"sortMode",ne,Fc,ag,io,"rootData","rootVisible",Lq,_d,"sortColumn",De,Pb,Qc,Qj,ts,Cf,cq,lr,ok,dm,Vh,Xd,"loader"],ms_v:1,ms_bnb:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_48o:1,_14Q:1,_45o:1,_47o:1,_sortMode:ys,_checkMode:V,_editable:!0,_batchEditable:!1,_indent:ik,_rowHeight:bk,_rowLineVisible:m.treeTableViewRowLineVisible,_rowLineColor:m.treeTableViewRowLineColor,_columnLineVisible:m.treeTableViewColumnLineVisible,_columnLineColor:m.treeTableViewColumnLineColor,_expandIcon:m.treeTableViewExpandIcon,_collapseIcon:m.treeTableViewCollapseIcon,_scrollBarColor:Dd,_scrollBarSize:Lb,_autoHideScrollBar:Uq,_autoMakeVisible:Ai,_selectBackground:m.treeTableViewSelectBackground,_labelColor:m.treeTableViewLabelColor,_labelSelectColor:m.treeTableViewLabelSelectColor,_labelFont:m.treeTableViewLabelFont,getTreeColumn:function(){return this._4o}});var gn=function(B){Hh(gn,this,[B])};Ir(gn,Bm,{_34o:function(R,Y){var $=this.list,J=$._4o,X=$._3Q(J),E=$.lp(R).x;if(X){var j=$._indent,n=X.startX+j*$.getLevel(Y);if(hs($.getToggleIcon(Y))&&E>=n&&n+j>=E)return $.toggle(Y),void 0;if($.isCellEditable(Y,J)&&(n+=j,E>=n&&n+j>=E))return $.checkData(Y),void 0}$._37O(Y,R),$.setFocusData(Y)},_33o:function(E,x){var I=this.list,p=I.lp(E).x;if(hs(I.getToggleIcon(x))){var v=I._3Q(I._4o);if(v){var Q=I._indent,Y=v.startX+Q*I.getLevel(x);if(p>=Y&&Y+Q>=p)return I.toggle(x),void 0}}I._37O(x,E),gn.superClass._33o.apply(this,arguments)}});var ao=Ui.TableHeader=function(g){var D=this,w=D._view=np(1,D),R=D._39o=g.getColumnModel(),a=D.iv;D.tv=D._tableView=g,D._60I=new Vd,D._canvas=sk(w),w.style.background=m.tableHeaderBackground||"",w.style.height=wk+Sd,R.mm(a,D),R.md(a,D),R.mh(a,D),g.mp(function(H){Fb[H.property]&&D.iv()},D),new li(D),D.iv()};yr("TableHeader",H,{ms_v:1,ms_lp:1,ms_fire:1,ms_ac:["checkIcon","sortDescIcon","sortAscIcon",Xp,tl,ag,"moveBackground","insertColor",dm,Vh,"resizable","movable"],_checkIcon:Xm,_movable:!0,_resizable:!0,_labelColor:m.tableHeaderLabelColor,_labelFont:m.tableHeaderLabelFont,_columnLineColor:m.tableHeaderColumnLineColor,_columnLineVisible:m.tableHeaderColumnLineVisible,_sortDescIcon:m.tableHeaderSortDescIcon,_sortAscIcon:m.tableHeaderSortAscIcon,_moveBackground:m.tableHeaderMoveBackground,_insertColor:m.tableHeaderInsertColor,_indent:ik,getCheckIcon:function(){return this._checkIcon},getTableView:function(){return this.tv},getLabel:function(j){return j.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(Z){return Z.getColor()||this._labelColor},getLabelAlign:function(s){return s._align},onPropertyChanged:function(){this.iv()},_5Q:function(K){this._61I=K,this.iv()},getLogicalPoint:function(s){return Gh(s,this._canvas,this.tv.tx())},validateImpl:function(){var O=this,M=O._canvas,l=O.getWidth(),N=O.getHeight(),r=O.tv,S=O._60I,t=O._61I,y=-r.tx(),i=0;(l!==M.clientWidth||N!==M.clientHeight)&&ye(M,l,N),S.clear(),O._39o._roots.each(function(d){if(d.isVisible()){var k=i+d.getWidth();y+l>=i&&k>=y&&S.add({column:d,startX:i}),i=k}});var g=Qq(M);if(dl(g,-y,0,1),g.beginPath(),g.rect(y,0,l,N),g.clip(),g.clearRect(y,0,l,N),S.each(function(u){var T=u.column,M=u.startX,_=T.getWidth();_>0&&(g.save(),g.beginPath(),g.rect(M,0,_,N),g.clip(),t&&t.column===T||O.drawColumn(g,T,M,0,_,N),O._columnLineVisible&&Qm(g,M+_-1,0,1,N,O._columnLineColor),g.restore())}),t){var J=t.column,i=t.startX,b=t.position,U=J.getWidth();g.save(),g.beginPath(),g.rect(i,0,U,N),g.clip(),g.fillStyle=O._moveBackground,g.fill(),O.drawColumn(g,J,i,0,U,N),g.restore(),Tf(g,O._insertColor,b,0,N)}g.restore()},_6Q:function(X){var B=this.tv;return B._31o===X&&B.sm().getSelectionMode()===Yr},drawColumn:function(x,H,d,W,v,R){var z=this,p=z.tv,k=hs(H.getIcon()),A=z.getLabelAlign(H);if(z._6Q(H)){var e=hs(z._checkIcon);Td(x,e,d+v/2,W+R/2,H,z)}else{var u=z.getLabel(H),f=z.getLabelFont(H),J=z.getLabelColor(H),C=hd(f,u).width,O=k?z._indent:0;A===ws?(k&&re(x,k,vl,d,W,O,R),_q(x,u,f,J,d+O,W,v,R,ws)):A===Hn?(k&&re(x,k,vl,d+v-C-O,W,O,R),_q(x,u,f,J,d,W,v,R,Hn)):(k&&re(x,k,vl,d+(v-C-O)/2,W,O,R),_q(x,u,f,J,d+(v-C+O)/2,W,0,R,ws))}if(H.isSortable()&&p.getSortColumn()===H&&(k=hs(H.getSortOrder()===ff?z._sortAscIcon:z._sortDescIcon))){var I=si(k,H)/2+2;Td(x,k,A===Hn?d+I:d+v-I,W+R/2,H,p)}}});var li=function(K){var r=this;r.th=K,r.tv=K._tableView,r.addListeners()};Ir(li,H,{ms_listener:1,getView:function(){return this.th.getView()},setCursor:function(z){this.getView().style.cursor=z},handle_mousemove:function(u){if(!bl){var a=this;delete a._29o,a.setCursor(wi);for(var v=a.th,H=v._60I,h=v.lp(u).x,B=H.size()-1;B>=0;B--){var E=H.get(B),F=E.column,d=E.startX+F.getWidth();if(v.isResizable()&&M(d-h)<=(fn?10:3))return a._29o=E,a.setCursor(bq),void 0;h>E.startX&&d>h&&(a._29o=E),(F.isClickable()||F.isSortable()||v.isMovable()||a.tv.getCheckColumn&&F===a.tv.getCheckColumn())&&h>E.startX&&d>h&&a.setCursor(Ig)}}},handle_mousedown:function(j){this.handle_touchstart(j)},handle_touchstart:function(C){var L=this;Mf(C),L.tv.endEditing(),L.handle_mousemove(C),L._29o&&(L.x=_h(C).x,L.lx=L.th.lp(C).x,L.w=L._29o.column.getWidth(),cp(L,C))},handleWindowMouseMove:function(E){this.handleWindowTouchMove(E)},handleWindowTouchMove:function(e){var q=this,U=q.th,D=q.getView().style.cursor,z=q._29o,$=_h(e).x-q.x;if(q.resizing||q.moving||(D===bq?q.resizing=1:U.isMovable()&&D===Ig&&M($)>2&&(q.moving=1)),q.resizing)z.column.setWidth(q.w+$);else if(q.moving){var j=q.lx+$;U._60I.each(function(a){var b=a.startX,P=b+a.column.getWidth();if(j>=b&&P>=j){var s={column:z.column,startX:z.startX+$,front:P-j>j-b,insertColumn:a.column};s.position=s.front?b:P,U._5Q(s)}})}},_16Q:function(i,D){var c=this,B=c.tv,d=c.th,j=d._checkIcon;if(d._6Q(i)){var t=hs(j),q=c.lx,u=i.getWidth(),y=si(t,i);if(q>=D+u/2-y&&D+u/2+y>=q){d.setCheckIcon(j===Em?Xm:Em);var h=B.sm(),v=B._rows;return j===Em?h.rs(v):h.ss(v),B.onCheckColumnClicked(i),!0}}return!1},handleWindowMouseUp:function(h){this.handleWindowTouchEnd(h)},handleWindowTouchEnd:function($){var Q=this,y=Q.tv,L=Q.th,N=Q._29o;if(Q.moving){var v=L._61I;if(v&&v.insertColumn!==v.column){var t=v.column,j=y.getColumnModel()._roots,U=j.remove(t),h=j.indexOf(v.insertColumn);h>=0&&(v.front||h++,h<=j.size()&&(j.add(t,h),y.getColumnModel()._38I(t,U,h)))}L._5Q(V),delete Q.moving}else if(!Q.resizing&&N){t=N.column;var m=L.lp($).x,_=N.startX,H=!0;if(L.onColumnClicked){var J=L.onColumnClicked(t,$,_);J===!1&&(H=!1)}if(H&&m>=_&&m<=_+t.getWidth()&&!Q._16Q(t,_)){if(t.isSortable()){var O=y.getSortMode(),X=t.getSortOrder();O===ys?y.getSortColumn()===t?(X===sf&&y.setSortColumn(V),t.setSortOrder(X===ff?sf:ff)):y.setSortColumn(t):"bistate"===O&&(y.getSortColumn()===t?t.setSortOrder(X===ff?sf:ff):y.setSortColumn(t))}y.onColumnClicked(t,$,_)}}Q._29o=Q.resizing=Q.x=Q.lx=Q.w=V}}),Ui.TablePane=function(i){this.init(new ab(i))},yr("TablePane",H,{ms_v:1,_44o:1}),Ui.TreeTablePane=function(k){this.init(new Xg(k))},yr("TreeTablePane",H,{ms_v:1,_44o:1}),Ui.Toolbar=function(x){var g=this,o=g._view=np(1,g),z=o.style;z.background=m.toolbarBackground||"",z.height=qq+Sd,g._canvas=sk(o),g._30o=new Vd,g._90I=new Vd,g.setItems(x||[]),o.handleGroupSelectedChanged=function(C){if(C.isSelected()){var i=C.getGroupId();null!=i&&g._items.forEach(function(G){var Z=G.element;Z&&Z!==C&&Z.setSelected&&Z.getGroupId&&Z.getGroupId()===i&&Z.setSelected(!1)})}},new yi(g)},yr("Toolbar",H,{ms_v:1,ms_fire:1,ms_tx:1,ms_lp:1,ms_tip:1,ms_value:1,ms_ac:[Pc,Xp,tl,Un,Xd,"itemGap","separatorColor","currentItem","stickToRight"],_labelColor:m.toolbarLabelColor,_labelSelectColor:m.toolbarLabelSelectColor,_labelFont:m.toolbarLabelFont,_selectBackground:m.toolbarSelectBackground,_itemGap:m.toolbarItemGap,_separatorColor:m.toolbarSeparatorColor,_stickToRight:!1,getSumWidth:function(){return this._64I},getToolTip:function(y){var v=this.getItemInfoAt(y);return v?v.item.toolTip:V},getLabelColor:function(M){return M&&M.selected&&M.type!==Em&&M.type!==zf?this._labelSelectColor:this._labelColor},onPropertyChanged:function(W){this.iv(),W.property===Pc&&this._items.forEach(function(L){He(L)})},redraw:function(){this.iv()},addItem:function(D,R){var T=this._items;R==V?T.push(D):T.splice(R,0,D),this.fp(Pc,V,T)},removeItem:function(R){if(R)for(var z=this._items,c=0;c<z.length;c++)R===z[c]&&(z.splice(c,1),this.fp(Pc,V,z))},removeItemById:function(y){if(y!=V)for(var q=this._items,Q=0;Q<q.length;Q++)if(y===q[Q].id){var I=q.splice(Q,1)[0];return this.fp(Pc,V,q),I}},getItemById:function(b){if(b!=V)for(var H=this._items,M=0;M<H.length;M++){var A=H[M];if(b===A.id)return A}},setItemVisible:function(j,B){var _=this.getItemById(j);_&&(_.visible=B)},getItemInfos:function(){return this._30o},getItemInfoAt:function(u){var H=this,M=0,v=H._30o,g=H.lp(u),x=g.x,c=g.y;if(c>=0&&c<=H.getHeight())for(;M<v.size();M++){var n=v.get(M);if(n.startX<=x&&x<=n.endX)return n}return V},drawItem:function(B,t,G,U,e){if(t.visible===!1)return 0;if(fg(t.visible)&&!t.visible())return 0;var d=this,r=t.disabled;r&&(B.globalAlpha=rr);var C=d.drawItemImpl(B,t,G,U,e),j=d._itemGap;return r&&(B.globalAlpha=1),this._currentItem!==t||"separator"===t||t.separator===!0||t.unfocusable||Mh(B,d._separatorColor,G-j/2,0,C+j,U),C},drawItemImpl:function(K,i,O,N,k){var W=this,I=W._view,u=W._itemGap,f=N/2,m=i.type,X=i.element,t=i.label;Jh(X)&&(t=X,X=V);var G,L=W.getLabelFont(i),M=W.getLabelColor(i),H=i.selected,T=hs(i.icon),j=si(T,i),F=0,B=j+(t?hd(L,t).width:0);if("separator"===i||i.separator===!0)return Tf(K,W._separatorColor,O,N/4,f),1;if(X){T&&Td(K,T,O+j/2,f,i,W),_q(K,t,L,M,O+j,0,0,N);var P=Wg(X);k||W._90I.add(P),P.parentNode!==I&&Kl(I,P),X.iv&&X.iv(),X.validate&&X.validate();var l=P.getBoundingClientRect(),Z=l.width,R=P.style;return Dq(P),R.left=W.tx()+O+B+Sd,R.top=(N-l.height)/2+Sd,B+Z}return m===zf?G=hs(H?pm:jn):m===Em&&(G=hs(H?Em:Xm)),G?(F=si(G,i),Td(K,G,O+F/2,f,i,W),O+=F,B+=F):H&&Qm(K,O-u/2,0,B+u,N,W.getSelectBackground(i)),T&&Td(K,T,O+j/2,f,i,W),_q(K,t,L,M,O+j,0,0,N),B},validateImpl:function(){var o=this,W=o._canvas,v=o.getWidth(),L=o.getHeight(),O=o._30o,M=o._items;ye(W,v,L);var j=Qq(W),m=o._itemGap,l=m/2;dl(j,o.tx(),0,1),j.clearRect(0,0,v,L);var n=o._90I;o._90I=new Vd,O.clear(),M.forEach(function(J){var I=o.drawItem(j,J,l,L);O.add({item:J,startX:l,endX:l+I,width:I}),I&&(l+=I+m)}),n.each(function(r){o._90I.contains(r)||Nr(r)});var E=o._64I;o._64I=D(0,l),j.restore(),o._stickToRight?(o._65O=0,j=Qq(W),l=v-o._64I+m,dl(j,0,0,1),j.clearRect(0,0,v,L),O.clear(),M.forEach(function(J){var U=o.drawItem(j,J,l,L,!0);O.add({item:J,startX:l,endX:l+U,width:U}),U&&(l+=U+m)}),j.restore()):o.tx(o.tx()),E!==o._64I&&o.onSumWidthChanged(E,o._64I)},onSumWidthChanged:function(){},handleClick:function(J,c){var M=this,B=J.type,w=J.action,p=J.groupId,W=J.selected;J.disabled||(p!=V?W||(J.selected=!0,this._items.forEach(function(x){x.groupId===p&&J!==x&&(x.selected=!1)}),w&&J.action(J,M,c)):B===Em||"toggle"===B?(J.selected=!W,w&&J.action(J,M,c)):w&&J.action(J,M,c)),_g(),M.iv()}});var yi=function(L){this.tb=L,this.addListeners()};Ir(yi,H,{ms_listener:1,getView:function(){return this.tb._view},handle_mousewheel:function(M){this.handleScroll(M,10*(M.wheelDelta/40))},handle_DOMMouseScroll:function(j){this.handleScroll(j,10*-j.detail)},handleScroll:function(w,e){Mf(w);var p=this.tb;p.isScrollable()&&!p._stickToRight&&(p.tx(p.tx()+e),am())},handle_mousemove:function(y){var p=this;bl||p.setItem(y)},handle_mouseout:function(D){var N=this;D.target===N.getView()?N.tb.setCurrentItem(V):N.handle_mousemove(D)},handle_mousedown:function(E){this.handle_mousemove(E),this.handle_touchstart(E)},handle_touchstart:function(e){var Z=this,F=Z.tb,z=e.target;Te(e)&&(z===Z.getView()||z===F._canvas)&&(Mf(e),F.setFocus(e)&&(this.setItem(e,!0),(F.isScrollable()||Z.info&&!Z.info.item.disabled)&&(Z.x=_h(e).x,Z.tx=F.tx(),cp(Z,e))))},handleWindowMouseMove:function(i){this.handleWindowTouchMove(i)},handleWindowTouchMove:function(l){var Y=this,e=Y.tb;if(!e._stickToRight){var U=_h(l).x-Y.x;!Y._25o&&M(U)>2&&e.isScrollable()&&(Y._25o=1),Y._25o&&e.tx(Y.tx+U)}},handleWindowMouseUp:function(z){this.handleWindowTouchEnd(z)},handleWindowTouchEnd:function(S){var m=this,q=m.tb,z=m.info,L=m.tb.getItemInfoAt(S);if(!m._25o&&z){var e=z.item;L&&L.item===e&&q.handleClick(e,S)}m._25o=m.x=m.tx=V,m.setItem()},setItem:function(k,H){var R=this,X=R.tb,J=R.info=k?X.getItemInfoAt(k):V,Q=J?J.item:V;X.setCurrentItem(Q),H&&Q&&fg(Q.onDown)&&Q.onDown(k)}}),Ui.BorderPane=function(){this._view=np(1,this),this.iv()},yr("BorderPane",H,{ms_v:1,ms_ac:["topHeight","bottomHeight","leftWidth","rightWidth"],ms_fire:1,getLeftView:function(){return this._leftView},setLeftView:function(N,J){this._12o("leftView",N),J!=V&&this.setLeftWidth(J)},getRightView:function(){return this._rightView},setRightView:function(l,L){this._12o("rightView",l),L!=V&&this.setRightWidth(L)},getTopView:function(){return this._topView},setTopView:function(k,T){this._12o("topView",k),T!=V&&this.setTopHeight(T)},getBottomView:function(){return this._bottomView},setBottomView:function(L,l){this._12o("bottomView",L),l!=V&&this.setBottomHeight(l)},getCenterView:function(){return this._centerView},setCenterView:function(s){this._12o("centerView",s)},_12o:function(m,B){var j=this,$="_"+m,V=j._view,W=j[$];W!==B&&(W&&(W.getView?Nr(W.getView()):Nr(W)),j[$]=B,B&&(B.getView?Kl(V,B.getView(),1):Kl(V,B,1)),j.fp(m,W,B))},onPropertyChanged:function(){this.iv()},validateImpl:function(){var W=this,t=W._topView,y=W._bottomView,u=W._leftView,h=W._rightView,q=W._centerView,O=W.getWidth(),z=W.getHeight(),s=0,A=0,w=O,Q=z,H=0,v=0,o=0,c=0;t&&(H=W._topHeight==V?Uh(t):W._topHeight,A=H),y&&(v=W._bottomHeight==V?Uh(y):W._bottomHeight,Q=z-v),u&&(o=W._leftWidth==V?gi(u):W._leftWidth,s=o),h&&(c=W._rightWidth==V?gi(h):W._rightWidth,w=O-c);var l=D(0,w-s),S=D(0,Q-A);t&&xg(t,0,0,O,H),y&&xg(y,0,Q,O,v),u&&xg(u,0,A,o,S),h&&xg(h,w,A,c,S),q&&xg(q,s,A,l,S)}})}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);